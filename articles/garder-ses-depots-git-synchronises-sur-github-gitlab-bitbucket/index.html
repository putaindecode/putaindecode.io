<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Garder ses dépôts Git synchronisés sur GitHub, GitLab &amp; Bitbucket | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Garder ses dépôts Git synchronisés sur GitHub, GitLab &amp; Bitbucket | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Garder ses dépôts Git synchronisés sur GitHub, GitLab &amp; Bitbucket | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par MoOx" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/garder-ses-depots-git-synchronises-sur-github-gitlab-bitbucket" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(337, 100%, 35%), hsl(280, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Garder ses dépôts Git synchronisés sur GitHub, GitLab &amp; Bitbucket</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/MoOx"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="MoOx" src="https://avatars.githubusercontent.com/MoOx?size=64"/><div>MoOx<!-- --> <!-- -->•<!-- --> <!-- -->2018/10/23</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Partager du code en ligne est plutôt facile ces temps-ci.</p>
<p>Par contre garder synchronisés tous ses dépôts entre différents services, c'est
une autre histoire. Alors oui, vous trouverez des commandes et scripts assez
facilement pour importer/exporter vos dépôts. Idem pour mettre en place des
miroirs en lecture seule. Mais avoir un système transparent pour être à même de
pousser son code sur différentes plateformes, c'est un peu moins facile. Mais bon
c'est pas difficile pour autant.</p>
<p>Souvent on utilise GitHub, qui est la solution la plus répandue à ce jour, mais
en cas de grosse coupure (coucou les DDoS) ou juste car vous n'avez pas envie
d'être trop lié à GitHub (le rachat de GitHub par Microsoft vous rappelle le syndrome Skype ?)
vous aimeriez bien avoir des
miroirs accessibles en écriture.</p>
<p><strong>Voici donc une petite astuce pour garder vos dépôts synchro entre plusieurs
plateformes</strong> comme GitLab et Bitbucket, où vous pourrez pousser et récupérer du
code sans effort particulier, après un petit coup d'init. Donc pas de miroir en
lecture seule hein. De vrais dépôts. Et ça <strong>juste en utilisant les
fonctionnalités de git (push et pull)</strong>.</p>
<p><em>Rappel : pour rester sécurisé, mettez en place SSH et l'authentification à deux
facteurs (2FA) sur les plateformes que vous utilisez (sauf Bitbucket, car ça ne
marche pas avec leur outil CLI).</em></p>
<h2>Git Tooling</h2>
<p>Pour rendre le tout facile, on va s'installer quelques outils vite fait.</p>
<h3>Github</h3>
<p>On va utiliser <a href="https://github.com/github/hub">hub</a>.</p>
<p>Pour macOS</p>
<pre><code class="hljs language-console">brew install hub
</code></pre>
<p>Voir
<a href="https://github.com/github/hub#installation">les instructions d'installation hub</a>
pour les autres OS.</p>
<p>Il vous faudra un <a href="https://github.com/settings/tokens/new">token GitHub</a>.</p>
<p>Mettez-le dans votre dossier home (~) dans un fichier <code>.github_token</code>, et
chargez-le dans votre <code>.bash/zshrc</code> comme ça :</p>
<pre><code class="hljs language-sh"><span class="hljs-keyword">if</span> [[ -f <span class="hljs-variable">$HOME</span>/.github_token ]]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">export</span> GITHUB_TOKEN=$(cat <span class="hljs-variable">$HOME</span>/.github_token)
<span class="hljs-keyword">fi</span>
</code></pre>
<h3>GitLab</h3>
<p><a href="http://narkoz.github.io/gitlab/cli">GitLab CLI</a> est disponible en
<a href="https://rubygems.org/">rubygem</a> :</p>
<pre><code class="hljs language-console">gem install gitlab
</code></pre>
<p>(Vous aurez peut-être besoin de <code>sudo gem install</code> si vous utilisez la version
macOS de ruby.)</p>
<h4><code>Please set an endpoint to API</code></h4>
<p>GitLab nécessite un token ainsi qu'un endpoint (car GitLab peut être déployé
n'importe où).</p>
<p>Pour le token, <a href="https://gitlab.com/profile/account">récupérez le votre</a> et
faites comme pour GitHub. Voici un example avec l'instance GitLab.com que vous
pouvez placer dans votre <code>.bash/zshrc</code>:</p>
<pre><code class="hljs language-sh"><span class="hljs-keyword">if</span> [[ -f <span class="hljs-variable">$HOME</span>/.gitlab_token ]]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">export</span> GITLAB_API_PRIVATE_TOKEN=$(cat <span class="hljs-variable">$HOME</span>/.gitlab_token)
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">export</span> GITLAB_API_ENDPOINT=<span class="hljs-string">&quot;https://gitlab.com/api/v3&quot;</span>
</code></pre>
<h3>Bitbucket</h3>
<p>Le <a href="https://bitbucket.org/zhemao/bitbucket-cli">CLI Bitbucket</a> est disponible
via <a href="https://pip.pypa.io/en/stable/">pip</a> :</p>
<pre><code class="hljs language-sh">pip install bitbucket-cli
</code></pre>
<p>(Vous aurez peut-être besoin de <code>sudo pip install</code> si vous utilisez la version
macOS de Python.)</p>
<p>BitBucket ne fonctionne pas bien avec un token et la 2FA n'est pas pratique (et
accessoirement
<a href="https://bitbucket.org/zhemao/bitbucket-cli/issues/25/create-issue-ssh-not-taken-in">est impossible à utiliser en ssh</a>).
Il faudra faire avec login/mot de passe à chaque fois, à moins que
<a href="https://bitbucket.org/zhemao/bitbucket-cli#markdown-header-configuration">vous mettiez en clair votre mot de passe dans un fichier</a>.</p>
<hr />
<p>Maintenant qu'on a les outils, on va créér des dépôts sur chaque plateforme.</p>
<h2>Créér des dépôts sur GitHub, GitLab &amp; Bitbucket en CLI</h2>
<p>Les commandes ci-dessous assument que votre nom d'utilisateur est le même sur
chaque service. Si ce n'est pas le cas, pensez à ajuster les commandes.</p>
<p>Nous allons créer/réutiliser un dossier, initialiser un dépôt si ce n'est pas
le cas, et le mettre en ligne sur chaque service.</p>
<h3>Votre dépôt git existe</h3>
<p>On va partir du principe que le nom du dossier est le nom du projet.</p>
<p>Ouvrez un terminal et faites :</p>
<pre><code class="hljs language-console">export GIT_USER_NAME=$USER
export GIT_REPO_NAME=$(basename $(pwd))
</code></pre>
<p>Ajustez les variables si cela ne correspond pas à ce que nous assumons ici.</p>
<h3>Vous n'avez pas encore de dépôt</h3>
<pre><code class="hljs language-console">export GIT_USER_NAME=$USER
export GIT_REPO_NAME=&quot;your-repo&quot;
mkdir $GIT_REPO_NAME &amp;&amp; cd $GIT_REPO_NAME
git init
</code></pre>
<h3>Créer un dépôt sur GitHub en ligne de commande</h3>
<pre><code class="hljs language-console">hub create
</code></pre>
<p>Cette commande va créer le dépôt et initialiser les remotes.</p>
<h3>Créer un dépôt sur GitLab en ligne de commande</h3>
<pre><code class="hljs language-console">gitlab create_project $GIT_REPO_NAME &quot;{visibility_level: 20}&quot;
</code></pre>
<p>(Visibilité publique). <a href="http://stackoverflow.com/a/31338095/988941">Source</a></p>
<p>Nous ajouterons la remote plus tard, cela fait partie de l'astuce. ;)</p>
<h3>Créer un dépôt sur Bitbucket en ligne de commande</h3>
<pre><code class="hljs language-console">bb create --protocol=ssh --scm=git --public $GIT_REPO_NAME
</code></pre>
<p><a href="http://stackoverflow.com/a/12795747/988941">Source</a></p>
<h2>Configurer les remotes</h2>
<p>En fonction de ce que vous voulez, vous pouvez configurer votre dépôt de
plusieurs manières.</p>
<p>Pour un dépôt principal et des miroirs, vous pouvez commencer par</p>
<pre><code class="hljs language-console">git remote set-url origin --add https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
git remote set-url origin --add https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
</code></pre>
<p>Vérifiez que les commandes sont bonnes en faisant :</p>
<pre><code class="hljs language-console">git remote -v
</code></pre>
<p>Ça devrait vous donner un truc du genre :</p>
<pre><code>origin  https://github.com/YOU/YOUR-REPO.git (fetch)
origin  https://github.com/YOU/YOUR-REPO.git (push)
origin  https://gitlab.com/YOU/YOUR-REPO.git (push)
origin  https://bitbucket.org/YOU/YOUR-REPO.git (push)
</code></pre>
<p>Et maintenant vous pouvez faire <code>git push</code> et ça poussera sur tous les dépôts
🙂.</p>
<hr />
<p>⚠️ <strong>Note : pour forcer SSH à la place de HTTPS, petite astuce :</strong></p>
<pre><code class="hljs language-console">git config --global url.ssh://git@github.com/.insteadOf https://github.com/
git config --global url.ssh://git@gitlab.com/.insteadOf https://gitlab.com/
git config --global url.ssh://git@bitbucket.org/.insteadOf https://bitbucket.org/
</code></pre>
<h3>Petit souci, <code>git pull</code> ne va prendre que les commits sur la first remote.</h3>
<p>Il y a même une incohérence entre <code>git push --all</code> (pousser toutes les branches
sur toutes les remotes) et <code>git pull --all</code> (récupérer toutes les branches
depuis la première remote).</p>
<p><a href="https://astrofloyd.wordpress.com/2015/05/05/git-pushing-to-and-pulling-from-multiple-remote-locations-remote-url-and-pushurl/">Vous trouverez plus d'infos sur comment configurer votre dépôt pour pouvoir push/pull depuis toutes les sources</a>.</p>
<p><em>en gros : on va ajouter d'autres remotes pour pouvoir pull facilement.</em></p>
<pre><code class="hljs language-console">git remote add origin-gitlab https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
git remote add origin-bitbucket https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
</code></pre>
<p>Vérifiez que les commandes sont bonnes en faisant :</p>
<pre><code class="hljs language-console">git remote -v
</code></pre>
<p>Cela devrait vous donner un truc du genre :</p>
<pre><code>origin  ssh://git@github.com/YOU/YOUR-REPO.git (fetch)
origin  ssh://git@github.com/YOU/YOUR-REPO.git (push)
origin  ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)
origin  ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)
origin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (fetch)
origin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)
origin-bitbucket    ssh://git@bitbucket.org/YOU/YOUR-REPO.git (fetch)
origin-bitbucket    ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)
</code></pre>
<p>Maintenant vous pourrez <code>git push</code> pour pousser sur toutes les remotes, puis
faire <code>git pull --all</code> pour récupérer de toutes les remotes.</p>
<p><strong>L'astuce à 2 centimes : faites un alias pour <code>pull --all</code>.</strong></p>
<p>Si vous n'avez qu'une remote sur un projet, ça ne changera rien, mais
ça fonctionnera si vous en avez plus d'une.</p>
<p>Dans votre <code>.gitconfig</code> :</p>
<pre><code class="hljs language-ini"><span class="hljs-attr">g</span> = pull --all
<span class="hljs-attr">p</span> = push
</code></pre>
<p>Et maintenant vous pouvez utiliser <code>git g</code> pour pull et <code>git p</code> pour push.</p>
<h3>Pull depuis plusieurs remotes avec des commits différents</h3>
<p>Un petit edge case peut se révéler problématique : une PR mergée sur GitHub et une
sur GitLab, à peu près en même temps. Vous allez pouvoir récupérer tout ça
facilement (pour peu que vous utilisiez
<a href="https://github.com/MoOx/setup/blob/60ec182707168e4cf9ffcb2d0351dc0ce2eac7ed/dotfiles/.gitconfig#L30-L31"><code>pull --rebase</code> par défaut</a>)
mais quand vous allez vouloir pousser, sans force push, ça va avoir du mal.</p>
<p>C'est le seul petit cas problématique. Si vous faites attention quand vous
acceptez des PR/MR, vous ne devriez pas le rencontrer souvent.</p>
<h4>Note à propos des force push</h4>
<p>Si vous rencontrez ce cas et que vous voulez force push pour arranger le tout,
faites attention que votre branche (coucou master) ne soit pas protégée durant
cette manipulation.</p>
<h6>GitHub</h6>
<pre><code>https://github.com/${GIT_USER_NAME}/${GIT_REPO_NAME}/settings/branches
</code></pre>
<h5>GitLab</h5>
<pre><code>https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}/protected_branches
</code></pre>
<p>GitLab protège la branche master <strong>par défaut</strong>. Donc si vous ne changez rien, vous
ne pourrez pas force push.</p>
<p>Souvent quand je commence un projet j'ai tendance à faire un petit force push
sur le premier commit, le temps de faire passer la CI par exemple. Ne me jugez
pas. <strong>Vous voilà prévenus</strong>.</p>
<h2>Pour les dépôts GitHub existant</h2>
<p>Je n'ai pas trouvé de moyen automatisé d'appliquer cette technique pour tous mes
dêpots d'un coup. Du coup je fais ça petit à petit quand je bosse sur un projet
qui n'est pas encore &quot;redondé&quot;. J'utilise cette article en guise de mémo.</p>
<p>Vous pourrez éventuellement être intéressés par ces posts</p>
<ul>
<li><a href="https://pypi.python.org/pypi/github2gitlab">https://pypi.python.org/pypi/github2gitlab</a></li>
<li><a href="https://github.com/xuhdev/backup-on-the-go">https://github.com/xuhdev/backup-on-the-go</a></li>
</ul>
<h2>FAQ</h2>
<h3>Gérer les issues et PR/MR</h3>
<p>Je n'ai pas de silver-bullet pour ça. Pour l'instant j'utilise un dépôt, souvent
GitHub en principal, et les autres ne sont que des copies sans issues… Mais
bon, en cas de licorne rose (GitHub down), j'ai l'air moins con ! C'est toute l'idée de cette
approche, même si elle est perfectible : ne pas être bloqué par un service.</p>
<h3>Faire un commit depuis l'UI Web</h3>
<p>Pas un soucis, faut juste y penser. Et la prochaine fois que vous avez votre CLI
en main, pull + push et tout sera en ordre.</p>
<hr />
<h2>tl;dr</h2>
<p><strong>La première fois</strong> installez quelques dépendances :</p>
<pre><code class="hljs language-console">brew install hub
gem install gitlab
pip install bitbucket-cli
</code></pre>
<p>Note : soyez sûrs d'avoir les bons tokens en tant que variable d'environnement ;
voir au début de ce post pour les détails.</p>
<p>(Pensez aussi à configurer un alias git pour <code>pull --all</code> si vous voulez pull
toutes les remotes par défaut.)</p>
<h3>Pour chaque dépôt :</h3>
<ol>
<li>exportez votre nom d'utilisateur (j'assume que vous ayez le même sur chaque
plateforme)</li>
</ol>
<pre><code class="hljs language-console">export GIT_USER_NAME=$USER
</code></pre>
<ol start="2">
<li>Pour les nouveaux dépôts (si votre dépôt existe déjà sur GitHub, sautez
cette étape)</li>
</ol>
<pre><code class="hljs language-console">export GIT_REPO_NAME=your-repo
mkdir $GIT_REPO_NAME &amp;&amp; cd $GIT_REPO_NAME
git init
hub create
</code></pre>
<ol start="3">
<li>Pour les dépôts existants sur GitHub</li>
</ol>
<pre><code class="hljs language-console">export GIT_REPO_NAME=$(basename $(pwd))
gitlab create_project $GIT_REPO_NAME &quot;{visibility_level: 20}&quot;
bb create --protocol=ssh --scm=git --public $GIT_REPO_NAME
</code></pre>
<p>Ensuite, on ajoute les remotes</p>
<pre><code>git remote set-url origin --add https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
git remote set-url origin --add https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
git remote add origin-gitlab https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
git remote add origin-bitbucket https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git
</code></pre>
<ol start="4">
<li>Puis on check que tout va bien</li>
</ol>
<pre><code class="hljs language-console">git remote -v
</code></pre>
<p>Vous devriez avoir un truc du genre</p>
<pre><code>origin  ssh://git@github.com/YOU/YOUR-REPO.git (fetch)
origin  ssh://git@github.com/YOU/YOUR-REPO.git (push)
origin  ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)
origin  ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)
origin-bitbucket        ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)
origin-bitbucket        ssh://git@bitbucket.org/YOU/YOUR-REPO.git (fetch)
origin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (fetch)
origin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)
</code></pre>
<p>😇 Maintenant vous n'avez plus qu'à <code>git push</code> et <code>git pull --all</code> !</p>
<h2>Bonus : badges</h2>
<p>Vous pouvez ajouter des petits badges pour exposer la redondance sur la
documentation de votre projet.</p>
<pre><code class="hljs language-markdown">[<span class="hljs-string">![Repo on GitHub</span>](<span class="hljs-link">https://img.shields.io/badge/repo-GitHub-3D76C2.svg</span>)](<span class="hljs-link">https://github.com/YOU/YOUR-REPO</span>)
[<span class="hljs-string">![Repo on GitLab</span>](<span class="hljs-link">https://img.shields.io/badge/repo-GitLab-6C488A.svg</span>)](<span class="hljs-link">https://gitlab.com/YOU/YOUR-REPO</span>)
[<span class="hljs-string">![Repo on Bitbucket</span>](<span class="hljs-link">https://img.shields.io/badge/repo-BitBucket-1F5081.svg</span>)](<span class="hljs-link">https://bitbucket.org/YOU/YOUR-REPO</span>)
</code></pre>
<p><strong>Ajustez <code>YOU/YOUR-REPO</code> à votre besoin</strong>.</p>
<p>Ça ressemblera à ça</p>
<p><a href="https://github.com/YOU/YOUR-REPO"><img src="https://img.shields.io/badge/repo-GitHub-3D76C2.svg" alt="Repo on GitHub" /></a>
<a href="https://gitlab.com/YOU/YOUR-REPO"><img src="https://img.shields.io/badge/repo-GitLab-6C488A.svg" alt="Repo on GitLab" /></a>
<a href="https://bitbucket.org/YOU/YOUR-REPO"><img src="https://img.shields.io/badge/repo-BitBucket-1F5081.svg" alt="Repo on Bitbucket" /></a></p>
<p>J'ai mis en ligne
<a href="https://github.com/MoOx/git-init">ces instructions résumées sur un dépôt</a>, peut-être
en ferais-je un script, qui sait… 😄. Enfin trois dépôts !</p>
<ul>
<li><a href="https://github.com/MoOx/git-init">https://github.com/MoOx/git-init</a></li>
<li><a href="https://gitlab.com/MoOx/git-init">https://gitlab.com/MoOx/git-init</a></li>
<li><a href="https://bitbucket.org/MoOx/git-init">https://bitbucket.org/MoOx/git-init</a></li>
</ul>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Garder%20ses%20d%C3%A9p%C3%B4ts%20Git%20synchronis%C3%A9s%20sur%20GitHub%2C%20GitLab%20%26%20Bitbucket%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fgarder-ses-depots-git-synchronises-sur-github-gitlab-bitbucket" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"garder-ses-depots-git-synchronises-sur-github-gitlab-bitbucket","v":{"_0":{"TAG":0,"_0":{"slug":"garder-ses-depots-git-synchronises-sur-github-gitlab-bitbucket","filename":"2018-10-23-garder-ses-depots-git-synchronises-sur-github-gitlab-bitbucket","title":"Garder ses dépôts Git synchronisés sur GitHub, GitLab & Bitbucket","date":"Tue, 23 Oct 2018 00:00:00 GMT","draft":false,"meta":{"date":"2018-10-23T00:00:00.000Z","title":"Garder ses dépôts Git synchronisés sur GitHub, GitLab & Bitbucket","author":"MoOx","oldSlug":"git/synchroniser-sans-effort-ses-depots-git-entre-github-gitlab-bitbucket","slug":"garder-ses-depots-git-synchronises-sur-github-gitlab-bitbucket","original":"https://moox.io/blog/keep-in-sync-git-repos-on-github-gitlab-bitbucket/"},"body":"<p>Partager du code en ligne est plutôt facile ces temps-ci.</p>\n<p>Par contre garder synchronisés tous ses dépôts entre différents services, c'est\nune autre histoire. Alors oui, vous trouverez des commandes et scripts assez\nfacilement pour importer/exporter vos dépôts. Idem pour mettre en place des\nmiroirs en lecture seule. Mais avoir un système transparent pour être à même de\npousser son code sur différentes plateformes, c'est un peu moins facile. Mais bon\nc'est pas difficile pour autant.</p>\n<p>Souvent on utilise GitHub, qui est la solution la plus répandue à ce jour, mais\nen cas de grosse coupure (coucou les DDoS) ou juste car vous n'avez pas envie\nd'être trop lié à GitHub (le rachat de GitHub par Microsoft vous rappelle le syndrome Skype ?)\nvous aimeriez bien avoir des\nmiroirs accessibles en écriture.</p>\n<p><strong>Voici donc une petite astuce pour garder vos dépôts synchro entre plusieurs\nplateformes</strong> comme GitLab et Bitbucket, où vous pourrez pousser et récupérer du\ncode sans effort particulier, après un petit coup d'init. Donc pas de miroir en\nlecture seule hein. De vrais dépôts. Et ça <strong>juste en utilisant les\nfonctionnalités de git (push et pull)</strong>.</p>\n<p><em>Rappel : pour rester sécurisé, mettez en place SSH et l'authentification à deux\nfacteurs (2FA) sur les plateformes que vous utilisez (sauf Bitbucket, car ça ne\nmarche pas avec leur outil CLI).</em></p>\n<h2>Git Tooling</h2>\n<p>Pour rendre le tout facile, on va s'installer quelques outils vite fait.</p>\n<h3>Github</h3>\n<p>On va utiliser <a href=\"https://github.com/github/hub\">hub</a>.</p>\n<p>Pour macOS</p>\n<pre><code class=\"hljs language-console\">brew install hub\n</code></pre>\n<p>Voir\n<a href=\"https://github.com/github/hub#installation\">les instructions d'installation hub</a>\npour les autres OS.</p>\n<p>Il vous faudra un <a href=\"https://github.com/settings/tokens/new\">token GitHub</a>.</p>\n<p>Mettez-le dans votre dossier home (~) dans un fichier <code>.github_token</code>, et\nchargez-le dans votre <code>.bash/zshrc</code> comme ça :</p>\n<pre><code class=\"hljs language-sh\"><span class=\"hljs-keyword\">if</span> [[ -f <span class=\"hljs-variable\">$HOME</span>/.github_token ]]\n<span class=\"hljs-keyword\">then</span>\n  <span class=\"hljs-built_in\">export</span> GITHUB_TOKEN=$(cat <span class=\"hljs-variable\">$HOME</span>/.github_token)\n<span class=\"hljs-keyword\">fi</span>\n</code></pre>\n<h3>GitLab</h3>\n<p><a href=\"http://narkoz.github.io/gitlab/cli\">GitLab CLI</a> est disponible en\n<a href=\"https://rubygems.org/\">rubygem</a> :</p>\n<pre><code class=\"hljs language-console\">gem install gitlab\n</code></pre>\n<p>(Vous aurez peut-être besoin de <code>sudo gem install</code> si vous utilisez la version\nmacOS de ruby.)</p>\n<h4><code>Please set an endpoint to API</code></h4>\n<p>GitLab nécessite un token ainsi qu'un endpoint (car GitLab peut être déployé\nn'importe où).</p>\n<p>Pour le token, <a href=\"https://gitlab.com/profile/account\">récupérez le votre</a> et\nfaites comme pour GitHub. Voici un example avec l'instance GitLab.com que vous\npouvez placer dans votre <code>.bash/zshrc</code>:</p>\n<pre><code class=\"hljs language-sh\"><span class=\"hljs-keyword\">if</span> [[ -f <span class=\"hljs-variable\">$HOME</span>/.gitlab_token ]]\n<span class=\"hljs-keyword\">then</span>\n  <span class=\"hljs-built_in\">export</span> GITLAB_API_PRIVATE_TOKEN=$(cat <span class=\"hljs-variable\">$HOME</span>/.gitlab_token)\n<span class=\"hljs-keyword\">fi</span>\n<span class=\"hljs-built_in\">export</span> GITLAB_API_ENDPOINT=<span class=\"hljs-string\">&quot;https://gitlab.com/api/v3&quot;</span>\n</code></pre>\n<h3>Bitbucket</h3>\n<p>Le <a href=\"https://bitbucket.org/zhemao/bitbucket-cli\">CLI Bitbucket</a> est disponible\nvia <a href=\"https://pip.pypa.io/en/stable/\">pip</a> :</p>\n<pre><code class=\"hljs language-sh\">pip install bitbucket-cli\n</code></pre>\n<p>(Vous aurez peut-être besoin de <code>sudo pip install</code> si vous utilisez la version\nmacOS de Python.)</p>\n<p>BitBucket ne fonctionne pas bien avec un token et la 2FA n'est pas pratique (et\naccessoirement\n<a href=\"https://bitbucket.org/zhemao/bitbucket-cli/issues/25/create-issue-ssh-not-taken-in\">est impossible à utiliser en ssh</a>).\nIl faudra faire avec login/mot de passe à chaque fois, à moins que\n<a href=\"https://bitbucket.org/zhemao/bitbucket-cli#markdown-header-configuration\">vous mettiez en clair votre mot de passe dans un fichier</a>.</p>\n<hr />\n<p>Maintenant qu'on a les outils, on va créér des dépôts sur chaque plateforme.</p>\n<h2>Créér des dépôts sur GitHub, GitLab &amp; Bitbucket en CLI</h2>\n<p>Les commandes ci-dessous assument que votre nom d'utilisateur est le même sur\nchaque service. Si ce n'est pas le cas, pensez à ajuster les commandes.</p>\n<p>Nous allons créer/réutiliser un dossier, initialiser un dépôt si ce n'est pas\nle cas, et le mettre en ligne sur chaque service.</p>\n<h3>Votre dépôt git existe</h3>\n<p>On va partir du principe que le nom du dossier est le nom du projet.</p>\n<p>Ouvrez un terminal et faites :</p>\n<pre><code class=\"hljs language-console\">export GIT_USER_NAME=$USER\nexport GIT_REPO_NAME=$(basename $(pwd))\n</code></pre>\n<p>Ajustez les variables si cela ne correspond pas à ce que nous assumons ici.</p>\n<h3>Vous n'avez pas encore de dépôt</h3>\n<pre><code class=\"hljs language-console\">export GIT_USER_NAME=$USER\nexport GIT_REPO_NAME=&quot;your-repo&quot;\nmkdir $GIT_REPO_NAME &amp;&amp; cd $GIT_REPO_NAME\ngit init\n</code></pre>\n<h3>Créer un dépôt sur GitHub en ligne de commande</h3>\n<pre><code class=\"hljs language-console\">hub create\n</code></pre>\n<p>Cette commande va créer le dépôt et initialiser les remotes.</p>\n<h3>Créer un dépôt sur GitLab en ligne de commande</h3>\n<pre><code class=\"hljs language-console\">gitlab create_project $GIT_REPO_NAME &quot;{visibility_level: 20}&quot;\n</code></pre>\n<p>(Visibilité publique). <a href=\"http://stackoverflow.com/a/31338095/988941\">Source</a></p>\n<p>Nous ajouterons la remote plus tard, cela fait partie de l'astuce. ;)</p>\n<h3>Créer un dépôt sur Bitbucket en ligne de commande</h3>\n<pre><code class=\"hljs language-console\">bb create --protocol=ssh --scm=git --public $GIT_REPO_NAME\n</code></pre>\n<p><a href=\"http://stackoverflow.com/a/12795747/988941\">Source</a></p>\n<h2>Configurer les remotes</h2>\n<p>En fonction de ce que vous voulez, vous pouvez configurer votre dépôt de\nplusieurs manières.</p>\n<p>Pour un dépôt principal et des miroirs, vous pouvez commencer par</p>\n<pre><code class=\"hljs language-console\">git remote set-url origin --add https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\ngit remote set-url origin --add https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\n</code></pre>\n<p>Vérifiez que les commandes sont bonnes en faisant :</p>\n<pre><code class=\"hljs language-console\">git remote -v\n</code></pre>\n<p>Ça devrait vous donner un truc du genre :</p>\n<pre><code>origin  https://github.com/YOU/YOUR-REPO.git (fetch)\norigin  https://github.com/YOU/YOUR-REPO.git (push)\norigin  https://gitlab.com/YOU/YOUR-REPO.git (push)\norigin  https://bitbucket.org/YOU/YOUR-REPO.git (push)\n</code></pre>\n<p>Et maintenant vous pouvez faire <code>git push</code> et ça poussera sur tous les dépôts\n🙂.</p>\n<hr />\n<p>⚠️ <strong>Note : pour forcer SSH à la place de HTTPS, petite astuce :</strong></p>\n<pre><code class=\"hljs language-console\">git config --global url.ssh://git@github.com/.insteadOf https://github.com/\ngit config --global url.ssh://git@gitlab.com/.insteadOf https://gitlab.com/\ngit config --global url.ssh://git@bitbucket.org/.insteadOf https://bitbucket.org/\n</code></pre>\n<h3>Petit souci, <code>git pull</code> ne va prendre que les commits sur la first remote.</h3>\n<p>Il y a même une incohérence entre <code>git push --all</code> (pousser toutes les branches\nsur toutes les remotes) et <code>git pull --all</code> (récupérer toutes les branches\ndepuis la première remote).</p>\n<p><a href=\"https://astrofloyd.wordpress.com/2015/05/05/git-pushing-to-and-pulling-from-multiple-remote-locations-remote-url-and-pushurl/\">Vous trouverez plus d'infos sur comment configurer votre dépôt pour pouvoir push/pull depuis toutes les sources</a>.</p>\n<p><em>en gros : on va ajouter d'autres remotes pour pouvoir pull facilement.</em></p>\n<pre><code class=\"hljs language-console\">git remote add origin-gitlab https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\ngit remote add origin-bitbucket https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\n</code></pre>\n<p>Vérifiez que les commandes sont bonnes en faisant :</p>\n<pre><code class=\"hljs language-console\">git remote -v\n</code></pre>\n<p>Cela devrait vous donner un truc du genre :</p>\n<pre><code>origin  ssh://git@github.com/YOU/YOUR-REPO.git (fetch)\norigin  ssh://git@github.com/YOU/YOUR-REPO.git (push)\norigin  ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)\norigin  ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)\norigin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (fetch)\norigin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)\norigin-bitbucket    ssh://git@bitbucket.org/YOU/YOUR-REPO.git (fetch)\norigin-bitbucket    ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)\n</code></pre>\n<p>Maintenant vous pourrez <code>git push</code> pour pousser sur toutes les remotes, puis\nfaire <code>git pull --all</code> pour récupérer de toutes les remotes.</p>\n<p><strong>L'astuce à 2 centimes : faites un alias pour <code>pull --all</code>.</strong></p>\n<p>Si vous n'avez qu'une remote sur un projet, ça ne changera rien, mais\nça fonctionnera si vous en avez plus d'une.</p>\n<p>Dans votre <code>.gitconfig</code> :</p>\n<pre><code class=\"hljs language-ini\"><span class=\"hljs-attr\">g</span> = pull --all\n<span class=\"hljs-attr\">p</span> = push\n</code></pre>\n<p>Et maintenant vous pouvez utiliser <code>git g</code> pour pull et <code>git p</code> pour push.</p>\n<h3>Pull depuis plusieurs remotes avec des commits différents</h3>\n<p>Un petit edge case peut se révéler problématique : une PR mergée sur GitHub et une\nsur GitLab, à peu près en même temps. Vous allez pouvoir récupérer tout ça\nfacilement (pour peu que vous utilisiez\n<a href=\"https://github.com/MoOx/setup/blob/60ec182707168e4cf9ffcb2d0351dc0ce2eac7ed/dotfiles/.gitconfig#L30-L31\"><code>pull --rebase</code> par défaut</a>)\nmais quand vous allez vouloir pousser, sans force push, ça va avoir du mal.</p>\n<p>C'est le seul petit cas problématique. Si vous faites attention quand vous\nacceptez des PR/MR, vous ne devriez pas le rencontrer souvent.</p>\n<h4>Note à propos des force push</h4>\n<p>Si vous rencontrez ce cas et que vous voulez force push pour arranger le tout,\nfaites attention que votre branche (coucou master) ne soit pas protégée durant\ncette manipulation.</p>\n<h6>GitHub</h6>\n<pre><code>https://github.com/${GIT_USER_NAME}/${GIT_REPO_NAME}/settings/branches\n</code></pre>\n<h5>GitLab</h5>\n<pre><code>https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}/protected_branches\n</code></pre>\n<p>GitLab protège la branche master <strong>par défaut</strong>. Donc si vous ne changez rien, vous\nne pourrez pas force push.</p>\n<p>Souvent quand je commence un projet j'ai tendance à faire un petit force push\nsur le premier commit, le temps de faire passer la CI par exemple. Ne me jugez\npas. <strong>Vous voilà prévenus</strong>.</p>\n<h2>Pour les dépôts GitHub existant</h2>\n<p>Je n'ai pas trouvé de moyen automatisé d'appliquer cette technique pour tous mes\ndêpots d'un coup. Du coup je fais ça petit à petit quand je bosse sur un projet\nqui n'est pas encore &quot;redondé&quot;. J'utilise cette article en guise de mémo.</p>\n<p>Vous pourrez éventuellement être intéressés par ces posts</p>\n<ul>\n<li><a href=\"https://pypi.python.org/pypi/github2gitlab\">https://pypi.python.org/pypi/github2gitlab</a></li>\n<li><a href=\"https://github.com/xuhdev/backup-on-the-go\">https://github.com/xuhdev/backup-on-the-go</a></li>\n</ul>\n<h2>FAQ</h2>\n<h3>Gérer les issues et PR/MR</h3>\n<p>Je n'ai pas de silver-bullet pour ça. Pour l'instant j'utilise un dépôt, souvent\nGitHub en principal, et les autres ne sont que des copies sans issues… Mais\nbon, en cas de licorne rose (GitHub down), j'ai l'air moins con ! C'est toute l'idée de cette\napproche, même si elle est perfectible : ne pas être bloqué par un service.</p>\n<h3>Faire un commit depuis l'UI Web</h3>\n<p>Pas un soucis, faut juste y penser. Et la prochaine fois que vous avez votre CLI\nen main, pull + push et tout sera en ordre.</p>\n<hr />\n<h2>tl;dr</h2>\n<p><strong>La première fois</strong> installez quelques dépendances :</p>\n<pre><code class=\"hljs language-console\">brew install hub\ngem install gitlab\npip install bitbucket-cli\n</code></pre>\n<p>Note : soyez sûrs d'avoir les bons tokens en tant que variable d'environnement ;\nvoir au début de ce post pour les détails.</p>\n<p>(Pensez aussi à configurer un alias git pour <code>pull --all</code> si vous voulez pull\ntoutes les remotes par défaut.)</p>\n<h3>Pour chaque dépôt :</h3>\n<ol>\n<li>exportez votre nom d'utilisateur (j'assume que vous ayez le même sur chaque\nplateforme)</li>\n</ol>\n<pre><code class=\"hljs language-console\">export GIT_USER_NAME=$USER\n</code></pre>\n<ol start=\"2\">\n<li>Pour les nouveaux dépôts (si votre dépôt existe déjà sur GitHub, sautez\ncette étape)</li>\n</ol>\n<pre><code class=\"hljs language-console\">export GIT_REPO_NAME=your-repo\nmkdir $GIT_REPO_NAME &amp;&amp; cd $GIT_REPO_NAME\ngit init\nhub create\n</code></pre>\n<ol start=\"3\">\n<li>Pour les dépôts existants sur GitHub</li>\n</ol>\n<pre><code class=\"hljs language-console\">export GIT_REPO_NAME=$(basename $(pwd))\ngitlab create_project $GIT_REPO_NAME &quot;{visibility_level: 20}&quot;\nbb create --protocol=ssh --scm=git --public $GIT_REPO_NAME\n</code></pre>\n<p>Ensuite, on ajoute les remotes</p>\n<pre><code>git remote set-url origin --add https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\ngit remote set-url origin --add https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\ngit remote add origin-gitlab https://gitlab.com/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\ngit remote add origin-bitbucket https://bitbucket.org/${GIT_USER_NAME}/${GIT_REPO_NAME}.git\n</code></pre>\n<ol start=\"4\">\n<li>Puis on check que tout va bien</li>\n</ol>\n<pre><code class=\"hljs language-console\">git remote -v\n</code></pre>\n<p>Vous devriez avoir un truc du genre</p>\n<pre><code>origin  ssh://git@github.com/YOU/YOUR-REPO.git (fetch)\norigin  ssh://git@github.com/YOU/YOUR-REPO.git (push)\norigin  ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)\norigin  ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)\norigin-bitbucket        ssh://git@bitbucket.org/YOU/YOUR-REPO.git (push)\norigin-bitbucket        ssh://git@bitbucket.org/YOU/YOUR-REPO.git (fetch)\norigin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (fetch)\norigin-gitlab   ssh://git@gitlab.com/YOU/YOUR-REPO.git (push)\n</code></pre>\n<p>😇 Maintenant vous n'avez plus qu'à <code>git push</code> et <code>git pull --all</code> !</p>\n<h2>Bonus : badges</h2>\n<p>Vous pouvez ajouter des petits badges pour exposer la redondance sur la\ndocumentation de votre projet.</p>\n<pre><code class=\"hljs language-markdown\">[<span class=\"hljs-string\">![Repo on GitHub</span>](<span class=\"hljs-link\">https://img.shields.io/badge/repo-GitHub-3D76C2.svg</span>)](<span class=\"hljs-link\">https://github.com/YOU/YOUR-REPO</span>)\n[<span class=\"hljs-string\">![Repo on GitLab</span>](<span class=\"hljs-link\">https://img.shields.io/badge/repo-GitLab-6C488A.svg</span>)](<span class=\"hljs-link\">https://gitlab.com/YOU/YOUR-REPO</span>)\n[<span class=\"hljs-string\">![Repo on Bitbucket</span>](<span class=\"hljs-link\">https://img.shields.io/badge/repo-BitBucket-1F5081.svg</span>)](<span class=\"hljs-link\">https://bitbucket.org/YOU/YOUR-REPO</span>)\n</code></pre>\n<p><strong>Ajustez <code>YOU/YOUR-REPO</code> à votre besoin</strong>.</p>\n<p>Ça ressemblera à ça</p>\n<p><a href=\"https://github.com/YOU/YOUR-REPO\"><img src=\"https://img.shields.io/badge/repo-GitHub-3D76C2.svg\" alt=\"Repo on GitHub\" /></a>\n<a href=\"https://gitlab.com/YOU/YOUR-REPO\"><img src=\"https://img.shields.io/badge/repo-GitLab-6C488A.svg\" alt=\"Repo on GitLab\" /></a>\n<a href=\"https://bitbucket.org/YOU/YOUR-REPO\"><img src=\"https://img.shields.io/badge/repo-BitBucket-1F5081.svg\" alt=\"Repo on Bitbucket\" /></a></p>\n<p>J'ai mis en ligne\n<a href=\"https://github.com/MoOx/git-init\">ces instructions résumées sur un dépôt</a>, peut-être\nen ferais-je un script, qui sait… 😄. Enfin trois dépôts !</p>\n<ul>\n<li><a href=\"https://github.com/MoOx/git-init\">https://github.com/MoOx/git-init</a></li>\n<li><a href=\"https://gitlab.com/MoOx/git-init\">https://gitlab.com/MoOx/git-init</a></li>\n<li><a href=\"https://bitbucket.org/MoOx/git-init\">https://bitbucket.org/MoOx/git-init</a></li>\n</ul>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>