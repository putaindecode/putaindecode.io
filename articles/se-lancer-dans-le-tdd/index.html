<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Se lancer dans le TDD | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Se lancer dans le TDD | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Se lancer dans le TDD | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par Freezystem" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/se-lancer-dans-le-tdd" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(36, 100%, 35%), hsl(30, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Se lancer dans le TDD</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/Freezystem"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="Freezystem" src="https://avatars.githubusercontent.com/Freezystem?size=64"/><div>Freezystem<!-- --> <!-- -->•<!-- --> <!-- -->2017/10/31</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><h2>Introduction</h2>
<p>Tout commence en octobre 1999 lorsque
<a href="https://fr.wikipedia.org/wiki/Kent_Beck">Kent Beck</a> présente une nouvelle
méthode de programmation agile : l'eXtreme Programmming abrégé <em>XP</em>.<br />
l'<em>XP</em> définit des pratiques de développement optimisées qui améliorent la production
et la robustesse du code.<br />
Parmi les principes les plus connus de sa méthode on pourra citer
<strong>l'intégration continue</strong> aussi appelée <em>CI</em> pour <em>Continuous Integration</em> et
<strong>la programmation en binôme</strong> ou <em>pair programming</em> en anglais.</p>
<p>L'aspect qui nous intéresse ici est un autre pilier de la méthode qui consiste à
piloter le développement par les tests alias <em>TDD</em>.</p>
<p>Le TDD est une pratique controversée car coûteuse à mettre en place. Popularisée
par les développeurs elle peine à émerger.</p>
<p>Avec la multiplication des environnements d'execution, la complexité des
applications web et l'essor des projets Open-source, les développeurs se
heurtent à des problèmes de compatibilités croisées et d'inconsistances.<br />
Aujourd’hui les standards sont de plus en plus permissifs et favorisent ainsi les
comportements à risque. La plupart du temps, les systèmes sont capables de corriger
vos erreurs, des fois sans même vous en avertir.</p>
<p>Dans ce contexte :</p>
<ul>
<li>Comment écrire un code multi-plateforme fonctionnel ?</li>
<li>Comment être sûr que les ajouts ne cassent pas le code plus ancien ?</li>
<li>Comment être sûr que le code se comporte comme voulu ?</li>
</ul>
<p>Commencer par vous imposer des pratiques de développement rigoureuses est
impératif mais les tests seront un complément indispensable à la qualité de
votre code.</p>
<p>Heureusement, le TDD apporte alors une réponse élégante à l'ensemble de ces
problématiques.</p>
<h2>TDD, vous avez dit TDD ?</h2>
<p>Le Test Driven Development <em>(Développement Dirigé par les Tests)</em>, est une
technique de développement qui impose l’écriture de tests avant même l’écriture
de la première ligne de code.</p>
<p>Dans la théorie, la méthode requiert l’intervention d’au moins deux intervenants
différents, une personne écrit les tests, l’autre le code testé. Cela permet
d’éviter les problèmes liés à la subjectivité.</p>
<p>Dans la pratique les choses sont plus compliquées, parfois on développe seul ou
on écrit soi-même les tests qui garantissent l’intégrité d'une nouvelle
fonctionnalité dans un projet collaboratif.</p>
<blockquote>
<p>Quoi qu’il arrive, un test peu efficace vaudra toujours mieux que pas de test
du tout. Le but étant de prendre l’habitude d’en écrire et d’être objectif
dans leur rédaction.</p>
</blockquote>
<p>Le TDD tend à se démocratiser et requiert l’effort de chacun pour devenir un
standard. Tout développeur soucieux de son environnement et de son héritage doit
se poser sérieusement la question.<br />
Les frameworks de tests, les guides et les documentations sur le sujet fleurissent,
vous pouvez donc vous lancer sans crainte.</p>
<p>On peut découper le TDD en 5 étapes distinctes :</p>
<ol>
<li>Écrire un test,</li>
<li>Vérifier qu’il échoue,</li>
<li>Écrire le code <strong>suffisant</strong> pour que le test passe,</li>
<li>Vérifier que le test passe,</li>
<li>Optimiser le code et vérifier qu’il n’y ait pas de régression.</li>
</ol>
<p>Pour simplifier cette logique on peut regrouper ces cinq étapes en trois grandes
idées :</p>
<ul>
<li><strong>Tester d’abord</strong>, qui correspond aux deux premières étapes.</li>
<li><strong>Rendre fonctionnel</strong>, qui englobe les points 3 et 4.</li>
<li><strong>Rendre meilleur</strong>, qui n’est autre que l’étape 5.</li>
</ul>
<p>Bill Wake définit ainsi la méthode
<a href="http://xp123.com/articles/3a-arrange-act-assert/">3A</a>, pour Arrange, Act,
Assert <em>(Arranger, Agir, Affirmer)</em>.<br />
Il insiste sur le fait que la méthode ne définit pas un ordre immuable, l’<em>affirmation</em>
peut ainsi venir avant l’<em>action</em>, etc...</p>
<ul>
<li><strong>Arranger</strong> : Phase de préparation de l’environnement de test dans laquelle
on déclare les variables et les fonctions.</li>
<li><strong>Agir</strong> : Phase qui met à l’épreuve notre environnement en lui faisant subir
des mutations.</li>
<li><strong>Affirmer</strong> : On formule des attentes à propos de l'environnement (variables,
fonctions, paramètres).</li>
</ul>
<h2>TDD : concepts de base</h2>
<p>Pour la série de tests suivante on utilisera EcmaScript 6 et la méthode
<a href="https://developer.mozilla.org/fr/docs/Web/API/Console/assert"><code>.assert()</code></a> de
la console navigateur: Vous pourrez ainsi reproduire ces tests vous-même.</p>
<p>Objectif : Ecrire une fonction <code>countWords()</code> qui compte les mots d'une phrase.</p>
<p><strong>ITERATION 1</strong> : écriture et échec du test initial</p>
<p>On écrit tout d'abord une affirmation de base.</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
</code></pre>
<blockquote>
<p><code>Uncaught ReferenceError: countWords is not defined</code></p>
</blockquote>
<p>Après exécution la console rejette le test. On doit d'abord définir
<code>countWords()</code>.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function">() =&gt;</span> {};
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
</code></pre>
<blockquote>
<p><code>Assertion failed: test 0: le texte ne contient aucun mot</code></p>
</blockquote>
<p><code>countWords()</code> est définie et le test échoue mais l'erreur a changé.<br />
Il faut à présent définir la logique du cœur de notre fonction.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> text || <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>La console ne renvoie rien, le test est donc passé.</p>
<blockquote>
<p><code>countWords()</code> étant très simple nous omettrons les phases d'optimisation. On
peut aussi considérer les itérations suivantes comme des optimisations.</p>
</blockquote>
<p><strong>ITERATION 2</strong> : test pour les phrases d'un seul mot</p>
<p>Très bien. Essayons à présent une phrase d'un seul mot.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> text || <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;nope&quot;</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test 1: le texte contient 1 mot&quot;</span>);
</code></pre>
<blockquote>
<p><code>Assertion failed: test 1: le texte contient 1 mot</code></p>
</blockquote>
<p><code>countWords()</code> ne compte pas correctement, ajoutons le code suffisant pour
passer le test.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> (text ? text.split(<span class="hljs-string">&quot; &quot;</span>).length : <span class="hljs-number">0</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;nope&quot;</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test 1: le texte contient 1 mot&quot;</span>);
</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Le test est passé, ajoutons un autre cas standard.</p>
<p><strong>ITERATION 3</strong> : test pour les phrases de plusieurs mots</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> (text ? text.split(<span class="hljs-string">&quot; &quot;</span>).length : <span class="hljs-number">0</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;nope&quot;</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test 1: le texte contient 1 mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot;tdd is so fun&quot;</span>) === <span class="hljs-number">4</span>,
  <span class="hljs-string">&quot;test 2: le texte contient 4 mots&quot;</span>,
);
</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Le nouveau test passe sans modification, on peut continuer.</p>
<p><strong>ITERATION 4</strong> : test pour les phrases contenant des espaces au début et à la
fin</p>
<p>Vérifions à présent la robustesse de la fonction.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> (text ? text.split(<span class="hljs-string">&quot; &quot;</span>).length : <span class="hljs-number">0</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;nope&quot;</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test 1: le texte contient 1 mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot;tdd is so fun&quot;</span>) === <span class="hljs-number">4</span>,
  <span class="hljs-string">&quot;test 2: le texte contient 4 mots&quot;</span>,
);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot; so is skateboarding &quot;</span>) === <span class="hljs-number">3</span>,
  <span class="hljs-string">&quot;test 3: le texte contient 3 mots&quot;</span>,
);
</code></pre>
<blockquote>
<p><code>Assertion failed: test 3: le texte contient 3 mots</code></p>
</blockquote>
<p>Aïe… notre fonction n'est pas assez solide. Corrigeons-la pour capter ce nouveau
cas en supprimant les espaces inutiles avant et après le texte.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> (text ? text.trim().split(<span class="hljs-string">&quot; &quot;</span>).length : <span class="hljs-number">0</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;nope&quot;</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test 1: le texte contient 1 mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot;tdd is so fun&quot;</span>) === <span class="hljs-number">4</span>,
  <span class="hljs-string">&quot;test 2: le texte contient 4 mots&quot;</span>,
);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot; so is skateboarding &quot;</span>) === <span class="hljs-number">3</span>,
  <span class="hljs-string">&quot;test 3: le texte contient 3 mots&quot;</span>,
);
</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Parfait, La fonction est améliorée ! Ajoutons quand même un dernier test pour
être sur.</p>
<p><strong>ITERATION 5</strong> : test pour les phrases contenant un nombre inégal d'espaces
entre les mots</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> (text ? text.trim().split(<span class="hljs-string">&quot; &quot;</span>).length : <span class="hljs-number">0</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;nope&quot;</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test 1: le texte contient 1 mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot;tdd is so fun&quot;</span>) === <span class="hljs-number">4</span>,
  <span class="hljs-string">&quot;test 2: le texte contient 4 mots&quot;</span>,
);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot; so is skateboarding &quot;</span>) === <span class="hljs-number">3</span>,
  <span class="hljs-string">&quot;test 3: le texte contient 3 mots&quot;</span>,
);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">`  I&#x27;m 28, I love $#@! and    multi-spaces  `</span>) === <span class="hljs-number">7</span>,
  <span class="hljs-string">&quot;test 4: le texte contient 7 mots&quot;</span>,
);
</code></pre>
<blockquote>
<p><code>Assertion failed: test 4: le texte contient 7 mots</code></p>
</blockquote>
<p>Et mince… Encore un cas particulier, modifions l'algorithme en conséquence. On
doit ici retirer les espaces inutiles entre les mots.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span>
  text
    ? text
        .trim()
        .replace(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">&quot; &quot;</span>)
        .split(<span class="hljs-string">&quot; &quot;</span>).length
    : <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;&quot;</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">&quot;test 0: le texte ne contient aucun mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">&quot;nope&quot;</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">&quot;test 1: le texte contient 1 mot&quot;</span>);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot;tdd is so fun&quot;</span>) === <span class="hljs-number">4</span>,
  <span class="hljs-string">&quot;test 2: le texte contient 4 mots&quot;</span>,
);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">&quot; so is skateboarding &quot;</span>) === <span class="hljs-number">3</span>,
  <span class="hljs-string">&quot;test 3: le texte contient 3 mots&quot;</span>,
);
<span class="hljs-built_in">console</span>.assert(
  countWords(<span class="hljs-string">`  I&#x27;m 28, I love $#@! and    multi-spaces  `</span>) === <span class="hljs-number">7</span>,
  <span class="hljs-string">&quot;test 4: le texte contient 7 mots&quot;</span>,
);
</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Le test final est passé sans que les précédents n'échouent.</p>
<p>On notera que l'écriture de tests est un processus itératif.<br />
La phase d'optimisation implique l'écriture d'un nouveau test qui échoue et relance
donc une nouvelle itération.</p>
<p>Evidemment <code>countWords()</code> est très largement sous-optimisée et ne couvre pas
tous les cas spéciaux. On aurait pu ajouter une vérification sur le paramètre
<code>text</code> et compter avec une expression régulière comme ceci :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span>
  <span class="hljs-keyword">typeof</span> text === <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; text.trim()
    ? text.match(<span class="hljs-regexp">/\S+\s{0,1}/g</span>).length
    : <span class="hljs-number">0</span>;
</code></pre>
<p>L'idée ici est que coder est un processus incrémental et que chaque nouveau
cycle doit être initié par un besoin spécifique défini par un test dédié.</p>
<p>L'écriture des tests est simple : on décompose notre script en une suite
d'affirmations correspondant chacune à une fonctionnalité précise de notre
algorithme.</p>
<p>Grâce à ce processus on évite :</p>
<ul>
<li><strong>les régressions</strong>: la suite valide de tests est la garantie que le code
reste fonctionnel malgré les évolutions de l'algorithme.</li>
<li><strong>le code mort</strong>: chaque morceau de code écrit est testé et a son utilité.</li>
<li><strong>le code non documenté</strong>: chaque comportement est décrit de manière
fonctionnelle.</li>
</ul>
<h2>BDD : Des tests pour tous</h2>
<p>Une variante plus agnostique de la logique du développeur existe et permet à des
intervenants externes de faire partie intégrante du processus créatif.</p>
<p>le BDD, Behaviour Driven Development (Développement Dirigé par le Comportement),
permet de définir de manière compréhensible pour tous les intervenants les
spécifications d’une fonctionnalité. Cela permet aussi aux développeurs de
comprendre le comportement général sans évoquer les détails techniques. La
discussion est donc facilitée entre les différents acteurs.</p>
<p>Pour illustrer cette variante adaptons l'exemple précédent :</p>
<blockquote>
<p>Note : Pour exécuter ce type de code vous aurez besoin d'un <em>test-runner</em>
comme <a href="https://facebook.github.io/jest/">Jest</a>, <a href="https://mochajs.org">Mocha</a>
ou <a href="https://karma-runner.github.io">Karma</a>.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span>
  text
    ? text
        .trim()
        .replace(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">&quot; &quot;</span>)
        .split(<span class="hljs-string">&quot; &quot;</span>).length
    : <span class="hljs-number">0</span>;

describe(<span class="hljs-string">&quot;countWords()&quot;</span>, <span class="hljs-function">() =&gt;</span> {
  it(<span class="hljs-string">&quot;doit traiter un texte vide&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    expect(countWords(<span class="hljs-string">&quot;&quot;</span>)).toBe(<span class="hljs-number">0</span>);
  });

  it(<span class="hljs-string">&quot;doit traiter un texte d&#x27;un seul mot&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    expect(countWords(<span class="hljs-string">&quot;nope&quot;</span>)).toBe(<span class="hljs-number">1</span>);
  });

  it(<span class="hljs-string">&quot;doit traiter un texte de n mots&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    expect(countWords(<span class="hljs-string">&quot;tdd is so fun&quot;</span>)).toBe(<span class="hljs-number">4</span>);
  });

  it(<span class="hljs-string">&quot;doit traiter un texte avec des espaces aux extrémités&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    expect(countWords(<span class="hljs-string">&quot; so is skateboarding &quot;</span>)).toBe(<span class="hljs-number">3</span>);
  });

  it(<span class="hljs-string">&quot;doit traiter un texte avec des espaces inégaux entre les mots&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    expect(countWords(<span class="hljs-string">`  I&#x27;m 28, I love $#@! and    multi-spaces  `</span>)).toBe(<span class="hljs-number">7</span>);
  });
});
</code></pre>
<p>Voici le résultat du run :</p>
<p><img src="/public/images/articles/2017-10-31-se-lancer-dans-le-tdd/testrunner.png" alt="résultat du run de tests" /></p>
<p>La relecture est simplifiée pour tous les participants non techniques.</p>
<h2>Conclusion</h2>
<p>Le TDD est destiné à être incorporé à un processus
d'<a href="http://putaindecode.io/fr/articles/ci/">Intégration Continue</a> pour s'assurer
du bon fonctionnement de l'application sur tous les environnements de production
après chaque nouveau <code>commit</code>.</p>
<p>J'espère vous avez apprécié la démo et que ça vous a donné envie de tester le
TDD pour apporter équilibre et harmonie à votre code.</p>
<p>Dans tous les cas, je peux vous certifier que les autres codeurs vous en seront
reconnaissants, croyez-moi.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Se%20lancer%20dans%20le%20TDD%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fse-lancer-dans-le-tdd" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"se-lancer-dans-le-tdd","v":{"_0":{"TAG":0,"_0":{"slug":"se-lancer-dans-le-tdd","filename":"2017-10-31-se-lancer-dans-le-tdd","title":"Se lancer dans le TDD","date":"Tue, 31 Oct 2017 00:00:00 GMT","draft":false,"meta":{"date":"2017-10-31T00:00:00.000Z","title":"Se lancer dans le TDD","author":"Freezystem","oldSlug":"tdd","slug":"se-lancer-dans-le-tdd"},"body":"<h2>Introduction</h2>\n<p>Tout commence en octobre 1999 lorsque\n<a href=\"https://fr.wikipedia.org/wiki/Kent_Beck\">Kent Beck</a> présente une nouvelle\nméthode de programmation agile : l'eXtreme Programmming abrégé <em>XP</em>.<br />\nl'<em>XP</em> définit des pratiques de développement optimisées qui améliorent la production\net la robustesse du code.<br />\nParmi les principes les plus connus de sa méthode on pourra citer\n<strong>l'intégration continue</strong> aussi appelée <em>CI</em> pour <em>Continuous Integration</em> et\n<strong>la programmation en binôme</strong> ou <em>pair programming</em> en anglais.</p>\n<p>L'aspect qui nous intéresse ici est un autre pilier de la méthode qui consiste à\npiloter le développement par les tests alias <em>TDD</em>.</p>\n<p>Le TDD est une pratique controversée car coûteuse à mettre en place. Popularisée\npar les développeurs elle peine à émerger.</p>\n<p>Avec la multiplication des environnements d'execution, la complexité des\napplications web et l'essor des projets Open-source, les développeurs se\nheurtent à des problèmes de compatibilités croisées et d'inconsistances.<br />\nAujourd’hui les standards sont de plus en plus permissifs et favorisent ainsi les\ncomportements à risque. La plupart du temps, les systèmes sont capables de corriger\nvos erreurs, des fois sans même vous en avertir.</p>\n<p>Dans ce contexte :</p>\n<ul>\n<li>Comment écrire un code multi-plateforme fonctionnel ?</li>\n<li>Comment être sûr que les ajouts ne cassent pas le code plus ancien ?</li>\n<li>Comment être sûr que le code se comporte comme voulu ?</li>\n</ul>\n<p>Commencer par vous imposer des pratiques de développement rigoureuses est\nimpératif mais les tests seront un complément indispensable à la qualité de\nvotre code.</p>\n<p>Heureusement, le TDD apporte alors une réponse élégante à l'ensemble de ces\nproblématiques.</p>\n<h2>TDD, vous avez dit TDD ?</h2>\n<p>Le Test Driven Development <em>(Développement Dirigé par les Tests)</em>, est une\ntechnique de développement qui impose l’écriture de tests avant même l’écriture\nde la première ligne de code.</p>\n<p>Dans la théorie, la méthode requiert l’intervention d’au moins deux intervenants\ndifférents, une personne écrit les tests, l’autre le code testé. Cela permet\nd’éviter les problèmes liés à la subjectivité.</p>\n<p>Dans la pratique les choses sont plus compliquées, parfois on développe seul ou\non écrit soi-même les tests qui garantissent l’intégrité d'une nouvelle\nfonctionnalité dans un projet collaboratif.</p>\n<blockquote>\n<p>Quoi qu’il arrive, un test peu efficace vaudra toujours mieux que pas de test\ndu tout. Le but étant de prendre l’habitude d’en écrire et d’être objectif\ndans leur rédaction.</p>\n</blockquote>\n<p>Le TDD tend à se démocratiser et requiert l’effort de chacun pour devenir un\nstandard. Tout développeur soucieux de son environnement et de son héritage doit\nse poser sérieusement la question.<br />\nLes frameworks de tests, les guides et les documentations sur le sujet fleurissent,\nvous pouvez donc vous lancer sans crainte.</p>\n<p>On peut découper le TDD en 5 étapes distinctes :</p>\n<ol>\n<li>Écrire un test,</li>\n<li>Vérifier qu’il échoue,</li>\n<li>Écrire le code <strong>suffisant</strong> pour que le test passe,</li>\n<li>Vérifier que le test passe,</li>\n<li>Optimiser le code et vérifier qu’il n’y ait pas de régression.</li>\n</ol>\n<p>Pour simplifier cette logique on peut regrouper ces cinq étapes en trois grandes\nidées :</p>\n<ul>\n<li><strong>Tester d’abord</strong>, qui correspond aux deux premières étapes.</li>\n<li><strong>Rendre fonctionnel</strong>, qui englobe les points 3 et 4.</li>\n<li><strong>Rendre meilleur</strong>, qui n’est autre que l’étape 5.</li>\n</ul>\n<p>Bill Wake définit ainsi la méthode\n<a href=\"http://xp123.com/articles/3a-arrange-act-assert/\">3A</a>, pour Arrange, Act,\nAssert <em>(Arranger, Agir, Affirmer)</em>.<br />\nIl insiste sur le fait que la méthode ne définit pas un ordre immuable, l’<em>affirmation</em>\npeut ainsi venir avant l’<em>action</em>, etc...</p>\n<ul>\n<li><strong>Arranger</strong> : Phase de préparation de l’environnement de test dans laquelle\non déclare les variables et les fonctions.</li>\n<li><strong>Agir</strong> : Phase qui met à l’épreuve notre environnement en lui faisant subir\ndes mutations.</li>\n<li><strong>Affirmer</strong> : On formule des attentes à propos de l'environnement (variables,\nfonctions, paramètres).</li>\n</ul>\n<h2>TDD : concepts de base</h2>\n<p>Pour la série de tests suivante on utilisera EcmaScript 6 et la méthode\n<a href=\"https://developer.mozilla.org/fr/docs/Web/API/Console/assert\"><code>.assert()</code></a> de\nla console navigateur: Vous pourrez ainsi reproduire ces tests vous-même.</p>\n<p>Objectif : Ecrire une fonction <code>countWords()</code> qui compte les mots d'une phrase.</p>\n<p><strong>ITERATION 1</strong> : écriture et échec du test initial</p>\n<p>On écrit tout d'abord une affirmation de base.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n</code></pre>\n<blockquote>\n<p><code>Uncaught ReferenceError: countWords is not defined</code></p>\n</blockquote>\n<p>Après exécution la console rejette le test. On doit d'abord définir\n<code>countWords()</code>.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\">() =&gt;</span> {};\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n</code></pre>\n<blockquote>\n<p><code>Assertion failed: test 0: le texte ne contient aucun mot</code></p>\n</blockquote>\n<p><code>countWords()</code> est définie et le test échoue mais l'erreur a changé.<br />\nIl faut à présent définir la logique du cœur de notre fonction.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> text || <span class=\"hljs-number\">0</span>;\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n</code></pre>\n<blockquote>\n<p><code>undefined</code></p>\n</blockquote>\n<p>La console ne renvoie rien, le test est donc passé.</p>\n<blockquote>\n<p><code>countWords()</code> étant très simple nous omettrons les phases d'optimisation. On\npeut aussi considérer les itérations suivantes comme des optimisations.</p>\n</blockquote>\n<p><strong>ITERATION 2</strong> : test pour les phrases d'un seul mot</p>\n<p>Très bien. Essayons à présent une phrase d'un seul mot.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> text || <span class=\"hljs-number\">0</span>;\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>) === <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;test 1: le texte contient 1 mot&quot;</span>);\n</code></pre>\n<blockquote>\n<p><code>Assertion failed: test 1: le texte contient 1 mot</code></p>\n</blockquote>\n<p><code>countWords()</code> ne compte pas correctement, ajoutons le code suffisant pour\npasser le test.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> (text ? text.split(<span class=\"hljs-string\">&quot; &quot;</span>).length : <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>) === <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;test 1: le texte contient 1 mot&quot;</span>);\n</code></pre>\n<blockquote>\n<p><code>undefined</code></p>\n</blockquote>\n<p>Le test est passé, ajoutons un autre cas standard.</p>\n<p><strong>ITERATION 3</strong> : test pour les phrases de plusieurs mots</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> (text ? text.split(<span class=\"hljs-string\">&quot; &quot;</span>).length : <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>) === <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;test 1: le texte contient 1 mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot;tdd is so fun&quot;</span>) === <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-string\">&quot;test 2: le texte contient 4 mots&quot;</span>,\n);\n</code></pre>\n<blockquote>\n<p><code>undefined</code></p>\n</blockquote>\n<p>Le nouveau test passe sans modification, on peut continuer.</p>\n<p><strong>ITERATION 4</strong> : test pour les phrases contenant des espaces au début et à la\nfin</p>\n<p>Vérifions à présent la robustesse de la fonction.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> (text ? text.split(<span class=\"hljs-string\">&quot; &quot;</span>).length : <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>) === <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;test 1: le texte contient 1 mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot;tdd is so fun&quot;</span>) === <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-string\">&quot;test 2: le texte contient 4 mots&quot;</span>,\n);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot; so is skateboarding &quot;</span>) === <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;test 3: le texte contient 3 mots&quot;</span>,\n);\n</code></pre>\n<blockquote>\n<p><code>Assertion failed: test 3: le texte contient 3 mots</code></p>\n</blockquote>\n<p>Aïe… notre fonction n'est pas assez solide. Corrigeons-la pour capter ce nouveau\ncas en supprimant les espaces inutiles avant et après le texte.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> (text ? text.trim().split(<span class=\"hljs-string\">&quot; &quot;</span>).length : <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>) === <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;test 1: le texte contient 1 mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot;tdd is so fun&quot;</span>) === <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-string\">&quot;test 2: le texte contient 4 mots&quot;</span>,\n);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot; so is skateboarding &quot;</span>) === <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;test 3: le texte contient 3 mots&quot;</span>,\n);\n</code></pre>\n<blockquote>\n<p><code>undefined</code></p>\n</blockquote>\n<p>Parfait, La fonction est améliorée ! Ajoutons quand même un dernier test pour\nêtre sur.</p>\n<p><strong>ITERATION 5</strong> : test pour les phrases contenant un nombre inégal d'espaces\nentre les mots</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span> (text ? text.trim().split(<span class=\"hljs-string\">&quot; &quot;</span>).length : <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>) === <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;test 1: le texte contient 1 mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot;tdd is so fun&quot;</span>) === <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-string\">&quot;test 2: le texte contient 4 mots&quot;</span>,\n);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot; so is skateboarding &quot;</span>) === <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;test 3: le texte contient 3 mots&quot;</span>,\n);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">`  I&#x27;m 28, I love $#@! and    multi-spaces  `</span>) === <span class=\"hljs-number\">7</span>,\n  <span class=\"hljs-string\">&quot;test 4: le texte contient 7 mots&quot;</span>,\n);\n</code></pre>\n<blockquote>\n<p><code>Assertion failed: test 4: le texte contient 7 mots</code></p>\n</blockquote>\n<p>Et mince… Encore un cas particulier, modifions l'algorithme en conséquence. On\ndoit ici retirer les espaces inutiles entre les mots.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span>\n  text\n    ? text\n        .trim()\n        .replace(<span class=\"hljs-regexp\">/\\s+/g</span>, <span class=\"hljs-string\">&quot; &quot;</span>)\n        .split(<span class=\"hljs-string\">&quot; &quot;</span>).length\n    : <span class=\"hljs-number\">0</span>;\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;&quot;</span>) === <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;test 0: le texte ne contient aucun mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>) === <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;test 1: le texte contient 1 mot&quot;</span>);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot;tdd is so fun&quot;</span>) === <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-string\">&quot;test 2: le texte contient 4 mots&quot;</span>,\n);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">&quot; so is skateboarding &quot;</span>) === <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;test 3: le texte contient 3 mots&quot;</span>,\n);\n<span class=\"hljs-built_in\">console</span>.assert(\n  countWords(<span class=\"hljs-string\">`  I&#x27;m 28, I love $#@! and    multi-spaces  `</span>) === <span class=\"hljs-number\">7</span>,\n  <span class=\"hljs-string\">&quot;test 4: le texte contient 7 mots&quot;</span>,\n);\n</code></pre>\n<blockquote>\n<p><code>undefined</code></p>\n</blockquote>\n<p>Le test final est passé sans que les précédents n'échouent.</p>\n<p>On notera que l'écriture de tests est un processus itératif.<br />\nLa phase d'optimisation implique l'écriture d'un nouveau test qui échoue et relance\ndonc une nouvelle itération.</p>\n<p>Evidemment <code>countWords()</code> est très largement sous-optimisée et ne couvre pas\ntous les cas spéciaux. On aurait pu ajouter une vérification sur le paramètre\n<code>text</code> et compter avec une expression régulière comme ceci :</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span>\n  <span class=\"hljs-keyword\">typeof</span> text === <span class=\"hljs-string\">&quot;string&quot;</span> &amp;&amp; text.trim()\n    ? text.match(<span class=\"hljs-regexp\">/\\S+\\s{0,1}/g</span>).length\n    : <span class=\"hljs-number\">0</span>;\n</code></pre>\n<p>L'idée ici est que coder est un processus incrémental et que chaque nouveau\ncycle doit être initié par un besoin spécifique défini par un test dédié.</p>\n<p>L'écriture des tests est simple : on décompose notre script en une suite\nd'affirmations correspondant chacune à une fonctionnalité précise de notre\nalgorithme.</p>\n<p>Grâce à ce processus on évite :</p>\n<ul>\n<li><strong>les régressions</strong>: la suite valide de tests est la garantie que le code\nreste fonctionnel malgré les évolutions de l'algorithme.</li>\n<li><strong>le code mort</strong>: chaque morceau de code écrit est testé et a son utilité.</li>\n<li><strong>le code non documenté</strong>: chaque comportement est décrit de manière\nfonctionnelle.</li>\n</ul>\n<h2>BDD : Des tests pour tous</h2>\n<p>Une variante plus agnostique de la logique du développeur existe et permet à des\nintervenants externes de faire partie intégrante du processus créatif.</p>\n<p>le BDD, Behaviour Driven Development (Développement Dirigé par le Comportement),\npermet de définir de manière compréhensible pour tous les intervenants les\nspécifications d’une fonctionnalité. Cela permet aussi aux développeurs de\ncomprendre le comportement général sans évoquer les détails techniques. La\ndiscussion est donc facilitée entre les différents acteurs.</p>\n<p>Pour illustrer cette variante adaptons l'exemple précédent :</p>\n<blockquote>\n<p>Note : Pour exécuter ce type de code vous aurez besoin d'un <em>test-runner</em>\ncomme <a href=\"https://facebook.github.io/jest/\">Jest</a>, <a href=\"https://mochajs.org\">Mocha</a>\nou <a href=\"https://karma-runner.github.io\">Karma</a>.</p>\n</blockquote>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> countWords = <span class=\"hljs-function\"><span class=\"hljs-params\">text</span> =&gt;</span>\n  text\n    ? text\n        .trim()\n        .replace(<span class=\"hljs-regexp\">/\\s+/g</span>, <span class=\"hljs-string\">&quot; &quot;</span>)\n        .split(<span class=\"hljs-string\">&quot; &quot;</span>).length\n    : <span class=\"hljs-number\">0</span>;\n\ndescribe(<span class=\"hljs-string\">&quot;countWords()&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n  it(<span class=\"hljs-string\">&quot;doit traiter un texte vide&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n    expect(countWords(<span class=\"hljs-string\">&quot;&quot;</span>)).toBe(<span class=\"hljs-number\">0</span>);\n  });\n\n  it(<span class=\"hljs-string\">&quot;doit traiter un texte d&#x27;un seul mot&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n    expect(countWords(<span class=\"hljs-string\">&quot;nope&quot;</span>)).toBe(<span class=\"hljs-number\">1</span>);\n  });\n\n  it(<span class=\"hljs-string\">&quot;doit traiter un texte de n mots&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n    expect(countWords(<span class=\"hljs-string\">&quot;tdd is so fun&quot;</span>)).toBe(<span class=\"hljs-number\">4</span>);\n  });\n\n  it(<span class=\"hljs-string\">&quot;doit traiter un texte avec des espaces aux extrémités&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n    expect(countWords(<span class=\"hljs-string\">&quot; so is skateboarding &quot;</span>)).toBe(<span class=\"hljs-number\">3</span>);\n  });\n\n  it(<span class=\"hljs-string\">&quot;doit traiter un texte avec des espaces inégaux entre les mots&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n    expect(countWords(<span class=\"hljs-string\">`  I&#x27;m 28, I love $#@! and    multi-spaces  `</span>)).toBe(<span class=\"hljs-number\">7</span>);\n  });\n});\n</code></pre>\n<p>Voici le résultat du run :</p>\n<p><img src=\"/public/images/articles/2017-10-31-se-lancer-dans-le-tdd/testrunner.png\" alt=\"résultat du run de tests\" /></p>\n<p>La relecture est simplifiée pour tous les participants non techniques.</p>\n<h2>Conclusion</h2>\n<p>Le TDD est destiné à être incorporé à un processus\nd'<a href=\"http://putaindecode.io/fr/articles/ci/\">Intégration Continue</a> pour s'assurer\ndu bon fonctionnement de l'application sur tous les environnements de production\naprès chaque nouveau <code>commit</code>.</p>\n<p>J'espère vous avez apprécié la démo et que ça vous a donné envie de tester le\nTDD pour apporter équilibre et harmonie à votre code.</p>\n<p>Dans tous les cas, je peux vous certifier que les autres codeurs vous en seront\nreconnaissants, croyez-moi.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>