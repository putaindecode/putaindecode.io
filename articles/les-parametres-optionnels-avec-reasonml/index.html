<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Les paramètres optionnels avec ReasonML | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Les paramètres optionnels avec ReasonML | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Les paramètres optionnels avec ReasonML | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par freddy03h" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/les-parametres-optionnels-avec-reasonml" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(279, 100%, 35%), hsl(232, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Les paramètres optionnels avec ReasonML</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/freddy03h"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="freddy03h" src="https://avatars.githubusercontent.com/freddy03h?size=64"/><div>freddy03h<!-- --> <!-- -->•<!-- --> <!-- -->2019/06/25</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Le type option est vraiment super à utiliser en Reason, je vous conseille la lecture de <a href="/articles/introduction-a-reasonml">l'introduction à ReasonML</a> et <a href="/articles/le-type-option-c-est-quoi-et-ca-regle-quel-probleme">l'article sur le type option</a>. Mais j’ai un peu buté sur un petit point, c'est le lien entre les types option et les paramètres optionnels d’une fonction ou d’un composant React <a href="https://reasonml.github.io/docs/en/function#optional-labeled-arguments">malgré la doc à ce sujet</a>, alors je résume cela dans cet article.</p>
<p>On va prendre comme exemple un composant <code>User</code> qui prend en paramètre un <code>name</code> et une <code>imageSrc</code> qui peut être facultative.</p>
<p>Une solution peut être d’utiliser le type option explicitement comme type de paramètre.</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* User.re */</span>
<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~name: string, ~imageSrc: option(string)) =&gt; {
  &lt;div&gt;
    &lt;div&gt;
      {imageSrc
       <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Option</span>.map(src =&gt; &lt;img src /&gt;)
       <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Option</span>.getWithDefault(<span class="hljs-module-identifier">React</span>.null)}
    &lt;/div&gt;
    &lt;div&gt; name<span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">React</span>.string &lt;/div&gt;
  &lt;/div&gt;;
};
</code></pre>
<p>À l’intérieur du composant le type option est parfait pour gérer l’optionalité du paramètre. En l'état, nous sommes obligé de l’utiliser de cette manière :</p>
<pre><code class="hljs language-reason">&lt;<span class="hljs-module-identifier">User</span> name=<span class="hljs-string">&quot;Ariel&quot;</span> imageSrc={<span class="hljs-constructor">Some</span>(<span class="hljs-string">&quot;https://example.com/user.jpg&quot;</span>)} /&gt;

&lt;<span class="hljs-module-identifier">User</span> name=<span class="hljs-string">&quot;Manon&quot;</span> imageSrc={<span class="hljs-constructor">None</span>} /&gt;
</code></pre>
<p>Il est impossible d’omettre le paramètre <code>imageSrc</code>. Il faudra obligatoirement lui renseigner un option. Pour rendre le renseignement du paramètre vraiment optionnel, on peut déclarer le paramètre comme étant optionnel avec la syntaxe du point d'interrogation.</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* User.re */</span>
<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~name: string, ~imageSrc: option(string)=?) =&gt; { … };
</code></pre>
<p>Le point d'interrogation va permettre de renseigner directement le type inclus dans l’option (ici un string) ou d’omettre complètement le paramètre, ce qui donne ceci à l'usage :</p>
<pre><code class="hljs language-reason">&lt;<span class="hljs-module-identifier">User</span> name=<span class="hljs-string">&quot;Ariel&quot;</span> imageSrc=<span class="hljs-string">&quot;https://example.com/user.jpg&quot;</span> /&gt;

&lt;<span class="hljs-module-identifier">User</span> name=<span class="hljs-string">&quot;Manon&quot;</span> /&gt;
</code></pre>
<p>La valeur sera <strong>automatiquement encapsulée dans un option</strong>, ce qui fait que l’implémentation ne change pas et on profite toujours des avantages du type option dans le composant.</p>
<h2>Bon alors c'est tout ?</h2>
<p>Là on pourrait se dire que c’est bon c’est fini, mais en fait pas vraiment.</p>
<p>Si on résume, notre component accepte en paramètre que <code>imageSrc</code> soit absent, ou qu’il soit un string. Mais à première vue, impossible de lui donner un option, et cela peut être embêtant à l’usage.</p>
<p>Par exemple, <code>User</code> est utilisé dans un autre composant <code>Follower</code> qui lui prend en paramètre un <code>avatarUrl</code>, et qui sera un type option. Pour transmettre la valeur de <code>avatarUrl</code> à <code>imageSrc</code> nous seront obligé de faire quelque chose comme ça :</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* Follower.re */</span>
<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~name: string, ~avatarUrl: option(string)=?) =&gt;
  &lt;div&gt;
    {avatarUrl
    <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Option</span>.map(url =&gt; &lt;<span class="hljs-module-identifier">User</span> name imageSrc={url} /&gt;)
    <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Option</span>.getWithDefault(&lt;<span class="hljs-module-identifier">User</span> name /&gt;)}
  &lt;/div&gt;;
</code></pre>
<p>Vu que <code>imageSrc</code> ne prend pas de type option, on est obligé d'appeler <code>&lt;User&gt;</code> différement selon que <code>avatarUrl</code> soit <code>Some()</code> ou <code>None</code>.</p>
<p>Heureusement il existe une notation qui va nous permettre de renseigner un option, et on retrouve là encore le point d'interrogation :</p>
<pre><code class="hljs language-reason">&lt;<span class="hljs-module-identifier">User</span> name imageSrc=?{avatarUrl} /&gt;
</code></pre>
<p>Le point d'interrogation va permettre de renseigner le paramètre avec un type option, de transmettre la valeur contenue dans le <code>Some()</code> de <code>avatarUrl</code> ou d’omettre complètement le paramètre <code>imageSrc</code> si <code>avatarUrl</code> est <code>None</code>.</p>
<h2>Deux syntaxes utilisant le point d'interrogation</h2>
<p>Si on résume, la première syntaxe qui s'utilise dans la déclaration d'une fonction permet de déclarer un paramètre comme optionnel, <strong>la fonction acceptera de recevoir une valeur, comme il acceptera qu'on n'en passe aucune</strong>.</p>
<p>Ensuite, la seconde syntaxe qui s'utilise à l'appel d'une fonction permet de <strong>transformer une valeur de type option en paramètre optionnel</strong>.</p>
<p>Dis comme ça, cela peut sembler inutilement complexe, sauf que <strong>la complexité est gérée par le langage</strong>, et qu’à l’utilisation on y gagne en souplesse :</p>
<ul>
<li>J’ai un composant avec un paramètre optionnel que je peux gérer, en interne, grâce aux avantages du type option</li>
<li>Je peux renseigner ce paramètre avec une valeur string, option ou l’omettre.</li>
</ul>
<h2>Notations raccourcis et typage</h2>
<p>Pour les besoins de l’exemple j’ai volontairement utilisé du code très explicite, mais il faut savoir qu’on a quelques raccourcis dans la notation.</p>
<h3>Punning</h3>
<p>L’avantage du JSX de ReasonReact par rapport à React.js, c’est le punning. Le raccourci lorsqu'on a une prop ayant le même nom que la variable qu'on y passe. On a déjà l’habitude en JS avec les objets, au lieu de <code>return {name: name}</code>, on peut faire <code>return {name}</code>.</p>
<p>On peut aussi l’utiliser avec le point d'interrogation, par exemple :</p>
<pre><code class="hljs language-reason"><span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~name: string, ~avatarUrl <span class="hljs-keyword">as</span> imageSrc:option(string)=?) =&gt;
  &lt;div&gt;
    &lt;<span class="hljs-module-identifier">User</span> name imageSrc=?{imageSrc} /&gt;
  &lt;/div&gt;;
</code></pre>
<p>devient</p>
<pre><code class="hljs language-reason"><span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~name: string, ~avatarUrl <span class="hljs-keyword">as</span> imageSrc:option(string)=?) =&gt;
  &lt;div&gt;
    &lt;<span class="hljs-module-identifier">User</span> name ?imageSrc /&gt;
  &lt;/div&gt;;
</code></pre>
<p>(d’ailleurs, si vous écrivez le code sans punning, le Reformat vous réécrit automatiquement votre code avec).</p>
<p>C’est aussi l’occasion d’aborder le fait de pouvoir renommer un argument avec <code>as</code>. Il ne faut vraiment pas s’en priver. En fait il faut savoir que <code>(~name)</code> est lui même un raccourci pour <code>(~name as name)</code>.</p>
<h3>Inférence de type</h3>
<p>L’inférence de type est vraiment très bonne en Reason, si j’ai explicité le type option et leur contenu string, je peux très bien m’en passer. Ce qui nous donne un exemple final moins verbeux :</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* User.re */</span>
<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~name, ~imageSrc=?) =&gt;
  &lt;div&gt;
    &lt;div&gt;
      {imageSrc
      <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Option</span>.map(src =&gt; &lt;img src /&gt;)
      <span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Option</span>.getWithDefault(<span class="hljs-module-identifier">React</span>.null)}
    &lt;/div&gt;
    &lt;div&gt; name<span class="hljs-operator">-&gt;</span><span class="hljs-module-identifier">React</span>.string &lt;/div&gt;
  &lt;/div&gt;;

<span class="hljs-comment">/* Follower.re */</span>
<span class="hljs-attribute">[@react.component]</span>
<span class="hljs-keyword">let</span> make = (~name, ~avatarUrl <span class="hljs-keyword">as</span> imageSrc=?) =&gt;
  &lt;div&gt; &lt;<span class="hljs-module-identifier">User</span> name ?imageSrc /&gt; &lt;/div&gt;;
</code></pre>
<p>Le type option se révèle très pratique lors de l'écriture d'un fonction ou d'un component. Les paramètres optionnels, avec les deux syntaxes utilisant le point d'interrogation, permettent de ne pas complexifier l'usage de la fonction ou du component.</p>
<p>Dans l'exemple final, l'implémentation de <code>User</code> n'a pas changé depuis le début car nous voulons gérer l'aspect facultatif du paramètre. En revanche <code>Follower</code> n'avait absoluement pas besoin de le gérer dans son implémentation, le code s'en serait trouvé inutilement alourdi.
Nous gardons ainsi une écriture fluide tout en permettant de gérer l'optionnalité d'une valeur lorsque cela est nécessaire.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Les%20param%C3%A8tres%20optionnels%20avec%20ReasonML%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fles-parametres-optionnels-avec-reasonml" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"les-parametres-optionnels-avec-reasonml","v":{"_0":{"TAG":0,"_0":{"slug":"les-parametres-optionnels-avec-reasonml","filename":"2019-06-25-les-parametres-optionnels-avec-reasonml","title":"Les paramètres optionnels avec ReasonML","date":"Tue, 25 Jun 2019 00:00:00 GMT","draft":false,"meta":{"date":"2019-06-25T00:00:00.000Z","title":"Les paramètres optionnels avec ReasonML","author":"freddy03h","slug":"les-parametres-optionnels-avec-reasonml"},"body":"<p>Le type option est vraiment super à utiliser en Reason, je vous conseille la lecture de <a href=\"/articles/introduction-a-reasonml\">l'introduction à ReasonML</a> et <a href=\"/articles/le-type-option-c-est-quoi-et-ca-regle-quel-probleme\">l'article sur le type option</a>. Mais j’ai un peu buté sur un petit point, c'est le lien entre les types option et les paramètres optionnels d’une fonction ou d’un composant React <a href=\"https://reasonml.github.io/docs/en/function#optional-labeled-arguments\">malgré la doc à ce sujet</a>, alors je résume cela dans cet article.</p>\n<p>On va prendre comme exemple un composant <code>User</code> qui prend en paramètre un <code>name</code> et une <code>imageSrc</code> qui peut être facultative.</p>\n<p>Une solution peut être d’utiliser le type option explicitement comme type de paramètre.</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-comment\">/* User.re */</span>\n<span class=\"hljs-attribute\">[@react.component]</span>\n<span class=\"hljs-keyword\">let</span> make = (~name: string, ~imageSrc: option(string)) =&gt; {\n  &lt;div&gt;\n    &lt;div&gt;\n      {imageSrc\n       <span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">Belt</span>.<span class=\"hljs-module-identifier\">Option</span>.map(src =&gt; &lt;img src /&gt;)\n       <span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">Belt</span>.<span class=\"hljs-module-identifier\">Option</span>.getWithDefault(<span class=\"hljs-module-identifier\">React</span>.null)}\n    &lt;/div&gt;\n    &lt;div&gt; name<span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">React</span>.string &lt;/div&gt;\n  &lt;/div&gt;;\n};\n</code></pre>\n<p>À l’intérieur du composant le type option est parfait pour gérer l’optionalité du paramètre. En l'état, nous sommes obligé de l’utiliser de cette manière :</p>\n<pre><code class=\"hljs language-reason\">&lt;<span class=\"hljs-module-identifier\">User</span> name=<span class=\"hljs-string\">&quot;Ariel&quot;</span> imageSrc={<span class=\"hljs-constructor\">Some</span>(<span class=\"hljs-string\">&quot;https://example.com/user.jpg&quot;</span>)} /&gt;\n\n&lt;<span class=\"hljs-module-identifier\">User</span> name=<span class=\"hljs-string\">&quot;Manon&quot;</span> imageSrc={<span class=\"hljs-constructor\">None</span>} /&gt;\n</code></pre>\n<p>Il est impossible d’omettre le paramètre <code>imageSrc</code>. Il faudra obligatoirement lui renseigner un option. Pour rendre le renseignement du paramètre vraiment optionnel, on peut déclarer le paramètre comme étant optionnel avec la syntaxe du point d'interrogation.</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-comment\">/* User.re */</span>\n<span class=\"hljs-attribute\">[@react.component]</span>\n<span class=\"hljs-keyword\">let</span> make = (~name: string, ~imageSrc: option(string)=?) =&gt; { … };\n</code></pre>\n<p>Le point d'interrogation va permettre de renseigner directement le type inclus dans l’option (ici un string) ou d’omettre complètement le paramètre, ce qui donne ceci à l'usage :</p>\n<pre><code class=\"hljs language-reason\">&lt;<span class=\"hljs-module-identifier\">User</span> name=<span class=\"hljs-string\">&quot;Ariel&quot;</span> imageSrc=<span class=\"hljs-string\">&quot;https://example.com/user.jpg&quot;</span> /&gt;\n\n&lt;<span class=\"hljs-module-identifier\">User</span> name=<span class=\"hljs-string\">&quot;Manon&quot;</span> /&gt;\n</code></pre>\n<p>La valeur sera <strong>automatiquement encapsulée dans un option</strong>, ce qui fait que l’implémentation ne change pas et on profite toujours des avantages du type option dans le composant.</p>\n<h2>Bon alors c'est tout ?</h2>\n<p>Là on pourrait se dire que c’est bon c’est fini, mais en fait pas vraiment.</p>\n<p>Si on résume, notre component accepte en paramètre que <code>imageSrc</code> soit absent, ou qu’il soit un string. Mais à première vue, impossible de lui donner un option, et cela peut être embêtant à l’usage.</p>\n<p>Par exemple, <code>User</code> est utilisé dans un autre composant <code>Follower</code> qui lui prend en paramètre un <code>avatarUrl</code>, et qui sera un type option. Pour transmettre la valeur de <code>avatarUrl</code> à <code>imageSrc</code> nous seront obligé de faire quelque chose comme ça :</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-comment\">/* Follower.re */</span>\n<span class=\"hljs-attribute\">[@react.component]</span>\n<span class=\"hljs-keyword\">let</span> make = (~name: string, ~avatarUrl: option(string)=?) =&gt;\n  &lt;div&gt;\n    {avatarUrl\n    <span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">Belt</span>.<span class=\"hljs-module-identifier\">Option</span>.map(url =&gt; &lt;<span class=\"hljs-module-identifier\">User</span> name imageSrc={url} /&gt;)\n    <span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">Belt</span>.<span class=\"hljs-module-identifier\">Option</span>.getWithDefault(&lt;<span class=\"hljs-module-identifier\">User</span> name /&gt;)}\n  &lt;/div&gt;;\n</code></pre>\n<p>Vu que <code>imageSrc</code> ne prend pas de type option, on est obligé d'appeler <code>&lt;User&gt;</code> différement selon que <code>avatarUrl</code> soit <code>Some()</code> ou <code>None</code>.</p>\n<p>Heureusement il existe une notation qui va nous permettre de renseigner un option, et on retrouve là encore le point d'interrogation :</p>\n<pre><code class=\"hljs language-reason\">&lt;<span class=\"hljs-module-identifier\">User</span> name imageSrc=?{avatarUrl} /&gt;\n</code></pre>\n<p>Le point d'interrogation va permettre de renseigner le paramètre avec un type option, de transmettre la valeur contenue dans le <code>Some()</code> de <code>avatarUrl</code> ou d’omettre complètement le paramètre <code>imageSrc</code> si <code>avatarUrl</code> est <code>None</code>.</p>\n<h2>Deux syntaxes utilisant le point d'interrogation</h2>\n<p>Si on résume, la première syntaxe qui s'utilise dans la déclaration d'une fonction permet de déclarer un paramètre comme optionnel, <strong>la fonction acceptera de recevoir une valeur, comme il acceptera qu'on n'en passe aucune</strong>.</p>\n<p>Ensuite, la seconde syntaxe qui s'utilise à l'appel d'une fonction permet de <strong>transformer une valeur de type option en paramètre optionnel</strong>.</p>\n<p>Dis comme ça, cela peut sembler inutilement complexe, sauf que <strong>la complexité est gérée par le langage</strong>, et qu’à l’utilisation on y gagne en souplesse :</p>\n<ul>\n<li>J’ai un composant avec un paramètre optionnel que je peux gérer, en interne, grâce aux avantages du type option</li>\n<li>Je peux renseigner ce paramètre avec une valeur string, option ou l’omettre.</li>\n</ul>\n<h2>Notations raccourcis et typage</h2>\n<p>Pour les besoins de l’exemple j’ai volontairement utilisé du code très explicite, mais il faut savoir qu’on a quelques raccourcis dans la notation.</p>\n<h3>Punning</h3>\n<p>L’avantage du JSX de ReasonReact par rapport à React.js, c’est le punning. Le raccourci lorsqu'on a une prop ayant le même nom que la variable qu'on y passe. On a déjà l’habitude en JS avec les objets, au lieu de <code>return {name: name}</code>, on peut faire <code>return {name}</code>.</p>\n<p>On peut aussi l’utiliser avec le point d'interrogation, par exemple :</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-attribute\">[@react.component]</span>\n<span class=\"hljs-keyword\">let</span> make = (~name: string, ~avatarUrl <span class=\"hljs-keyword\">as</span> imageSrc:option(string)=?) =&gt;\n  &lt;div&gt;\n    &lt;<span class=\"hljs-module-identifier\">User</span> name imageSrc=?{imageSrc} /&gt;\n  &lt;/div&gt;;\n</code></pre>\n<p>devient</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-attribute\">[@react.component]</span>\n<span class=\"hljs-keyword\">let</span> make = (~name: string, ~avatarUrl <span class=\"hljs-keyword\">as</span> imageSrc:option(string)=?) =&gt;\n  &lt;div&gt;\n    &lt;<span class=\"hljs-module-identifier\">User</span> name ?imageSrc /&gt;\n  &lt;/div&gt;;\n</code></pre>\n<p>(d’ailleurs, si vous écrivez le code sans punning, le Reformat vous réécrit automatiquement votre code avec).</p>\n<p>C’est aussi l’occasion d’aborder le fait de pouvoir renommer un argument avec <code>as</code>. Il ne faut vraiment pas s’en priver. En fait il faut savoir que <code>(~name)</code> est lui même un raccourci pour <code>(~name as name)</code>.</p>\n<h3>Inférence de type</h3>\n<p>L’inférence de type est vraiment très bonne en Reason, si j’ai explicité le type option et leur contenu string, je peux très bien m’en passer. Ce qui nous donne un exemple final moins verbeux :</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-comment\">/* User.re */</span>\n<span class=\"hljs-attribute\">[@react.component]</span>\n<span class=\"hljs-keyword\">let</span> make = (~name, ~imageSrc=?) =&gt;\n  &lt;div&gt;\n    &lt;div&gt;\n      {imageSrc\n      <span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">Belt</span>.<span class=\"hljs-module-identifier\">Option</span>.map(src =&gt; &lt;img src /&gt;)\n      <span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">Belt</span>.<span class=\"hljs-module-identifier\">Option</span>.getWithDefault(<span class=\"hljs-module-identifier\">React</span>.null)}\n    &lt;/div&gt;\n    &lt;div&gt; name<span class=\"hljs-operator\">-&gt;</span><span class=\"hljs-module-identifier\">React</span>.string &lt;/div&gt;\n  &lt;/div&gt;;\n\n<span class=\"hljs-comment\">/* Follower.re */</span>\n<span class=\"hljs-attribute\">[@react.component]</span>\n<span class=\"hljs-keyword\">let</span> make = (~name, ~avatarUrl <span class=\"hljs-keyword\">as</span> imageSrc=?) =&gt;\n  &lt;div&gt; &lt;<span class=\"hljs-module-identifier\">User</span> name ?imageSrc /&gt; &lt;/div&gt;;\n</code></pre>\n<p>Le type option se révèle très pratique lors de l'écriture d'un fonction ou d'un component. Les paramètres optionnels, avec les deux syntaxes utilisant le point d'interrogation, permettent de ne pas complexifier l'usage de la fonction ou du component.</p>\n<p>Dans l'exemple final, l'implémentation de <code>User</code> n'a pas changé depuis le début car nous voulons gérer l'aspect facultatif du paramètre. En revanche <code>Follower</code> n'avait absoluement pas besoin de le gérer dans son implémentation, le code s'en serait trouvé inutilement alourdi.\nNous gardons ainsi une écriture fluide tout en permettant de gérer l'optionnalité d'une valeur lorsque cela est nécessaire.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>