<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Déploiement continu avec Travis-CI (et GitHub Pages) | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Déploiement continu avec Travis-CI (et GitHub Pages) | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Déploiement continu avec Travis-CI (et GitHub Pages) | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par MoOx" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/deploiement-continu-avec-travis-ci-et-gh-pages" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(57, 100%, 35%), hsl(47, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Déploiement continu avec Travis-CI (et GitHub Pages)</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/MoOx"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="MoOx" src="https://avatars.githubusercontent.com/MoOx?size=64"/><div>MoOx<!-- --> <!-- -->•<!-- --> <!-- -->2016/04/19</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>On va partir comme ça : on a un projet sur git et tous les commits dans la
branche <code>master</code> provoqueront une mise en production automatique une fois les
tests validés.</p>
<p>Les autres commits sur les autres branches et pull/merge requests joueront juste
les tests pour notifier l'état. Quand même.</p>
<h2>C'est qui Travis?</h2>
<p><a href="https://travis-ci.com/">Travis-CI</a> est un service en ligne qui permet de tester
et déployer ses applications de manière automatisée.</p>
<p>Ce service payant propose une solution gratuite à tous les projets open source,
ce qui est assez cool. Cette version est disponible sur
<a href="https://travis-ci.org/">travis-ci.org</a>. Il existe bien entendu plein d'autres
services similaires, mais Travis-CI étant très répandu dans la communauté open
source, on le prendra pour notre exemple.</p>
<h2>Configuration de Travis-CI</h2>
<p>Travis-CI fonctionne avec un fichier de configuration assez simple. Il n'y a
qu'à voir
<a href="https://github.com/putaindecode/putaindecode.io/blob/master/.travis.yml">le nôtre</a>.</p>
<p>Voici ci-dessous une version minimale pour faire tourner un projet node par
exemple :</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">language:</span> <span class="hljs-string">node_js</span>
</code></pre>
<p>Oui, c'est tout. Selon le language et/ou les fichiers présents, Travis-CI va
choisir la commande de test par défaut. Avec node par exemple, ce sera
<code>npm test</code> si un package.json est présent. Si un <a href="/fr/articles/make/">Makefile</a>
est de la partie, Travis-CI va exécuter <code>make test</code>.</p>
<p>Voici un fichier plus complet avec quelques exemples et trucs bons à savoir.</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">language:</span> <span class="hljs-string">node_js</span>

<span class="hljs-attr">node_js:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;5&#x27;</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">‘4’</span>

<span class="hljs-comment"># échoue dès qu&#x27;une erreur intervient</span>
<span class="hljs-attr">matrix:</span>
  <span class="hljs-attr">fast_finish:</span> <span class="hljs-literal">true</span>

<span class="hljs-comment"># met en cache node_modules, à noter que dans ce genre d’utilisation pour des</span>
<span class="hljs-comment"># bibliothèques open source consommées via npm, il ne faudra pas oublier</span>
<span class="hljs-comment"># npm prune utilisé ci-après, histoire de ne pas lancer des tests avec</span>
<span class="hljs-comment"># des paquets encore en cache mais non présents dans le package.json</span>
<span class="hljs-attr">cache:</span>
  <span class="hljs-attr">directories:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">node_modules</span>

<span class="hljs-attr">before_install:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">npm</span> <span class="hljs-string">prune</span>

<span class="hljs-comment"># ici on peut mettre des commandes à utiliser avec le script</span>
<span class="hljs-attr">before_script:</span>
  <span class="hljs-comment"># certains runners comme karma, testem ou testling peuvent avoir</span>
  <span class="hljs-comment"># besoin d&#x27;un écran pour fonctionner, voici l&#x27;astuce :)</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">export</span> <span class="hljs-string">DISPLAY=:99.0</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">sh</span> <span class="hljs-string">-e</span> <span class="hljs-string">/etc/init.d/xvfb</span> <span class="hljs-string">start</span>

<span class="hljs-comment"># si on veut utiliser autre chose que la commande par défaut</span>
<span class="hljs-attr">script:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">test-with-coverage</span>

<span class="hljs-comment"># voici un exemple de ce que l’on peut faire après les tests :</span>
<span class="hljs-comment"># on peut lancer une tâche qui va envoyer les informations de</span>
<span class="hljs-comment"># pourcentage de couverture de code à un service tiers.</span>
<span class="hljs-comment"># (eg: http://coveralls.io/, https://codecov.io/)</span>
<span class="hljs-attr">after_success:</span> <span class="hljs-string">&#x27;npm run coverage&#x27;</span>

<span class="hljs-comment"># partie intéressante : ici on ne va déployer que les commits sur la</span>
<span class="hljs-comment"># branche master uniquement pour une version de node</span>
<span class="hljs-comment"># (car sinon on déploierait plusieurs fois…)</span>
<span class="hljs-attr">deploy:</span>
  <span class="hljs-attr">skip_cleanup:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">provider:</span> <span class="hljs-string">script</span>
  <span class="hljs-attr">script:</span> <span class="hljs-string">./scripts/deploy.sh</span>
  <span class="hljs-attr">on:</span>
    <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span>
    <span class="hljs-attr">node:</span> <span class="hljs-string">&#x27;5&#x27;</span>

<span class="hljs-comment"># variables d&#x27;env</span>
<span class="hljs-attr">env:</span>
  <span class="hljs-attr">global:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=production</span>
</code></pre>
<h2>Exemple concret</h2>
<p>On va prendre un petit projet simple en JavaScript qu’on va déployer sur GitHub
Pages. Il va donc nous falloir un token GitHub qu’on va encrypter via un
utilitaire spécifique afin de ne pas publier cela à la vue de tous.</p>
<h3>Générer un token GitHub encrypté sur Travis-CI</h3>
<p>Le plus simple est d’utiliser l'interface GitHub pour
<a href="https://github.com/settings/tokens/new">ajouter un token</a>.</p>
<h4>Encryption du token et utilisation</h4>
<p>Maintenant, nous allons encrypter ce token. Vous avez 2 possibilités :</p>
<ul>
<li>soit installer le paquet node <code>travis-encrypt</code></li>
<li>soit installer la gem ruby <code>travis</code> (qui embarque la commande <code>encrypt</code>)</li>
</ul>
<h5>Via la gem Ruby <code>travis</code></h5>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> sudo gem install travis</span>
<span class="hljs-meta">$</span><span class="bash"> travis encrypt --add --repo {YOU/YOUR_REPO} GITHUB_TOKEN={YOUR_TOKEN}</span>
</code></pre>
<h5>Via le paquet Node <code>travis-encrypt</code></h5>
<pre><code class="hljs language-bash">$ npm i -g travis-encrypt
$ travis-encrypt --add --repo {YOU/YOUR_REPO} GITHUB_TOKEN={YOUR_TOKEN}
</code></pre>
<p>Les 2 commandes devraient ajouter automatiquement le token encrypté dans votre
<code>.travis.yml</code> dans la section <code>env.global</code>.</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># …</span>

<span class="hljs-attr">env:</span>
  <span class="hljs-attr">global:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=production</span>
    <span class="hljs-comment"># Ajouter un petit commentaire pour indiquer que c’est votre token GitHub</span>
    <span class="hljs-comment"># GITHUB_TOKEN</span>
    <span class="hljs-comment"># cela permettra, si vous avez d’autres variables encryptées et</span>
    <span class="hljs-comment"># que vous devez changer de token pour X raison(s), de savoir lequel</span>
    <span class="hljs-comment"># supprimer</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">secure:</span> <span class="hljs-string">vqhHD....ROxGPQo=</span> <span class="hljs-comment"># VOTRE TOKEN DOIT ETRE PAR LA</span>
    <span class="hljs-comment"># vous aller maintenant ajouter une url utilisant le token</span>
    <span class="hljs-comment"># (pensez à ajuter l&#x27;url du repo)</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">GIT_DEPLOY_REPO=https://$GITHUB_TOKEN@github.com/YOU/YOUR_REPO.git</span>

    <span class="hljs-comment"># ici vous pouvez définir en plus d&#x27;autres variables non encryptées</span>
    <span class="hljs-comment"># qui seront réutilsables par la suite</span>
</code></pre>
<h3>Automatisation</h3>
<p>Imaginons que vous ayez un projet à deployer sur GitHub Pages (exemple : vous
générez un site statique avec <a href="https://phenomic.io/">Phenomic</a>, le générateur de
site statique qu'on utilise). Vous allez devoir générer votre projet, puis
ensuite pousser le dossier généré sur votre branche <code>gh-pages</code>.</p>
<h4>Utiliser la tâche de déploiement seulement si nécessaire</h4>
<p>Travis-CI possède une étape qui s'exécute après le succès des tests afin de
pouvoir faire un deploiement.</p>
<p><a href="https://docs.travis-ci.com/user/deployment/">https://docs.travis-ci.com/user/deployment/</a></p>
<p>Dans notre cas, on va choisir un provider très simple : un script bash.</p>
<p><strong>Par défaut, ceci sera executé pour tous les commits, sur toutes les
branches.</strong></p>
<p>On va donc devoir ajuster un peu le tir, car par exemple les commits sur
<code>gh-pages</code> ne doivent rien faire (déjà pour éviter la boucle infinie). Il en
sera de même pour les commits sur d'autres branches de travail ainsi que les
pull/merge requests, comme on l’a vu dans le précédent exemple.</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">deploy:</span>

  <span class="hljs-comment"># très important, on garde notre build, sans ça, nos fichiers buildés</span>
  <span class="hljs-comment"># sont supprimés.</span>
  <span class="hljs-attr">skip_cleanup:</span> <span class="hljs-literal">true</span>

  <span class="hljs-attr">provider:</span> <span class="hljs-string">script</span>
  <span class="hljs-attr">script:</span> <span class="hljs-string">./scripts/deploy.sh</span>

  <span class="hljs-comment"># ici on pose notre restriction</span>
  <span class="hljs-attr">on:</span>
    <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span>
    <span class="hljs-attr">node:</span> <span class="hljs-string">&#x27;5&#x27;</span>
</code></pre>
<h4>Écrire notre fameux <code>scripts/deploy.sh</code></h4>
<p>Dans le cas d’un déploiement de dossier sur une branche <code>gh-pages</code>, on peut
faire de manière assez simple avec le script suivant :</p>
<pre><code class="hljs language-sh"><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment"># on lit GIT_DEPLOY_REPO ou si y‘a pas on tente le package.json repository field</span>
<span class="hljs-comment"># (il faut une string et pas un objet dans ce cas)</span>
GIT_DEPLOY_REPO=<span class="hljs-variable">${GIT_DEPLOY_REPO:-$(node -e
&#x27;process.stdout.write(require(&quot;./package.json&quot;).repository)&#x27;)}</span>

<span class="hljs-comment"># on se déplace dans le dossier de build</span>
<span class="hljs-built_in">cd</span> dist &amp;&amp; \
<span class="hljs-comment"># on repart sur un repo git vierge, pas besoin de versionner quelque chose qui</span>
<span class="hljs-comment"># se build</span>
$(npm bin)/rimraf .git
git init &amp;&amp; \
<span class="hljs-comment"># il faut quelques infos pour que git soit content</span>
git config user.name <span class="hljs-string">&quot;Travis CI&quot;</span> &amp;&amp; \
git config user.email <span class="hljs-string">&quot;github@travis-ci.org&quot;</span> &amp;&amp; \
<span class="hljs-comment"># on met tout dans git et on commit</span>
git add . &amp;&amp; \
git commit -m <span class="hljs-string">&quot;Deploy to GitHub Pages&quot;</span> &amp;&amp; \
<span class="hljs-comment"># puis on force push sur gh-pages</span>
git push --force <span class="hljs-string">&quot;<span class="hljs-variable">${GIT_DEPLOY_REPO}</span>&quot;</span> master:gh-pages
</code></pre>
<h2>Y'a plus qu'à !</h2>
<p>Et voilà ! On pousse un commit sur <code>master</code> et la magie devrait opérer !</p>
<p><em>Note : pour commiter sans déclencher un build sur Travis-CI, il suffit
d'ajouter <code>[ci skip]</code> dans votre message de commit. Pratique quand on modifie
juste un README par exemple.</em></p>
<p>Cette méthode est celle que nous utilisons pour générer et deployer notre site
statique. Et cela permet, par exemple, si quelqu'un corrige une typo depuis
l'interface en ligne de GitHub, de n'avoir rien d'autre à faire que de « merger
» la correction (et pour rappel : vous pouvez <strong>modifier</strong> n'importe quel
article via le lien situé plus bas).</p>
<p>Travis exécutera nos tests, génèrera notre site si les tests sont bons et mettra
ça en production. Les mises en prod' le vendredi à 19 h 45 ? Même pas peur.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=D%C3%A9ploiement%20continu%20avec%20Travis-CI%20(et%20GitHub%20Pages)%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fdeploiement-continu-avec-travis-ci-et-gh-pages" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"deploiement-continu-avec-travis-ci-et-gh-pages","v":{"_0":{"TAG":0,"_0":{"slug":"deploiement-continu-avec-travis-ci-et-gh-pages","filename":"2016-04-19-deploiement-continu-avec-travis-ci-et-gh-pages","title":"Déploiement continu avec Travis-CI (et GitHub Pages)","date":"Tue, 19 Apr 2016 00:00:00 GMT","draft":false,"meta":{"date":"2016-04-19T00:00:00.000Z","title":"Déploiement continu avec Travis-CI (et GitHub Pages)","author":"MoOx","oldSlug":"ci/travis-ci","slug":"deploiement-continu-avec-travis-ci-et-gh-pages"},"body":"<p>On va partir comme ça : on a un projet sur git et tous les commits dans la\nbranche <code>master</code> provoqueront une mise en production automatique une fois les\ntests validés.</p>\n<p>Les autres commits sur les autres branches et pull/merge requests joueront juste\nles tests pour notifier l'état. Quand même.</p>\n<h2>C'est qui Travis?</h2>\n<p><a href=\"https://travis-ci.com/\">Travis-CI</a> est un service en ligne qui permet de tester\net déployer ses applications de manière automatisée.</p>\n<p>Ce service payant propose une solution gratuite à tous les projets open source,\nce qui est assez cool. Cette version est disponible sur\n<a href=\"https://travis-ci.org/\">travis-ci.org</a>. Il existe bien entendu plein d'autres\nservices similaires, mais Travis-CI étant très répandu dans la communauté open\nsource, on le prendra pour notre exemple.</p>\n<h2>Configuration de Travis-CI</h2>\n<p>Travis-CI fonctionne avec un fichier de configuration assez simple. Il n'y a\nqu'à voir\n<a href=\"https://github.com/putaindecode/putaindecode.io/blob/master/.travis.yml\">le nôtre</a>.</p>\n<p>Voici ci-dessous une version minimale pour faire tourner un projet node par\nexemple :</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">language:</span> <span class=\"hljs-string\">node_js</span>\n</code></pre>\n<p>Oui, c'est tout. Selon le language et/ou les fichiers présents, Travis-CI va\nchoisir la commande de test par défaut. Avec node par exemple, ce sera\n<code>npm test</code> si un package.json est présent. Si un <a href=\"/fr/articles/make/\">Makefile</a>\nest de la partie, Travis-CI va exécuter <code>make test</code>.</p>\n<p>Voici un fichier plus complet avec quelques exemples et trucs bons à savoir.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">language:</span> <span class=\"hljs-string\">node_js</span>\n\n<span class=\"hljs-attr\">node_js:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x27;5&#x27;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">‘4’</span>\n\n<span class=\"hljs-comment\"># échoue dès qu&#x27;une erreur intervient</span>\n<span class=\"hljs-attr\">matrix:</span>\n  <span class=\"hljs-attr\">fast_finish:</span> <span class=\"hljs-literal\">true</span>\n\n<span class=\"hljs-comment\"># met en cache node_modules, à noter que dans ce genre d’utilisation pour des</span>\n<span class=\"hljs-comment\"># bibliothèques open source consommées via npm, il ne faudra pas oublier</span>\n<span class=\"hljs-comment\"># npm prune utilisé ci-après, histoire de ne pas lancer des tests avec</span>\n<span class=\"hljs-comment\"># des paquets encore en cache mais non présents dans le package.json</span>\n<span class=\"hljs-attr\">cache:</span>\n  <span class=\"hljs-attr\">directories:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">node_modules</span>\n\n<span class=\"hljs-attr\">before_install:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">prune</span>\n\n<span class=\"hljs-comment\"># ici on peut mettre des commandes à utiliser avec le script</span>\n<span class=\"hljs-attr\">before_script:</span>\n  <span class=\"hljs-comment\"># certains runners comme karma, testem ou testling peuvent avoir</span>\n  <span class=\"hljs-comment\"># besoin d&#x27;un écran pour fonctionner, voici l&#x27;astuce :)</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">export</span> <span class=\"hljs-string\">DISPLAY=:99.0</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">sh</span> <span class=\"hljs-string\">-e</span> <span class=\"hljs-string\">/etc/init.d/xvfb</span> <span class=\"hljs-string\">start</span>\n\n<span class=\"hljs-comment\"># si on veut utiliser autre chose que la commande par défaut</span>\n<span class=\"hljs-attr\">script:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">test-with-coverage</span>\n\n<span class=\"hljs-comment\"># voici un exemple de ce que l’on peut faire après les tests :</span>\n<span class=\"hljs-comment\"># on peut lancer une tâche qui va envoyer les informations de</span>\n<span class=\"hljs-comment\"># pourcentage de couverture de code à un service tiers.</span>\n<span class=\"hljs-comment\"># (eg: http://coveralls.io/, https://codecov.io/)</span>\n<span class=\"hljs-attr\">after_success:</span> <span class=\"hljs-string\">&#x27;npm run coverage&#x27;</span>\n\n<span class=\"hljs-comment\"># partie intéressante : ici on ne va déployer que les commits sur la</span>\n<span class=\"hljs-comment\"># branche master uniquement pour une version de node</span>\n<span class=\"hljs-comment\"># (car sinon on déploierait plusieurs fois…)</span>\n<span class=\"hljs-attr\">deploy:</span>\n  <span class=\"hljs-attr\">skip_cleanup:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">provider:</span> <span class=\"hljs-string\">script</span>\n  <span class=\"hljs-attr\">script:</span> <span class=\"hljs-string\">./scripts/deploy.sh</span>\n  <span class=\"hljs-attr\">on:</span>\n    <span class=\"hljs-attr\">branch:</span> <span class=\"hljs-string\">master</span>\n    <span class=\"hljs-attr\">node:</span> <span class=\"hljs-string\">&#x27;5&#x27;</span>\n\n<span class=\"hljs-comment\"># variables d&#x27;env</span>\n<span class=\"hljs-attr\">env:</span>\n  <span class=\"hljs-attr\">global:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">NODE_ENV=production</span>\n</code></pre>\n<h2>Exemple concret</h2>\n<p>On va prendre un petit projet simple en JavaScript qu’on va déployer sur GitHub\nPages. Il va donc nous falloir un token GitHub qu’on va encrypter via un\nutilitaire spécifique afin de ne pas publier cela à la vue de tous.</p>\n<h3>Générer un token GitHub encrypté sur Travis-CI</h3>\n<p>Le plus simple est d’utiliser l'interface GitHub pour\n<a href=\"https://github.com/settings/tokens/new\">ajouter un token</a>.</p>\n<h4>Encryption du token et utilisation</h4>\n<p>Maintenant, nous allons encrypter ce token. Vous avez 2 possibilités :</p>\n<ul>\n<li>soit installer le paquet node <code>travis-encrypt</code></li>\n<li>soit installer la gem ruby <code>travis</code> (qui embarque la commande <code>encrypt</code>)</li>\n</ul>\n<h5>Via la gem Ruby <code>travis</code></h5>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> sudo gem install travis</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> travis encrypt --add --repo {YOU/YOUR_REPO} GITHUB_TOKEN={YOUR_TOKEN}</span>\n</code></pre>\n<h5>Via le paquet Node <code>travis-encrypt</code></h5>\n<pre><code class=\"hljs language-bash\">$ npm i -g travis-encrypt\n$ travis-encrypt --add --repo {YOU/YOUR_REPO} GITHUB_TOKEN={YOUR_TOKEN}\n</code></pre>\n<p>Les 2 commandes devraient ajouter automatiquement le token encrypté dans votre\n<code>.travis.yml</code> dans la section <code>env.global</code>.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># …</span>\n\n<span class=\"hljs-attr\">env:</span>\n  <span class=\"hljs-attr\">global:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">NODE_ENV=production</span>\n    <span class=\"hljs-comment\"># Ajouter un petit commentaire pour indiquer que c’est votre token GitHub</span>\n    <span class=\"hljs-comment\"># GITHUB_TOKEN</span>\n    <span class=\"hljs-comment\"># cela permettra, si vous avez d’autres variables encryptées et</span>\n    <span class=\"hljs-comment\"># que vous devez changer de token pour X raison(s), de savoir lequel</span>\n    <span class=\"hljs-comment\"># supprimer</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">secure:</span> <span class=\"hljs-string\">vqhHD....ROxGPQo=</span> <span class=\"hljs-comment\"># VOTRE TOKEN DOIT ETRE PAR LA</span>\n    <span class=\"hljs-comment\"># vous aller maintenant ajouter une url utilisant le token</span>\n    <span class=\"hljs-comment\"># (pensez à ajuter l&#x27;url du repo)</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">GIT_DEPLOY_REPO=https://$GITHUB_TOKEN@github.com/YOU/YOUR_REPO.git</span>\n\n    <span class=\"hljs-comment\"># ici vous pouvez définir en plus d&#x27;autres variables non encryptées</span>\n    <span class=\"hljs-comment\"># qui seront réutilsables par la suite</span>\n</code></pre>\n<h3>Automatisation</h3>\n<p>Imaginons que vous ayez un projet à deployer sur GitHub Pages (exemple : vous\ngénérez un site statique avec <a href=\"https://phenomic.io/\">Phenomic</a>, le générateur de\nsite statique qu'on utilise). Vous allez devoir générer votre projet, puis\nensuite pousser le dossier généré sur votre branche <code>gh-pages</code>.</p>\n<h4>Utiliser la tâche de déploiement seulement si nécessaire</h4>\n<p>Travis-CI possède une étape qui s'exécute après le succès des tests afin de\npouvoir faire un deploiement.</p>\n<p><a href=\"https://docs.travis-ci.com/user/deployment/\">https://docs.travis-ci.com/user/deployment/</a></p>\n<p>Dans notre cas, on va choisir un provider très simple : un script bash.</p>\n<p><strong>Par défaut, ceci sera executé pour tous les commits, sur toutes les\nbranches.</strong></p>\n<p>On va donc devoir ajuster un peu le tir, car par exemple les commits sur\n<code>gh-pages</code> ne doivent rien faire (déjà pour éviter la boucle infinie). Il en\nsera de même pour les commits sur d'autres branches de travail ainsi que les\npull/merge requests, comme on l’a vu dans le précédent exemple.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">deploy:</span>\n\n  <span class=\"hljs-comment\"># très important, on garde notre build, sans ça, nos fichiers buildés</span>\n  <span class=\"hljs-comment\"># sont supprimés.</span>\n  <span class=\"hljs-attr\">skip_cleanup:</span> <span class=\"hljs-literal\">true</span>\n\n  <span class=\"hljs-attr\">provider:</span> <span class=\"hljs-string\">script</span>\n  <span class=\"hljs-attr\">script:</span> <span class=\"hljs-string\">./scripts/deploy.sh</span>\n\n  <span class=\"hljs-comment\"># ici on pose notre restriction</span>\n  <span class=\"hljs-attr\">on:</span>\n    <span class=\"hljs-attr\">branch:</span> <span class=\"hljs-string\">master</span>\n    <span class=\"hljs-attr\">node:</span> <span class=\"hljs-string\">&#x27;5&#x27;</span>\n</code></pre>\n<h4>Écrire notre fameux <code>scripts/deploy.sh</code></h4>\n<p>Dans le cas d’un déploiement de dossier sur une branche <code>gh-pages</code>, on peut\nfaire de manière assez simple avec le script suivant :</p>\n<pre><code class=\"hljs language-sh\"><span class=\"hljs-meta\">#!/usr/bin/env bash</span>\n\n<span class=\"hljs-comment\"># on lit GIT_DEPLOY_REPO ou si y‘a pas on tente le package.json repository field</span>\n<span class=\"hljs-comment\"># (il faut une string et pas un objet dans ce cas)</span>\nGIT_DEPLOY_REPO=<span class=\"hljs-variable\">${GIT_DEPLOY_REPO:-$(node -e\n&#x27;process.stdout.write(require(&quot;./package.json&quot;).repository)&#x27;)}</span>\n\n<span class=\"hljs-comment\"># on se déplace dans le dossier de build</span>\n<span class=\"hljs-built_in\">cd</span> dist &amp;&amp; \\\n<span class=\"hljs-comment\"># on repart sur un repo git vierge, pas besoin de versionner quelque chose qui</span>\n<span class=\"hljs-comment\"># se build</span>\n$(npm bin)/rimraf .git\ngit init &amp;&amp; \\\n<span class=\"hljs-comment\"># il faut quelques infos pour que git soit content</span>\ngit config user.name <span class=\"hljs-string\">&quot;Travis CI&quot;</span> &amp;&amp; \\\ngit config user.email <span class=\"hljs-string\">&quot;github@travis-ci.org&quot;</span> &amp;&amp; \\\n<span class=\"hljs-comment\"># on met tout dans git et on commit</span>\ngit add . &amp;&amp; \\\ngit commit -m <span class=\"hljs-string\">&quot;Deploy to GitHub Pages&quot;</span> &amp;&amp; \\\n<span class=\"hljs-comment\"># puis on force push sur gh-pages</span>\ngit push --force <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">${GIT_DEPLOY_REPO}</span>&quot;</span> master:gh-pages\n</code></pre>\n<h2>Y'a plus qu'à !</h2>\n<p>Et voilà ! On pousse un commit sur <code>master</code> et la magie devrait opérer !</p>\n<p><em>Note : pour commiter sans déclencher un build sur Travis-CI, il suffit\nd'ajouter <code>[ci skip]</code> dans votre message de commit. Pratique quand on modifie\njuste un README par exemple.</em></p>\n<p>Cette méthode est celle que nous utilisons pour générer et deployer notre site\nstatique. Et cela permet, par exemple, si quelqu'un corrige une typo depuis\nl'interface en ligne de GitHub, de n'avoir rien d'autre à faire que de « merger\n» la correction (et pour rappel : vous pouvez <strong>modifier</strong> n'importe quel\narticle via le lien situé plus bas).</p>\n<p>Travis exécutera nos tests, génèrera notre site si les tests sont bons et mettra\nça en production. Les mises en prod' le vendredi à 19 h 45 ? Même pas peur.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>