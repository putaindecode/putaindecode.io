<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">L&#x27;injection de dépendances en PHP | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="L&#x27;injection de dépendances en PHP | Putain de code" property="og:title"/><meta data-react-helmet="true" content="L&#x27;injection de dépendances en PHP | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par neemzy" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/injection-de-dependances-en-php" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(107, 100%, 35%), hsl(89, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">L&#x27;injection de dépendances en PHP</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/neemzy"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="neemzy" src="https://avatars.githubusercontent.com/neemzy?size=64"/><div>neemzy<!-- --> <!-- -->•<!-- --> <!-- -->2014/11/05</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Salutations ! Aujourd'hui, je suis venu te parler de PHP (sisi), et notamment du
mécanisme d'injection de dépendances avec lequel tu n'es peut-être pas familier.
Au menu, des objets, des usines et des conteneurs, alors enfile ton bonnet et
tes gants, on va bouger du bordel !</p>
<h2>L'injection de dépendances ? C'est quoi ce truc ?</h2>
<p>Si tu fais de la programmation orientée objet, il est fort probable que ce terme
ne te soit pas totalement inconnu. En PHP, on a principalement commencé à nous
en rebattre les oreilles avec l'avènement de Symfony, qui est aujourd'hui le
framework web majeur pour ce langage. Fabien Potencier, créateur et <em>lead
developer</em> de Symfony, cite en exemple sur
<a href="http://fabien.potencier.org/article/11/what-is-dependency-injection">son blog</a>
cette définition :</p>
<blockquote>
<p><em>Dependency Injection is where components are given their dependencies through
their constructors, methods, or directly into fields.</em></p>
<p>Quelqu'un</p>
</blockquote>
<p>C'est clair, non ? Non ? Bon. Imaginons un bout d'appli PHP, où l'on désire
gérer des personnes qui ont chacune une adresse postale. Si tu n'as pas trop
dormi à la fac le vendredi matin après ta cuite du jeudi soir, tu devrais
pouvoir déterminer tout seul qu'on va avoir besoin d'une classe <code>Person</code> et
d'une classe <code>Address</code> :</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$number</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$street</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$zipcode</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$city</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span></span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;number = <span class="hljs-variable">$number</span>;
        <span class="hljs-keyword">$this</span>-&gt;street = <span class="hljs-variable">$street</span>;
        <span class="hljs-keyword">$this</span>-&gt;zipcode = <span class="hljs-variable">$zipcode</span>;
        <span class="hljs-keyword">$this</span>-&gt;city = <span class="hljs-variable">$city</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;
}
</code></pre>
<p>Tu noteras que je n'ai pas encore écrit le constructeur de la classe <code>Person</code>.
Justement. Le développeur naïf procédera de la façon suivante :</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span></span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;address = <span class="hljs-keyword">new</span> Address(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>);
    }
}

<span class="hljs-variable">$person</span> = <span class="hljs-keyword">new</span> Person(<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;Allée des Rosiers&#x27;</span>, <span class="hljs-number">78670</span>, <span class="hljs-string">&#x27;Villennes-sur-Seine&#x27;</span>);
</code></pre>
<p>Alors oui, hein, ça marche, et on peut instancier une personne et son adresse en
une ligne de code. Le problème est qu'en procédant ainsi, les classes <code>Person</code>
et <code>Address</code> deviennent <strong>étroitement couplées</strong> : la classe <code>Person</code> est
inutilisable sans la classe <code>Address</code>, et pire, le code interne de la première
serait impacté par un changement sur la seconde.</p>
<p>Pas convaincu ? Qu'est-ce qui se passera le jour où on lèvera 10 millions de
dollars pour internationaliser l'appli ?</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span>
</span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$country</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>, <span class="hljs-variable">$country</span></span>)
    </span>{
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">$this</span>-&gt;country = <span class="hljs-variable">$country</span>;
    }
}
</code></pre>
<p>Ah bah mince, il faut aussi modifier le constructeur de la classe <code>Person</code> pour
y ajouter le nouveau paramètre <code>$country</code> de manière symétrique. C'est ballot.</p>
<p>Dans l'idéal, la classe <code>Person</code> devrait se foutre royalement de la façon dont
la classe <code>Address</code> fonctionne. Une personne a toujours besoin d'une adresse,
mais ça n'implique certainement pas que ce soit le rôle de cette classe de la
forger. Alors, on fait comment ? C'est très simple :</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">Address <span class="hljs-variable">$address</span></span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;address = <span class="hljs-variable">$address</span>;
    }
}
</code></pre>
<p>L'injection de dépendances, c'est précisément ça. Si une classe a besoin d'une
instance d'une autre classe, que ce soit dans son constructeur ou dans une autre
méthode (un <em>setter</em> par exemple), alors elle prend cette instance directement
en paramètre et ne s'occupe certainement pas de l'instancier elle-même. Procéder
ainsi permet d'écrire du code <strong>découplé</strong>, évitant toute interdépendance entre
ses différents composants, ce qui les rend <strong>réutilisables</strong> sans devoir
embarquer toute la smala au passage, mais également beaucoup plus
<strong>maintenables</strong> puisque chaque classe s'occupe de ses fesses et pas de celles
des autres. En PHP, on tire également parti du <em>type hinting</em> d'objets, qui
permet de s'assurer d'emblée que notre paramètre est une instance de la classe
voulue et non pas n'importe quoi.</p>
<p>Alors oui, je t'entends déjà grommeler :</p>
<blockquote>
<p>Ouais mais du coup je dois instancier une adresse moi-même à chaque fois que
je crée une personne, c'est relou ton truc</p>
</blockquote>
<p>Si telle est ton opinion, <del>tu ne mérites pas de vivre</del> je t'invite à
poursuivre la lecture de cet article avec l'entrain qui te caractérise.</p>
<h2>L'usine à la rescousse</h2>
<p>Je ne sais pas si tu sais, mais il existe un <em>design pattern</em> assez répandu en
programmation orientée objet que l'on nomme <strong>factory</strong> (usine en français, d'où
le titre pourrave de cette partie).</p>
<p>En gros, le principe est de créer une classe dont le rôle est d'instancier
d'autres classes, précisément dans le cas où une telle tâche demande plusieurs
lignes de code, afin justement d'éviter de répéter celles-ci. Pour reprendre
notre exemple :</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonFactory</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPerson</span>(<span class="hljs-params"><span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>, <span class="hljs-variable">$country</span></span>)
    </span>{
        <span class="hljs-variable">$address</span> = <span class="hljs-keyword">new</span> Address(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$zipcode</span>, <span class="hljs-variable">$city</span>, <span class="hljs-variable">$country</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Person(<span class="hljs-variable">$address</span>);
    }
}
</code></pre>
<p>Pour le coup, tu te dis peut-être que je te prends allègrement pour un idiot :
pourquoi se prendre le chou à créer une classe qui fait exactement ce qu'on
faisait directement dans <code>Person</code> au départ ? Parce que tu n'as pas bien écouté,
<del>petit c</del> jeune padawan. L'objectif en utilisant l'injection de dépendances,
c'est que nos classes ne soient pas dépendantes (justement) les unes des autres
si ce n'est pas justifié. Une personne a beau avoir besoin d'une adresse, on
pourrait fort bien imaginer les utiliser l'une sans l'autre (tu comprendras à la
partie suivante). Dans le cas de <code>PersonFactory</code>, notre objectif est justement
de créer une personne à partir des différents composants d'une adresse en une
ligne de code, pour conserver la simplicité du code métier qui te tient tant à
coeur (et tu as bien raison, au fond). Seulement, <code>Person</code> et <code>Address</code> restent
utilisables avec ou sans <code>PersonFactory</code> : l'objectif est atteint, petit navire.</p>
<p>Tant qu'on en est à se simplifier la vie :</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonFactory</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getZipcodeFromDistrict</span>(<span class="hljs-params"><span class="hljs-variable">$district</span></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-number">75000</span> + <span class="hljs-variable">$district</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createParigot</span>(<span class="hljs-params"><span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-variable">$district</span></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;createPerson(<span class="hljs-variable">$number</span>, <span class="hljs-variable">$street</span>, <span class="hljs-keyword">$this</span>-&gt;getZipcodeFromDistrict(<span class="hljs-variable">$district</span>), <span class="hljs-string">&#x27;Paris&#x27;</span>, <span class="hljs-string">&#x27;France&#x27;</span>);
    }
}
</code></pre>
<p>Tu t'imagines faire ce genre de chose dans la classe <code>Person</code> ou la classe
<code>Address</code> ? J'espère bien que non.</p>
<h2>Oui, ça sert à quelque chose une interface</h2>
<p>Dans tes souvenirs brumeux de vendredis matins étudiants (<em>cf. supra</em>), tu
retrouveras peut-être des bribes de cours portant sur les <strong>interfaces</strong>. Si
tout ce que tu as retenu, c'est qu'&quot;une classe toute vide ça sert à rien&quot;, lis
donc ce qui va suivre.</p>
<p>Une interface, c'est avant tout un contrat. Une classe qui <strong>implémente</strong> une
interface s'engage à implémenter toutes les méthodes que celle-ci déclare. Sans
même lire le code de ladite classe, on sait donc d'emblée comment on peut jouer
avec et comment elle est censée fonctionner.</p>
<p>Poursuivons encore sur notre exemple et imaginons qu'on doive gérer des adresses
ne respectant pas le format utilisé jusqu'ici, par exemple une adresse plus
basique constituée d'une unique chaîne de caractères :</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicAddress</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;
}
</code></pre>
<p>Dans l'état actuel des choses, on ne peut pas utiliser une instance de cette
classe avec <code>Person</code>, puisque le constructeur de cette dernière attend une
instance d'<code>Address</code>. Qu'à cela ne tienne !</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AddressInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFullAddress</span>(<span class="hljs-params"></span>)</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicAddress</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AddressInterface</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$address</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFullAddress</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;address;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Address</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AddressInterface</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFullAddress</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;number.<span class="hljs-string">&#x27;, &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;street.<span class="hljs-string">&#x27;, &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;zipcode.<span class="hljs-string">&#x27; &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;city.<span class="hljs-string">&#x27;, &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;country;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
</span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">AddressInterface <span class="hljs-variable">$address</span></span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;address = <span class="hljs-variable">$address</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAddress</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;address;
    }
}

<span class="hljs-variable">$address</span> = <span class="hljs-keyword">new</span> BasicAddress(<span class="hljs-string">&#x27;test test un deux un deux&#x27;</span>);
<span class="hljs-variable">$person</span> = <span class="hljs-keyword">new</span> Person(<span class="hljs-variable">$address</span>);

<span class="hljs-variable">$factory</span> = <span class="hljs-keyword">new</span> PersonFactory();
<span class="hljs-variable">$robert</span> = <span class="hljs-variable">$factory</span>-&gt;createParigot(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Rue de la Paix&#x27;</span>, <span class="hljs-number">2</span>);

<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$person</span>-&gt;getAddress()-&gt;getFullAddress()); <span class="hljs-comment">// &#x27;test test un deux un deux&#x27;</span>
<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$robert</span>-&gt;getAddress()-&gt;getFullAddress()); <span class="hljs-comment">// &#x27;1, rue de la Paix, 75002 Paris, France&#x27;</span>
</code></pre>
<p>Tu vois l'idée ? En demandant une instance de n'importe quelle classe
implémentant <code>AddressInterface</code> au lieu d'une instance d'<code>Address</code>
spécifiquement, on se donne plus de mou et on réduit encore davantage le
couplage entre nos classes. Qu'on crée une personne avec une instance
d'<code>Address</code> ou de <code>BasicAddress</code>, on pourra dans tous les cas obtenir l'adresse
postale de ladite personne de la même façon.</p>
<h2>Elle contient ta fiancée, hein Mitch ?</h2>
<p>Tu auras peut-être tiqué sur un détail du dernier exemple : le fait de ne pas
faire de <code>PersonFactory</code> une classe statique (beurk) nous oblige à l'instancier
pour pouvoir l'utiliser ; ce qui, à n'en pas douter, t'aura mené à te dire &quot;arf,
ça va m'en faire des <code>new MachinFactory()</code> pour instancier mes objets&quot;. Là
encore, l'injection de dépendances peut nous aider, quoique de manière indirecte
: en utilisant un conteneur d'injection de dépendances.</p>
<p>Un conteneur (ça sera plus court) peut <em>grosso modo</em> être comparé à une grosse
<em>factory</em> capable d'instancier plusieurs classes. En pratique, afin d'éviter
d'écrire et de devoir maintenir une classe monolithique, on en fera plutôt
quelque chose qui fait appel aux différentes <em>factories</em>. Poursuivons sur notre
exemple :</p>
<pre><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DependencyInjectionContainer</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPersonFactory</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PersonFactory();
    }
}
</code></pre>
<p>Mais ça ne s'arrête évidemment pas là. De par le fait d'utiliser l'injection de
dépendances à grande échelle, on a souvent besoin d'instancier nous-même les
objets dont on a besoin. Dans certains cas, ce seront toujours les mêmes, ce qui
vaut pour les <em>factories</em> mais pas que : pense aux différentes librairies qui
composent un projet web, par exemple. Ce ne serait pas génial que les
différentes instances de ces classes soient accessibles via le conteneur pour
pouvoir y accéder à l'envi ?</p>
<pre><code class="hljs language-php"><span class="hljs-variable">$container</span> = <span class="hljs-keyword">new</span> DependencyInjectionContainer();

<span class="hljs-variable">$container</span>-&gt;getOrm()-&gt;performSomeNaughtyQuery();
<span class="hljs-variable">$container</span>-&gt;getTwig()-&gt;renderUglyTemplate();
<span class="hljs-variable">$container</span>-&gt;getTranslator()-&gt;translate(<span class="hljs-string">&#x27;Putain de code !&#x27;</span>);
</code></pre>
<p>Les objets ainsi gérés par un tel conteneur deviennent dès lors des <strong>services</strong>
dans ton application.</p>
<blockquote>
<p>Mais ça signifie instancier un service à chaque appel ?</p>
</blockquote>
<p>Pas nécessairement ! Il existe des mécanismes permettant de conserver une même
instance pour la servir lors des appels suivants. Cela sort un peu du cadre de
cet article, mais je t'invite vivement à jeter un oeil à
<a href="http://php-di.org/">PHP-DI</a>, qui est un conteneur d'injection de dépendances
très bien fichu que tu peux utiliser dans ton projet si tu le souhaites.</p>
<h2>Épilogue</h2>
<p>Si tu développes en PHP, j'espère t'avoir montré qu'il est possible d'écrire du
code plus maintenable et plus élégant en utilisant l'injection de dépendances.
Dans le cas contraire, sache que ce concept est très répandu dans les langages
orientés objet d'une manière générale - après tout,
<a href="https://docs.angularjs.org/guide/di">on en retrouve même dans Angular</a>.</p>
<p>Bon code, et n'oublie pas, on ne met pas en prod le vendredi, c'est mal. Allez,
file !</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=L&#x27;injection%20de%20d%C3%A9pendances%20en%20PHP%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Finjection-de-dependances-en-php" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"injection-de-dependances-en-php","v":{"_0":{"TAG":0,"_0":{"slug":"injection-de-dependances-en-php","filename":"2014-11-05-injection-de-dependances-en-php","title":"L'injection de dépendances en PHP","date":"Wed, 05 Nov 2014 00:00:00 GMT","draft":false,"meta":{"date":"2014-11-05T00:00:00.000Z","title":"L'injection de dépendances en PHP","author":"neemzy","oldSlug":"php/injection-dependances","slug":"injection-de-dependances-en-php"},"body":"<p>Salutations ! Aujourd'hui, je suis venu te parler de PHP (sisi), et notamment du\nmécanisme d'injection de dépendances avec lequel tu n'es peut-être pas familier.\nAu menu, des objets, des usines et des conteneurs, alors enfile ton bonnet et\ntes gants, on va bouger du bordel !</p>\n<h2>L'injection de dépendances ? C'est quoi ce truc ?</h2>\n<p>Si tu fais de la programmation orientée objet, il est fort probable que ce terme\nne te soit pas totalement inconnu. En PHP, on a principalement commencé à nous\nen rebattre les oreilles avec l'avènement de Symfony, qui est aujourd'hui le\nframework web majeur pour ce langage. Fabien Potencier, créateur et <em>lead\ndeveloper</em> de Symfony, cite en exemple sur\n<a href=\"http://fabien.potencier.org/article/11/what-is-dependency-injection\">son blog</a>\ncette définition :</p>\n<blockquote>\n<p><em>Dependency Injection is where components are given their dependencies through\ntheir constructors, methods, or directly into fields.</em></p>\n<p>Quelqu'un</p>\n</blockquote>\n<p>C'est clair, non ? Non ? Bon. Imaginons un bout d'appli PHP, où l'on désire\ngérer des personnes qui ont chacune une adresse postale. Si tu n'as pas trop\ndormi à la fac le vendredi matin après ta cuite du jeudi soir, tu devrais\npouvoir déterminer tout seul qu'on va avoir besoin d'une classe <code>Person</code> et\nd'une classe <code>Address</code> :</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Address</span>\n</span>{\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$number</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$street</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$zipcode</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$city</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">__construct</span>(<span class=\"hljs-params\"><span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-variable\">$zipcode</span>, <span class=\"hljs-variable\">$city</span></span>)\n    </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;number = <span class=\"hljs-variable\">$number</span>;\n        <span class=\"hljs-keyword\">$this</span>-&gt;street = <span class=\"hljs-variable\">$street</span>;\n        <span class=\"hljs-keyword\">$this</span>-&gt;zipcode = <span class=\"hljs-variable\">$zipcode</span>;\n        <span class=\"hljs-keyword\">$this</span>-&gt;city = <span class=\"hljs-variable\">$city</span>;\n    }\n}\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Person</span>\n</span>{\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$address</span>;\n}\n</code></pre>\n<p>Tu noteras que je n'ai pas encore écrit le constructeur de la classe <code>Person</code>.\nJustement. Le développeur naïf procédera de la façon suivante :</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Person</span>\n</span>{\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$address</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">__construct</span>(<span class=\"hljs-params\"><span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-variable\">$zipcode</span>, <span class=\"hljs-variable\">$city</span></span>)\n    </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;address = <span class=\"hljs-keyword\">new</span> Address(<span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-variable\">$zipcode</span>, <span class=\"hljs-variable\">$city</span>);\n    }\n}\n\n<span class=\"hljs-variable\">$person</span> = <span class=\"hljs-keyword\">new</span> Person(<span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">&#x27;Allée des Rosiers&#x27;</span>, <span class=\"hljs-number\">78670</span>, <span class=\"hljs-string\">&#x27;Villennes-sur-Seine&#x27;</span>);\n</code></pre>\n<p>Alors oui, hein, ça marche, et on peut instancier une personne et son adresse en\nune ligne de code. Le problème est qu'en procédant ainsi, les classes <code>Person</code>\net <code>Address</code> deviennent <strong>étroitement couplées</strong> : la classe <code>Person</code> est\ninutilisable sans la classe <code>Address</code>, et pire, le code interne de la première\nserait impacté par un changement sur la seconde.</p>\n<p>Pas convaincu ? Qu'est-ce qui se passera le jour où on lèvera 10 millions de\ndollars pour internationaliser l'appli ?</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Address</span>\n</span>{\n    <span class=\"hljs-comment\">// ...</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$country</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">__construct</span>(<span class=\"hljs-params\"><span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-variable\">$zipcode</span>, <span class=\"hljs-variable\">$city</span>, <span class=\"hljs-variable\">$country</span></span>)\n    </span>{\n        <span class=\"hljs-comment\">// ...</span>\n        <span class=\"hljs-keyword\">$this</span>-&gt;country = <span class=\"hljs-variable\">$country</span>;\n    }\n}\n</code></pre>\n<p>Ah bah mince, il faut aussi modifier le constructeur de la classe <code>Person</code> pour\ny ajouter le nouveau paramètre <code>$country</code> de manière symétrique. C'est ballot.</p>\n<p>Dans l'idéal, la classe <code>Person</code> devrait se foutre royalement de la façon dont\nla classe <code>Address</code> fonctionne. Une personne a toujours besoin d'une adresse,\nmais ça n'implique certainement pas que ce soit le rôle de cette classe de la\nforger. Alors, on fait comment ? C'est très simple :</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Person</span>\n</span>{\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$address</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">__construct</span>(<span class=\"hljs-params\">Address <span class=\"hljs-variable\">$address</span></span>)\n    </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;address = <span class=\"hljs-variable\">$address</span>;\n    }\n}\n</code></pre>\n<p>L'injection de dépendances, c'est précisément ça. Si une classe a besoin d'une\ninstance d'une autre classe, que ce soit dans son constructeur ou dans une autre\nméthode (un <em>setter</em> par exemple), alors elle prend cette instance directement\nen paramètre et ne s'occupe certainement pas de l'instancier elle-même. Procéder\nainsi permet d'écrire du code <strong>découplé</strong>, évitant toute interdépendance entre\nses différents composants, ce qui les rend <strong>réutilisables</strong> sans devoir\nembarquer toute la smala au passage, mais également beaucoup plus\n<strong>maintenables</strong> puisque chaque classe s'occupe de ses fesses et pas de celles\ndes autres. En PHP, on tire également parti du <em>type hinting</em> d'objets, qui\npermet de s'assurer d'emblée que notre paramètre est une instance de la classe\nvoulue et non pas n'importe quoi.</p>\n<p>Alors oui, je t'entends déjà grommeler :</p>\n<blockquote>\n<p>Ouais mais du coup je dois instancier une adresse moi-même à chaque fois que\nje crée une personne, c'est relou ton truc</p>\n</blockquote>\n<p>Si telle est ton opinion, <del>tu ne mérites pas de vivre</del> je t'invite à\npoursuivre la lecture de cet article avec l'entrain qui te caractérise.</p>\n<h2>L'usine à la rescousse</h2>\n<p>Je ne sais pas si tu sais, mais il existe un <em>design pattern</em> assez répandu en\nprogrammation orientée objet que l'on nomme <strong>factory</strong> (usine en français, d'où\nle titre pourrave de cette partie).</p>\n<p>En gros, le principe est de créer une classe dont le rôle est d'instancier\nd'autres classes, précisément dans le cas où une telle tâche demande plusieurs\nlignes de code, afin justement d'éviter de répéter celles-ci. Pour reprendre\nnotre exemple :</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PersonFactory</span>\n</span>{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">createPerson</span>(<span class=\"hljs-params\"><span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-variable\">$zipcode</span>, <span class=\"hljs-variable\">$city</span>, <span class=\"hljs-variable\">$country</span></span>)\n    </span>{\n        <span class=\"hljs-variable\">$address</span> = <span class=\"hljs-keyword\">new</span> Address(<span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-variable\">$zipcode</span>, <span class=\"hljs-variable\">$city</span>, <span class=\"hljs-variable\">$country</span>);\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> Person(<span class=\"hljs-variable\">$address</span>);\n    }\n}\n</code></pre>\n<p>Pour le coup, tu te dis peut-être que je te prends allègrement pour un idiot :\npourquoi se prendre le chou à créer une classe qui fait exactement ce qu'on\nfaisait directement dans <code>Person</code> au départ ? Parce que tu n'as pas bien écouté,\n<del>petit c</del> jeune padawan. L'objectif en utilisant l'injection de dépendances,\nc'est que nos classes ne soient pas dépendantes (justement) les unes des autres\nsi ce n'est pas justifié. Une personne a beau avoir besoin d'une adresse, on\npourrait fort bien imaginer les utiliser l'une sans l'autre (tu comprendras à la\npartie suivante). Dans le cas de <code>PersonFactory</code>, notre objectif est justement\nde créer une personne à partir des différents composants d'une adresse en une\nligne de code, pour conserver la simplicité du code métier qui te tient tant à\ncoeur (et tu as bien raison, au fond). Seulement, <code>Person</code> et <code>Address</code> restent\nutilisables avec ou sans <code>PersonFactory</code> : l'objectif est atteint, petit navire.</p>\n<p>Tant qu'on en est à se simplifier la vie :</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PersonFactory</span>\n</span>{\n    <span class=\"hljs-comment\">// ...</span>\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getZipcodeFromDistrict</span>(<span class=\"hljs-params\"><span class=\"hljs-variable\">$district</span></span>)\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">75000</span> + <span class=\"hljs-variable\">$district</span>;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">createParigot</span>(<span class=\"hljs-params\"><span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-variable\">$district</span></span>)\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;createPerson(<span class=\"hljs-variable\">$number</span>, <span class=\"hljs-variable\">$street</span>, <span class=\"hljs-keyword\">$this</span>-&gt;getZipcodeFromDistrict(<span class=\"hljs-variable\">$district</span>), <span class=\"hljs-string\">&#x27;Paris&#x27;</span>, <span class=\"hljs-string\">&#x27;France&#x27;</span>);\n    }\n}\n</code></pre>\n<p>Tu t'imagines faire ce genre de chose dans la classe <code>Person</code> ou la classe\n<code>Address</code> ? J'espère bien que non.</p>\n<h2>Oui, ça sert à quelque chose une interface</h2>\n<p>Dans tes souvenirs brumeux de vendredis matins étudiants (<em>cf. supra</em>), tu\nretrouveras peut-être des bribes de cours portant sur les <strong>interfaces</strong>. Si\ntout ce que tu as retenu, c'est qu'&quot;une classe toute vide ça sert à rien&quot;, lis\ndonc ce qui va suivre.</p>\n<p>Une interface, c'est avant tout un contrat. Une classe qui <strong>implémente</strong> une\ninterface s'engage à implémenter toutes les méthodes que celle-ci déclare. Sans\nmême lire le code de ladite classe, on sait donc d'emblée comment on peut jouer\navec et comment elle est censée fonctionner.</p>\n<p>Poursuivons encore sur notre exemple et imaginons qu'on doive gérer des adresses\nne respectant pas le format utilisé jusqu'ici, par exemple une adresse plus\nbasique constituée d'une unique chaîne de caractères :</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BasicAddress</span>\n</span>{\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$address</span>;\n}\n</code></pre>\n<p>Dans l'état actuel des choses, on ne peut pas utiliser une instance de cette\nclasse avec <code>Person</code>, puisque le constructeur de cette dernière attend une\ninstance d'<code>Address</code>. Qu'à cela ne tienne !</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">AddressInterface</span>\n</span>{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getFullAddress</span>(<span class=\"hljs-params\"></span>)</span>;\n}\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BasicAddress</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">AddressInterface</span>\n</span>{\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-variable\">$address</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getFullAddress</span>(<span class=\"hljs-params\"></span>)\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;address;\n    }\n}\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Address</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">AddressInterface</span>\n</span>{\n    <span class=\"hljs-comment\">// ...</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getFullAddress</span>(<span class=\"hljs-params\"></span>)\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;number.<span class=\"hljs-string\">&#x27;, &#x27;</span>.<span class=\"hljs-keyword\">$this</span>-&gt;street.<span class=\"hljs-string\">&#x27;, &#x27;</span>.<span class=\"hljs-keyword\">$this</span>-&gt;zipcode.<span class=\"hljs-string\">&#x27; &#x27;</span>.<span class=\"hljs-keyword\">$this</span>-&gt;city.<span class=\"hljs-string\">&#x27;, &#x27;</span>.<span class=\"hljs-keyword\">$this</span>-&gt;country;\n    }\n}\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Person</span>\n</span>{\n    <span class=\"hljs-comment\">// ...</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">__construct</span>(<span class=\"hljs-params\">AddressInterface <span class=\"hljs-variable\">$address</span></span>)\n    </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;address = <span class=\"hljs-variable\">$address</span>;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getAddress</span>(<span class=\"hljs-params\"></span>)\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;address;\n    }\n}\n\n<span class=\"hljs-variable\">$address</span> = <span class=\"hljs-keyword\">new</span> BasicAddress(<span class=\"hljs-string\">&#x27;test test un deux un deux&#x27;</span>);\n<span class=\"hljs-variable\">$person</span> = <span class=\"hljs-keyword\">new</span> Person(<span class=\"hljs-variable\">$address</span>);\n\n<span class=\"hljs-variable\">$factory</span> = <span class=\"hljs-keyword\">new</span> PersonFactory();\n<span class=\"hljs-variable\">$robert</span> = <span class=\"hljs-variable\">$factory</span>-&gt;createParigot(<span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&#x27;Rue de la Paix&#x27;</span>, <span class=\"hljs-number\">2</span>);\n\n<span class=\"hljs-keyword\">echo</span>(<span class=\"hljs-variable\">$person</span>-&gt;getAddress()-&gt;getFullAddress()); <span class=\"hljs-comment\">// &#x27;test test un deux un deux&#x27;</span>\n<span class=\"hljs-keyword\">echo</span>(<span class=\"hljs-variable\">$robert</span>-&gt;getAddress()-&gt;getFullAddress()); <span class=\"hljs-comment\">// &#x27;1, rue de la Paix, 75002 Paris, France&#x27;</span>\n</code></pre>\n<p>Tu vois l'idée ? En demandant une instance de n'importe quelle classe\nimplémentant <code>AddressInterface</code> au lieu d'une instance d'<code>Address</code>\nspécifiquement, on se donne plus de mou et on réduit encore davantage le\ncouplage entre nos classes. Qu'on crée une personne avec une instance\nd'<code>Address</code> ou de <code>BasicAddress</code>, on pourra dans tous les cas obtenir l'adresse\npostale de ladite personne de la même façon.</p>\n<h2>Elle contient ta fiancée, hein Mitch ?</h2>\n<p>Tu auras peut-être tiqué sur un détail du dernier exemple : le fait de ne pas\nfaire de <code>PersonFactory</code> une classe statique (beurk) nous oblige à l'instancier\npour pouvoir l'utiliser ; ce qui, à n'en pas douter, t'aura mené à te dire &quot;arf,\nça va m'en faire des <code>new MachinFactory()</code> pour instancier mes objets&quot;. Là\nencore, l'injection de dépendances peut nous aider, quoique de manière indirecte\n: en utilisant un conteneur d'injection de dépendances.</p>\n<p>Un conteneur (ça sera plus court) peut <em>grosso modo</em> être comparé à une grosse\n<em>factory</em> capable d'instancier plusieurs classes. En pratique, afin d'éviter\nd'écrire et de devoir maintenir une classe monolithique, on en fera plutôt\nquelque chose qui fait appel aux différentes <em>factories</em>. Poursuivons sur notre\nexemple :</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DependencyInjectionContainer</span>\n</span>{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getPersonFactory</span>(<span class=\"hljs-params\"></span>)\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> PersonFactory();\n    }\n}\n</code></pre>\n<p>Mais ça ne s'arrête évidemment pas là. De par le fait d'utiliser l'injection de\ndépendances à grande échelle, on a souvent besoin d'instancier nous-même les\nobjets dont on a besoin. Dans certains cas, ce seront toujours les mêmes, ce qui\nvaut pour les <em>factories</em> mais pas que : pense aux différentes librairies qui\ncomposent un projet web, par exemple. Ce ne serait pas génial que les\ndifférentes instances de ces classes soient accessibles via le conteneur pour\npouvoir y accéder à l'envi ?</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-variable\">$container</span> = <span class=\"hljs-keyword\">new</span> DependencyInjectionContainer();\n\n<span class=\"hljs-variable\">$container</span>-&gt;getOrm()-&gt;performSomeNaughtyQuery();\n<span class=\"hljs-variable\">$container</span>-&gt;getTwig()-&gt;renderUglyTemplate();\n<span class=\"hljs-variable\">$container</span>-&gt;getTranslator()-&gt;translate(<span class=\"hljs-string\">&#x27;Putain de code !&#x27;</span>);\n</code></pre>\n<p>Les objets ainsi gérés par un tel conteneur deviennent dès lors des <strong>services</strong>\ndans ton application.</p>\n<blockquote>\n<p>Mais ça signifie instancier un service à chaque appel ?</p>\n</blockquote>\n<p>Pas nécessairement ! Il existe des mécanismes permettant de conserver une même\ninstance pour la servir lors des appels suivants. Cela sort un peu du cadre de\ncet article, mais je t'invite vivement à jeter un oeil à\n<a href=\"http://php-di.org/\">PHP-DI</a>, qui est un conteneur d'injection de dépendances\ntrès bien fichu que tu peux utiliser dans ton projet si tu le souhaites.</p>\n<h2>Épilogue</h2>\n<p>Si tu développes en PHP, j'espère t'avoir montré qu'il est possible d'écrire du\ncode plus maintenable et plus élégant en utilisant l'injection de dépendances.\nDans le cas contraire, sache que ce concept est très répandu dans les langages\norientés objet d'une manière générale - après tout,\n<a href=\"https://docs.angularjs.org/guide/di\">on en retrouve même dans Angular</a>.</p>\n<p>Bon code, et n'oublie pas, on ne met pas en prod le vendredi, c'est mal. Allez,\nfile !</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>