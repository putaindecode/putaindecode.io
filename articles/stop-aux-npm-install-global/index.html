<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Stop aux `npm install -g` sauvages (ou pourquoi vous ne devriez pas installer en global de packages et outils CLI) | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Stop aux `npm install -g` sauvages (ou pourquoi vous ne devriez pas installer en global de packages et outils CLI) | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Stop aux `npm install -g` sauvages (ou pourquoi vous ne devriez pas installer en global de packages et outils CLI) | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par MoOx" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/stop-aux-npm-install-global" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(255, 100%, 35%), hsl(212, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Stop aux `npm install -g` sauvages (ou pourquoi vous ne devriez pas installer en global de packages et outils CLI)</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/MoOx"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="MoOx" src="https://avatars.githubusercontent.com/MoOx?size=64"/><div>MoOx<!-- --> <!-- -->•<!-- --> <!-- -->2017/11/30</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>À chaque fois qu’un développeur installe un outil globalement, une discussion
tabs vs spaces commence. Et Dieu sait que c’est inutile. Les espaces c’est
mieux. Fin de la discussion.</p>
<p>À chaque fois qu’un développeur utilise un outil de développement global, un
chaton meurt. Et Dieu sait que nous aimons les chats.</p>
<p>Plus sérieusement, c’est une vraie question. Et une bonne question.</p>
<h2>Pourquoi installer un outil de manière globale sur sa machine est une mauvaise idée?</h2>
<p>On va tenter de répondre ici de manière constructive.</p>
<p>La raison est simple et c’est la même raison pour laquelle aujourd’hui il y a
Yarn et npm 5 qui utilisent des fichiers <code>lock</code> : parce que vous voulez avoir
l'assurance d'avoir la même version que vos collègues.</p>
<p>Très souvent, dans le fond un outil CLI n’est rien de plus qu’une dépendance à
un projet. Il est tout à fait (voire hautement) probable que sur deux projets
différents développés à deux instants différents dans le temps vous ayez utilisé
deux versions différentes d’un outil.</p>
<p>Le premier exemple de ma vie qui me vient en tête c’est les pré-processeurs CSS.
À l’époque où j’utilisais Sass, il était courant que pour une raison X ou Y (par
exemple une nouvelle fonctionnalité disponible dans une version majeure) que je
dois mettre à jour la version pour le projet en cours. Mais que se passe-t-il
alors pour tous mes anciens projets ? Vont-ils être compatibles ? Vont-ils avoir
des problèmes ? Vais-je devoir mettre mes autres projets à jour ? Cela va-t-il
me faire chier d’une manière hors du commun ?</p>
<p>Vous avez ici des vraies questions d'ordre pratique. Ça a dû arriver à tout le
monde d’avoir ce cas de figure.</p>
<p>Et je vais ajouter à ceci un autre problème.</p>
<h2>« mais puisse ke je te di ke sa marche cez moi ! »</h2>
<p>On a tous travaillé à plus de deux développeurs sur un projet (et encore ça peut
nous arriver tout seul au changement de machine)</p>
<p>Le fameux « ça marche sur ma machine ». Celui-là qui prend grâve la tête.
Celui-là qui peut nous faire perdre des heures à comprendre pourquoi ça marche
pas sur le PC des collègues.</p>
<p>Celui-là qui énerve les personnes chez qui ça marche et ceux chez qui cela ne
marche pas. Oui ça fait clairement chier tout le monde.</p>
<p>Du coup pour éviter ce problème, il y a une méthode simple.</p>
<h2>Ne jamais (ô grand jamais) installer un outil de développeur globalement sur sa machine.</h2>
<p>De rien. Voilà c’était un conseil gratuit.</p>
<p>(Je détaillerai à la fin de cet article les seules raisons valables pour
utiliser et installer globalement un package ou un outil CLI)</p>
<p>Bon du coup pour éviter ce problème on a une solution extrêmement simple :
installer localement à chaque projet TOUTES les dépendances.</p>
<p>Il y a deux choses que peu de gens savent : la première est que npm et yarn vont
automatiquement ajouter tous les bin disponibles de tous les node_modules locaux
dans le PATH utilisé via les scripts définis dans votre package.json.</p>
<p>Du coup dans la pratique il vous suffit de vous faire un petit alias pour chaque
outil CLI et le tour est joué.</p>
<pre><code class="hljs language-js">{
  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">&quot;cmd&quot;</span> <span class="hljs-comment">// on assume qu&#x27;on a un outil qui offre le bin `cmd`</span>
  }
}
</code></pre>
<pre><code class="hljs language-console">npm run cmd
</code></pre>
<p>À savoir avec npm il faudra rajouter des — à la fin d’une commande pour que cela
fonctionne correctement si vous passez des arguments.</p>
<pre><code class="hljs language-console">npm run cmd -- arg
</code></pre>
<p>Avec Yarn, cela n’est pas nécessaire. C’est bien plus bref (et pratique).</p>
<pre><code class="hljs language-console">yarn cmd arg
</code></pre>
<p>Il faut savoir que pour les développeurs de ce type d’outil c’est aussi un petit
cauchemar à gérer.</p>
<p>Lorsqu’un outil a une package offrant une interface CLI, comment savoir si la
version de la bibliothèque fonctionnera avec ?</p>
<p>De cette problématique est née une solution récurrente : les packages qui ont une
CLI et une bibliothèque en parallèle vont très souvent avoir une CLI très light
qui va en général consister à aller chercher dans le dossier de la bibliothèque
où vous vous trouvez le vrai code à exécuter.</p>
<p>Je dirais même que c’est plutôt cool dans un sens.</p>
<p>Mais on voit bien ici qu’on a un petit problème car cela demande du travail
supplémentaire aux développeurs des projets qui sont déjà trop souvent à flirter
avec le burnout.</p>
<h2>Petite astuce bien stylée</h2>
<p>Vous pouvez ajouter tous les binaires de <code>node_modules/.bin</code> localement à votre
PATH histoire de pouvoir les utiliser en CLI.</p>
<pre><code class="hljs language-sh"><span class="hljs-comment"># to avoid npm install -g / yarn global add</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:./node_modules/.bin
</code></pre>
<p>Une fois cette astuce réalisée, déposez dans votre <code>.bashrc</code> (ou<code>.zshrc</code>…), vous
pourrez utiliser des bin locaux à votre projet comme si ils avaient été
installés globalement. Sans passer par alias. Mais ça ne marchera bien entendu
qu’à la racine du projet. Ça reste bien pratique n’est-ce pas?</p>
<p>(Et non, si vous faites ça dans l'ordre décrit plus haut, il n'y a pas de soucis
de sécurité genre <em>&quot;un package remplace <code>rm</code> et fait ce qu'il veut avec mes
données&quot;</em> puisque la priorité sera donnée à la première partie du <code>PATH</code>.)</p>
<h2>Alternative bien stylée</h2>
<p>Si vous n'êtes pas fan de modifier votre <code>PATH</code>,
<a href="https://www.npmjs.com/package/npx"><code>npx</code></a> est un outil qui va justement
permettre d'appeler les <code>node_modules/.bin</code> locaux sans le modifier.</p>
<p>Ah mais comment on l'installe? Avec <code>-g</code> pardi ! Je plaisante. Il est inclus
avec <code>npm</code>. Faites un petit <code>which npx</code> pour vérifier!</p>
<p>Dans tous les cas, <code>npx</code> fait partie des rares outils qui méritent d'être
installés en global, ceux qui sont pour l'environnement du développeur, pas pour
un projet.</p>
<p>D'ailleurs parlons en de ces cas où <code>-g</code> est valide.</p>
<h2>Les seuls cas valides où les outils globaux ont du sens</h2>
<p>Les seuls cas valides sont pour des outils qui ne sont pas des outils liés à un
projet. C’est pas plus compliqué!</p>
<p>Répétez avec moi: <em>&quot;Installer avec -g c'est pour mon environnement de
développeur, rien qu'à moi. Pas pour un projet&quot;.</em></p>
<p>En plus de <code>npx</code>, un très bon exemple serait
<a href="https://www.npmjs.com/package/trash"><code>trash(-cli)</code></a>, que je vous conseille
d’utiliser en place de <code>rm -rf</code> (il va plus vite (déplace dans votre corbeille),
et permet donc la récupération, sait-on jamais). Et encore si vous l’utilisez
sur un projet, pensez à l’ajouter aux dépendances (--dev)!</p>
<p>Il en existera d'autres, mais rappelez-vous que <code>npm install -g</code> est clairement
trop souvent recommandé alors qu'il ne devrait pas l'être!</p>
<p>N’hésitez pas à réagir à ces conseils.</p>
<p>Bisous à tous 😘</p>
<hr />
<h2>Note sur <code>npx</code> et sa magie intégrée</h2>
<p><code>npx</code> permet de télécharger automatiquement les packages. Par exemple tapez
<code>npx mocha</code> et il vous installera le package <code>mocha</code> en global et ira même
jusqu'à s'occuper des mises à jour tout seul (en plus d'exécuter la commande,
puisque c'est son but initial). Malheureusement, pour les raisons expliquées
plus haut, je ne pense vraiment pas que ça soit une bonne idée. Que se
passe-t-il si vous avez pris l'habitude d'utiliser <code>npx</code> et qu'un beau jour il
vous télécharge (puisqu'il ne vous demande rien - c'est magique) une version
contenant un bug? Vous aurez l'air malin. Et cela n'empêche en rien le fameux
problème du &quot;ça marche sur ma machine&quot; puisque vous aurez potentiellement des
collègues qui ne l'utiliseront pas. Oui ceux qui ne lisent jamais les README et
n'écoutent pas les recommandations...</p>
<p>(Je vois encore trop souvent des gens utiliser <code>npm</code> sur des projets nécessitant
<code>yarn</code> et qui viennent se plaindre de temps en temps que
&quot;ça-marche-plus-j'ai-fait-rm-rf-node_modules-&amp;&amp;-npm-install-mais-c-est-pas-mieux&quot;)</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Stop%20aux%20%60npm%20install%20-g%60%20sauvages%20(ou%20pourquoi%20vous%20ne%20devriez%20pas%20installer%20en%20global%20de%20packages%20et%20outils%20CLI)%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fstop-aux-npm-install-global" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"stop-aux-npm-install-global","v":{"_0":{"TAG":0,"_0":{"slug":"stop-aux-npm-install-global","filename":"2017-11-30-stop-aux-npm-install-global","title":"Stop aux `npm install -g` sauvages (ou pourquoi vous ne devriez pas installer en global de packages et outils CLI)","date":"Thu, 30 Nov 2017 00:00:00 GMT","draft":false,"meta":{"date":"2017-11-30T00:00:00.000Z","title":"Stop aux `npm install -g` sauvages (ou pourquoi vous ne devriez pas installer en global de packages et outils CLI)","author":"MoOx","oldSlug":"npm/install-g","slug":"stop-aux-npm-install-global"},"body":"<p>À chaque fois qu’un développeur installe un outil globalement, une discussion\ntabs vs spaces commence. Et Dieu sait que c’est inutile. Les espaces c’est\nmieux. Fin de la discussion.</p>\n<p>À chaque fois qu’un développeur utilise un outil de développement global, un\nchaton meurt. Et Dieu sait que nous aimons les chats.</p>\n<p>Plus sérieusement, c’est une vraie question. Et une bonne question.</p>\n<h2>Pourquoi installer un outil de manière globale sur sa machine est une mauvaise idée?</h2>\n<p>On va tenter de répondre ici de manière constructive.</p>\n<p>La raison est simple et c’est la même raison pour laquelle aujourd’hui il y a\nYarn et npm 5 qui utilisent des fichiers <code>lock</code> : parce que vous voulez avoir\nl'assurance d'avoir la même version que vos collègues.</p>\n<p>Très souvent, dans le fond un outil CLI n’est rien de plus qu’une dépendance à\nun projet. Il est tout à fait (voire hautement) probable que sur deux projets\ndifférents développés à deux instants différents dans le temps vous ayez utilisé\ndeux versions différentes d’un outil.</p>\n<p>Le premier exemple de ma vie qui me vient en tête c’est les pré-processeurs CSS.\nÀ l’époque où j’utilisais Sass, il était courant que pour une raison X ou Y (par\nexemple une nouvelle fonctionnalité disponible dans une version majeure) que je\ndois mettre à jour la version pour le projet en cours. Mais que se passe-t-il\nalors pour tous mes anciens projets ? Vont-ils être compatibles ? Vont-ils avoir\ndes problèmes ? Vais-je devoir mettre mes autres projets à jour ? Cela va-t-il\nme faire chier d’une manière hors du commun ?</p>\n<p>Vous avez ici des vraies questions d'ordre pratique. Ça a dû arriver à tout le\nmonde d’avoir ce cas de figure.</p>\n<p>Et je vais ajouter à ceci un autre problème.</p>\n<h2>« mais puisse ke je te di ke sa marche cez moi ! »</h2>\n<p>On a tous travaillé à plus de deux développeurs sur un projet (et encore ça peut\nnous arriver tout seul au changement de machine)</p>\n<p>Le fameux « ça marche sur ma machine ». Celui-là qui prend grâve la tête.\nCelui-là qui peut nous faire perdre des heures à comprendre pourquoi ça marche\npas sur le PC des collègues.</p>\n<p>Celui-là qui énerve les personnes chez qui ça marche et ceux chez qui cela ne\nmarche pas. Oui ça fait clairement chier tout le monde.</p>\n<p>Du coup pour éviter ce problème, il y a une méthode simple.</p>\n<h2>Ne jamais (ô grand jamais) installer un outil de développeur globalement sur sa machine.</h2>\n<p>De rien. Voilà c’était un conseil gratuit.</p>\n<p>(Je détaillerai à la fin de cet article les seules raisons valables pour\nutiliser et installer globalement un package ou un outil CLI)</p>\n<p>Bon du coup pour éviter ce problème on a une solution extrêmement simple :\ninstaller localement à chaque projet TOUTES les dépendances.</p>\n<p>Il y a deux choses que peu de gens savent : la première est que npm et yarn vont\nautomatiquement ajouter tous les bin disponibles de tous les node_modules locaux\ndans le PATH utilisé via les scripts définis dans votre package.json.</p>\n<p>Du coup dans la pratique il vous suffit de vous faire un petit alias pour chaque\noutil CLI et le tour est joué.</p>\n<pre><code class=\"hljs language-js\">{\n  <span class=\"hljs-string\">&quot;scripts&quot;</span>: {\n    <span class=\"hljs-string\">&quot;cmd&quot;</span>: <span class=\"hljs-string\">&quot;cmd&quot;</span> <span class=\"hljs-comment\">// on assume qu&#x27;on a un outil qui offre le bin `cmd`</span>\n  }\n}\n</code></pre>\n<pre><code class=\"hljs language-console\">npm run cmd\n</code></pre>\n<p>À savoir avec npm il faudra rajouter des — à la fin d’une commande pour que cela\nfonctionne correctement si vous passez des arguments.</p>\n<pre><code class=\"hljs language-console\">npm run cmd -- arg\n</code></pre>\n<p>Avec Yarn, cela n’est pas nécessaire. C’est bien plus bref (et pratique).</p>\n<pre><code class=\"hljs language-console\">yarn cmd arg\n</code></pre>\n<p>Il faut savoir que pour les développeurs de ce type d’outil c’est aussi un petit\ncauchemar à gérer.</p>\n<p>Lorsqu’un outil a une package offrant une interface CLI, comment savoir si la\nversion de la bibliothèque fonctionnera avec ?</p>\n<p>De cette problématique est née une solution récurrente : les packages qui ont une\nCLI et une bibliothèque en parallèle vont très souvent avoir une CLI très light\nqui va en général consister à aller chercher dans le dossier de la bibliothèque\noù vous vous trouvez le vrai code à exécuter.</p>\n<p>Je dirais même que c’est plutôt cool dans un sens.</p>\n<p>Mais on voit bien ici qu’on a un petit problème car cela demande du travail\nsupplémentaire aux développeurs des projets qui sont déjà trop souvent à flirter\navec le burnout.</p>\n<h2>Petite astuce bien stylée</h2>\n<p>Vous pouvez ajouter tous les binaires de <code>node_modules/.bin</code> localement à votre\nPATH histoire de pouvoir les utiliser en CLI.</p>\n<pre><code class=\"hljs language-sh\"><span class=\"hljs-comment\"># to avoid npm install -g / yarn global add</span>\n<span class=\"hljs-built_in\">export</span> PATH=<span class=\"hljs-variable\">$PATH</span>:./node_modules/.bin\n</code></pre>\n<p>Une fois cette astuce réalisée, déposez dans votre <code>.bashrc</code> (ou<code>.zshrc</code>…), vous\npourrez utiliser des bin locaux à votre projet comme si ils avaient été\ninstallés globalement. Sans passer par alias. Mais ça ne marchera bien entendu\nqu’à la racine du projet. Ça reste bien pratique n’est-ce pas?</p>\n<p>(Et non, si vous faites ça dans l'ordre décrit plus haut, il n'y a pas de soucis\nde sécurité genre <em>&quot;un package remplace <code>rm</code> et fait ce qu'il veut avec mes\ndonnées&quot;</em> puisque la priorité sera donnée à la première partie du <code>PATH</code>.)</p>\n<h2>Alternative bien stylée</h2>\n<p>Si vous n'êtes pas fan de modifier votre <code>PATH</code>,\n<a href=\"https://www.npmjs.com/package/npx\"><code>npx</code></a> est un outil qui va justement\npermettre d'appeler les <code>node_modules/.bin</code> locaux sans le modifier.</p>\n<p>Ah mais comment on l'installe? Avec <code>-g</code> pardi ! Je plaisante. Il est inclus\navec <code>npm</code>. Faites un petit <code>which npx</code> pour vérifier!</p>\n<p>Dans tous les cas, <code>npx</code> fait partie des rares outils qui méritent d'être\ninstallés en global, ceux qui sont pour l'environnement du développeur, pas pour\nun projet.</p>\n<p>D'ailleurs parlons en de ces cas où <code>-g</code> est valide.</p>\n<h2>Les seuls cas valides où les outils globaux ont du sens</h2>\n<p>Les seuls cas valides sont pour des outils qui ne sont pas des outils liés à un\nprojet. C’est pas plus compliqué!</p>\n<p>Répétez avec moi: <em>&quot;Installer avec -g c'est pour mon environnement de\ndéveloppeur, rien qu'à moi. Pas pour un projet&quot;.</em></p>\n<p>En plus de <code>npx</code>, un très bon exemple serait\n<a href=\"https://www.npmjs.com/package/trash\"><code>trash(-cli)</code></a>, que je vous conseille\nd’utiliser en place de <code>rm -rf</code> (il va plus vite (déplace dans votre corbeille),\net permet donc la récupération, sait-on jamais). Et encore si vous l’utilisez\nsur un projet, pensez à l’ajouter aux dépendances (--dev)!</p>\n<p>Il en existera d'autres, mais rappelez-vous que <code>npm install -g</code> est clairement\ntrop souvent recommandé alors qu'il ne devrait pas l'être!</p>\n<p>N’hésitez pas à réagir à ces conseils.</p>\n<p>Bisous à tous 😘</p>\n<hr />\n<h2>Note sur <code>npx</code> et sa magie intégrée</h2>\n<p><code>npx</code> permet de télécharger automatiquement les packages. Par exemple tapez\n<code>npx mocha</code> et il vous installera le package <code>mocha</code> en global et ira même\njusqu'à s'occuper des mises à jour tout seul (en plus d'exécuter la commande,\npuisque c'est son but initial). Malheureusement, pour les raisons expliquées\nplus haut, je ne pense vraiment pas que ça soit une bonne idée. Que se\npasse-t-il si vous avez pris l'habitude d'utiliser <code>npx</code> et qu'un beau jour il\nvous télécharge (puisqu'il ne vous demande rien - c'est magique) une version\ncontenant un bug? Vous aurez l'air malin. Et cela n'empêche en rien le fameux\nproblème du &quot;ça marche sur ma machine&quot; puisque vous aurez potentiellement des\ncollègues qui ne l'utiliseront pas. Oui ceux qui ne lisent jamais les README et\nn'écoutent pas les recommandations...</p>\n<p>(Je vois encore trop souvent des gens utiliser <code>npm</code> sur des projets nécessitant\n<code>yarn</code> et qui viennent se plaindre de temps en temps que\n&quot;ça-marche-plus-j'ai-fait-rm-rf-node_modules-&amp;&amp;-npm-install-mais-c-est-pas-mieux&quot;)</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>