<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">La puissance de dnsmasq | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="La puissance de dnsmasq | Putain de code" property="og:title"/><meta data-react-helmet="true" content="La puissance de dnsmasq | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par kud" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/la-puissance-de-dnsmasq" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(315, 100%, 35%), hsl(262, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">La puissance de dnsmasq</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/kud"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="kud" src="https://avatars.githubusercontent.com/kud?size=64"/><div>kud<!-- --> <!-- -->•<!-- --> <!-- -->2014/02/20</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Dernièrement, j'ai voulu accéder avec mon Smartphone à ma machine virtuelle
(<em>VM</em>) de développement qui se trouve sur mon poste de travail (<em>machine ou
poste hôte</em>). Ma machine virtuelle me permet de reproduire à l'identique la
production afin d'avoir le moins de marge d'erreur possible entre la phase de
développement et la phase de mise en production.</p>
<p>A ce moment là, j'accédais à ma machine virtuelle à partir de mon poste via le
fichier <em>hosts</em> comprenant ceci :</p>
<pre><code>192.168.1.145 monsite.dev
</code></pre>
<p>Le problème est que seul mon poste est au courant de la résolution du nom de
domaine de par cette méthode.</p>
<p>Étant donné qu'il est laborieux de changer des <em>hosts</em> sur un appareil comme un
téléphone et que je n'ai pas non plus envie de dupliquer cette modification sur
chaque appareil, il me fallait trouver une solution généralisée.</p>
<p>C'est là que <strong><a href="http://fr.wikipedia.org/wiki/Dnsmasq">dnsmasq</a></strong> entre en jeu.</p>
<blockquote>
<p>Dnsmasq est un serveur léger pour fournir les services DNS, DHCP, Bootstrap
Protocol et TFTP pour un petit réseau, voire pour un poste de travail. Il
permet d'offrir un service de nommage des machines du réseau interne non
intégrées au service de nommage global (i.e. le service DNS d'Internet). Le
service de nommage est associé au service d'adressage de telle manière que les
machines dont le bail DHCP est fourni par Dnsmasq peuvent avoir
automatiquement un nom DNS sur le réseau interne. Le logiciel offre un service
DHCP statique ou dynamique.</p>
</blockquote>
<h2>dnsmasq, le serveur dns tout petit</h2>
<p><strong>dnsmasq</strong> va me permettre de faire plusieurs choses :</p>
<ul>
<li>accélérer la résolution dns</li>
<li>ne pas polluer le réseau interne de la boite avec des résolutions de domaines
propre à votre poste (imaginez que vous soyez plusieurs à avoir <em>monsite.dev</em>
(ce qui est le cas dans notre boite)); une résolution se ferait uniquement
vers un seul poste donc impossible de faire sans si vous êtes plusieurs</li>
<li>ne pas dupliquer sur chacun appareil la résolution dns</li>
<li>réussir à résoudre un nom de domaine sur un appareil où le fichier <em>hosts</em> est
difficile voire impossible d'accès</li>
</ul>
<p>Cependant, tout n'est pas si rose, je vais vous montrer pourquoi après.</p>
<h3>Partage de connexion</h3>
<p>Je vous propose dans un premier temps de partager votre connexion via le Wifi
sous Mac OS X afin :</p>
<ul>
<li>d'avoir constamment un débit stable et performant; étant donné que vous êtes
souvent devant votre poste pour tester sur différents appareils, en partageant
votre connexion via Wifi, vous vous assurez d'avoir un excellent débit, chose
qui n'est pas toujours évidente quand le wifi de votre boite est un peu /
souvent trop loin</li>
<li>d'utiliser le serveur dns (dnsmasq) que vous allez monter</li>
</ul>
<p>Pour cela, il suffit de faire :
<code>System Preferences &gt; Sharing &gt; Internet Sharing</code> puis choisir <code>Ethernet</code> en
source, et <code>Wifi</code> en sortie. (Je vous conseille d'ailleurs de protéger votre
Wifi avec une clé WPA2).</p>
<figure>
  <img src="/public/images/articles/2014-02-20-la-puissance-de-dnsmasq/macosx-network-sharing.png" alt="" />
</figure>
<p><em>Ici, c'est USB Ethernet en source car je suis sur un Mac Book Air donc aucun
port ethernet natif mais choisissez Ethernet si possible.</em></p>
<p>Une fois que le partage de connexion via Wifi est activé, vous pouvez vous y
connecter avec votre smartphone (ou tablette).</p>
<p>Cela crée alors un nouveau réseau privé entre votre machine hôte et votre
téléphone avec des adresses comme <code>192.168.2.x</code>. La machine hôte aura sûrement
l'adresse <code>192.168.2.1</code> et votre téléphone très probablement <code>192.168.2.2</code>.</p>
<p>C'est alors un autre réseau que le réseau interne à la boite en <code>192.168.1.x</code>.</p>
<p>Notez aussi que la machine hôte, faisant bridge, donne les informations en
cascade aux appareils connectés. Ce que vous spécifiez comme serveurs dns sur la
machine hôte sera alors ceux utilisés par les appareils étant connectés à votre
partage de réseau.</p>
<h3>Aaaah dnsmasq !</h3>
<p>On est sous Mac OS X, la vie est si simple, on installe <strong>dnsmasq</strong> via
<strong>homebrew</strong>.</p>
<h4>dnsmasq via homebrew</h4>
<pre><code>$ brew install dnsmasq
</code></pre>
<h4>configuration de dnsmasq</h4>
<p>Une fois installé, on copie la configuration :</p>
<pre><code>$ cp /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf
</code></pre>
<p>puis on édite le comme ceci :</p>
<pre><code># Add domains which you want to force to an IP address here.
# The example below send any host in double-click.net to a local
# web-server.
#address=/double-click.net/127.0.0.1
address=/monsite.dev/192.168.1.145

# If you want dnsmasq to listen for DHCP and DNS requests only on
# specified interfaces (and the loopback) give the name of the
# interface (eg eth0) here.
# Repeat the line for more than one interface.
#interface=
# Or you can specify which interface _not_ to listen on
#except-interface=
# Or which to listen on by address (remember to include 127.0.0.1 if
# you use this.)
listen-address=0.0.0.0
# If you don't want dnsmasq to read /etc/hosts, uncomment the
# following line.
no-hosts
</code></pre>
<p>Nous précisons dans un premier temps la résolution du nom de domaine
<code>monsite.dev</code> (notez que c'est du wildcard, donc pas besoin de préciser les
sous-domaines), puis nous indiquons que le serveur DNS marche sur toutes les IPs
de la machine hôte et enfin nous indiquons que nous ne voulons pas prendre en
compte le fichier <code>/etc/hosts</code> vu qu'on spécifie les résolutions via <code>address</code>.</p>
<p>Cela permettra à terme de ne plus gérer le fichier <code>/etc/hosts</code> et de tout
spécifier dans <code>dnsmasq.conf</code>.</p>
<h4>lancer dnsmasq au démarrage de la machine</h4>
<p>On copie le fichier de démon dans le dossier qui va bien puis on lance le démon.</p>
<pre><code>$ sudo cp -fv /usr/local/opt/dnsmasq/*.plist /Library/LaunchDaemons
$ sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist
</code></pre>
<h4>utiliser le serveur dnsmasq</h4>
<p>Etant donné que vous partagez votre connexion et que votre poste fait hôte, le
serveur dns utilisé sera celui installé sur votre poste, donc rien à faire.</p>
<p>Sinon :</p>
<ul>
<li><p>vous pouvez changer le serveur dns de la machine hôte dans <code>network</code> et dans
ce cas, que ce soit sur vos appareils connectés au wifi ou votre machine
principale, vous utiliserez <strong>dnsmasq</strong> mais je vous le déconseile car j'ai
constaté que j'atteignais trop facilement le nombre de connexions maximum.</p></li>
<li><p>vous pouvez aussi modifier le serveur dns de l'appareil connecté au wifi
partagé :</p></li>
</ul>
<p><em>(Sous Android)</em></p>
<p><code>Wifi &gt; Press on the current connnection &gt; Modify network &gt; Show advanced options</code></p>
<figure>
  <img src="/public/images/articles/2014-02-20-la-puissance-de-dnsmasq/android-network-advanced.jpg" alt="" />
</figure>
<p>Mais quel intérêt car vous devrez faire cela sur tous vos appareils connectés</p>
<ul>
<li>vous pouvez aussi éditer le fichier <code>/etc/bootpd.plist</code> qui définit toute
votre configuration de partage de connexion :</li>
</ul>
<pre><code>$ sudo $EDITOR /etc/bootpd.plist
</code></pre>
<pre><code class="hljs language-xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">plist</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="hljs-meta-string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">plist</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Subnets<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>_creator<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.apple.InternetSharing<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>allocate<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>dhcp_domain_name_server<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>dhcp_router<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>lease_max<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>lease_min<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-name">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>192.168.2/24<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>net_address<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>192.168.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>net_mask<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>255.255.255.0<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>net_range<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>192.168.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>192.168.2.254<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>bootp_enabled<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">false</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>detect_other_dhcp_server<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>dhcp_enabled<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>bridge100<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>use_server_config_for_dhcp_options<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">false</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plist</span>&gt;</span>
</code></pre>
<p><code>192.168.2.1</code> est l'adresse de votre machine hôte dans le réseau de partage.</p>
<h2>Oh oui, j'oubliais, Mac OS X peut être lourd parfois</h2>
<p>Oui, quand vous créez un partage de connexion sur Mac OS X, il lance son propre
serveur dns s'appelant <strong>_mdnsresponder</strong>. C'est le système <em>Bonjour</em> de
iOS/Mac OS X permettant à n'importe quel appareil Apple de communiquer entre
eux. Le problème c'est qu'il risque de marcher sur les pieds de <strong>dnsmasq</strong>.</p>
<p>Faites donc un <code>$ sudo lsof -i :53</code> et vous pourrez éventuellement voir que
<strong>_mdnsresponder</strong> est lancé aussi bien en ipv6 qu'en ipv4 sur le port 53. Cela
vous empêchera de lancer <strong>dnsmasq</strong>.</p>
<p>Ce que je vous propose dans ces cas là, c'est de couper votre partage de
connexion, puis notez le pid de <strong>_mdnsresponder</strong> via <code>$ sudo lsof -i :53</code>, de
le <code>sudo kill :pid</code>, de lancer <code>$ sudo dnsmasq</code> puis de relancer le partage de
connexion. Comme ça <strong>_mdnsresponser</strong> ne prendra plus la place de <strong>dnsmasq</strong>.</p>
<p>Autre point, évitez, mais vraiment, de nommer vos noms de domaines personnels en
<code>.local</code>. En effet, ceux-ci sont plutôt réservés à l'environnement Mac OS X. Ils
sont d'ailleurs en rapport avec <strong>_mdnsresponder</strong>. Les <code>.local</code> permettent à
n'importe quel produit Apple sur le réseau de se connecter à d'autres postes
Apple via <code>nom-de-l-appareil.local</code>. Votre connexion pourrait alors s'emméler
entre le serveur dns de <strong>Bonjour</strong> et votre propre serveur dns.</p>
<p>Happy coding !</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=La%20puissance%20de%20dnsmasq%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fla-puissance-de-dnsmasq" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"la-puissance-de-dnsmasq","v":{"_0":{"TAG":0,"_0":{"slug":"la-puissance-de-dnsmasq","filename":"2014-02-20-la-puissance-de-dnsmasq","title":"La puissance de dnsmasq","date":"Thu, 20 Feb 2014 00:00:00 GMT","draft":false,"meta":{"date":"2014-02-20T00:00:00.000Z","title":"La puissance de dnsmasq","author":"kud","oldSlug":"dnsmasq","slug":"la-puissance-de-dnsmasq"},"body":"<p>Dernièrement, j'ai voulu accéder avec mon Smartphone à ma machine virtuelle\n(<em>VM</em>) de développement qui se trouve sur mon poste de travail (<em>machine ou\nposte hôte</em>). Ma machine virtuelle me permet de reproduire à l'identique la\nproduction afin d'avoir le moins de marge d'erreur possible entre la phase de\ndéveloppement et la phase de mise en production.</p>\n<p>A ce moment là, j'accédais à ma machine virtuelle à partir de mon poste via le\nfichier <em>hosts</em> comprenant ceci :</p>\n<pre><code>192.168.1.145 monsite.dev\n</code></pre>\n<p>Le problème est que seul mon poste est au courant de la résolution du nom de\ndomaine de par cette méthode.</p>\n<p>Étant donné qu'il est laborieux de changer des <em>hosts</em> sur un appareil comme un\ntéléphone et que je n'ai pas non plus envie de dupliquer cette modification sur\nchaque appareil, il me fallait trouver une solution généralisée.</p>\n<p>C'est là que <strong><a href=\"http://fr.wikipedia.org/wiki/Dnsmasq\">dnsmasq</a></strong> entre en jeu.</p>\n<blockquote>\n<p>Dnsmasq est un serveur léger pour fournir les services DNS, DHCP, Bootstrap\nProtocol et TFTP pour un petit réseau, voire pour un poste de travail. Il\npermet d'offrir un service de nommage des machines du réseau interne non\nintégrées au service de nommage global (i.e. le service DNS d'Internet). Le\nservice de nommage est associé au service d'adressage de telle manière que les\nmachines dont le bail DHCP est fourni par Dnsmasq peuvent avoir\nautomatiquement un nom DNS sur le réseau interne. Le logiciel offre un service\nDHCP statique ou dynamique.</p>\n</blockquote>\n<h2>dnsmasq, le serveur dns tout petit</h2>\n<p><strong>dnsmasq</strong> va me permettre de faire plusieurs choses :</p>\n<ul>\n<li>accélérer la résolution dns</li>\n<li>ne pas polluer le réseau interne de la boite avec des résolutions de domaines\npropre à votre poste (imaginez que vous soyez plusieurs à avoir <em>monsite.dev</em>\n(ce qui est le cas dans notre boite)); une résolution se ferait uniquement\nvers un seul poste donc impossible de faire sans si vous êtes plusieurs</li>\n<li>ne pas dupliquer sur chacun appareil la résolution dns</li>\n<li>réussir à résoudre un nom de domaine sur un appareil où le fichier <em>hosts</em> est\ndifficile voire impossible d'accès</li>\n</ul>\n<p>Cependant, tout n'est pas si rose, je vais vous montrer pourquoi après.</p>\n<h3>Partage de connexion</h3>\n<p>Je vous propose dans un premier temps de partager votre connexion via le Wifi\nsous Mac OS X afin :</p>\n<ul>\n<li>d'avoir constamment un débit stable et performant; étant donné que vous êtes\nsouvent devant votre poste pour tester sur différents appareils, en partageant\nvotre connexion via Wifi, vous vous assurez d'avoir un excellent débit, chose\nqui n'est pas toujours évidente quand le wifi de votre boite est un peu /\nsouvent trop loin</li>\n<li>d'utiliser le serveur dns (dnsmasq) que vous allez monter</li>\n</ul>\n<p>Pour cela, il suffit de faire :\n<code>System Preferences &gt; Sharing &gt; Internet Sharing</code> puis choisir <code>Ethernet</code> en\nsource, et <code>Wifi</code> en sortie. (Je vous conseille d'ailleurs de protéger votre\nWifi avec une clé WPA2).</p>\n<figure>\n  <img src=\"/public/images/articles/2014-02-20-la-puissance-de-dnsmasq/macosx-network-sharing.png\" alt=\"\" />\n</figure>\n<p><em>Ici, c'est USB Ethernet en source car je suis sur un Mac Book Air donc aucun\nport ethernet natif mais choisissez Ethernet si possible.</em></p>\n<p>Une fois que le partage de connexion via Wifi est activé, vous pouvez vous y\nconnecter avec votre smartphone (ou tablette).</p>\n<p>Cela crée alors un nouveau réseau privé entre votre machine hôte et votre\ntéléphone avec des adresses comme <code>192.168.2.x</code>. La machine hôte aura sûrement\nl'adresse <code>192.168.2.1</code> et votre téléphone très probablement <code>192.168.2.2</code>.</p>\n<p>C'est alors un autre réseau que le réseau interne à la boite en <code>192.168.1.x</code>.</p>\n<p>Notez aussi que la machine hôte, faisant bridge, donne les informations en\ncascade aux appareils connectés. Ce que vous spécifiez comme serveurs dns sur la\nmachine hôte sera alors ceux utilisés par les appareils étant connectés à votre\npartage de réseau.</p>\n<h3>Aaaah dnsmasq !</h3>\n<p>On est sous Mac OS X, la vie est si simple, on installe <strong>dnsmasq</strong> via\n<strong>homebrew</strong>.</p>\n<h4>dnsmasq via homebrew</h4>\n<pre><code>$ brew install dnsmasq\n</code></pre>\n<h4>configuration de dnsmasq</h4>\n<p>Une fois installé, on copie la configuration :</p>\n<pre><code>$ cp /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf\n</code></pre>\n<p>puis on édite le comme ceci :</p>\n<pre><code># Add domains which you want to force to an IP address here.\n# The example below send any host in double-click.net to a local\n# web-server.\n#address=/double-click.net/127.0.0.1\naddress=/monsite.dev/192.168.1.145\n\n# If you want dnsmasq to listen for DHCP and DNS requests only on\n# specified interfaces (and the loopback) give the name of the\n# interface (eg eth0) here.\n# Repeat the line for more than one interface.\n#interface=\n# Or you can specify which interface _not_ to listen on\n#except-interface=\n# Or which to listen on by address (remember to include 127.0.0.1 if\n# you use this.)\nlisten-address=0.0.0.0\n# If you don't want dnsmasq to read /etc/hosts, uncomment the\n# following line.\nno-hosts\n</code></pre>\n<p>Nous précisons dans un premier temps la résolution du nom de domaine\n<code>monsite.dev</code> (notez que c'est du wildcard, donc pas besoin de préciser les\nsous-domaines), puis nous indiquons que le serveur DNS marche sur toutes les IPs\nde la machine hôte et enfin nous indiquons que nous ne voulons pas prendre en\ncompte le fichier <code>/etc/hosts</code> vu qu'on spécifie les résolutions via <code>address</code>.</p>\n<p>Cela permettra à terme de ne plus gérer le fichier <code>/etc/hosts</code> et de tout\nspécifier dans <code>dnsmasq.conf</code>.</p>\n<h4>lancer dnsmasq au démarrage de la machine</h4>\n<p>On copie le fichier de démon dans le dossier qui va bien puis on lance le démon.</p>\n<pre><code>$ sudo cp -fv /usr/local/opt/dnsmasq/*.plist /Library/LaunchDaemons\n$ sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist\n</code></pre>\n<h4>utiliser le serveur dnsmasq</h4>\n<p>Etant donné que vous partagez votre connexion et que votre poste fait hôte, le\nserveur dns utilisé sera celui installé sur votre poste, donc rien à faire.</p>\n<p>Sinon :</p>\n<ul>\n<li><p>vous pouvez changer le serveur dns de la machine hôte dans <code>network</code> et dans\nce cas, que ce soit sur vos appareils connectés au wifi ou votre machine\nprincipale, vous utiliserez <strong>dnsmasq</strong> mais je vous le déconseile car j'ai\nconstaté que j'atteignais trop facilement le nombre de connexions maximum.</p></li>\n<li><p>vous pouvez aussi modifier le serveur dns de l'appareil connecté au wifi\npartagé :</p></li>\n</ul>\n<p><em>(Sous Android)</em></p>\n<p><code>Wifi &gt; Press on the current connnection &gt; Modify network &gt; Show advanced options</code></p>\n<figure>\n  <img src=\"/public/images/articles/2014-02-20-la-puissance-de-dnsmasq/android-network-advanced.jpg\" alt=\"\" />\n</figure>\n<p>Mais quel intérêt car vous devrez faire cela sur tous vos appareils connectés</p>\n<ul>\n<li>vous pouvez aussi éditer le fichier <code>/etc/bootpd.plist</code> qui définit toute\nvotre configuration de partage de connexion :</li>\n</ul>\n<pre><code>$ sudo $EDITOR /etc/bootpd.plist\n</code></pre>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>\n<span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-meta-keyword\">plist</span> <span class=\"hljs-meta-keyword\">PUBLIC</span> <span class=\"hljs-meta-string\">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class=\"hljs-meta-string\">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plist</span> <span class=\"hljs-attr\">version</span>=<span class=\"hljs-string\">&quot;1.0&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dict</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>Subnets<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">array</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dict</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>_creator<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>com.apple.InternetSharing<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>allocate<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">true</span>/&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>dhcp_domain_name_server<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">array</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>192.168.2.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">array</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>dhcp_router<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>192.168.2.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>lease_max<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">integer</span>&gt;</span>86400<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">integer</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>lease_min<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">integer</span>&gt;</span>86400<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">integer</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>name<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>192.168.2/24<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>net_address<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>192.168.2.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>net_mask<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>255.255.255.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>net_range<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">array</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>192.168.2.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>192.168.2.254<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">array</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dict</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">array</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>bootp_enabled<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">false</span>/&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>detect_other_dhcp_server<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">true</span>/&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>dhcp_enabled<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">array</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">string</span>&gt;</span>bridge100<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">string</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">array</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">key</span>&gt;</span>use_server_config_for_dhcp_options<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">key</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">false</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dict</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plist</span>&gt;</span>\n</code></pre>\n<p><code>192.168.2.1</code> est l'adresse de votre machine hôte dans le réseau de partage.</p>\n<h2>Oh oui, j'oubliais, Mac OS X peut être lourd parfois</h2>\n<p>Oui, quand vous créez un partage de connexion sur Mac OS X, il lance son propre\nserveur dns s'appelant <strong>_mdnsresponder</strong>. C'est le système <em>Bonjour</em> de\niOS/Mac OS X permettant à n'importe quel appareil Apple de communiquer entre\neux. Le problème c'est qu'il risque de marcher sur les pieds de <strong>dnsmasq</strong>.</p>\n<p>Faites donc un <code>$ sudo lsof -i :53</code> et vous pourrez éventuellement voir que\n<strong>_mdnsresponder</strong> est lancé aussi bien en ipv6 qu'en ipv4 sur le port 53. Cela\nvous empêchera de lancer <strong>dnsmasq</strong>.</p>\n<p>Ce que je vous propose dans ces cas là, c'est de couper votre partage de\nconnexion, puis notez le pid de <strong>_mdnsresponder</strong> via <code>$ sudo lsof -i :53</code>, de\nle <code>sudo kill :pid</code>, de lancer <code>$ sudo dnsmasq</code> puis de relancer le partage de\nconnexion. Comme ça <strong>_mdnsresponser</strong> ne prendra plus la place de <strong>dnsmasq</strong>.</p>\n<p>Autre point, évitez, mais vraiment, de nommer vos noms de domaines personnels en\n<code>.local</code>. En effet, ceux-ci sont plutôt réservés à l'environnement Mac OS X. Ils\nsont d'ailleurs en rapport avec <strong>_mdnsresponder</strong>. Les <code>.local</code> permettent à\nn'importe quel produit Apple sur le réseau de se connecter à d'autres postes\nApple via <code>nom-de-l-appareil.local</code>. Votre connexion pourrait alors s'emméler\nentre le serveur dns de <strong>Bonjour</strong> et votre propre serveur dns.</p>\n<p>Happy coding !</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>