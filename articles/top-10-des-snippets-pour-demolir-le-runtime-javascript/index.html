<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Top 10 des snippets pour démolir le runtime JavaScript | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Top 10 des snippets pour démolir le runtime JavaScript | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Top 10 des snippets pour démolir le runtime JavaScript | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par bloodyowl" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/top-10-des-snippets-pour-demolir-le-runtime-javascript" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(286, 100%, 35%), hsl(238, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Top 10 des snippets pour démolir le runtime JavaScript</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/bloodyowl"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="bloodyowl" src="https://avatars.githubusercontent.com/bloodyowl?size=64"/><div>bloodyowl<!-- --> <!-- -->•<!-- --> <!-- -->2017/11/13</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>(ou juste faire une blague à vos collègues)</p>
<h2>10. L'array vide magique</h2>
<p>Cette technique fonctionne grace à l'héritage prototypal et au fait que pour une
obscure raison, <code>Array.prototype</code> est un array (qui hérite de lui même, allez
savoir). Il suffit d'appeler une des méthodes mutatives d'<code>Array.prototype</code> sur
lui-même :</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Array</span>.prototype.push(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<p>Puisque dans le corps de <code>Array.prototype.push()</code>, <code>this</code> correspond à
<code>Array.prototype</code>, c'est dans celui-ci que seront injectés les éléments.</p>
<pre><code class="hljs language-javascript">[][<span class="hljs-number">0</span>]; <span class="hljs-comment">// 1</span>
</code></pre>
<p>Et hop. À noter que vu l'implémentation de la plupart des fonctions travaillant
avec des <em>arrays</em>, ça devrait pas causer grand dommage puisque <code>length</code> est géré
au niveau de l'array, et pas de son prototype. Ceci-dit ça peut surprendre en
faisant mumuse dans la console.</p>
<h2>9. L'objet magique</h2>
<p>Souvent, dans une boucle <code>for(name in object)</code>, on appelle
<code>object.hasOwnProperty(name)</code> pour vérifier si la propriété appartient bien à
l'objet et qu'il ne s'agit pas juste d'un truc hérité.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Object</span>.prototype.hasOwnProperty = <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>;
<span class="hljs-comment">// peut se combiner avec un petit</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10</span>; index++) {
  <span class="hljs-built_in">Object</span>.prototype[index] = <span class="hljs-literal">undefined</span>;
}
</code></pre>
<p>Même concept que pour l'exemple précédent, avec l'héritage prototypal. Le petit
côté rigolo ici, c'est que c'est un pattern très courant en JavaScript,
notamment dans les bibliothèques que vous utilisez probablement. Et c'est là
qu'on se rend compte que de mettre la fonction qui vérifie si une propriété est
héritée ou non dans l'héritage, c'est pas forcément l'idée du siècle.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">let</span> object = {};
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> object) {
  <span class="hljs-keyword">if</span> (object.hasOwnProperty(object)) {
    <span class="hljs-built_in">console</span>.log(key);
  }
}
<span class="hljs-comment">// 0, 1, 2, 3, 4, 5, 6, 7, 8, 9</span>
</code></pre>
<h2>8. Le DOM fou</h2>
<p>Celui-là est plutôt sympa quand vous ou vos bibliothèques DOM de prédilection
touchez un peu aux élements. Vu que l'appel à <code>Math.random()</code> rend l'opération
aussi déterministe que l'application de styles assignés à des sélecteurs CSS
chargés de manière asynchrone, vous risquez de jolies surprises.</p>
<pre><code class="hljs language-javascript">Element.prototype.appendChild = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element</span>) </span>{
  <span class="hljs-keyword">return</span> Element.prototype.insertBefore.call(
    <span class="hljs-built_in">this</span>,
    element,
    <span class="hljs-built_in">this</span>.childNodes[<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-built_in">this</span>.childNodes.length)],
  );
};
</code></pre>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10</span>; index++) {
  <span class="hljs-built_in">document</span>.body.appendChild(<span class="hljs-built_in">document</span>.createTextNode(<span class="hljs-built_in">String</span>(index)));
}
<span class="hljs-comment">// &quot;1895234760&quot; (par exemple)</span>
</code></pre>
<h2>7. Simple mais efficace, faire de la console une no-op</h2>
<p>Bizarrement, j'ai déjà vu des sites qui faisaient ça en production (e.g. Twitter
si je me rappelle correctement). Vous rendez inopérable la console, ce qui peut
faire une très bonne blague à vos collègues en cachant ça dans un vieux commit
avec l'option <code>amend</code>.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Object</span>.keys(<span class="hljs-built_in">console</span>).forEach(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
  <span class="hljs-built_in">console</span>[key] = <span class="hljs-function">() =&gt;</span> {};
});
</code></pre>
<h2>6. Supprimer les stack traces des erreurs</h2>
<p>Là, on est vraiment sur le petit truc horrible, parce que vous pouvez mettre un
petit moment avant de le réaliser. Le constructeur <code>Error</code> vient normalement
ajouter une propriété <code>stack</code> qui vous permet de retrouver le chemin qu'a
emprunté le code avant de jeter une erreur. Eh ben fini, à vous le debug à
l'aveugle !</p>
<pre><code class="hljs language-javascript">(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Error</span>(<span class="hljs-params">message</span>) </span>{
    <span class="hljs-built_in">this</span>.message = message;
  }
  <span class="hljs-built_in">Error</span>.prototype = <span class="hljs-built_in">window</span>.Error.prototype;
  <span class="hljs-built_in">window</span>.Error = <span class="hljs-built_in">Error</span>;
})();
</code></pre>
<h2>5. Rendre l'asynchrone synchrone</h2>
<p>Il est assez courrant d'avoir des <code>setTimeout(func)</code> ou <code>setTimeout(func, 0)</code>
(les deux sont équivalents). Ça permet s'assurer qu'on décale un peu l'execution
d'une fonction, et souvent de s'assurer que si elle jette une erreur, elle
n'empêchera pas le reste de s'executer.</p>
<pre><code class="hljs language-javascript">(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> originalTimeout = <span class="hljs-built_in">window</span>.setTimeout;
  <span class="hljs-built_in">window</span>.setTimeout = <span class="hljs-function">(<span class="hljs-params">func, duration, ...args</span>) =&gt;</span>
    !duration
      ? func(...args)
      : originalTimeout.call(<span class="hljs-built_in">window</span>, func, duration, ...args);
})();
</code></pre>
<p>Avec ce snippet, petites surprises bizarres assurées. Et c'est un bug présent
dans quelques bibliothèques implémentant une fonction <code>domReady</code>, et qui font:</p>
<pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">domReady</span>(<span class="hljs-params">func</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.readyState === <span class="hljs-string">&quot;complete&quot;</span>) {
    func();
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">&quot;DOMContentLoaded&quot;</span>, func);
  }
}
</code></pre>
<p>Avec une implémentation comme celle qu'on voit au dessus, <code>func</code> aura un
comportement différent si le DOM est chargé ou non:</p>
<pre><code class="hljs language-javascript">domReady(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>();
});
<span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>);
<span class="hljs-comment">// Logue 1 si le DOM est prêt, parce que l&#x27;execution de func par le handler DOMContentLoaded est asynchrone</span>
<span class="hljs-comment">// Logue rien du tout si func() est appelé en synchrone par la première branche de domReady</span>
</code></pre>
<h2>4. Le réseau qui ne répond jamais</h2>
<p>Les <code>Promise</code>, c'est bien relou à débugger lorsque ça reste infiniment en
&quot;pending&quot;: on ne sait pas forcément pourquoi, surtout si c'est derrière une API
opaque, comme <code>fetch</code>. Plaisir garanti, parce qu'avec ça sur la page, c'est
probablement le dernier endroit où on va intuitivement chercher la source la
bug.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">window</span>.fetch = <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">() =&gt;</span> {});
</code></pre>
<h2>3. Faire marcher les event listener au hasard</h2>
<p>C'est particulièrement horrible quand un bug n'est pas reproduit à tous les
coups: pourquoi ne pas attacher les évenements au hasard ?</p>
<pre><code class="hljs language-javascript">(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> originalAddEventListener = Element.prototype.addEventListener;
  Element.prototype.addEventListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.random() &lt; <span class="hljs-number">0.75</span>) {
      originalAddEventListener.call(<span class="hljs-built_in">this</span>, ...args);
    }
  };
})();
</code></pre>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-number">3</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-number">4</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-number">5</span>));
</code></pre>
<h2>2. Faire foirer parseInt de temps en temps</h2>
<pre><code class="hljs language-javascript">(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> originalParseInt = <span class="hljs-built_in">window</span>.parseInt;
  <span class="hljs-built_in">window</span>.parseInt = <span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> (<span class="hljs-built_in">Math</span>.random() &gt; <span class="hljs-number">0.9</span> ? originalParseInt(n) : <span class="hljs-literal">NaN</span>);
})();
</code></pre>
<p>Pour un bon petit moment à pas comprendre ce qui se passe. Je suis sûr que <code>NaN</code>
n'est pas toujours géré dans tous les cas dans la plupart des scripts qui
tournent aujourd'hui en prod.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">parseInt</span>(<span class="hljs-string">&quot;1&quot;</span>); <span class="hljs-comment">// 1</span>
<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">&quot;1&quot;</span>); <span class="hljs-comment">// NaN</span>
</code></pre>
<h2>1. (De)serialiser les URL</h2>
<p>Pour ce coup, c'est bien de prévoir les deux fonctions utilisées par tout le
monde pour encoder et décoder les URLs. Vu que si l'une ne marche pas, le
reflexe est souvent de tester la deuxième, bon arrachage de cheveux en
perspective.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">window</span>.decodeURIComponent = <span class="hljs-built_in">window</span>.encodeURIComponent = <span class="hljs-built_in">window</span>.escape = <span class="hljs-built_in">window</span>.unescape = <span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span>
  <span class="hljs-built_in">String</span>(a);
</code></pre>
<h2>Bonus: pour rendre tout ça crédible</h2>
<p>Si dans la console de développement, vous tapez le nom d'une fonction accessible
dans le scope, le navigateur va appeler <code>Function.prototype.toString</code> sur cette
fonction pour en récupérer l'allure. Couvrez vos arrières en replaçant la
méthode :</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Function</span>.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">`function <span class="hljs-subst">${<span class="hljs-built_in">this</span>.name || <span class="hljs-string">&quot;&quot;</span>}</span>() {
    [native code]
}`</span>;
};
</code></pre>
<pre><code class="hljs language-javascript">() =&gt; {};
<span class="hljs-comment">/* function () {
    [native code]
} */</span>
</code></pre>
<p>Pour faire un peu de zèle, vous pouvez également déclarer ces fonctions dans un
<code>eval</code> pour brouiller les pistes sur l'endroit où elles ont été déclarées.</p>
<p>Voilà, vous avez toutes les clés pour faire des petites blagues à vos collègues.</p>
<p>Et n'oubliez pas, JavaScript c'est super, mais faisez gaffe quand même, parce
que dans un langage encourageant la mutabilité, qui utilise des globales et de
l'héritage par dessus le marché, il suffit d'un petit bout de code innocent pour
que plus rien ne marche.</p>
<p>Bisous.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Top%2010%20des%20snippets%20pour%20d%C3%A9molir%20le%20runtime%20JavaScript%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Ftop-10-des-snippets-pour-demolir-le-runtime-javascript" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"top-10-des-snippets-pour-demolir-le-runtime-javascript","v":{"_0":{"TAG":0,"_0":{"slug":"top-10-des-snippets-pour-demolir-le-runtime-javascript","filename":"2017-11-13-top-10-des-snippets-pour-demolir-le-runtime-javascript","title":"Top 10 des snippets pour démolir le runtime JavaScript","date":"Mon, 13 Nov 2017 00:00:00 GMT","draft":false,"meta":{"date":"2017-11-13T00:00:00.000Z","title":"Top 10 des snippets pour démolir le runtime JavaScript","author":"bloodyowl","oldSlug":"js/top-10-snippets-demolir-runtime","slug":"top-10-des-snippets-pour-demolir-le-runtime-javascript"},"body":"<p>(ou juste faire une blague à vos collègues)</p>\n<h2>10. L'array vide magique</h2>\n<p>Cette technique fonctionne grace à l'héritage prototypal et au fait que pour une\nobscure raison, <code>Array.prototype</code> est un array (qui hérite de lui même, allez\nsavoir). Il suffit d'appeler une des méthodes mutatives d'<code>Array.prototype</code> sur\nlui-même :</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">Array</span>.prototype.push(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>);\n</code></pre>\n<p>Puisque dans le corps de <code>Array.prototype.push()</code>, <code>this</code> correspond à\n<code>Array.prototype</code>, c'est dans celui-ci que seront injectés les éléments.</p>\n<pre><code class=\"hljs language-javascript\">[][<span class=\"hljs-number\">0</span>]; <span class=\"hljs-comment\">// 1</span>\n</code></pre>\n<p>Et hop. À noter que vu l'implémentation de la plupart des fonctions travaillant\navec des <em>arrays</em>, ça devrait pas causer grand dommage puisque <code>length</code> est géré\nau niveau de l'array, et pas de son prototype. Ceci-dit ça peut surprendre en\nfaisant mumuse dans la console.</p>\n<h2>9. L'objet magique</h2>\n<p>Souvent, dans une boucle <code>for(name in object)</code>, on appelle\n<code>object.hasOwnProperty(name)</code> pour vérifier si la propriété appartient bien à\nl'objet et qu'il ne s'agit pas juste d'un truc hérité.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">Object</span>.prototype.hasOwnProperty = <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-literal\">true</span>;\n<span class=\"hljs-comment\">// peut se combiner avec un petit</span>\n<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> index = <span class=\"hljs-number\">0</span>; index &lt; <span class=\"hljs-number\">10</span>; index++) {\n  <span class=\"hljs-built_in\">Object</span>.prototype[index] = <span class=\"hljs-literal\">undefined</span>;\n}\n</code></pre>\n<p>Même concept que pour l'exemple précédent, avec l'héritage prototypal. Le petit\ncôté rigolo ici, c'est que c'est un pattern très courant en JavaScript,\nnotamment dans les bibliothèques que vous utilisez probablement. Et c'est là\nqu'on se rend compte que de mettre la fonction qui vérifie si une propriété est\nhéritée ou non dans l'héritage, c'est pas forcément l'idée du siècle.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">let</span> object = {};\n<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> key <span class=\"hljs-keyword\">in</span> object) {\n  <span class=\"hljs-keyword\">if</span> (object.hasOwnProperty(object)) {\n    <span class=\"hljs-built_in\">console</span>.log(key);\n  }\n}\n<span class=\"hljs-comment\">// 0, 1, 2, 3, 4, 5, 6, 7, 8, 9</span>\n</code></pre>\n<h2>8. Le DOM fou</h2>\n<p>Celui-là est plutôt sympa quand vous ou vos bibliothèques DOM de prédilection\ntouchez un peu aux élements. Vu que l'appel à <code>Math.random()</code> rend l'opération\naussi déterministe que l'application de styles assignés à des sélecteurs CSS\nchargés de manière asynchrone, vous risquez de jolies surprises.</p>\n<pre><code class=\"hljs language-javascript\">Element.prototype.appendChild = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">element</span>) </span>{\n  <span class=\"hljs-keyword\">return</span> Element.prototype.insertBefore.call(\n    <span class=\"hljs-built_in\">this</span>,\n    element,\n    <span class=\"hljs-built_in\">this</span>.childNodes[<span class=\"hljs-built_in\">Math</span>.floor(<span class=\"hljs-built_in\">Math</span>.random() * <span class=\"hljs-built_in\">this</span>.childNodes.length)],\n  );\n};\n</code></pre>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> index = <span class=\"hljs-number\">0</span>; index &lt; <span class=\"hljs-number\">10</span>; index++) {\n  <span class=\"hljs-built_in\">document</span>.body.appendChild(<span class=\"hljs-built_in\">document</span>.createTextNode(<span class=\"hljs-built_in\">String</span>(index)));\n}\n<span class=\"hljs-comment\">// &quot;1895234760&quot; (par exemple)</span>\n</code></pre>\n<h2>7. Simple mais efficace, faire de la console une no-op</h2>\n<p>Bizarrement, j'ai déjà vu des sites qui faisaient ça en production (e.g. Twitter\nsi je me rappelle correctement). Vous rendez inopérable la console, ce qui peut\nfaire une très bonne blague à vos collègues en cachant ça dans un vieux commit\navec l'option <code>amend</code>.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">Object</span>.keys(<span class=\"hljs-built_in\">console</span>).forEach(<span class=\"hljs-function\"><span class=\"hljs-params\">key</span> =&gt;</span> {\n  <span class=\"hljs-built_in\">console</span>[key] = <span class=\"hljs-function\">() =&gt;</span> {};\n});\n</code></pre>\n<h2>6. Supprimer les stack traces des erreurs</h2>\n<p>Là, on est vraiment sur le petit truc horrible, parce que vous pouvez mettre un\npetit moment avant de le réaliser. Le constructeur <code>Error</code> vient normalement\najouter une propriété <code>stack</code> qui vous permet de retrouver le chemin qu'a\nemprunté le code avant de jeter une erreur. Eh ben fini, à vous le debug à\nl'aveugle !</p>\n<pre><code class=\"hljs language-javascript\">(<span class=\"hljs-function\">() =&gt;</span> {\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">Error</span>(<span class=\"hljs-params\">message</span>) </span>{\n    <span class=\"hljs-built_in\">this</span>.message = message;\n  }\n  <span class=\"hljs-built_in\">Error</span>.prototype = <span class=\"hljs-built_in\">window</span>.Error.prototype;\n  <span class=\"hljs-built_in\">window</span>.Error = <span class=\"hljs-built_in\">Error</span>;\n})();\n</code></pre>\n<h2>5. Rendre l'asynchrone synchrone</h2>\n<p>Il est assez courrant d'avoir des <code>setTimeout(func)</code> ou <code>setTimeout(func, 0)</code>\n(les deux sont équivalents). Ça permet s'assurer qu'on décale un peu l'execution\nd'une fonction, et souvent de s'assurer que si elle jette une erreur, elle\nn'empêchera pas le reste de s'executer.</p>\n<pre><code class=\"hljs language-javascript\">(<span class=\"hljs-function\">() =&gt;</span> {\n  <span class=\"hljs-keyword\">let</span> originalTimeout = <span class=\"hljs-built_in\">window</span>.setTimeout;\n  <span class=\"hljs-built_in\">window</span>.setTimeout = <span class=\"hljs-function\">(<span class=\"hljs-params\">func, duration, ...args</span>) =&gt;</span>\n    !duration\n      ? func(...args)\n      : originalTimeout.call(<span class=\"hljs-built_in\">window</span>, func, duration, ...args);\n})();\n</code></pre>\n<p>Avec ce snippet, petites surprises bizarres assurées. Et c'est un bug présent\ndans quelques bibliothèques implémentant une fonction <code>domReady</code>, et qui font:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">domReady</span>(<span class=\"hljs-params\">func</span>) </span>{\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">document</span>.readyState === <span class=\"hljs-string\">&quot;complete&quot;</span>) {\n    func();\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-built_in\">document</span>.addEventListener(<span class=\"hljs-string\">&quot;DOMContentLoaded&quot;</span>, func);\n  }\n}\n</code></pre>\n<p>Avec une implémentation comme celle qu'on voit au dessus, <code>func</code> aura un\ncomportement différent si le DOM est chargé ou non:</p>\n<pre><code class=\"hljs language-javascript\">domReady(<span class=\"hljs-function\">() =&gt;</span> {\n  <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Error</span>();\n});\n<span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">1</span>);\n<span class=\"hljs-comment\">// Logue 1 si le DOM est prêt, parce que l&#x27;execution de func par le handler DOMContentLoaded est asynchrone</span>\n<span class=\"hljs-comment\">// Logue rien du tout si func() est appelé en synchrone par la première branche de domReady</span>\n</code></pre>\n<h2>4. Le réseau qui ne répond jamais</h2>\n<p>Les <code>Promise</code>, c'est bien relou à débugger lorsque ça reste infiniment en\n&quot;pending&quot;: on ne sait pas forcément pourquoi, surtout si c'est derrière une API\nopaque, comme <code>fetch</code>. Plaisir garanti, parce qu'avec ça sur la page, c'est\nprobablement le dernier endroit où on va intuitivement chercher la source la\nbug.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">window</span>.fetch = <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">() =&gt;</span> {});\n</code></pre>\n<h2>3. Faire marcher les event listener au hasard</h2>\n<p>C'est particulièrement horrible quand un bug n'est pas reproduit à tous les\ncoups: pourquoi ne pas attacher les évenements au hasard ?</p>\n<pre><code class=\"hljs language-javascript\">(<span class=\"hljs-function\">() =&gt;</span> {\n  <span class=\"hljs-keyword\">let</span> originalAddEventListener = Element.prototype.addEventListener;\n  Element.prototype.addEventListener = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">...args</span>) </span>{\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">Math</span>.random() &lt; <span class=\"hljs-number\">0.75</span>) {\n      originalAddEventListener.call(<span class=\"hljs-built_in\">this</span>, ...args);\n    }\n  };\n})();\n</code></pre>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">document</span>.body.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">1</span>));\n<span class=\"hljs-built_in\">document</span>.body.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">2</span>));\n<span class=\"hljs-built_in\">document</span>.body.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">3</span>));\n<span class=\"hljs-built_in\">document</span>.body.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">4</span>));\n<span class=\"hljs-built_in\">document</span>.body.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-number\">5</span>));\n</code></pre>\n<h2>2. Faire foirer parseInt de temps en temps</h2>\n<pre><code class=\"hljs language-javascript\">(<span class=\"hljs-function\">() =&gt;</span> {\n  <span class=\"hljs-keyword\">let</span> originalParseInt = <span class=\"hljs-built_in\">window</span>.parseInt;\n  <span class=\"hljs-built_in\">window</span>.parseInt = <span class=\"hljs-function\"><span class=\"hljs-params\">n</span> =&gt;</span> (<span class=\"hljs-built_in\">Math</span>.random() &gt; <span class=\"hljs-number\">0.9</span> ? originalParseInt(n) : <span class=\"hljs-literal\">NaN</span>);\n})();\n</code></pre>\n<p>Pour un bon petit moment à pas comprendre ce qui se passe. Je suis sûr que <code>NaN</code>\nn'est pas toujours géré dans tous les cas dans la plupart des scripts qui\ntournent aujourd'hui en prod.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;1&quot;</span>); <span class=\"hljs-comment\">// 1</span>\n<span class=\"hljs-built_in\">parseInt</span>(<span class=\"hljs-string\">&quot;1&quot;</span>); <span class=\"hljs-comment\">// NaN</span>\n</code></pre>\n<h2>1. (De)serialiser les URL</h2>\n<p>Pour ce coup, c'est bien de prévoir les deux fonctions utilisées par tout le\nmonde pour encoder et décoder les URLs. Vu que si l'une ne marche pas, le\nreflexe est souvent de tester la deuxième, bon arrachage de cheveux en\nperspective.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">window</span>.decodeURIComponent = <span class=\"hljs-built_in\">window</span>.encodeURIComponent = <span class=\"hljs-built_in\">window</span>.escape = <span class=\"hljs-built_in\">window</span>.unescape = <span class=\"hljs-function\"><span class=\"hljs-params\">a</span> =&gt;</span>\n  <span class=\"hljs-built_in\">String</span>(a);\n</code></pre>\n<h2>Bonus: pour rendre tout ça crédible</h2>\n<p>Si dans la console de développement, vous tapez le nom d'une fonction accessible\ndans le scope, le navigateur va appeler <code>Function.prototype.toString</code> sur cette\nfonction pour en récupérer l'allure. Couvrez vos arrières en replaçant la\nméthode :</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">Function</span>.prototype.toString = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">`function <span class=\"hljs-subst\">${<span class=\"hljs-built_in\">this</span>.name || <span class=\"hljs-string\">&quot;&quot;</span>}</span>() {\n    [native code]\n}`</span>;\n};\n</code></pre>\n<pre><code class=\"hljs language-javascript\">() =&gt; {};\n<span class=\"hljs-comment\">/* function () {\n    [native code]\n} */</span>\n</code></pre>\n<p>Pour faire un peu de zèle, vous pouvez également déclarer ces fonctions dans un\n<code>eval</code> pour brouiller les pistes sur l'endroit où elles ont été déclarées.</p>\n<p>Voilà, vous avez toutes les clés pour faire des petites blagues à vos collègues.</p>\n<p>Et n'oubliez pas, JavaScript c'est super, mais faisez gaffe quand même, parce\nque dans un langage encourageant la mutabilité, qui utilise des globales et de\nl'héritage par dessus le marché, il suffit d'un petit bout de code innocent pour\nque plus rien ne marche.</p>\n<p>Bisous.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>