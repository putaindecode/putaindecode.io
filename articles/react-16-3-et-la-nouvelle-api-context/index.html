<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">React 16.3 et la nouvelle API Context | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="React 16.3 et la nouvelle API Context | Putain de code" property="og:title"/><meta data-react-helmet="true" content="React 16.3 et la nouvelle API Context | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par neovea" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/react-16-3-et-la-nouvelle-api-context" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(233, 100%, 35%), hsl(194, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">React 16.3 et la nouvelle API Context</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/neovea"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="neovea" src="https://avatars.githubusercontent.com/neovea?size=64"/><div>neovea<!-- --> <!-- -->•<!-- --> <!-- -->2018/06/21</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Depuis fin mars 2018, la version 16.3 de React est sortie et a apporté son lot
de nouveautés, dont l'API Context. Alors ok, cette API existait déjà par le
passé mais il était déconseillé de l'utiliser car sujette à évolution (c'est la
doc de React qui le disait). Et évolution il y a eu. La nouvelle API Context est
devenue beaucoup plus facile à utiliser ; sa syntaxe s'est assouplie et
simplifiée. Ce qui fait désormais d'elle un outil de premier ordre.</p>
<h2>À quoi ça sert exactement ?</h2>
<p>Ça permet tout simplement de rendre disponibles des propriétés au sein des ses
composants React sans avoir à les passer directement à ces derniers. Autant dire
que lorsqu'on a une application un peu complexe (entendre beaucoup de composants
et d'héritages de propriétés), il devient très vite compliqué de maintenir tout
ce petit monde ensemble. De plus, cela pose un souci de performance non
négligeable à la longue puisque les données sont traitées par des composants qui
n'ont rien à faire avec, sans compter les <code>Render</code>s potentiellement inutiles. Du
coup, très souvent, on a recours à des solutions qui peuvent se montrer
potentiellement <em>overkill</em> (aka Redux, Mobx et consorts) afin de ségréguer tout
ou partie de nos données pour des composants spécifiques, et les rendre
disponibles &quot;facilement&quot; à l'ensemble de l'app.</p>
<p>Avec la nouvelle API Context, on peut facilement créer un ou plusieurs <code>store</code>s
pour nos données. Cela permet de mieux structurer nos données, mais aussi d'en
passer la juste quantité nos composants, sans avoir à faire face au calamiteux
<em><a href="https://blog.kentcdodds.com/prop-drilling-bb62e02cb691">prop drilling</a></em>. Mais
attention tout de même à ne pas en faire un marteau doré.</p>
<h2>À quoi ça ressemble dans la pratique ?</h2>
<p>Assez de blabla, passons à un exemple concret avec des vrais morceaux de
<code>Context</code> dedans !</p>
<p>Imaginons que nous souhaitions créer un contexte qui contient les informations
de l'utilisateur connecté pour les rendre facilement accessibles à plusieurs
endroits de notre app. Nous créons un contexte et l'implémentons de la manière
suivante :</p>
<h3>Création du contexte</h3>
<pre><code class="hljs language-jsx"><span class="hljs-comment">// store/UserProvider.js</span>
<span class="hljs-keyword">import</span> React, { createContext, Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>; <span class="hljs-comment">// on importe createContext qui servira à la création d&#x27;un ou plusieurs contextes</span>

<span class="hljs-comment">/**
 * `createContext` contient 2 propriétés :
 * `Provider` et `Consumer`. Nous les rendons accessibles
 * via la constante `UserContext` et on initialise une
 * propriété par défaut &quot;name&quot; qui sera une chaîne vide.
 * On exporte ce contexte afin qu&#x27;il soit exploitable par
 * d&#x27;autres composants par la suite via le `Consumer`
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> UserContext = createContext({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;&quot;</span>,
});

<span class="hljs-comment">/**
 * la classe UserProvider fera office de... Provider (!)
 * en englobant son enfant direct
 * dans le composant éponyme. De cette façon, ses values
 * seront accessibles de manière globale via le `Consumer`
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  state = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Putain de Code&quot;</span>, <span class="hljs-comment">// une valeur de départ</span>
  };

  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> (
      <span class="hljs-comment">/**
       * la propriété value est très importante ici, elle rend
       * le contenu du state disponible aux `Consumers` de l&#x27;application
       */</span>
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{this.state}</span>&gt;</span>
        {this.props.children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
    );
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> UserProvider;
</code></pre>
<h3>Initialisation du contexte</h3>
<pre><code class="hljs language-jsx"><span class="hljs-comment">// app.js</span>
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;
<span class="hljs-keyword">import</span> Hello <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Hello&quot;</span>;

<span class="hljs-comment">// On importe la classe `UserProvider`</span>
<span class="hljs-keyword">import</span> UserProvider <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store/UserProvider&quot;</span>;

<span class="hljs-keyword">const</span> styles = {
  <span class="hljs-attr">fontFamily</span>: <span class="hljs-string">&quot;sans-serif&quot;</span>,
  <span class="hljs-attr">textAlign</span>: <span class="hljs-string">&quot;center&quot;</span>,
};

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles}</span>&gt;</span>
    {/* A noter qu&#x27;aucune propriété n&#x27;est passée au composant `Hello` */}
    <span class="hljs-tag">&lt;<span class="hljs-name">Hello</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
);

render(
  <span class="hljs-comment">/**
   * On pourrait tout à fait n&#x27;englober que les composants qui
   * nous intéressent, mais pour l&#x27;exemple, nous englobons le bootstrap
   * de notre app dans notre `UserProvider`
   */</span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserProvider</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">UserProvider</span>&gt;</span></span>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;root&quot;</span>),
);
</code></pre>
<h3>Création du composant <code>Hello</code> qui consommera les data de notre contexte</h3>
<pre><code class="hljs language-jsx"><span class="hljs-comment">// Hello.js</span>
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-comment">/**
 * On importe cette fois non pas le UserProvider,
 * mais le contexte afin d&#x27;accéder au `Consumer`
 */</span>
<span class="hljs-keyword">import</span> { UserContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store/UserProvider&quot;</span>;

<span class="hljs-comment">/**
 * Le Consumer expose le contenu de la propriété `value`
 * du Provider
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Consumer</span>&gt;</span>
    {value =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello {value.name}!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}
  <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Consumer</span>&gt;</span></span>
);
</code></pre>
<h3>Le rendu sera :</h3>
<pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello Putain de Code!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
</code></pre>
<p>En gros, ce qu'il faut retenir ici, c'est que pour utiliser l'API, on a deux
propriétés : le <code>Provider</code>, qui se charge de diffuser nos propriétés d'une part,
et un ou plusieurs <code>Consumer</code>s qui permettent d'accéder aux données fournies par
le <code>Provider</code> d'autre part.</p>
<p>Avec cet exemple minimaliste, on constate qu'il n'est plus nécessaire de passer
les <code>props</code> à nos composants enfants. Ceci rend le code plus light et plus
facile à lire et à comprendre. Et ça c'est déjà énorme en soi. Petite note en
passant : vos composants qui se nourrissent de votre contexte seront re-rendus à
chaque fois que ce dernier sera mis à jour. Donc faites gaffe quand même à ne
pas en abuser. Mais avec une bonne gestion on peut aller assez loin :)</p>
<p>Bon c'est bien tout ça, mais si on veut permettre à nos composants de modifier
les valeurs de notre contexte ?</p>
<h2>Passer des méthodes à nos composants via <code>Context</code></h2>
<p>La partie la plus fun commence : on va enrichir notre contexte avec des méthodes
qui seront accessibles aux enfants, et créer un <code>store</code> &quot;à la Redux&quot; en quelques
lignes de code seulement ! 😈</p>
<h3>Implémenter une méthode</h3>
<p>On va déclarer notre méthode à deux endroits : Dans le <code>context</code>, et dans le
<code>state</code> de notre <code>UserProvider</code> :</p>
<pre><code class="hljs language-jsx"><span class="hljs-comment">// store/UserProvider.js</span>
...

<span class="hljs-comment">/**
 * On ajoute la propriété `setName` à notre contexte
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> UserContext = createContext({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;&quot;</span>,
  <span class="hljs-attr">setName</span>: <span class="hljs-function">() =&gt;</span> {}
});

...

<span class="hljs-comment">/**
 * et on implémente une méthode dans notre `state`
 * qui va mettre à jour ce dernier avec la valeur passée en paramètre.
 * A noter qu&#x27;on peut aussi faire appel à des méthodes de notre
 * composant, mais on va faire simple pour l&#x27;exemple.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  state = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Franck&quot;</span>, <span class="hljs-comment">// une valeur de départ</span>
    <span class="hljs-attr">setName</span>: <span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> <span class="hljs-built_in">this</span>.setState({ <span class="hljs-attr">name</span>: name }) <span class="hljs-comment">// nouvelle propriété de mutation</span>
  };

  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> (
      <span class="hljs-comment">// Ici, rien ne change !</span>
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{this.state}</span>&gt;</span>
        {this.props.children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
    );
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> UserProvider;
</code></pre>
<p>Comme implémenter le <code>Consumer</code> dans chaque composant est rébarbatif, on va
créer un Higher Order Component qui se chargera d'implémenter ce dernier à notre
place :</p>
<pre><code class="hljs language-jsx"><span class="hljs-comment">// store/UserProvider.js</span>

...

<span class="hljs-comment">/**
 * A la suite de notre classe `UserProvider`, on créé notre HOC
 * qui se chargera d&#x27;injecter les propriétés de notre contexte
 * à n&#x27;importe quel composant qui l&#x27;appellera
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> withUser = <span class="hljs-function"><span class="hljs-params">Component</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Consumer</span>&gt;</span>
    {store =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...props</span>} {<span class="hljs-attr">...store</span>} /&gt;</span>}
  <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Consumer</span>&gt;</span></span>
)
</code></pre>
<p>Il ne reste plus qu'à modifier notre composant <code>Hello</code> comme suit :</p>
<pre><code class="hljs language-jsx"><span class="hljs-comment">// Hello.js</span>
<span class="hljs-keyword">import</span> React, { Fragment } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-comment">/**
 * On replace `UserContext` par notre HOC `withUser`
 */</span>
<span class="hljs-keyword">import</span> { withUser } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store/UserProvider&quot;</span>;

<span class="hljs-comment">/**
 * et on utilise `withUser` comme n&#x27;importe quel HOC
 * de ce type
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> withUser(<span class="hljs-function">(<span class="hljs-params">{ name, setName }</span>) =&gt;</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fragment</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello {name}!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{name}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setName(e.target.value)} /&gt;
  <span class="hljs-tag">&lt;/<span class="hljs-name">Fragment</span>&gt;</span></span>
));
</code></pre>
<p>Et tadam ✨✨ ! On a créé un micro store pour notre application !</p>
<h2>En conclusion</h2>
<p>Avec l'API Context, les possibilités sont nombreuses, on peut :</p>
<ul>
<li>créer des &quot;micro stores&quot; pour certaines parties de notre application, voire
les faire hériter d'un store plus global.</li>
<li>imaginer combiner les <code>store</code>s et les faire &quot;hériter&quot; les uns des autres.</li>
</ul>
<p>On résout au passage pas mal de problèmes liés à l'imbrication et à la
hiérarchisation des composants. Ainsi, on peut très facilement faire face à une
application qui grossit sans avoir à sortir l'artillerie parfois lourde de
Redux.</p>
<p>Maintenant vous avez le pouvoir ! Mais usez-en avec sagesse :)</p>
<p>Le code source est disponible ici :</p>
<p><a href="https://codesandbox.io/s/mq8jq87v9p"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit mq8jq87v9p" /></a></p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=React%2016.3%20et%20la%20nouvelle%20API%20Context%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Freact-16-3-et-la-nouvelle-api-context" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"react-16-3-et-la-nouvelle-api-context","v":{"_0":{"TAG":0,"_0":{"slug":"react-16-3-et-la-nouvelle-api-context","filename":"2018-06-21-react-16-3-et-la-nouvelle-api-context","title":"React 16.3 et la nouvelle API Context","date":"Thu, 21 Jun 2018 00:00:00 GMT","draft":false,"meta":{"date":"2018-06-21T00:00:00.000Z","title":"React 16.3 et la nouvelle API Context","author":"neovea","oldSlug":"js/react/react-new-context-api","slug":"react-16-3-et-la-nouvelle-api-context"},"body":"<p>Depuis fin mars 2018, la version 16.3 de React est sortie et a apporté son lot\nde nouveautés, dont l'API Context. Alors ok, cette API existait déjà par le\npassé mais il était déconseillé de l'utiliser car sujette à évolution (c'est la\ndoc de React qui le disait). Et évolution il y a eu. La nouvelle API Context est\ndevenue beaucoup plus facile à utiliser ; sa syntaxe s'est assouplie et\nsimplifiée. Ce qui fait désormais d'elle un outil de premier ordre.</p>\n<h2>À quoi ça sert exactement ?</h2>\n<p>Ça permet tout simplement de rendre disponibles des propriétés au sein des ses\ncomposants React sans avoir à les passer directement à ces derniers. Autant dire\nque lorsqu'on a une application un peu complexe (entendre beaucoup de composants\net d'héritages de propriétés), il devient très vite compliqué de maintenir tout\nce petit monde ensemble. De plus, cela pose un souci de performance non\nnégligeable à la longue puisque les données sont traitées par des composants qui\nn'ont rien à faire avec, sans compter les <code>Render</code>s potentiellement inutiles. Du\ncoup, très souvent, on a recours à des solutions qui peuvent se montrer\npotentiellement <em>overkill</em> (aka Redux, Mobx et consorts) afin de ségréguer tout\nou partie de nos données pour des composants spécifiques, et les rendre\ndisponibles &quot;facilement&quot; à l'ensemble de l'app.</p>\n<p>Avec la nouvelle API Context, on peut facilement créer un ou plusieurs <code>store</code>s\npour nos données. Cela permet de mieux structurer nos données, mais aussi d'en\npasser la juste quantité nos composants, sans avoir à faire face au calamiteux\n<em><a href=\"https://blog.kentcdodds.com/prop-drilling-bb62e02cb691\">prop drilling</a></em>. Mais\nattention tout de même à ne pas en faire un marteau doré.</p>\n<h2>À quoi ça ressemble dans la pratique ?</h2>\n<p>Assez de blabla, passons à un exemple concret avec des vrais morceaux de\n<code>Context</code> dedans !</p>\n<p>Imaginons que nous souhaitions créer un contexte qui contient les informations\nde l'utilisateur connecté pour les rendre facilement accessibles à plusieurs\nendroits de notre app. Nous créons un contexte et l'implémentons de la manière\nsuivante :</p>\n<h3>Création du contexte</h3>\n<pre><code class=\"hljs language-jsx\"><span class=\"hljs-comment\">// store/UserProvider.js</span>\n<span class=\"hljs-keyword\">import</span> React, { createContext, Component } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>; <span class=\"hljs-comment\">// on importe createContext qui servira à la création d&#x27;un ou plusieurs contextes</span>\n\n<span class=\"hljs-comment\">/**\n * `createContext` contient 2 propriétés :\n * `Provider` et `Consumer`. Nous les rendons accessibles\n * via la constante `UserContext` et on initialise une\n * propriété par défaut &quot;name&quot; qui sera une chaîne vide.\n * On exporte ce contexte afin qu&#x27;il soit exploitable par\n * d&#x27;autres composants par la suite via le `Consumer`\n */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> UserContext = createContext({\n  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;&quot;</span>,\n});\n\n<span class=\"hljs-comment\">/**\n * la classe UserProvider fera office de... Provider (!)\n * en englobant son enfant direct\n * dans le composant éponyme. De cette façon, ses values\n * seront accessibles de manière globale via le `Consumer`\n */</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserProvider</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n  state = {\n    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Putain de Code&quot;</span>, <span class=\"hljs-comment\">// une valeur de départ</span>\n  };\n\n  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> {\n    <span class=\"hljs-keyword\">return</span> (\n      <span class=\"hljs-comment\">/**\n       * la propriété value est très importante ici, elle rend\n       * le contenu du state disponible aux `Consumers` de l&#x27;application\n       */</span>\n      <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">UserContext.Provider</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{this.state}</span>&gt;</span>\n        {this.props.children}\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">UserContext.Provider</span>&gt;</span></span>\n    );\n  }\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> UserProvider;\n</code></pre>\n<h3>Initialisation du contexte</h3>\n<pre><code class=\"hljs language-jsx\"><span class=\"hljs-comment\">// app.js</span>\n<span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { render } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react-dom&quot;</span>;\n<span class=\"hljs-keyword\">import</span> Hello <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./Hello&quot;</span>;\n\n<span class=\"hljs-comment\">// On importe la classe `UserProvider`</span>\n<span class=\"hljs-keyword\">import</span> UserProvider <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./store/UserProvider&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> styles = {\n  <span class=\"hljs-attr\">fontFamily</span>: <span class=\"hljs-string\">&quot;sans-serif&quot;</span>,\n  <span class=\"hljs-attr\">textAlign</span>: <span class=\"hljs-string\">&quot;center&quot;</span>,\n};\n\n<span class=\"hljs-keyword\">const</span> App = <span class=\"hljs-function\">() =&gt;</span> (\n  <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">{styles}</span>&gt;</span>\n    {/* A noter qu&#x27;aucune propriété n&#x27;est passée au composant `Hello` */}\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Hello</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n);\n\nrender(\n  <span class=\"hljs-comment\">/**\n   * On pourrait tout à fait n&#x27;englober que les composants qui\n   * nous intéressent, mais pour l&#x27;exemple, nous englobons le bootstrap\n   * de notre app dans notre `UserProvider`\n   */</span>\n  <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">UserProvider</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">App</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">UserProvider</span>&gt;</span></span>,\n  <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&quot;root&quot;</span>),\n);\n</code></pre>\n<h3>Création du composant <code>Hello</code> qui consommera les data de notre contexte</h3>\n<pre><code class=\"hljs language-jsx\"><span class=\"hljs-comment\">// Hello.js</span>\n<span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n<span class=\"hljs-comment\">/**\n * On importe cette fois non pas le UserProvider,\n * mais le contexte afin d&#x27;accéder au `Consumer`\n */</span>\n<span class=\"hljs-keyword\">import</span> { UserContext } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./store/UserProvider&quot;</span>;\n\n<span class=\"hljs-comment\">/**\n * Le Consumer expose le contenu de la propriété `value`\n * du Provider\n */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> () =&gt; (\n  <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">UserContext.Consumer</span>&gt;</span>\n    {value =&gt; <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Hello {value.name}!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>}\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">UserContext.Consumer</span>&gt;</span></span>\n);\n</code></pre>\n<h3>Le rendu sera :</h3>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Hello Putain de Code!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n</code></pre>\n<p>En gros, ce qu'il faut retenir ici, c'est que pour utiliser l'API, on a deux\npropriétés : le <code>Provider</code>, qui se charge de diffuser nos propriétés d'une part,\net un ou plusieurs <code>Consumer</code>s qui permettent d'accéder aux données fournies par\nle <code>Provider</code> d'autre part.</p>\n<p>Avec cet exemple minimaliste, on constate qu'il n'est plus nécessaire de passer\nles <code>props</code> à nos composants enfants. Ceci rend le code plus light et plus\nfacile à lire et à comprendre. Et ça c'est déjà énorme en soi. Petite note en\npassant : vos composants qui se nourrissent de votre contexte seront re-rendus à\nchaque fois que ce dernier sera mis à jour. Donc faites gaffe quand même à ne\npas en abuser. Mais avec une bonne gestion on peut aller assez loin :)</p>\n<p>Bon c'est bien tout ça, mais si on veut permettre à nos composants de modifier\nles valeurs de notre contexte ?</p>\n<h2>Passer des méthodes à nos composants via <code>Context</code></h2>\n<p>La partie la plus fun commence : on va enrichir notre contexte avec des méthodes\nqui seront accessibles aux enfants, et créer un <code>store</code> &quot;à la Redux&quot; en quelques\nlignes de code seulement ! 😈</p>\n<h3>Implémenter une méthode</h3>\n<p>On va déclarer notre méthode à deux endroits : Dans le <code>context</code>, et dans le\n<code>state</code> de notre <code>UserProvider</code> :</p>\n<pre><code class=\"hljs language-jsx\"><span class=\"hljs-comment\">// store/UserProvider.js</span>\n...\n\n<span class=\"hljs-comment\">/**\n * On ajoute la propriété `setName` à notre contexte\n */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> UserContext = createContext({\n  <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;&quot;</span>,\n  <span class=\"hljs-attr\">setName</span>: <span class=\"hljs-function\">() =&gt;</span> {}\n});\n\n...\n\n<span class=\"hljs-comment\">/**\n * et on implémente une méthode dans notre `state`\n * qui va mettre à jour ce dernier avec la valeur passée en paramètre.\n * A noter qu&#x27;on peut aussi faire appel à des méthodes de notre\n * composant, mais on va faire simple pour l&#x27;exemple.\n */</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserProvider</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n  state = {\n    <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Franck&quot;</span>, <span class=\"hljs-comment\">// une valeur de départ</span>\n    <span class=\"hljs-attr\">setName</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">name</span> =&gt;</span> <span class=\"hljs-built_in\">this</span>.setState({ <span class=\"hljs-attr\">name</span>: name }) <span class=\"hljs-comment\">// nouvelle propriété de mutation</span>\n  };\n\n  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> {\n    <span class=\"hljs-keyword\">return</span> (\n      <span class=\"hljs-comment\">// Ici, rien ne change !</span>\n      <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">UserContext.Provider</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{this.state}</span>&gt;</span>\n        {this.props.children}\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">UserContext.Provider</span>&gt;</span></span>\n    );\n  }\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> UserProvider;\n</code></pre>\n<p>Comme implémenter le <code>Consumer</code> dans chaque composant est rébarbatif, on va\ncréer un Higher Order Component qui se chargera d'implémenter ce dernier à notre\nplace :</p>\n<pre><code class=\"hljs language-jsx\"><span class=\"hljs-comment\">// store/UserProvider.js</span>\n\n...\n\n<span class=\"hljs-comment\">/**\n * A la suite de notre classe `UserProvider`, on créé notre HOC\n * qui se chargera d&#x27;injecter les propriétés de notre contexte\n * à n&#x27;importe quel composant qui l&#x27;appellera\n */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> withUser = <span class=\"hljs-function\"><span class=\"hljs-params\">Component</span> =&gt;</span> <span class=\"hljs-function\"><span class=\"hljs-params\">props</span> =&gt;</span> (\n  <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">UserContext.Consumer</span>&gt;</span>\n    {store =&gt; <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Component</span> {<span class=\"hljs-attr\">...props</span>} {<span class=\"hljs-attr\">...store</span>} /&gt;</span>}\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">UserContext.Consumer</span>&gt;</span></span>\n)\n</code></pre>\n<p>Il ne reste plus qu'à modifier notre composant <code>Hello</code> comme suit :</p>\n<pre><code class=\"hljs language-jsx\"><span class=\"hljs-comment\">// Hello.js</span>\n<span class=\"hljs-keyword\">import</span> React, { Fragment } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n<span class=\"hljs-comment\">/**\n * On replace `UserContext` par notre HOC `withUser`\n */</span>\n<span class=\"hljs-keyword\">import</span> { withUser } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./store/UserProvider&quot;</span>;\n\n<span class=\"hljs-comment\">/**\n * et on utilise `withUser` comme n&#x27;importe quel HOC\n * de ce type\n */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> withUser(<span class=\"hljs-function\">(<span class=\"hljs-params\">{ name, setName }</span>) =&gt;</span> (\n  <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Fragment</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Hello {name}!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{name}</span> <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{e</span> =&gt;</span> setName(e.target.value)} /&gt;\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Fragment</span>&gt;</span></span>\n));\n</code></pre>\n<p>Et tadam ✨✨ ! On a créé un micro store pour notre application !</p>\n<h2>En conclusion</h2>\n<p>Avec l'API Context, les possibilités sont nombreuses, on peut :</p>\n<ul>\n<li>créer des &quot;micro stores&quot; pour certaines parties de notre application, voire\nles faire hériter d'un store plus global.</li>\n<li>imaginer combiner les <code>store</code>s et les faire &quot;hériter&quot; les uns des autres.</li>\n</ul>\n<p>On résout au passage pas mal de problèmes liés à l'imbrication et à la\nhiérarchisation des composants. Ainsi, on peut très facilement faire face à une\napplication qui grossit sans avoir à sortir l'artillerie parfois lourde de\nRedux.</p>\n<p>Maintenant vous avez le pouvoir ! Mais usez-en avec sagesse :)</p>\n<p>Le code source est disponible ici :</p>\n<p><a href=\"https://codesandbox.io/s/mq8jq87v9p\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" alt=\"Edit mq8jq87v9p\" /></a></p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>