<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">ExternalInterface.call() de Flash (et Backbone), toute une histoire | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="ExternalInterface.call() de Flash (et Backbone), toute une histoire | Putain de code" property="og:title"/><meta data-react-helmet="true" content="ExternalInterface.call() de Flash (et Backbone), toute une histoire | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par kud" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/external-interface-call-flash-backbone" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(116, 100%, 35%), hsl(97, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">ExternalInterface.call() de Flash (et Backbone), toute une histoire</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/kud"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="kud" src="https://avatars.githubusercontent.com/kud?size=64"/><div>kud<!-- --> <!-- -->•<!-- --> <!-- -->2013/12/05</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Je voulais vous parler d'un bug qui m'a bien emmerdé récemment et comme
j'aimerais que vous ne perdiez pas de temps avec cela, un article s'imposait.</p>
<p><em>Note de la direction : j'y connais rien en Flash (et je ne crois pas avoir trop
envie de connaître en fait).</em></p>
<p>Dans la boite où je travaille, nous utilisons Flash en tant que lecteur vidéo
étant donné qu'il est pour le moment très difficile de faire lire sur toutes les
plateformes des vidéos au format <em>H.264</em> et/ou passant par du <em>HLS</em>. Longue
histoire qui fera office d'un autre article. (Je dis ça à chaque fois, haha).</p>
<h2>Le pitch</h2>
<p>Avec notre <em>flasheur</em> attitré, nous nous sommes mis en tête de créer un objet
<em>event</em> qui permettrait au Flash de déclencher des évènements lorsqu'il le
souhaite afin de communiquer avec l'application JavaScript et que celui-ci fasse
en conséquence. Cet objet, nous l'avons appelé <code>App.FlashManager</code> et plus
précisemment <code>App.FlashManager.Events</code> dans le cas des évènements. Nous
utilisons <strong>Backbone.js</strong> pour gérer ce principe d'évènement mais vous en avez
d'<a href="http://microjs.com/#event">autres</a> de disponible. En pratique, voilà ce que
ça donne :</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// on crée un objet vide</span>
App.FlashManager.Events = {};

<span class="hljs-comment">// on lui ajoute les fonctionnalités des events Backbone</span>
_.extend(App.FlashManager.Events, Backbone.Events);
</code></pre>
<p>En soi, pas de souci, tout se passe bien à ce moment, nous avons un
<a href="http://backbonejs.org/#Events">objet d'évènement façon Backbone</a>. Il pourra
alors s'écouter lui-même, écouter un autre objet, mais aussi déclencher des
évènements.</p>
<h2>Côté Flash</h2>
<p>La base est en place, maintenant on souhaite que le Flash déclenche un
évènement. On passe par l'objet <code>ExternalInterface</code> :</p>
<pre><code class="hljs language-javascript">ExternalInterface.call(<span class="hljs-string">&quot;window.App.FlashManager.Events.trigger&quot;</span>, <span class="hljs-string">&quot;my-event&quot;</span>);
<span class="hljs-comment">// http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/external/ExternalInterface.html#call</span>
</code></pre>
<p>Et là, bug.</p>
<h2>Pourquoi bug ?</h2>
<p>Pour le moment, je ne sais pas vraiment. Je me pencherai plus sur le sujet dès
que j'ai un peu de temps, mais ce que je sais, c'est que
<code>ExternalInterface.call()</code> ne s'attend pas à recevoir ce que <strong>Backbone.js</strong> lui
propose. Lorsque vous faites <code>.trigger()</code>, <strong>Backbone.js</strong> renvoie
l'<a href="https://github.com/jashkenas/backbone/blob/master/backbone.js#L144-L153">objet en cours</a>,
ce qui provoque un énooooorme bug dans le plugin Flash de votre navigateur.</p>
<h2>La solution côté JavaScript</h2>
<p>Pour contrer cela, je vous propose la solution suivante qui est de ne pas
utiliser directement l'objet <code>Backbone.Events|View</code> mais plutôt de passer par
une interface, un objet proxy.</p>
<p>Voici le schéma :</p>
<ul>
<li>Créer un objet simple qui contient les mêmes noms de méthodes que les objets
évènements <strong>Backbone.js</strong> (en gros, se mapper sur l'API Backbone)</li>
<li>Utiliser <strong>Backbone.js</strong> dans les méthodes de cet objet <em>Proxy</em></li>
</ul>
<p>Exemple :</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Bridge between flash and js</span>
App.FlashManager = {};
App.FlashManager.Events = {};

<span class="hljs-comment">// Backbone events used for Flash</span>
App.InternalFlashManager = {};
App.InternalFlashManager.Events = {};

_.extend(App.InternalFlashManager.Events, Backbone.Events);

App.FlashManager.Events.trigger = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, opts</span>) </span>{
  App.InternalFlashManager.Events.trigger(name, opts);

  <span class="hljs-comment">// Must return nothing not to loop JavaScript engine, important!</span>
  <span class="hljs-keyword">return</span>;
};
</code></pre>
<h2>Oh et...</h2>
<p>...il existe une version ayant plus ou moins le même souci que moi disponible là
:
<a href="https://coderwall.com/p/e-8niw">ExternalInterface#call in a deadly loop (<strong>flash</strong>toXML)</a>.</p>
<h2>Conclusion</h2>
<p>De manière générale (hors <strong>Backbone.js</strong>), lorsque vous utilisez
<code>ExternalInterface.call()</code>, faites en sorte que votre JavaScript retourne
quelque chose de simple (un objet ayant que des attributs, pas de fonctions, ou
encore un booléen ou un <em>integer</em>).</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=ExternalInterface.call()%20de%20Flash%20(et%20Backbone)%2C%20toute%20une%20histoire%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fexternal-interface-call-flash-backbone" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"external-interface-call-flash-backbone","v":{"_0":{"TAG":0,"_0":{"slug":"external-interface-call-flash-backbone","filename":"2013-12-05-external-interface-call-flash-backbone","title":"ExternalInterface.call() de Flash (et Backbone), toute une histoire","date":"Thu, 05 Dec 2013 00:00:00 GMT","draft":false,"meta":{"date":"2013-12-05T00:00:00.000Z","title":"ExternalInterface.call() de Flash (et Backbone), toute une histoire","author":"kud","oldSlug":"flash/bug-externalinterface-call-backbone","slug":"external-interface-call-flash-backbone"},"body":"<p>Je voulais vous parler d'un bug qui m'a bien emmerdé récemment et comme\nj'aimerais que vous ne perdiez pas de temps avec cela, un article s'imposait.</p>\n<p><em>Note de la direction : j'y connais rien en Flash (et je ne crois pas avoir trop\nenvie de connaître en fait).</em></p>\n<p>Dans la boite où je travaille, nous utilisons Flash en tant que lecteur vidéo\nétant donné qu'il est pour le moment très difficile de faire lire sur toutes les\nplateformes des vidéos au format <em>H.264</em> et/ou passant par du <em>HLS</em>. Longue\nhistoire qui fera office d'un autre article. (Je dis ça à chaque fois, haha).</p>\n<h2>Le pitch</h2>\n<p>Avec notre <em>flasheur</em> attitré, nous nous sommes mis en tête de créer un objet\n<em>event</em> qui permettrait au Flash de déclencher des évènements lorsqu'il le\nsouhaite afin de communiquer avec l'application JavaScript et que celui-ci fasse\nen conséquence. Cet objet, nous l'avons appelé <code>App.FlashManager</code> et plus\nprécisemment <code>App.FlashManager.Events</code> dans le cas des évènements. Nous\nutilisons <strong>Backbone.js</strong> pour gérer ce principe d'évènement mais vous en avez\nd'<a href=\"http://microjs.com/#event\">autres</a> de disponible. En pratique, voilà ce que\nça donne :</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// on crée un objet vide</span>\nApp.FlashManager.Events = {};\n\n<span class=\"hljs-comment\">// on lui ajoute les fonctionnalités des events Backbone</span>\n_.extend(App.FlashManager.Events, Backbone.Events);\n</code></pre>\n<p>En soi, pas de souci, tout se passe bien à ce moment, nous avons un\n<a href=\"http://backbonejs.org/#Events\">objet d'évènement façon Backbone</a>. Il pourra\nalors s'écouter lui-même, écouter un autre objet, mais aussi déclencher des\névènements.</p>\n<h2>Côté Flash</h2>\n<p>La base est en place, maintenant on souhaite que le Flash déclenche un\névènement. On passe par l'objet <code>ExternalInterface</code> :</p>\n<pre><code class=\"hljs language-javascript\">ExternalInterface.call(<span class=\"hljs-string\">&quot;window.App.FlashManager.Events.trigger&quot;</span>, <span class=\"hljs-string\">&quot;my-event&quot;</span>);\n<span class=\"hljs-comment\">// http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/external/ExternalInterface.html#call</span>\n</code></pre>\n<p>Et là, bug.</p>\n<h2>Pourquoi bug ?</h2>\n<p>Pour le moment, je ne sais pas vraiment. Je me pencherai plus sur le sujet dès\nque j'ai un peu de temps, mais ce que je sais, c'est que\n<code>ExternalInterface.call()</code> ne s'attend pas à recevoir ce que <strong>Backbone.js</strong> lui\npropose. Lorsque vous faites <code>.trigger()</code>, <strong>Backbone.js</strong> renvoie\nl'<a href=\"https://github.com/jashkenas/backbone/blob/master/backbone.js#L144-L153\">objet en cours</a>,\nce qui provoque un énooooorme bug dans le plugin Flash de votre navigateur.</p>\n<h2>La solution côté JavaScript</h2>\n<p>Pour contrer cela, je vous propose la solution suivante qui est de ne pas\nutiliser directement l'objet <code>Backbone.Events|View</code> mais plutôt de passer par\nune interface, un objet proxy.</p>\n<p>Voici le schéma :</p>\n<ul>\n<li>Créer un objet simple qui contient les mêmes noms de méthodes que les objets\névènements <strong>Backbone.js</strong> (en gros, se mapper sur l'API Backbone)</li>\n<li>Utiliser <strong>Backbone.js</strong> dans les méthodes de cet objet <em>Proxy</em></li>\n</ul>\n<p>Exemple :</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Bridge between flash and js</span>\nApp.FlashManager = {};\nApp.FlashManager.Events = {};\n\n<span class=\"hljs-comment\">// Backbone events used for Flash</span>\nApp.InternalFlashManager = {};\nApp.InternalFlashManager.Events = {};\n\n_.extend(App.InternalFlashManager.Events, Backbone.Events);\n\nApp.FlashManager.Events.trigger = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">name, opts</span>) </span>{\n  App.InternalFlashManager.Events.trigger(name, opts);\n\n  <span class=\"hljs-comment\">// Must return nothing not to loop JavaScript engine, important!</span>\n  <span class=\"hljs-keyword\">return</span>;\n};\n</code></pre>\n<h2>Oh et...</h2>\n<p>...il existe une version ayant plus ou moins le même souci que moi disponible là\n:\n<a href=\"https://coderwall.com/p/e-8niw\">ExternalInterface#call in a deadly loop (<strong>flash</strong>toXML)</a>.</p>\n<h2>Conclusion</h2>\n<p>De manière générale (hors <strong>Backbone.js</strong>), lorsque vous utilisez\n<code>ExternalInterface.call()</code>, faites en sorte que votre JavaScript retourne\nquelque chose de simple (un objet ayant que des attributs, pas de fonctions, ou\nencore un booléen ou un <em>integer</em>).</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>