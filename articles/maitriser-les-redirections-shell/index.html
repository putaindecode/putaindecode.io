<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Maîtriser les redirections shell | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Maîtriser les redirections shell | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Maîtriser les redirections shell | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par madx" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/maitriser-les-redirections-shell" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(315, 100%, 35%), hsl(262, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Maîtriser les redirections shell</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/madx"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="madx" src="https://avatars.githubusercontent.com/madx?size=64"/><div>madx<!-- --> <!-- -->•<!-- --> <!-- -->2014/07/16</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Le shell (ou ligne de commande) est l'outil de prédilection pour bon nombre
d'entre nous qui utilisons un OS de la famille UNIX. Nous sommes persuadés que
bien utilisé, il remplace avantageusement un IDE complexe et gourmand.</p>
<p>Chez <em>Putain de code !</em>, on a une certaine tendance à utiliser <a href="http://fr.wikipedia.org/wiki/Z_Shell">Zsh</a>,
mais pour ma part, j'utilise encore et toujours le vénérable <a href="http://fr.wikipedia.org/wiki/Bourne-Again_shell">Bash</a>,
non pas pour faire mon barbu mais simplement car il me suffit amplement.</p>
<p>La suite de l'article est donc basée sur celui-ci mais tout devrait fonctionner
à l'identique sur Zsh.</p>
<p>Venons en au sujet même de cet article, l'un des éléments essentiels de
l'utilisation du shell : l'utilisation des redirections d'entrée/sortie de base.</p>
<p>Si ça vous paraît barbare, tenez-vous bien, on attaque tout de suite !</p>
<h2>Une entrée, deux sorties</h2>
<p>Un des principes de base sous UNIX est que tout est fichier et que l'activité du
système est rendue par l'interaction de programmes (ou processus) à l'aide des
dits fichiers.</p>
<p>Pour pouvoir collaborer avec ses congénères, chaque processus peut accéder par
défaut à trois fichiers bien particuliers : l'entrée, la sortie, et la sortie
d'erreur standards.</p>
<ul>
<li>L'entrée standard (<code>stdin</code>)</li>
<li>La sortie standard (<code>stdout</code>)</li>
<li>La sortie d'erreur (<code>stderr</code>)</li>
</ul>
<p>Habituellement, l'entrée standard est liée au clavier de l'utilisateur <em>via</em> son
émulateur de terminal, et les deux sorties sont liées à l'affichage dans ce même
émulateur.</p>
<p>L'idée pour pouvoir faire collaborer les processus est donc de <em>brancher</em> les
entrées et sorties de différents programmes afin d'obtenir un résultat.</p>
<h2>Les redirections de base</h2>
<p>Commençons par quelques redirections de base, celles qu'il faut connaître et qui
sont employées systématiquement.</p>
<p>Pour nous exercer, nous allons utiliser principalement deux commandes :</p>
<ul>
<li><code>echo</code> : permet d'écrire un message spécifié en tant qu'argument sur sa sortie
standard.</li>
<li><code>cat</code> : permet d'afficher le contenu d'un fichier passé en argument sur sa
sortie standard ou de répéter son entrée standard sur sa sortie standard.</li>
</ul>
<p>Rappelez vous que par défaut, la sortie standard est affichée dans le terminal
et l'entrée standard est le clavier de l'utilisateur.</p>
<h3>Redirection de sortie : <code>&gt;</code></h3>
<p>Ce type de redirection permet d'indiquer à un processus que tout ce qui devrait
aller sur la sortie standard (par défaut, le terminal), doit plutôt être stocké
dans un fichier.</p>
<p>Pour ça, on utilise la syntaxe <code>&gt; [fichier]</code> :</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello&quot;</span> &gt; message</span>
<span class="hljs-meta">$</span><span class="bash"> cat message</span>
Hello
</code></pre>
<h3>Redirection d'entrée : <code>&lt;</code></h3>
<p>À l'inverse, on peut aussi spécifier à un programme qu'il doit utiliser un
fichier comme son entrée standard, à la place du clavier de l'utilisateur.</p>
<p>En réutilisant notre fichier <code>message</code>, on peut par exemple faire :</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> cat &lt; message</span>
Hello
</code></pre>
<p>Notez qu'on utilise bien <code>cat</code> <em>sans argument</em>, il utilise donc l'entrée
standard.</p>
<h3>Connecter deux processus : <code>|</code></h3>
<p>Dernier des connecteurs de base, l'opérateur <code>|</code>, aussi appelé <em>pipe</em> (et qui se
prononce <em>paillepe</em>, avé l'accent).</p>
<p>Il permet tout simplement d'utiliser la sortie d'un programme comme entrée d'un
autre.</p>
<p>Pour montrer ça, introduisons la commande <code>tr</code>, qui permet de remplacer des
caractères dans l'entrée par d'autres.</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello!&quot;</span> | tr <span class="hljs-string">&quot;[:lower:]&quot;</span> <span class="hljs-string">&quot;[:upper:]&quot;</span></span>
HELLO!
</code></pre>
<h2>Descripteurs de fichiers et redirections avancées</h2>
<p>Pour aller plus loin, on va maintenant voir que chaque descripteur de fichier
possède son propre identifiant numérique.</p>
<p>Pour <code>stdin</code>, <code>stdout</code> et <code>stderr</code> ce sera respectivement 0, 1 et 2.</p>
<p>On peut se servir de ces identifiants pour faire des redirections plus poussées
!</p>
<h3>Rediriger les autres descripteur</h3>
<p>Par défaut, <code>&gt;</code> ne redirige que la sortie standard vers un fichier. Pour
rediriger un autre descripteur vers un fichier on emploiera la notation <code>X&gt;</code> où
<em>X</em> prendra la valeur de l'identifiant du descripteur.</p>
<p>Si vous avez bien suivi, on redirigera donc la sortie d'erreur vers un fichier à
l'aide de la syntaxe <code>2&gt;</code>.</p>
<h3>Rediriger vers un autre descripteur : <code>&gt;&amp;</code></h3>
<p>On peut connecter les descripteurs d'un processus entre eux. C'est un mécanisme
que l'on utilise très souvent quand on écrit des scripts Shell, notamment pour
écrire sur la sortie d'erreur.</p>
<p>Pour celà, on utilise la redirection <code>X&gt;&amp;Y</code> avec <em>X</em> étant l'identifiant
descripteur source et <em>Y</em> l'identifiant du descripteur sur lequel on veut
rediriger.</p>
<p>L'exemple suivant montre comment rediriger la sortie standard sur la sortie
d'erreur (c'est comme ça qu'on écrit sur la sortie d'erreur dans un script).</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Error&quot;</span> 1&gt;&amp;2</span>
</code></pre>
<p>Plus généralement, on peut omettre la partie avant le <code>&gt;&amp;</code>, elle prendra la
valeur 1 par défaut. On aura donc le script suivant :</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Error&quot;</span> &gt;&amp;2</span>
</code></pre>
<h3>Ajouter en fin de fichier : <code>&gt;&gt;</code></h3>
<p>Par défaut, <code>&gt;</code> écrase le fichier dans lequel la redirection va s'effectuer.
Pour éviter ce problème, on peut utiliser à la place <code>&gt;&gt;</code> qui va ajouter en fin
de fichier.</p>
<pre><code class="hljs language-console"><span class="hljs-meta">#</span><span class="bash"> Sans &gt;&gt;</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span> &gt; file</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;2&quot;</span> &gt; file</span>
<span class="hljs-meta">$</span><span class="bash"> cat file</span>
2
</code></pre>
<pre><code class="hljs language-console"><span class="hljs-meta">#</span><span class="bash"> Avec &gt;&gt;</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span> &gt; file</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;2&quot;</span> &gt;&gt; file</span>
<span class="hljs-meta">$</span><span class="bash"> cat file</span>
1
2
</code></pre>
<h3><code>/dev/null</code>, le trou noir</h3>
<p>Il existe un fichier un peu particulier sur tout bon UNIX qui se respecte :
<code>/dev/null</code>.</p>
<p>Ce dernier est en fait une sorte de trou noir : Si on affiche son contenu on
n'obtient rien, et si on écrit quelque chose dedans elle disparait.</p>
<p>On se sert souvent de ce fichier pour supprimer la sortie d'un programme :</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello&quot;</span> &gt;/dev/null</span>
<span class="hljs-meta">$</span><span class="bash"> cat /dev/null</span>
<span class="hljs-meta">$</span><span class="bash">
</span></code></pre>
<h3>Ordre des redirections</h3>
<p>Un dernier mot avant la fin, l'ordre des redirections est très important !</p>
<p>Imaginez la fonction suivante qui affiche un message sur la sortie standard et
un sur la sortie d'erreur :</p>
<pre><code class="hljs language-console">function programme() {
  echo &quot;Message&quot;
  echo &quot;Error&quot; &gt;&amp;2
}
</code></pre>
<p>Si on veut rediriger toutes les sorties vers <code>/dev/null</code> on peut utiliser la
syntaxe suivante :</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> programme 2&gt;/dev/null &gt;/dev/null</span>
</code></pre>
<p>Vous remarquerez que c'est assez verbeux, et qu'on pourrait simplifier celà en
utilisant <code>&gt;&amp;</code> comme vu précédemment.</p>
<p>On essaie donc naïvement :</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> programme 2&gt;&amp;1 &gt;/dev/null</span>
Error
</code></pre>
<p>Hmm, pourtant on a tout branché ensemble non ? En fait non, on a redirigé la
sortie sur le fichier pointé par <code>1</code> au moment où on écrit la redirection, donc
avant qu'il soit redirigé sur <code>/dev/null</code>.</p>
<p>Pour bien faire, il faut écrire les redirections dans l'autre ordre :</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> programme &gt;/dev/null 2&gt;&amp;1</span>
</code></pre>
<p>On lira ceci : Rediriger la sortie standard vers <code>/dev/null</code>, puis rediriger la
sortie d'erreur vers la sortie standard.</p>
<h3>Pour résumer</h3>
<p>On a en fait que deux redirections de sortie, <code>&gt;</code> et <code>&gt;&gt;</code>, les symboles qui les
entourent sont souvent optionnels.</p>
<p>Si on veut spécifier un fichier on donnera son nom, si on veut spécifier un
descripteur on donnera son identifiant préfixé de <code>&amp;</code>.</p>
<h2>Pour aller plus loin</h2>
<p>Le manuel de bash contient <a href="http://www.gnu.org/software/bash/manual/bashref.html#Redirections">une section complète sur les
redirections</a>. Elle va beaucoup plus loin que cet article et je vous
invite à la lire pour voir tout ce qu'il est possible de faire.</p>
<p>Il y a aussi une section dédiée à ce sujet dans l'<a href="http://tldp.org/LDP/abs/html/io-redirection.html">Advanced Bash-Scripting
Guide</a>.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Ma%C3%AEtriser%20les%20redirections%20shell%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fmaitriser-les-redirections-shell" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"maitriser-les-redirections-shell","v":{"_0":{"TAG":0,"_0":{"slug":"maitriser-les-redirections-shell","filename":"2014-07-16-maitriser-les-redirections-shell","title":"Maîtriser les redirections shell","date":"Wed, 16 Jul 2014 00:00:00 GMT","draft":false,"meta":{"date":"2014-07-16T00:00:00.000Z","title":"Maîtriser les redirections shell","author":"madx","oldSlug":"shell/redirections","slug":"maitriser-les-redirections-shell"},"body":"<p>Le shell (ou ligne de commande) est l'outil de prédilection pour bon nombre\nd'entre nous qui utilisons un OS de la famille UNIX. Nous sommes persuadés que\nbien utilisé, il remplace avantageusement un IDE complexe et gourmand.</p>\n<p>Chez <em>Putain de code !</em>, on a une certaine tendance à utiliser <a href=\"http://fr.wikipedia.org/wiki/Z_Shell\">Zsh</a>,\nmais pour ma part, j'utilise encore et toujours le vénérable <a href=\"http://fr.wikipedia.org/wiki/Bourne-Again_shell\">Bash</a>,\nnon pas pour faire mon barbu mais simplement car il me suffit amplement.</p>\n<p>La suite de l'article est donc basée sur celui-ci mais tout devrait fonctionner\nà l'identique sur Zsh.</p>\n<p>Venons en au sujet même de cet article, l'un des éléments essentiels de\nl'utilisation du shell : l'utilisation des redirections d'entrée/sortie de base.</p>\n<p>Si ça vous paraît barbare, tenez-vous bien, on attaque tout de suite !</p>\n<h2>Une entrée, deux sorties</h2>\n<p>Un des principes de base sous UNIX est que tout est fichier et que l'activité du\nsystème est rendue par l'interaction de programmes (ou processus) à l'aide des\ndits fichiers.</p>\n<p>Pour pouvoir collaborer avec ses congénères, chaque processus peut accéder par\ndéfaut à trois fichiers bien particuliers : l'entrée, la sortie, et la sortie\nd'erreur standards.</p>\n<ul>\n<li>L'entrée standard (<code>stdin</code>)</li>\n<li>La sortie standard (<code>stdout</code>)</li>\n<li>La sortie d'erreur (<code>stderr</code>)</li>\n</ul>\n<p>Habituellement, l'entrée standard est liée au clavier de l'utilisateur <em>via</em> son\némulateur de terminal, et les deux sorties sont liées à l'affichage dans ce même\némulateur.</p>\n<p>L'idée pour pouvoir faire collaborer les processus est donc de <em>brancher</em> les\nentrées et sorties de différents programmes afin d'obtenir un résultat.</p>\n<h2>Les redirections de base</h2>\n<p>Commençons par quelques redirections de base, celles qu'il faut connaître et qui\nsont employées systématiquement.</p>\n<p>Pour nous exercer, nous allons utiliser principalement deux commandes :</p>\n<ul>\n<li><code>echo</code> : permet d'écrire un message spécifié en tant qu'argument sur sa sortie\nstandard.</li>\n<li><code>cat</code> : permet d'afficher le contenu d'un fichier passé en argument sur sa\nsortie standard ou de répéter son entrée standard sur sa sortie standard.</li>\n</ul>\n<p>Rappelez vous que par défaut, la sortie standard est affichée dans le terminal\net l'entrée standard est le clavier de l'utilisateur.</p>\n<h3>Redirection de sortie : <code>&gt;</code></h3>\n<p>Ce type de redirection permet d'indiquer à un processus que tout ce qui devrait\naller sur la sortie standard (par défaut, le terminal), doit plutôt être stocké\ndans un fichier.</p>\n<p>Pour ça, on utilise la syntaxe <code>&gt; [fichier]</code> :</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Hello&quot;</span> &gt; message</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> cat message</span>\nHello\n</code></pre>\n<h3>Redirection d'entrée : <code>&lt;</code></h3>\n<p>À l'inverse, on peut aussi spécifier à un programme qu'il doit utiliser un\nfichier comme son entrée standard, à la place du clavier de l'utilisateur.</p>\n<p>En réutilisant notre fichier <code>message</code>, on peut par exemple faire :</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> cat &lt; message</span>\nHello\n</code></pre>\n<p>Notez qu'on utilise bien <code>cat</code> <em>sans argument</em>, il utilise donc l'entrée\nstandard.</p>\n<h3>Connecter deux processus : <code>|</code></h3>\n<p>Dernier des connecteurs de base, l'opérateur <code>|</code>, aussi appelé <em>pipe</em> (et qui se\nprononce <em>paillepe</em>, avé l'accent).</p>\n<p>Il permet tout simplement d'utiliser la sortie d'un programme comme entrée d'un\nautre.</p>\n<p>Pour montrer ça, introduisons la commande <code>tr</code>, qui permet de remplacer des\ncaractères dans l'entrée par d'autres.</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Hello!&quot;</span> | tr <span class=\"hljs-string\">&quot;[:lower:]&quot;</span> <span class=\"hljs-string\">&quot;[:upper:]&quot;</span></span>\nHELLO!\n</code></pre>\n<h2>Descripteurs de fichiers et redirections avancées</h2>\n<p>Pour aller plus loin, on va maintenant voir que chaque descripteur de fichier\npossède son propre identifiant numérique.</p>\n<p>Pour <code>stdin</code>, <code>stdout</code> et <code>stderr</code> ce sera respectivement 0, 1 et 2.</p>\n<p>On peut se servir de ces identifiants pour faire des redirections plus poussées\n!</p>\n<h3>Rediriger les autres descripteur</h3>\n<p>Par défaut, <code>&gt;</code> ne redirige que la sortie standard vers un fichier. Pour\nrediriger un autre descripteur vers un fichier on emploiera la notation <code>X&gt;</code> où\n<em>X</em> prendra la valeur de l'identifiant du descripteur.</p>\n<p>Si vous avez bien suivi, on redirigera donc la sortie d'erreur vers un fichier à\nl'aide de la syntaxe <code>2&gt;</code>.</p>\n<h3>Rediriger vers un autre descripteur : <code>&gt;&amp;</code></h3>\n<p>On peut connecter les descripteurs d'un processus entre eux. C'est un mécanisme\nque l'on utilise très souvent quand on écrit des scripts Shell, notamment pour\nécrire sur la sortie d'erreur.</p>\n<p>Pour celà, on utilise la redirection <code>X&gt;&amp;Y</code> avec <em>X</em> étant l'identifiant\ndescripteur source et <em>Y</em> l'identifiant du descripteur sur lequel on veut\nrediriger.</p>\n<p>L'exemple suivant montre comment rediriger la sortie standard sur la sortie\nd'erreur (c'est comme ça qu'on écrit sur la sortie d'erreur dans un script).</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Error&quot;</span> 1&gt;&amp;2</span>\n</code></pre>\n<p>Plus généralement, on peut omettre la partie avant le <code>&gt;&amp;</code>, elle prendra la\nvaleur 1 par défaut. On aura donc le script suivant :</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Error&quot;</span> &gt;&amp;2</span>\n</code></pre>\n<h3>Ajouter en fin de fichier : <code>&gt;&gt;</code></h3>\n<p>Par défaut, <code>&gt;</code> écrase le fichier dans lequel la redirection va s'effectuer.\nPour éviter ce problème, on peut utiliser à la place <code>&gt;&gt;</code> qui va ajouter en fin\nde fichier.</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> Sans &gt;&gt;</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;1&quot;</span> &gt; file</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;2&quot;</span> &gt; file</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> cat file</span>\n2\n</code></pre>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> Avec &gt;&gt;</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;1&quot;</span> &gt; file</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;2&quot;</span> &gt;&gt; file</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> cat file</span>\n1\n2\n</code></pre>\n<h3><code>/dev/null</code>, le trou noir</h3>\n<p>Il existe un fichier un peu particulier sur tout bon UNIX qui se respecte :\n<code>/dev/null</code>.</p>\n<p>Ce dernier est en fait une sorte de trou noir : Si on affiche son contenu on\nn'obtient rien, et si on écrit quelque chose dedans elle disparait.</p>\n<p>On se sert souvent de ce fichier pour supprimer la sortie d'un programme :</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Hello&quot;</span> &gt;/dev/null</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> cat /dev/null</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\">\n</span></code></pre>\n<h3>Ordre des redirections</h3>\n<p>Un dernier mot avant la fin, l'ordre des redirections est très important !</p>\n<p>Imaginez la fonction suivante qui affiche un message sur la sortie standard et\nun sur la sortie d'erreur :</p>\n<pre><code class=\"hljs language-console\">function programme() {\n  echo &quot;Message&quot;\n  echo &quot;Error&quot; &gt;&amp;2\n}\n</code></pre>\n<p>Si on veut rediriger toutes les sorties vers <code>/dev/null</code> on peut utiliser la\nsyntaxe suivante :</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> programme 2&gt;/dev/null &gt;/dev/null</span>\n</code></pre>\n<p>Vous remarquerez que c'est assez verbeux, et qu'on pourrait simplifier celà en\nutilisant <code>&gt;&amp;</code> comme vu précédemment.</p>\n<p>On essaie donc naïvement :</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> programme 2&gt;&amp;1 &gt;/dev/null</span>\nError\n</code></pre>\n<p>Hmm, pourtant on a tout branché ensemble non ? En fait non, on a redirigé la\nsortie sur le fichier pointé par <code>1</code> au moment où on écrit la redirection, donc\navant qu'il soit redirigé sur <code>/dev/null</code>.</p>\n<p>Pour bien faire, il faut écrire les redirections dans l'autre ordre :</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> programme &gt;/dev/null 2&gt;&amp;1</span>\n</code></pre>\n<p>On lira ceci : Rediriger la sortie standard vers <code>/dev/null</code>, puis rediriger la\nsortie d'erreur vers la sortie standard.</p>\n<h3>Pour résumer</h3>\n<p>On a en fait que deux redirections de sortie, <code>&gt;</code> et <code>&gt;&gt;</code>, les symboles qui les\nentourent sont souvent optionnels.</p>\n<p>Si on veut spécifier un fichier on donnera son nom, si on veut spécifier un\ndescripteur on donnera son identifiant préfixé de <code>&amp;</code>.</p>\n<h2>Pour aller plus loin</h2>\n<p>Le manuel de bash contient <a href=\"http://www.gnu.org/software/bash/manual/bashref.html#Redirections\">une section complète sur les\nredirections</a>. Elle va beaucoup plus loin que cet article et je vous\ninvite à la lire pour voir tout ce qu'il est possible de faire.</p>\n<p>Il y a aussi une section dédiée à ce sujet dans l'<a href=\"http://tldp.org/LDP/abs/html/io-redirection.html\">Advanced Bash-Scripting\nGuide</a>.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>