<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Utiliser ReasonML avec JavaScript | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Utiliser ReasonML avec JavaScript | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Utiliser ReasonML avec JavaScript | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par bloodyowl" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/utiliser-reasonml-avec-javascript" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(2, 100%, 35%), hsl(2, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Utiliser ReasonML avec JavaScript</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/bloodyowl"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="bloodyowl" src="https://avatars.githubusercontent.com/bloodyowl?size=64"/><div>bloodyowl<!-- --> <!-- -->•<!-- --> <!-- -->2017/10/10</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Dans un <a href="/fr/articles/reason/introduction-reason/">précédent article</a>, on vous
présentait une nouvelle syntaxe pour OCaml:
<a href="https://reasonml.github.io">ReasonML</a>, elle rend le langage plus accessible en
le rapprochant de JavaScript moderne.</p>
<p>À l'aide du projet
<a href="https://bucklescript.github.io/bucklescript/Manual.html">BuckleScript</a> qui
supporte Reason nativement, on peut compiler notre code Reason vers JavaScript
très facilement. Le créateur de BuckleScript utilisait à l'origine un autre
projet appelé <a href="http://ocsigen.org/js_of_ocaml/">js_of_ocaml</a>. Trouvant qu'il
serait possible d'optimiser et de rendre plus lisible le code JavaScript en
sortie si le compiler commençait son travail à une étape plus haut niveau (une
représentation du programme contenant des informations supplémentaires, alors
que js_of_ocaml utilise du bytecode), il propose ce changement à la team
js_of_ocaml qui refuse, et décide donc de se lancer dans le projet qui deviendra
BuckleScript.</p>
<p>Pour démarrer un projet avec BuckleScript et Reason, on ouvre son terminal, et
c'est parti:</p>
<p>On installe BuckleScript:</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> npm install -g bs-platform</span>
</code></pre>
<p>On initialise le projet:</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> bsb -init my-app -theme basic-reason</span>
</code></pre>
<p>Hop, votre projet est prêt dans <code>my-app</code>.</p>
<p>Maintenant la question est: comment est-ce que je peux utiliser du JS dans
Reason et vice-versa ?</p>
<h2>Les FFI (ou Foreign Function Interface)</h2>
<p>OCaml gère naturellement les <code>FFI</code>, notamment pour appeler des fonctions <code>C</code>
lorsqu'il compile vers du code natif.</p>
<p>BuckleScript vient les overloader pour les adapter à JavaScript.</p>
<p>Créons une FFI pour la fonction <code>alert</code> :</p>
<pre><code class="hljs language-reason"><span class="hljs-attribute">[@bs.val]</span> <span class="hljs-keyword">external</span> alert : string =&gt; unit = <span class="hljs-string">&quot;&quot;</span>;
</code></pre>
<p>On définit:</p>
<ul>
<li>une fonction externe nommée <code>alert</code></li>
<li>qui prend une <code>string</code> et ne retourne <em>rien</em> (ici représenté par la valeur
<code>unit</code>)</li>
<li>qui est une valeur à simplement récupérer (<code>[@bs.val]</code>)</li>
</ul>
<p>Si on regarde le code JavaScript en sortie, c'est vide. En effet, <code>external</code> est
un moyen de définir comment accéder à une valeur ainsi que son type. Si en
revanche on utilise la function <code>alert</code> dans le module:</p>
<pre><code class="hljs language-reason"><span class="hljs-attribute">[@bs.val]</span> <span class="hljs-keyword">external</span> alert : string =&gt; unit = <span class="hljs-string">&quot;&quot;</span>;

alert(<span class="hljs-string">&quot;Hello!&quot;</span>);
</code></pre>
<p>On voit dans l'output que BuckleScript a <em>inliné</em> l'appel de <code>alert</code>, il n'a pas
crée de représentation intermédiaire.</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">&quot;use strict&quot;</span>;

alert(<span class="hljs-string">&quot;Hello!&quot;</span>);

<span class="hljs-comment">/*  Not a pure module */</span>
</code></pre>
<p>Maintenant amusons nous à créer des bindings pour jQuery, juste pour le fun:</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* On crée un type opaque pour représenter un objet jQuery */</span>
<span class="hljs-keyword">type</span> jQuery;

<span class="hljs-comment">/* On type le module jQuery */</span>
<span class="hljs-attribute">[@bs.module]</span> <span class="hljs-keyword">external</span> jQuery : string =&gt; jQuery = <span class="hljs-string">&quot;jquery&quot;</span>;

<span class="hljs-comment">/* On type la méthod `on`, BuckleScript peut naturellement typer
  le pattern de chaining, assez commun en JS, à l&#x27;aide de l&#x27;annotation
  `bs.send.pipe: type` */</span>
<span class="hljs-attribute">[@bs.send.pipe: jQuery]</span> <span class="hljs-keyword">external</span> on : string =&gt; (<span class="hljs-module-identifier">Dom</span>.event =&gt; unit) =&gt; jQuery = <span class="hljs-string">&quot;&quot;</span>;

jQuery(<span class="hljs-string">&quot;.selector&quot;</span>)
  <span class="hljs-operator">|&gt;</span> on(<span class="hljs-string">&quot;click&quot;</span>, (_) =&gt; alert(<span class="hljs-string">&quot;hey&quot;</span>));
</code></pre>
<p>Ce qui va nous sortir:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-keyword">var</span> JQuery = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;jquery&quot;</span>);

JQuery(<span class="hljs-string">&quot;.selector&quot;</span>).on(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  alert(<span class="hljs-string">&quot;hey&quot;</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-comment">/* () */</span> <span class="hljs-number">0</span>;
});

<span class="hljs-comment">/*  Not a pure module */</span>
</code></pre>
<p>Comme on peut le constater, le code de sortie ressemble beaucoup à ce qu'on
pourrait écrire à la main.</p>
<p>Pour en savoir un peu plus sur les FFI JavaScript:</p>
<ul>
<li><a href="https://bucklescript.github.io/bucklescript/Manual.html">La documentation de BuckleScript</a></li>
<li><a href="https://github.com/reasonml-community">Les projets de bindings crées par la communauté</a>
(ceux nommés <code>bs-{nom-de-lib-js}</code>)</li>
</ul>
<h2>Les objets</h2>
<p>On peut directement utiliser des objets JavaScript en Reason. Pour accéder à une
propriété, on utilise <code>##</code>.</p>
<pre><code class="hljs language-reason">myJsObject##property
</code></pre>
<p>Ça dépanne, mais au sein de notre code Reason, on préférera bien souvent
utiliser des records: ils ont une représentation plus légère et sont par défaut
immutables. Pour effectuer une conversion, on procède de la manière suivante:</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">type</span> jsUser = {
  .
  <span class="hljs-string">&quot;id&quot;</span>: string,
  <span class="hljs-string">&quot;username&quot;</span>: string,
  <span class="hljs-comment">/* valeur pouvant être null, undefined, ou la valeur */</span>
  <span class="hljs-string">&quot;birthdate&quot;</span>: <span class="hljs-module-identifier">Js</span>.<span class="hljs-module-identifier">Null_undefined</span>.t(string),
  <span class="hljs-comment">/* &quot;light&quot; ou &quot;dark&quot;, les enums sont souvent représentés par des strings en JS */</span>
  <span class="hljs-string">&quot;theme&quot;</span>: string
};

<span class="hljs-comment">/* En Reason, les enums sont représentés par des variants */</span>
<span class="hljs-keyword">type</span> theme =
  | <span class="hljs-constructor">Light</span>
  | <span class="hljs-constructor">Dark</span>;

<span class="hljs-keyword">type</span> user = {
  id: string,
  username: string,
  <span class="hljs-comment">/* pas de null ou undefined, on utilise un type option */</span>
  birthdate: option(string),
  theme
};

<span class="hljs-comment">/* une fonction de transformation JS -&gt; Reason */</span>
<span class="hljs-keyword">let</span> fromJs = (jsUser) =&gt; {
  id: jsUser##id,
  username: jsUser##username,
  <span class="hljs-comment">/* BuckleScript propose des helpers pour les conversions */</span>
  birthdate: <span class="hljs-module-identifier">Js</span>.<span class="hljs-module-identifier">Null_undefined</span>.to_opt(jsUser##birthdate),
  theme:
    <span class="hljs-keyword">switch</span> jsUser##theme {
    | <span class="hljs-string">&quot;dark&quot;</span> =&gt; <span class="hljs-constructor">Dark</span>
    | <span class="hljs-string">&quot;light&quot;</span>
    <span class="hljs-comment">/* On match une chaîne de caractère, le match n&#x27;est pas exhaustif,
         on doit donc définir la valeur de fallback (par defaut) à l&#x27;aide
         de `_`
       */</span>
    | _ =&gt; <span class="hljs-constructor">Light</span>
    }
};

<span class="hljs-comment">/* Pour créer un objet JS en Reason, il suffit de l&#x27;écrire comme un
     record, mais avec des clés entre quotes, comme du JSON.
   */</span>
<span class="hljs-keyword">let</span> toJs = (user) =&gt; {
  <span class="hljs-string">&quot;id&quot;</span>: user.id,
  <span class="hljs-string">&quot;username&quot;</span>: user.username,
  <span class="hljs-string">&quot;birthdate&quot;</span>: <span class="hljs-module-identifier">Js</span>.<span class="hljs-module-identifier">Null_undefined</span>.from_opt(user.birthdate),
  <span class="hljs-string">&quot;theme&quot;</span>:
    <span class="hljs-keyword">switch</span> user.theme {
    | <span class="hljs-constructor">Light</span> =&gt; <span class="hljs-string">&quot;light&quot;</span>
    | <span class="hljs-constructor">Dark</span> =&gt; <span class="hljs-string">&quot;dark&quot;</span>
    }
};
</code></pre>
<p>Le code en sortie:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-keyword">var</span> Js_primitive = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;bs-platform/lib/js/js_primitive.js&quot;</span>);
<span class="hljs-keyword">var</span> Js_null_undefined = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;bs-platform/lib/js/js_null_undefined.js&quot;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromJs</span>(<span class="hljs-params">jsUser</span>) </span>{
  <span class="hljs-keyword">var</span> match = jsUser.theme;
  <span class="hljs-keyword">var</span> tmp;
  <span class="hljs-keyword">switch</span> (match) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;dark&quot;</span>:
      tmp = <span class="hljs-comment">/* Dark */</span> <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;light&quot;</span>:
      tmp = <span class="hljs-comment">/* Light */</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      tmp = <span class="hljs-comment">/* Light */</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-comment">/* record */</span> [
    <span class="hljs-comment">/* id */</span> jsUser.id,
    <span class="hljs-comment">/* username */</span> jsUser.username,
    <span class="hljs-comment">/* birthdate */</span> Js_primitive.null_undefined_to_opt(jsUser.birthdate),
    <span class="hljs-comment">/* theme */</span> tmp,
  ];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toJs</span>(<span class="hljs-params">user</span>) </span>{
  <span class="hljs-keyword">var</span> match = user[<span class="hljs-comment">/* theme */</span> <span class="hljs-number">3</span>];
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">id</span>: user[<span class="hljs-comment">/* id */</span> <span class="hljs-number">0</span>],
    <span class="hljs-attr">username</span>: user[<span class="hljs-comment">/* username */</span> <span class="hljs-number">1</span>],
    <span class="hljs-attr">birthdate</span>: Js_null_undefined.from_opt(user[<span class="hljs-comment">/* birthdate */</span> <span class="hljs-number">2</span>]),
    <span class="hljs-attr">theme</span>: match !== <span class="hljs-number">0</span> ? <span class="hljs-string">&quot;dark&quot;</span> : <span class="hljs-string">&quot;light&quot;</span>,
  };
}

<span class="hljs-built_in">exports</span>.fromJs = fromJs;
<span class="hljs-built_in">exports</span>.toJs = toJs;
<span class="hljs-comment">/* No side effect */</span>
</code></pre>
<h2>Les standard-libs</h2>
<p>Si le besoin s'en fait sentir, BuckleScript propose naturellement la stdlib de
JavaScript.</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">let</span> myArray = <span class="hljs-literal">[|</span><span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span><span class="hljs-literal">|]</span>;

myArray
  <span class="hljs-operator">|&gt;</span> <span class="hljs-module-identifier">Js</span>.<span class="hljs-module-identifier">Array</span>.map((item) =&gt; item <span class="hljs-operator">*</span> <span class="hljs-number">2</span>)
  <span class="hljs-operator">|&gt;</span> <span class="hljs-module-identifier">Js</span>.<span class="hljs-module-identifier">Array</span>.reduce((acc, item) =&gt; acc <span class="hljs-operator">+</span> item, <span class="hljs-number">0</span>);
</code></pre>
<p>vous sortira:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-keyword">var</span> myArray = <span class="hljs-comment">/* array */</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

myArray
  .map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
    <span class="hljs-keyword">return</span> item &lt;&lt; <span class="hljs-number">1</span>;
  })
  .reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">acc, item</span>) </span>{
    <span class="hljs-keyword">return</span> (acc + item) | <span class="hljs-number">0</span>;
  }, <span class="hljs-number">0</span>);

<span class="hljs-built_in">exports</span>.myArray = myArray;
<span class="hljs-comment">/*  Not a pure module */</span>
</code></pre>
<h2>La technique bourrin</h2>
<p>Pour les cas extrêmes ou vous voulez juste balancer une fonction JS, vous
pouvez:</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* %bs.raw pour une expression, %%bs.raw pour un bloc de code arbitraire */</span>
<span class="hljs-keyword">let</span> log: string =&gt; unit = <span class="hljs-attribute">[%bs.raw {|
  function (a) {
    console.log(a);
  }
|}]</span>;

log(<span class="hljs-string">&quot;ok&quot;</span>);
</code></pre>
<p>qui vous sort un joli:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-keyword">var</span> Curry = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;bs-platform/lib/js/curry.js&quot;</span>);

<span class="hljs-keyword">var</span> log = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>) </span>{
  <span class="hljs-built_in">console</span>.log(a);
};

Curry._1(log, <span class="hljs-string">&quot;ok&quot;</span>);

<span class="hljs-built_in">exports</span>.log = log;
<span class="hljs-comment">/* log Not a pure module */</span>
</code></pre>
<h2>Conclusion</h2>
<p>OCaml peut en grande majorité être compilé en JavaScript très simple, parce
qu'il partage beaucoup de concepts avec ce dernier. Il est assez simple de créer
des ponts entre les deux langages à l'aide des FFI. L'énorme avantage de cette
feature, c'est que l'on peut commencer à utiliser Reason incrémentalement sur
son projet sans avoir à tout réécrire d'un coup.</p>
<p>Bisous bisous.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Utiliser%20ReasonML%20avec%20JavaScript%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Futiliser-reasonml-avec-javascript" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"utiliser-reasonml-avec-javascript","v":{"_0":{"TAG":0,"_0":{"slug":"utiliser-reasonml-avec-javascript","filename":"2017-10-10-utiliser-reasonml-avec-javascript","title":"Utiliser ReasonML avec JavaScript","date":"Tue, 10 Oct 2017 00:00:00 GMT","draft":false,"meta":{"date":"2017-10-10T00:00:00.000Z","title":"Utiliser ReasonML avec JavaScript","author":"bloodyowl","oldSlug":"reason/interop","slug":"utiliser-reasonml-avec-javascript"},"body":"<p>Dans un <a href=\"/fr/articles/reason/introduction-reason/\">précédent article</a>, on vous\nprésentait une nouvelle syntaxe pour OCaml:\n<a href=\"https://reasonml.github.io\">ReasonML</a>, elle rend le langage plus accessible en\nle rapprochant de JavaScript moderne.</p>\n<p>À l'aide du projet\n<a href=\"https://bucklescript.github.io/bucklescript/Manual.html\">BuckleScript</a> qui\nsupporte Reason nativement, on peut compiler notre code Reason vers JavaScript\ntrès facilement. Le créateur de BuckleScript utilisait à l'origine un autre\nprojet appelé <a href=\"http://ocsigen.org/js_of_ocaml/\">js_of_ocaml</a>. Trouvant qu'il\nserait possible d'optimiser et de rendre plus lisible le code JavaScript en\nsortie si le compiler commençait son travail à une étape plus haut niveau (une\nreprésentation du programme contenant des informations supplémentaires, alors\nque js_of_ocaml utilise du bytecode), il propose ce changement à la team\njs_of_ocaml qui refuse, et décide donc de se lancer dans le projet qui deviendra\nBuckleScript.</p>\n<p>Pour démarrer un projet avec BuckleScript et Reason, on ouvre son terminal, et\nc'est parti:</p>\n<p>On installe BuckleScript:</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> npm install -g bs-platform</span>\n</code></pre>\n<p>On initialise le projet:</p>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> bsb -init my-app -theme basic-reason</span>\n</code></pre>\n<p>Hop, votre projet est prêt dans <code>my-app</code>.</p>\n<p>Maintenant la question est: comment est-ce que je peux utiliser du JS dans\nReason et vice-versa ?</p>\n<h2>Les FFI (ou Foreign Function Interface)</h2>\n<p>OCaml gère naturellement les <code>FFI</code>, notamment pour appeler des fonctions <code>C</code>\nlorsqu'il compile vers du code natif.</p>\n<p>BuckleScript vient les overloader pour les adapter à JavaScript.</p>\n<p>Créons une FFI pour la fonction <code>alert</code> :</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-attribute\">[@bs.val]</span> <span class=\"hljs-keyword\">external</span> alert : string =&gt; unit = <span class=\"hljs-string\">&quot;&quot;</span>;\n</code></pre>\n<p>On définit:</p>\n<ul>\n<li>une fonction externe nommée <code>alert</code></li>\n<li>qui prend une <code>string</code> et ne retourne <em>rien</em> (ici représenté par la valeur\n<code>unit</code>)</li>\n<li>qui est une valeur à simplement récupérer (<code>[@bs.val]</code>)</li>\n</ul>\n<p>Si on regarde le code JavaScript en sortie, c'est vide. En effet, <code>external</code> est\nun moyen de définir comment accéder à une valeur ainsi que son type. Si en\nrevanche on utilise la function <code>alert</code> dans le module:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-attribute\">[@bs.val]</span> <span class=\"hljs-keyword\">external</span> alert : string =&gt; unit = <span class=\"hljs-string\">&quot;&quot;</span>;\n\nalert(<span class=\"hljs-string\">&quot;Hello!&quot;</span>);\n</code></pre>\n<p>On voit dans l'output que BuckleScript a <em>inliné</em> l'appel de <code>alert</code>, il n'a pas\ncrée de représentation intermédiaire.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>\n<span class=\"hljs-meta\">&quot;use strict&quot;</span>;\n\nalert(<span class=\"hljs-string\">&quot;Hello!&quot;</span>);\n\n<span class=\"hljs-comment\">/*  Not a pure module */</span>\n</code></pre>\n<p>Maintenant amusons nous à créer des bindings pour jQuery, juste pour le fun:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-comment\">/* On crée un type opaque pour représenter un objet jQuery */</span>\n<span class=\"hljs-keyword\">type</span> jQuery;\n\n<span class=\"hljs-comment\">/* On type le module jQuery */</span>\n<span class=\"hljs-attribute\">[@bs.module]</span> <span class=\"hljs-keyword\">external</span> jQuery : string =&gt; jQuery = <span class=\"hljs-string\">&quot;jquery&quot;</span>;\n\n<span class=\"hljs-comment\">/* On type la méthod `on`, BuckleScript peut naturellement typer\n  le pattern de chaining, assez commun en JS, à l&#x27;aide de l&#x27;annotation\n  `bs.send.pipe: type` */</span>\n<span class=\"hljs-attribute\">[@bs.send.pipe: jQuery]</span> <span class=\"hljs-keyword\">external</span> on : string =&gt; (<span class=\"hljs-module-identifier\">Dom</span>.event =&gt; unit) =&gt; jQuery = <span class=\"hljs-string\">&quot;&quot;</span>;\n\njQuery(<span class=\"hljs-string\">&quot;.selector&quot;</span>)\n  <span class=\"hljs-operator\">|&gt;</span> on(<span class=\"hljs-string\">&quot;click&quot;</span>, (_) =&gt; alert(<span class=\"hljs-string\">&quot;hey&quot;</span>));\n</code></pre>\n<p>Ce qui va nous sortir:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>\n<span class=\"hljs-meta\">&quot;use strict&quot;</span>;\n\n<span class=\"hljs-keyword\">var</span> JQuery = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;jquery&quot;</span>);\n\nJQuery(<span class=\"hljs-string\">&quot;.selector&quot;</span>).on(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  alert(<span class=\"hljs-string\">&quot;hey&quot;</span>);\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-comment\">/* () */</span> <span class=\"hljs-number\">0</span>;\n});\n\n<span class=\"hljs-comment\">/*  Not a pure module */</span>\n</code></pre>\n<p>Comme on peut le constater, le code de sortie ressemble beaucoup à ce qu'on\npourrait écrire à la main.</p>\n<p>Pour en savoir un peu plus sur les FFI JavaScript:</p>\n<ul>\n<li><a href=\"https://bucklescript.github.io/bucklescript/Manual.html\">La documentation de BuckleScript</a></li>\n<li><a href=\"https://github.com/reasonml-community\">Les projets de bindings crées par la communauté</a>\n(ceux nommés <code>bs-{nom-de-lib-js}</code>)</li>\n</ul>\n<h2>Les objets</h2>\n<p>On peut directement utiliser des objets JavaScript en Reason. Pour accéder à une\npropriété, on utilise <code>##</code>.</p>\n<pre><code class=\"hljs language-reason\">myJsObject##property\n</code></pre>\n<p>Ça dépanne, mais au sein de notre code Reason, on préférera bien souvent\nutiliser des records: ils ont une représentation plus légère et sont par défaut\nimmutables. Pour effectuer une conversion, on procède de la manière suivante:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">type</span> jsUser = {\n  .\n  <span class=\"hljs-string\">&quot;id&quot;</span>: string,\n  <span class=\"hljs-string\">&quot;username&quot;</span>: string,\n  <span class=\"hljs-comment\">/* valeur pouvant être null, undefined, ou la valeur */</span>\n  <span class=\"hljs-string\">&quot;birthdate&quot;</span>: <span class=\"hljs-module-identifier\">Js</span>.<span class=\"hljs-module-identifier\">Null_undefined</span>.t(string),\n  <span class=\"hljs-comment\">/* &quot;light&quot; ou &quot;dark&quot;, les enums sont souvent représentés par des strings en JS */</span>\n  <span class=\"hljs-string\">&quot;theme&quot;</span>: string\n};\n\n<span class=\"hljs-comment\">/* En Reason, les enums sont représentés par des variants */</span>\n<span class=\"hljs-keyword\">type</span> theme =\n  | <span class=\"hljs-constructor\">Light</span>\n  | <span class=\"hljs-constructor\">Dark</span>;\n\n<span class=\"hljs-keyword\">type</span> user = {\n  id: string,\n  username: string,\n  <span class=\"hljs-comment\">/* pas de null ou undefined, on utilise un type option */</span>\n  birthdate: option(string),\n  theme\n};\n\n<span class=\"hljs-comment\">/* une fonction de transformation JS -&gt; Reason */</span>\n<span class=\"hljs-keyword\">let</span> fromJs = (jsUser) =&gt; {\n  id: jsUser##id,\n  username: jsUser##username,\n  <span class=\"hljs-comment\">/* BuckleScript propose des helpers pour les conversions */</span>\n  birthdate: <span class=\"hljs-module-identifier\">Js</span>.<span class=\"hljs-module-identifier\">Null_undefined</span>.to_opt(jsUser##birthdate),\n  theme:\n    <span class=\"hljs-keyword\">switch</span> jsUser##theme {\n    | <span class=\"hljs-string\">&quot;dark&quot;</span> =&gt; <span class=\"hljs-constructor\">Dark</span>\n    | <span class=\"hljs-string\">&quot;light&quot;</span>\n    <span class=\"hljs-comment\">/* On match une chaîne de caractère, le match n&#x27;est pas exhaustif,\n         on doit donc définir la valeur de fallback (par defaut) à l&#x27;aide\n         de `_`\n       */</span>\n    | _ =&gt; <span class=\"hljs-constructor\">Light</span>\n    }\n};\n\n<span class=\"hljs-comment\">/* Pour créer un objet JS en Reason, il suffit de l&#x27;écrire comme un\n     record, mais avec des clés entre quotes, comme du JSON.\n   */</span>\n<span class=\"hljs-keyword\">let</span> toJs = (user) =&gt; {\n  <span class=\"hljs-string\">&quot;id&quot;</span>: user.id,\n  <span class=\"hljs-string\">&quot;username&quot;</span>: user.username,\n  <span class=\"hljs-string\">&quot;birthdate&quot;</span>: <span class=\"hljs-module-identifier\">Js</span>.<span class=\"hljs-module-identifier\">Null_undefined</span>.from_opt(user.birthdate),\n  <span class=\"hljs-string\">&quot;theme&quot;</span>:\n    <span class=\"hljs-keyword\">switch</span> user.theme {\n    | <span class=\"hljs-constructor\">Light</span> =&gt; <span class=\"hljs-string\">&quot;light&quot;</span>\n    | <span class=\"hljs-constructor\">Dark</span> =&gt; <span class=\"hljs-string\">&quot;dark&quot;</span>\n    }\n};\n</code></pre>\n<p>Le code en sortie:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>\n<span class=\"hljs-meta\">&quot;use strict&quot;</span>;\n\n<span class=\"hljs-keyword\">var</span> Js_primitive = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;bs-platform/lib/js/js_primitive.js&quot;</span>);\n<span class=\"hljs-keyword\">var</span> Js_null_undefined = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;bs-platform/lib/js/js_null_undefined.js&quot;</span>);\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">fromJs</span>(<span class=\"hljs-params\">jsUser</span>) </span>{\n  <span class=\"hljs-keyword\">var</span> match = jsUser.theme;\n  <span class=\"hljs-keyword\">var</span> tmp;\n  <span class=\"hljs-keyword\">switch</span> (match) {\n    <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;dark&quot;</span>:\n      tmp = <span class=\"hljs-comment\">/* Dark */</span> <span class=\"hljs-number\">1</span>;\n      <span class=\"hljs-keyword\">break</span>;\n    <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;light&quot;</span>:\n      tmp = <span class=\"hljs-comment\">/* Light */</span> <span class=\"hljs-number\">0</span>;\n      <span class=\"hljs-keyword\">break</span>;\n    <span class=\"hljs-keyword\">default</span>:\n      tmp = <span class=\"hljs-comment\">/* Light */</span> <span class=\"hljs-number\">0</span>;\n  }\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-comment\">/* record */</span> [\n    <span class=\"hljs-comment\">/* id */</span> jsUser.id,\n    <span class=\"hljs-comment\">/* username */</span> jsUser.username,\n    <span class=\"hljs-comment\">/* birthdate */</span> Js_primitive.null_undefined_to_opt(jsUser.birthdate),\n    <span class=\"hljs-comment\">/* theme */</span> tmp,\n  ];\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">toJs</span>(<span class=\"hljs-params\">user</span>) </span>{\n  <span class=\"hljs-keyword\">var</span> match = user[<span class=\"hljs-comment\">/* theme */</span> <span class=\"hljs-number\">3</span>];\n  <span class=\"hljs-keyword\">return</span> {\n    <span class=\"hljs-attr\">id</span>: user[<span class=\"hljs-comment\">/* id */</span> <span class=\"hljs-number\">0</span>],\n    <span class=\"hljs-attr\">username</span>: user[<span class=\"hljs-comment\">/* username */</span> <span class=\"hljs-number\">1</span>],\n    <span class=\"hljs-attr\">birthdate</span>: Js_null_undefined.from_opt(user[<span class=\"hljs-comment\">/* birthdate */</span> <span class=\"hljs-number\">2</span>]),\n    <span class=\"hljs-attr\">theme</span>: match !== <span class=\"hljs-number\">0</span> ? <span class=\"hljs-string\">&quot;dark&quot;</span> : <span class=\"hljs-string\">&quot;light&quot;</span>,\n  };\n}\n\n<span class=\"hljs-built_in\">exports</span>.fromJs = fromJs;\n<span class=\"hljs-built_in\">exports</span>.toJs = toJs;\n<span class=\"hljs-comment\">/* No side effect */</span>\n</code></pre>\n<h2>Les standard-libs</h2>\n<p>Si le besoin s'en fait sentir, BuckleScript propose naturellement la stdlib de\nJavaScript.</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-keyword\">let</span> myArray = <span class=\"hljs-literal\">[|</span><span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span><span class=\"hljs-literal\">|]</span>;\n\nmyArray\n  <span class=\"hljs-operator\">|&gt;</span> <span class=\"hljs-module-identifier\">Js</span>.<span class=\"hljs-module-identifier\">Array</span>.map((item) =&gt; item <span class=\"hljs-operator\">*</span> <span class=\"hljs-number\">2</span>)\n  <span class=\"hljs-operator\">|&gt;</span> <span class=\"hljs-module-identifier\">Js</span>.<span class=\"hljs-module-identifier\">Array</span>.reduce((acc, item) =&gt; acc <span class=\"hljs-operator\">+</span> item, <span class=\"hljs-number\">0</span>);\n</code></pre>\n<p>vous sortira:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>\n<span class=\"hljs-meta\">&quot;use strict&quot;</span>;\n\n<span class=\"hljs-keyword\">var</span> myArray = <span class=\"hljs-comment\">/* array */</span> [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>];\n\nmyArray\n  .map(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">item</span>) </span>{\n    <span class=\"hljs-keyword\">return</span> item &lt;&lt; <span class=\"hljs-number\">1</span>;\n  })\n  .reduce(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">acc, item</span>) </span>{\n    <span class=\"hljs-keyword\">return</span> (acc + item) | <span class=\"hljs-number\">0</span>;\n  }, <span class=\"hljs-number\">0</span>);\n\n<span class=\"hljs-built_in\">exports</span>.myArray = myArray;\n<span class=\"hljs-comment\">/*  Not a pure module */</span>\n</code></pre>\n<h2>La technique bourrin</h2>\n<p>Pour les cas extrêmes ou vous voulez juste balancer une fonction JS, vous\npouvez:</p>\n<pre><code class=\"hljs language-reason\"><span class=\"hljs-comment\">/* %bs.raw pour une expression, %%bs.raw pour un bloc de code arbitraire */</span>\n<span class=\"hljs-keyword\">let</span> log: string =&gt; unit = <span class=\"hljs-attribute\">[%bs.raw {|\n  function (a) {\n    console.log(a);\n  }\n|}]</span>;\n\nlog(<span class=\"hljs-string\">&quot;ok&quot;</span>);\n</code></pre>\n<p>qui vous sort un joli:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>\n<span class=\"hljs-meta\">&quot;use strict&quot;</span>;\n\n<span class=\"hljs-keyword\">var</span> Curry = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;bs-platform/lib/js/curry.js&quot;</span>);\n\n<span class=\"hljs-keyword\">var</span> log = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">a</span>) </span>{\n  <span class=\"hljs-built_in\">console</span>.log(a);\n};\n\nCurry._1(log, <span class=\"hljs-string\">&quot;ok&quot;</span>);\n\n<span class=\"hljs-built_in\">exports</span>.log = log;\n<span class=\"hljs-comment\">/* log Not a pure module */</span>\n</code></pre>\n<h2>Conclusion</h2>\n<p>OCaml peut en grande majorité être compilé en JavaScript très simple, parce\nqu'il partage beaucoup de concepts avec ce dernier. Il est assez simple de créer\ndes ponts entre les deux langages à l'aide des FFI. L'énorme avantage de cette\nfeature, c'est que l'on peut commencer à utiliser Reason incrémentalement sur\nson projet sans avoir à tout réécrire d'un coup.</p>\n<p>Bisous bisous.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>