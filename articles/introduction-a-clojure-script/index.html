<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Introduction à Clojure(Script) | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Introduction à Clojure(Script) | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Introduction à Clojure(Script) | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par jeans11" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/introduction-a-clojure-script" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(351, 100%, 35%), hsl(292, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Introduction à Clojure(Script)</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/jeans11"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="jeans11" src="https://avatars.githubusercontent.com/jeans11?size=64"/><div>jeans11<!-- --> <!-- -->•<!-- --> <!-- -->2018/05/22</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>La mise en oeuvre d’applications web, mobile, etc implique bien souvent la même
action: <strong>manipuler des données</strong>. Cette tâche se trouve aussi bien au niveau du
back-end que du front-end. Par exemple, le back transforme, collecte, met à
disposition les données alors que le front s’attache à récupérer ces dernières
et les mettre en forme. Les données peuvent être de différentes formes: chaînes
de caractères, nombres, listes, maps, etc. Le monde réel est bien souvent
confronté à des données beaucoup plus complexes. La manipulation des données est
un des exercices dans lesquels Clojure(Script) excelle.</p>
<h3>Clojure(Script) ???</h3>
<p>Clojure(Script), kesako ?</p>
<p>En fait, il faut lire <strong>Clojure</strong> et <strong>ClojureScript</strong>.</p>
<p><a href="https://clojure.org/"><strong>Clojure</strong></a> est un langage compilé, dynamiquement typé,
s’exécutant sur la JVM (compile vers du bytecode). Il a été crée par Rich Hickey
(même si vous avez des croyances différentes, vous pouvez regarder une conf de
ce monsieur,
<a href="https://www.youtube.com/watch?v=2V1FtfBDsLU">c’est très très intéressant</a> !).
C’est un langage purement fonctionnel et immutable, taillé pour la programmation
concurrente (mais pas que).</p>
<p><a href="https://clojurescript.org/"><strong>ClojureScript</strong></a> c’est Clojure compilant vers du
JavaScript via Google Closure.</p>
<blockquote>
<p>Clojure peut donc être utilisé en back et en front.</p>
</blockquote>
<p><strong>Tous les exemples de code qui vont suivre fonctionnent de la même manière pour
Clojure et ClojureScript.</strong></p>
<h3>Un peu de code</h3>
<h4>Primitives</h4>
<p>Comme tous les langages, Clojure comporte des primitives:</p>
<pre><code class="hljs language-clojure">;integer
1
;float
1.0
;string
&quot;Hello&quot;
;keyword (les keywords sont simplement des symbols. Ils sont généralement
;utilisés pour définir des constantes ainsi que les keys des maps)
:hello
;vector
[1 2 3]
;liste (séquence)
(1 2 3)
;set
#{1 2 3}
;map
{:label &quot;Hello&quot;}
</code></pre>
<h4>Une histoire de parenthèses</h4>
<p>Clojure reprend la syntaxe de LISP, c’est-à-dire que le langage s’écrit en
utilisant ses propres structures de données (homoiconicité). Une opération est
donc faite de liste:</p>
<pre><code class="hljs language-clojure">(+ 1 1)
=&gt; 2
</code></pre>
<p>En Clojure, les opérations emploient la notation <em>prefixe</em> qui diffère de la
notation <em>infixe</em> que l'on trouve en JavaScript par exemple:</p>
<pre><code class="hljs language-javascript"><span class="hljs-number">1</span> + <span class="hljs-number">1</span>
=&gt; <span class="hljs-number">2</span>
</code></pre>
<p>Contrairement à la notation <em>infixe</em> où l'opérateur est placé entre les
arguments, la notation <em>prefixe</em> place l'opérateur avant les arguments. En
Clojure, les appels de fonctions se feront toujours de cette façon:</p>
<pre><code class="hljs language-clojure">(operator arg1 arg2 ...)

;Autres exemples d&#x27;opérations

(- 2 1)
=&gt; 1

(* 2 2)
=&gt; 4

(/ 4 2)
=&gt; 2

(= 1 1)
=&gt; true
</code></pre>
<p>En Clojure, les opérateurs <code>+</code>, <code>*</code>, <code>-</code>, <code>/</code> sont avant tout des fonctions.
Même si la syntaxe est faite de listes, il y a une différence syntaxique entre
un appel de fonction et la définition d'une liste</p>
<pre><code class="hljs language-clojure">;Une opération
(+ 1 1)
=&gt; 2

;Une liste
&#x27;(+ 1 1) ;(quote (+ 1 1))
=&gt; (+ 1 1)

;Une liste simple
&#x27;(1 2 3)
=&gt; (1 2 3)

(1 2 3)
=&gt; ;Error
</code></pre>
<p>Le dernier exemple provoque une erreur car Clojure tente d'exécuter la fonction
<code>1</code> avec les paramètres <code>2</code> et <code>3</code>. L'utilisation de <code>'</code> ou <code>quote</code> permet de ne
pas évaluer l'opération mais simplement de la retourner sous forme de liste.</p>
<h4>Les variables</h4>
<p>Les variables (bindings) sont créées avec le mot clé <code>def</code>.</p>
<pre><code class="hljs language-clojure">(def level (* 2 10))
level
=&gt; 20

(def pikachu (str &quot;Oh! Pikachu is level &quot; level))
pikachu
=&gt; &quot;Oh! Pikachu is level 20&quot;
</code></pre>
<p>Les variables sont immuables:</p>
<pre><code class="hljs language-clojure">;Définition d&#x27;un binding dans le scope global
(def pikachu &quot;pikachu&quot;)

;Définition d&#x27;un binding local à la fonction `let`
(let [pikachu (upper-case pikachu)]
  pikachu) ;Le `let` retourne la dernière valeur
=&gt; &quot;PIKACHU&quot;

;Le binding global n&#x27;a pas été altéré.
pikachu
=&gt; &quot;pikachu&quot;
</code></pre>
<p><code>let</code> est une fonction qui définit des variables temporaires seulement dans son
scope local (jusqu'à la fin de la parenthèse fermante). À l'intérieur du <code>let</code>,
la variable <code>pikachu</code> sera toujours égale à <code>PIKACHU</code>, à l'extérieur elle
prendra la valeur <code>pikachu</code>. Le code ci-dessous provoque une erreur:</p>
<pre><code class="hljs language-clojure">(let [raichu &quot;Raichu&quot;]
  raichu)
=&gt; &quot;Raichu&quot;

;Le binding `raichu` n&#x27;existe pas dans le scope global
raichu
=&gt; ;Error
</code></pre>
<h4>Structures conditionnelles</h4>
<p>En Clojure chaque instruction retourne une valeur, même les structures
conditionnelles:</p>
<pre><code class="hljs language-clojure">(def pokemon-name &quot;Pikachu&quot;)

;Simple condition
(when (= pokemon-name &quot;Pikachu&quot;)
  &quot;Oh! a Pikachu&quot;)
=&gt; &quot;Oh! a Pikachu&quot;

;Condition avec un else
(if (= pokemon-name &quot;Raichu&quot;)
  &quot;Oh! a Raichu!&quot;
  &quot;Oh! it&#x27;s not a Raichu!&quot;)
=&gt; &quot;Oh! it&#x27;s not a Raichu!&quot;

;Fonctionne avec n&#x27;importe quel type de collection
(for [pokemon [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;]]
  (upper-case pokemon))
=&gt; (&quot;PIKACHU&quot; &quot;ROUCOUL&quot; &quot;CHENIPAN&quot;)
</code></pre>
<h4>Les collections</h4>
<p>Clojure dispose de plusieurs types de
<a href="https://clojure.org/reference/data_structures#Collections">collection</a>.</p>
<ul>
<li>Les listes simples sont des collections dont l’accès et l'insertion du <em>head</em>
est efficient. En contrepartie, l’accès à un élement de la liste est moins
performant que pour un vecteur.</li>
</ul>
<pre><code class="hljs language-clojure">(def my-list &#x27;(&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;))
;conj ajoute l&#x27;élement en début de liste
(conj my-list &quot;Arcko&quot;)
=&gt; (&quot;Arko&quot; &quot;Pikachu&quot; &quot;Roucoul&quot;  &quot;Chenipan&quot;)

(first my-list)
=&gt; &quot;Pikachu&quot;

;La liste est scannée avant d&#x27;accèder à l&#x27;élement.
(nth my-list 1)
=&gt; &quot;Roucoul&quot;

(map upper-case my-list)
=&gt; (&quot;PIKACHU&quot; &quot;ROUCOUL&quot; &quot;CHENIPAN&quot;)
</code></pre>
<ul>
<li>Les vecteurs sont des collections optimisées pour l'accès à un élement
arbitraire (via les indexes):</li>
</ul>
<pre><code class="hljs language-clojure">(def my-vec [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;])
;conj ajoute l&#x27;élément à la fin du vecteur
(conj my-vec &quot;Arcko&quot;)
=&gt; [&quot;Pikachu&quot; &quot;Roucoul&quot;  &quot;Chenipan&quot; &quot;Arcko&quot;]

;Le vecteur accède directement l&#x27;élement.
(nth my-vec 1) ;(my-vec 1)
=&gt; &quot;Roucoul&quot;

(map upper-case my-vec)
=&gt; (&quot;PIKACHU&quot; &quot;ROUCOUL&quot; &quot;CHENIPAN&quot;)
</code></pre>
<ul>
<li>Les sets sont des collections stockant chaque élément de manière unique
(rendant la duplication impossible):</li>
</ul>
<pre><code class="hljs language-clojure">(def my-set #{&quot;Pickachu&quot; &quot;Roucoul&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;})
=&gt; #{&quot;Pickachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;}

;Les sets sont particulièrement utiles pour tester la présence d&#x27;un élément
(my-set &quot;Dracaufeu&quot;)
=&gt; nil ;null

(my-set &quot;Roucoul&quot;)
=&gt; &quot;Roucoul&quot;

(when (my-set &quot;Pikachu&quot;) &quot;Oh! Great! You have a Pikachu&quot;)
=&gt; &quot;Oh! Great! You have a Pikachu&quot;
</code></pre>
<blockquote>
<p>En Clojure, les fonctions s'appliquant sur des collections peuvent également
être utilisées sur des maps. Ces dernières sont alors converties en liste de
vecteur <code>([key value] [key value])</code>.</p>
</blockquote>
<h4>Les fonctions</h4>
<p>Clojure étant un langage fonctionnel, les fonctions sont évidemment <em>first-class
citizen</em>, ce qui veut dire qu'elles peuvent être passées en argument et être
retournées par d'autres fonctions.</p>
<pre><code class="hljs language-clojure">;Définition d&#x27;une fonction
(defn make-pokemon-appear
  &quot;Display a savage pokemon&quot; ;docstring
  [pokemon-name] ;arguments
    (str &quot;Oh! a savage &quot; pokemon-name &quot; appear&quot;)) ;Retourne la dernière ligne

(make-pokemon-appear &quot;Pikachu&quot;)
=&gt; &quot;Oh! a savage Pikachu appear&quot;

(defn random-pokemon-appearance
  &quot;Choose a random pokemon to appear&quot;
  [f pokemon-coll]
    (f (rand-nth pokemon-coll))

(random-pokemon-appearance
  make-pokemon-appear
  [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;])
=&gt; &quot;Oh! a savage Chenipan appear&quot;

;Les fonctions anonymes existent aussi en Clojure
(def add-level-to-pokemon
  (fn [pokemon-name]
    (str pokemon-name &quot; level &quot; (rand-int 100))))

(random-pokemon-appearance
  make-pokemon-appear
  (map add-level-to-pokemon [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;]))
=&gt; &quot;Oh! a savage Roucoul level 6 appear&quot;
</code></pre>
<p>Le mot-clé <code>(defn name ...)</code>(sucre syntaxique pour <code>def name (fn ...)</code>) est
utilisé pour créer une fonction. Les arguments d’une fonction sont définis dans
un vecteur. Une fonction peut contenir une chaîne de caractères la documentant
(à la manière de python).</p>
<pre><code class="hljs language-clojure">;La fonction doc permet d&#x27;extraire la docstring d&#x27;une fonction
(doc make-pokemon-appear)
=&gt; ([pokemon-name])
     Display a savage pokemon
</code></pre>
<p>Par défaut en Clojure, les fonctions ne sont pas <em>autocurried</em>. Toutefois, une
fonction peut être &quot;décomposée&quot;:</p>
<pre><code class="hljs language-clojure">(def default-random-pokemon-appear
  (partial random-pokemon-appear make-pokemon-appear))

(default-random-pokemon-appear [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;])
=&gt; &quot;Oh! a savage Pikachu appear&quot;
</code></pre>
<p><code>partial</code> retourne une fonction <em>partielle</em> de la fonction passée en paramètre.
La signature initiale de la fonction <code>random-pokemon-appear</code> est <code>([f coll])</code>
(une fonction et une collection). En utilisant <code>partial</code>,
<code>default-random-pokemon-appear</code> devient une fonction avec la signature
<code>([coll])</code>. Le premier paramètre <code>f</code> ayant déjà été affecté, il n’est plus
nécessaire de le passer à la fonction.</p>
<h4>Les maps</h4>
<p>En Clojure, les maps sont créées de la façon suivante:</p>
<pre><code class="hljs language-clojure">(def dracolosse
  {:id 149
   :name &quot;Dracolosse&quot;
   :level 67
   :types #{:dragon :flying}})

(:name dracolosse)
=&gt; &quot;Dracolosse&quot;

(:level dracolosse)
=&gt; 67

(get dracolosse :types)
=&gt; #{:dragon :flying}
</code></pre>
<p>Les keywords peuvent faire office de fonction pour les maps. Ils sont très
utilisés pour les keys. Toutefois, les chaînes de caractères sont utilisables
mais ne peuvent pas être employées en opérateur comme c'est le cas pour les
keywords.</p>
<pre><code class="hljs language-clojure">(def dracolosse
  {&quot;id&quot; 149
   &quot;name&quot; &quot;Dracolosse&quot;
   &quot;level&quot; 67
   &quot;types&quot; #{:dragon :flying}})

(get dracolosse &quot;name&quot;)
=&gt; &quot;Dracolosse&quot;

(&quot;name&quot; dracolosse)
=&gt; ;Error
</code></pre>
<p>Puisque les structures de données Clojure sont immutables, une update retourne
un nouvel objet, et l'objet original reste intact:</p>
<pre><code class="hljs language-clojure">;Ajouter `2` au `level` de `dracolosse`
(update dracolosse :level + 2)
=&gt; {:id 149
    :name &quot;Dracolosse&quot;
    :level 69
    :types #{:dragon :flying}}

;La map original reste intact
dracolosse
=&gt; {:id 149
    :name &quot;Dracolosse&quot;
    :level 67
    :types #{:dragon :flying}}
</code></pre>
<p>La première ligne peut paraître un peu bizarre au premier abord. La signature de
la fonction <code>update</code> est la suivante: <code>([map key f x y z &amp; mores]) -&gt; new map</code>.
La fonction prend donc en paramètre une <code>map</code> (un objet), sur laquelle appliquer
la transformation, suivie de la <code>key</code> (string ou keyword) à modifier par la
fonction <code>f</code>. Les autres paramètres (<code>x</code>, <code>y</code>, <code>z</code>) sont en fait les arguments
optionnels que peut recevoir la fonction de transformation (<code>f</code>). Ainsi, les
différentes opérations retournent strictement la même valeur:</p>
<pre><code class="hljs language-clojure">(update dracolosse :level (fn [level] (+ level 2)))

(update dracolosse :level #(+ % 2)))

(update dracolosse :level + 2)
</code></pre>
<blockquote>
<p><code>#(+ % 2)</code> est simplement du sucre syntaxique pour une fonction anonyme. Le
<code>%</code> correspond au paramètre de la fonction.</p>
</blockquote>
<p>Un programme est souvent ammené à opérer une série de modifications sur un même
objet. Chaîner des opérations est possible grâce aux
<a href="https://clojure.org/guides/threading_macros">threading macros</a>:</p>
<pre><code class="hljs language-clojure">(-&gt; dracolosse
    (update :level + 2)) ;Ajouter `2` au `level`
    (assoc :height 268)) ;Associer la key `height` avec la valeur 268
=&gt; {:name &quot;Dracolosse&quot;
    :height 268
    :level 69
    :types #{:dragon :flying}}
</code></pre>
<blockquote>
<p>Le &quot;chaînage&quot; d'opérations existe dans d'autres langages comme par exemple
OCaml avec l'opérateur <code>|&gt;</code> (qui arrive prochainement dans la nouvelle version
d'ECMAScript).</p>
</blockquote>
<p>La macro <code>-&gt;</code> place le résultat de l’instruction précédente dans le premier
argument de la fonction courante. Après compilation, le code précédent donne:</p>
<pre><code class="hljs language-clojure"> (<span class="hljs-name"><span class="hljs-builtin-name">assoc</span></span>
   (<span class="hljs-name">update</span>
     dracolosse
     <span class="hljs-symbol">:level</span>
     + <span class="hljs-number">2</span>)
   <span class="hljs-symbol">:height</span> <span class="hljs-number">268</span>)
</code></pre>
<blockquote>
<p>Une macro est une sorte de fonction qui permet de générer du code lors de la
phase de compilation (détaillé dans un futur article).</p>
</blockquote>
<h4>Les namespaces</h4>
<p>Clojure permet de créer des
<a href="https://clojure.org/reference/namespaces"><strong>namespaces</strong></a> pouvant contenir un
ensemble d’instructions:</p>
<pre><code class="hljs language-clojure">;Déclaration du namespace
(ns my-namespace.utils)

(defn group-by-type
  &quot;Take a coll of pokemons and group by it by types&quot;
  [pokemons]
  (reduce
   (fn [acc {:keys [types] :as pokemon}]
     (merge-with
      into
      acc
      (into {} (map #(vector % [pokemon]) types))))
   {}
   pokemons))

;Utilisation du namespace
(use &#x27;my-namespace.utils)

(def pokemons
  [{:id &quot;149&quot; :name &quot;Dracolosse&quot; :types #{:dragon :flying}}
   {:id &quot;376&quot; :name &quot;Metalosse&quot; :types #{:psy :steel}}
   {:id &quot;169&quot; :name &quot;Nostenfer&quot; :types #{:poison :flying}}
   {:id &quot;248&quot; :name &quot;Tyranocif&quot; :types #{:rock :darkness}}])

(def pokemons-by-type (group-by-type pokemons))

;Le nombre de pokemons de type vol
(count (:flying pokemons-by-types))
=&gt; 2

;Le nom des pokemons de type dragon
(map :name (:dragon pokemons-by-types))
=&gt; (&quot;Dracolosse&quot; &quot;Drattack&quot;)

;Le nombre de pokemon par type
(into
  {}
  (map
    (fn [[type pokemons]] (vector type (count pokemons))
    pokemons-by-types)
=&gt; {:dragon 2 :flying 2 :poison 1 :psy 1 :steel 1 :rock 1 :darkness 1}
</code></pre>
<p>Dans l’exemple, ci-dessus, <code>ns</code> permet de créer le namespace
<code>my-namespace.utils</code>. Pour utiliser le namespace dans un autre, Clojure offre
plusieurs possiblités:</p>
<pre><code class="hljs language-clojure">(<span class="hljs-name"><span class="hljs-builtin-name">ns</span></span> my-namespace.core
  <span class="hljs-comment">;Charger toutes les fonctions du namespace</span>
  (<span class="hljs-symbol">:use</span> my-namespace.utils)
  <span class="hljs-comment">;Préfixer les fonctions du namespace</span>
  (<span class="hljs-symbol">:require</span> [my-namespace.utils <span class="hljs-symbol">:as</span> utils])
  <span class="hljs-comment">;Charger uniquement la ou les fonction(s)</span>
  (<span class="hljs-symbol">:require</span> [my-namespace.utils <span class="hljs-symbol">:refer</span> [group-by-type]]))
</code></pre>
<h4>Le destructuring</h4>
<p>Clojure dispose d’un puissant mécanisme de
<a href="https://clojure.org/guides/destructuring"><strong>destructuring</strong></a>:</p>
<pre><code class="hljs language-clojure">(<span class="hljs-name"><span class="hljs-builtin-name">ns</span></span> my-namespace.utils
  (<span class="hljs-symbol">:require</span> [clojure.string <span class="hljs-symbol">:refer</span> [join]]))

(<span class="hljs-keyword">defn</span> <span class="hljs-title">pokemon-&gt;string</span>
  <span class="hljs-string">&quot;Take a pokemon and return it to string&quot;</span>
  <span class="hljs-comment">;Des bindings locals sont crées en fonction des keys de la map</span>
  <span class="hljs-comment">;{label key label key}</span>
  <span class="hljs-comment">;`:as` (optionnel) permet de conserver une trace de l&#x27;objet</span>
  [{id <span class="hljs-symbol">:id</span> pokemon-name <span class="hljs-symbol">:name</span> types <span class="hljs-symbol">:types</span> <span class="hljs-symbol">:as</span> pokemon}]
  (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> [types-string
        (<span class="hljs-name">join</span> <span class="hljs-string">&quot;&quot;</span> (<span class="hljs-name"><span class="hljs-builtin-name">-&gt;&gt;</span></span> types (<span class="hljs-name"><span class="hljs-builtin-name">map</span></span> name) (<span class="hljs-name">interpose</span> <span class="hljs-string">&quot;/&quot;</span>)]
    (<span class="hljs-name"><span class="hljs-builtin-name">str</span></span> pokemon-name <span class="hljs-string">&quot;|&quot;</span> id <span class="hljs-string">&quot;:&quot;</span> types-string <span class="hljs-string">&quot; pokemon&quot;</span>)))

(<span class="hljs-name">pokemon-&gt;string</span> dracolosse)
=&gt; <span class="hljs-string">&quot;Dracolosse|149: dragon/flying pokemon
</span></code></pre>
<p>Dans l’exemple, ci-dessus, la destructuration s’opère sur une map. Il est
possible de destructurer d’autres structures de données comme les vecteurs par
exemple:</p>
<pre><code class="hljs language-clojure">(def pokemons-by-type (group-by-type pokemons))

pokemon-by-type
=&gt; {:dragon ({...} {...}) :psy ({...}) ...}

(into
  {}
  (map
    (fn [[type pokemons]]
      (vector type (map :name pokemons)))
    pokemons-by-type))
=&gt; {:dragon (&quot;Dracolosse&quot; &quot;Drattack&quot;) :psy (&quot;Metalosse&quot;) ...}
</code></pre>
<blockquote>
<p><code>(into {} (...))</code> convertit une collection dans le type indiqué en premier
paramètre.</p>
</blockquote>
<p>C’est tout pour cette première partie sur Clojure. Pour en découvrir un peu plus
sur le langage, vous pouvez jeter un oeil à la
<a href="https://clojuredocs.org/">documention</a>. Dans les prochains articles, nous
verrons d'autres aspects du langage, notamment l'interopérabilité avec Java pour
Clojure et avec JavaScript pour ClojureScript, le REPL-driven-development, le
testing, les macros ainsi que l'utilisation de React.</p>
<p>En attendant, attrapez-les tous ! ;)</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Introduction%20%C3%A0%20Clojure(Script)%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fintroduction-a-clojure-script" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"introduction-a-clojure-script","v":{"_0":{"TAG":0,"_0":{"slug":"introduction-a-clojure-script","filename":"2018-05-22-introduction-a-clojure-script","title":"Introduction à Clojure(Script)","date":"Tue, 22 May 2018 00:00:00 GMT","draft":false,"meta":{"date":"2018-05-22T00:00:00.000Z","title":"Introduction à Clojure(Script)","author":"jeans11","oldSlug":"clojure/intro","slug":"introduction-a-clojure-script"},"body":"<p>La mise en oeuvre d’applications web, mobile, etc implique bien souvent la même\naction: <strong>manipuler des données</strong>. Cette tâche se trouve aussi bien au niveau du\nback-end que du front-end. Par exemple, le back transforme, collecte, met à\ndisposition les données alors que le front s’attache à récupérer ces dernières\net les mettre en forme. Les données peuvent être de différentes formes: chaînes\nde caractères, nombres, listes, maps, etc. Le monde réel est bien souvent\nconfronté à des données beaucoup plus complexes. La manipulation des données est\nun des exercices dans lesquels Clojure(Script) excelle.</p>\n<h3>Clojure(Script) ???</h3>\n<p>Clojure(Script), kesako ?</p>\n<p>En fait, il faut lire <strong>Clojure</strong> et <strong>ClojureScript</strong>.</p>\n<p><a href=\"https://clojure.org/\"><strong>Clojure</strong></a> est un langage compilé, dynamiquement typé,\ns’exécutant sur la JVM (compile vers du bytecode). Il a été crée par Rich Hickey\n(même si vous avez des croyances différentes, vous pouvez regarder une conf de\nce monsieur,\n<a href=\"https://www.youtube.com/watch?v=2V1FtfBDsLU\">c’est très très intéressant</a> !).\nC’est un langage purement fonctionnel et immutable, taillé pour la programmation\nconcurrente (mais pas que).</p>\n<p><a href=\"https://clojurescript.org/\"><strong>ClojureScript</strong></a> c’est Clojure compilant vers du\nJavaScript via Google Closure.</p>\n<blockquote>\n<p>Clojure peut donc être utilisé en back et en front.</p>\n</blockquote>\n<p><strong>Tous les exemples de code qui vont suivre fonctionnent de la même manière pour\nClojure et ClojureScript.</strong></p>\n<h3>Un peu de code</h3>\n<h4>Primitives</h4>\n<p>Comme tous les langages, Clojure comporte des primitives:</p>\n<pre><code class=\"hljs language-clojure\">;integer\n1\n;float\n1.0\n;string\n&quot;Hello&quot;\n;keyword (les keywords sont simplement des symbols. Ils sont généralement\n;utilisés pour définir des constantes ainsi que les keys des maps)\n:hello\n;vector\n[1 2 3]\n;liste (séquence)\n(1 2 3)\n;set\n#{1 2 3}\n;map\n{:label &quot;Hello&quot;}\n</code></pre>\n<h4>Une histoire de parenthèses</h4>\n<p>Clojure reprend la syntaxe de LISP, c’est-à-dire que le langage s’écrit en\nutilisant ses propres structures de données (homoiconicité). Une opération est\ndonc faite de liste:</p>\n<pre><code class=\"hljs language-clojure\">(+ 1 1)\n=&gt; 2\n</code></pre>\n<p>En Clojure, les opérations emploient la notation <em>prefixe</em> qui diffère de la\nnotation <em>infixe</em> que l'on trouve en JavaScript par exemple:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-number\">1</span> + <span class=\"hljs-number\">1</span>\n=&gt; <span class=\"hljs-number\">2</span>\n</code></pre>\n<p>Contrairement à la notation <em>infixe</em> où l'opérateur est placé entre les\narguments, la notation <em>prefixe</em> place l'opérateur avant les arguments. En\nClojure, les appels de fonctions se feront toujours de cette façon:</p>\n<pre><code class=\"hljs language-clojure\">(operator arg1 arg2 ...)\n\n;Autres exemples d&#x27;opérations\n\n(- 2 1)\n=&gt; 1\n\n(* 2 2)\n=&gt; 4\n\n(/ 4 2)\n=&gt; 2\n\n(= 1 1)\n=&gt; true\n</code></pre>\n<p>En Clojure, les opérateurs <code>+</code>, <code>*</code>, <code>-</code>, <code>/</code> sont avant tout des fonctions.\nMême si la syntaxe est faite de listes, il y a une différence syntaxique entre\nun appel de fonction et la définition d'une liste</p>\n<pre><code class=\"hljs language-clojure\">;Une opération\n(+ 1 1)\n=&gt; 2\n\n;Une liste\n&#x27;(+ 1 1) ;(quote (+ 1 1))\n=&gt; (+ 1 1)\n\n;Une liste simple\n&#x27;(1 2 3)\n=&gt; (1 2 3)\n\n(1 2 3)\n=&gt; ;Error\n</code></pre>\n<p>Le dernier exemple provoque une erreur car Clojure tente d'exécuter la fonction\n<code>1</code> avec les paramètres <code>2</code> et <code>3</code>. L'utilisation de <code>'</code> ou <code>quote</code> permet de ne\npas évaluer l'opération mais simplement de la retourner sous forme de liste.</p>\n<h4>Les variables</h4>\n<p>Les variables (bindings) sont créées avec le mot clé <code>def</code>.</p>\n<pre><code class=\"hljs language-clojure\">(def level (* 2 10))\nlevel\n=&gt; 20\n\n(def pikachu (str &quot;Oh! Pikachu is level &quot; level))\npikachu\n=&gt; &quot;Oh! Pikachu is level 20&quot;\n</code></pre>\n<p>Les variables sont immuables:</p>\n<pre><code class=\"hljs language-clojure\">;Définition d&#x27;un binding dans le scope global\n(def pikachu &quot;pikachu&quot;)\n\n;Définition d&#x27;un binding local à la fonction `let`\n(let [pikachu (upper-case pikachu)]\n  pikachu) ;Le `let` retourne la dernière valeur\n=&gt; &quot;PIKACHU&quot;\n\n;Le binding global n&#x27;a pas été altéré.\npikachu\n=&gt; &quot;pikachu&quot;\n</code></pre>\n<p><code>let</code> est une fonction qui définit des variables temporaires seulement dans son\nscope local (jusqu'à la fin de la parenthèse fermante). À l'intérieur du <code>let</code>,\nla variable <code>pikachu</code> sera toujours égale à <code>PIKACHU</code>, à l'extérieur elle\nprendra la valeur <code>pikachu</code>. Le code ci-dessous provoque une erreur:</p>\n<pre><code class=\"hljs language-clojure\">(let [raichu &quot;Raichu&quot;]\n  raichu)\n=&gt; &quot;Raichu&quot;\n\n;Le binding `raichu` n&#x27;existe pas dans le scope global\nraichu\n=&gt; ;Error\n</code></pre>\n<h4>Structures conditionnelles</h4>\n<p>En Clojure chaque instruction retourne une valeur, même les structures\nconditionnelles:</p>\n<pre><code class=\"hljs language-clojure\">(def pokemon-name &quot;Pikachu&quot;)\n\n;Simple condition\n(when (= pokemon-name &quot;Pikachu&quot;)\n  &quot;Oh! a Pikachu&quot;)\n=&gt; &quot;Oh! a Pikachu&quot;\n\n;Condition avec un else\n(if (= pokemon-name &quot;Raichu&quot;)\n  &quot;Oh! a Raichu!&quot;\n  &quot;Oh! it&#x27;s not a Raichu!&quot;)\n=&gt; &quot;Oh! it&#x27;s not a Raichu!&quot;\n\n;Fonctionne avec n&#x27;importe quel type de collection\n(for [pokemon [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;]]\n  (upper-case pokemon))\n=&gt; (&quot;PIKACHU&quot; &quot;ROUCOUL&quot; &quot;CHENIPAN&quot;)\n</code></pre>\n<h4>Les collections</h4>\n<p>Clojure dispose de plusieurs types de\n<a href=\"https://clojure.org/reference/data_structures#Collections\">collection</a>.</p>\n<ul>\n<li>Les listes simples sont des collections dont l’accès et l'insertion du <em>head</em>\nest efficient. En contrepartie, l’accès à un élement de la liste est moins\nperformant que pour un vecteur.</li>\n</ul>\n<pre><code class=\"hljs language-clojure\">(def my-list &#x27;(&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;))\n;conj ajoute l&#x27;élement en début de liste\n(conj my-list &quot;Arcko&quot;)\n=&gt; (&quot;Arko&quot; &quot;Pikachu&quot; &quot;Roucoul&quot;  &quot;Chenipan&quot;)\n\n(first my-list)\n=&gt; &quot;Pikachu&quot;\n\n;La liste est scannée avant d&#x27;accèder à l&#x27;élement.\n(nth my-list 1)\n=&gt; &quot;Roucoul&quot;\n\n(map upper-case my-list)\n=&gt; (&quot;PIKACHU&quot; &quot;ROUCOUL&quot; &quot;CHENIPAN&quot;)\n</code></pre>\n<ul>\n<li>Les vecteurs sont des collections optimisées pour l'accès à un élement\narbitraire (via les indexes):</li>\n</ul>\n<pre><code class=\"hljs language-clojure\">(def my-vec [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;])\n;conj ajoute l&#x27;élément à la fin du vecteur\n(conj my-vec &quot;Arcko&quot;)\n=&gt; [&quot;Pikachu&quot; &quot;Roucoul&quot;  &quot;Chenipan&quot; &quot;Arcko&quot;]\n\n;Le vecteur accède directement l&#x27;élement.\n(nth my-vec 1) ;(my-vec 1)\n=&gt; &quot;Roucoul&quot;\n\n(map upper-case my-vec)\n=&gt; (&quot;PIKACHU&quot; &quot;ROUCOUL&quot; &quot;CHENIPAN&quot;)\n</code></pre>\n<ul>\n<li>Les sets sont des collections stockant chaque élément de manière unique\n(rendant la duplication impossible):</li>\n</ul>\n<pre><code class=\"hljs language-clojure\">(def my-set #{&quot;Pickachu&quot; &quot;Roucoul&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;})\n=&gt; #{&quot;Pickachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;}\n\n;Les sets sont particulièrement utiles pour tester la présence d&#x27;un élément\n(my-set &quot;Dracaufeu&quot;)\n=&gt; nil ;null\n\n(my-set &quot;Roucoul&quot;)\n=&gt; &quot;Roucoul&quot;\n\n(when (my-set &quot;Pikachu&quot;) &quot;Oh! Great! You have a Pikachu&quot;)\n=&gt; &quot;Oh! Great! You have a Pikachu&quot;\n</code></pre>\n<blockquote>\n<p>En Clojure, les fonctions s'appliquant sur des collections peuvent également\nêtre utilisées sur des maps. Ces dernières sont alors converties en liste de\nvecteur <code>([key value] [key value])</code>.</p>\n</blockquote>\n<h4>Les fonctions</h4>\n<p>Clojure étant un langage fonctionnel, les fonctions sont évidemment <em>first-class\ncitizen</em>, ce qui veut dire qu'elles peuvent être passées en argument et être\nretournées par d'autres fonctions.</p>\n<pre><code class=\"hljs language-clojure\">;Définition d&#x27;une fonction\n(defn make-pokemon-appear\n  &quot;Display a savage pokemon&quot; ;docstring\n  [pokemon-name] ;arguments\n    (str &quot;Oh! a savage &quot; pokemon-name &quot; appear&quot;)) ;Retourne la dernière ligne\n\n(make-pokemon-appear &quot;Pikachu&quot;)\n=&gt; &quot;Oh! a savage Pikachu appear&quot;\n\n(defn random-pokemon-appearance\n  &quot;Choose a random pokemon to appear&quot;\n  [f pokemon-coll]\n    (f (rand-nth pokemon-coll))\n\n(random-pokemon-appearance\n  make-pokemon-appear\n  [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;])\n=&gt; &quot;Oh! a savage Chenipan appear&quot;\n\n;Les fonctions anonymes existent aussi en Clojure\n(def add-level-to-pokemon\n  (fn [pokemon-name]\n    (str pokemon-name &quot; level &quot; (rand-int 100))))\n\n(random-pokemon-appearance\n  make-pokemon-appear\n  (map add-level-to-pokemon [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;]))\n=&gt; &quot;Oh! a savage Roucoul level 6 appear&quot;\n</code></pre>\n<p>Le mot-clé <code>(defn name ...)</code>(sucre syntaxique pour <code>def name (fn ...)</code>) est\nutilisé pour créer une fonction. Les arguments d’une fonction sont définis dans\nun vecteur. Une fonction peut contenir une chaîne de caractères la documentant\n(à la manière de python).</p>\n<pre><code class=\"hljs language-clojure\">;La fonction doc permet d&#x27;extraire la docstring d&#x27;une fonction\n(doc make-pokemon-appear)\n=&gt; ([pokemon-name])\n     Display a savage pokemon\n</code></pre>\n<p>Par défaut en Clojure, les fonctions ne sont pas <em>autocurried</em>. Toutefois, une\nfonction peut être &quot;décomposée&quot;:</p>\n<pre><code class=\"hljs language-clojure\">(def default-random-pokemon-appear\n  (partial random-pokemon-appear make-pokemon-appear))\n\n(default-random-pokemon-appear [&quot;Pikachu&quot; &quot;Roucoul&quot; &quot;Chenipan&quot;])\n=&gt; &quot;Oh! a savage Pikachu appear&quot;\n</code></pre>\n<p><code>partial</code> retourne une fonction <em>partielle</em> de la fonction passée en paramètre.\nLa signature initiale de la fonction <code>random-pokemon-appear</code> est <code>([f coll])</code>\n(une fonction et une collection). En utilisant <code>partial</code>,\n<code>default-random-pokemon-appear</code> devient une fonction avec la signature\n<code>([coll])</code>. Le premier paramètre <code>f</code> ayant déjà été affecté, il n’est plus\nnécessaire de le passer à la fonction.</p>\n<h4>Les maps</h4>\n<p>En Clojure, les maps sont créées de la façon suivante:</p>\n<pre><code class=\"hljs language-clojure\">(def dracolosse\n  {:id 149\n   :name &quot;Dracolosse&quot;\n   :level 67\n   :types #{:dragon :flying}})\n\n(:name dracolosse)\n=&gt; &quot;Dracolosse&quot;\n\n(:level dracolosse)\n=&gt; 67\n\n(get dracolosse :types)\n=&gt; #{:dragon :flying}\n</code></pre>\n<p>Les keywords peuvent faire office de fonction pour les maps. Ils sont très\nutilisés pour les keys. Toutefois, les chaînes de caractères sont utilisables\nmais ne peuvent pas être employées en opérateur comme c'est le cas pour les\nkeywords.</p>\n<pre><code class=\"hljs language-clojure\">(def dracolosse\n  {&quot;id&quot; 149\n   &quot;name&quot; &quot;Dracolosse&quot;\n   &quot;level&quot; 67\n   &quot;types&quot; #{:dragon :flying}})\n\n(get dracolosse &quot;name&quot;)\n=&gt; &quot;Dracolosse&quot;\n\n(&quot;name&quot; dracolosse)\n=&gt; ;Error\n</code></pre>\n<p>Puisque les structures de données Clojure sont immutables, une update retourne\nun nouvel objet, et l'objet original reste intact:</p>\n<pre><code class=\"hljs language-clojure\">;Ajouter `2` au `level` de `dracolosse`\n(update dracolosse :level + 2)\n=&gt; {:id 149\n    :name &quot;Dracolosse&quot;\n    :level 69\n    :types #{:dragon :flying}}\n\n;La map original reste intact\ndracolosse\n=&gt; {:id 149\n    :name &quot;Dracolosse&quot;\n    :level 67\n    :types #{:dragon :flying}}\n</code></pre>\n<p>La première ligne peut paraître un peu bizarre au premier abord. La signature de\nla fonction <code>update</code> est la suivante: <code>([map key f x y z &amp; mores]) -&gt; new map</code>.\nLa fonction prend donc en paramètre une <code>map</code> (un objet), sur laquelle appliquer\nla transformation, suivie de la <code>key</code> (string ou keyword) à modifier par la\nfonction <code>f</code>. Les autres paramètres (<code>x</code>, <code>y</code>, <code>z</code>) sont en fait les arguments\noptionnels que peut recevoir la fonction de transformation (<code>f</code>). Ainsi, les\ndifférentes opérations retournent strictement la même valeur:</p>\n<pre><code class=\"hljs language-clojure\">(update dracolosse :level (fn [level] (+ level 2)))\n\n(update dracolosse :level #(+ % 2)))\n\n(update dracolosse :level + 2)\n</code></pre>\n<blockquote>\n<p><code>#(+ % 2)</code> est simplement du sucre syntaxique pour une fonction anonyme. Le\n<code>%</code> correspond au paramètre de la fonction.</p>\n</blockquote>\n<p>Un programme est souvent ammené à opérer une série de modifications sur un même\nobjet. Chaîner des opérations est possible grâce aux\n<a href=\"https://clojure.org/guides/threading_macros\">threading macros</a>:</p>\n<pre><code class=\"hljs language-clojure\">(-&gt; dracolosse\n    (update :level + 2)) ;Ajouter `2` au `level`\n    (assoc :height 268)) ;Associer la key `height` avec la valeur 268\n=&gt; {:name &quot;Dracolosse&quot;\n    :height 268\n    :level 69\n    :types #{:dragon :flying}}\n</code></pre>\n<blockquote>\n<p>Le &quot;chaînage&quot; d'opérations existe dans d'autres langages comme par exemple\nOCaml avec l'opérateur <code>|&gt;</code> (qui arrive prochainement dans la nouvelle version\nd'ECMAScript).</p>\n</blockquote>\n<p>La macro <code>-&gt;</code> place le résultat de l’instruction précédente dans le premier\nargument de la fonction courante. Après compilation, le code précédent donne:</p>\n<pre><code class=\"hljs language-clojure\"> (<span class=\"hljs-name\"><span class=\"hljs-builtin-name\">assoc</span></span>\n   (<span class=\"hljs-name\">update</span>\n     dracolosse\n     <span class=\"hljs-symbol\">:level</span>\n     + <span class=\"hljs-number\">2</span>)\n   <span class=\"hljs-symbol\">:height</span> <span class=\"hljs-number\">268</span>)\n</code></pre>\n<blockquote>\n<p>Une macro est une sorte de fonction qui permet de générer du code lors de la\nphase de compilation (détaillé dans un futur article).</p>\n</blockquote>\n<h4>Les namespaces</h4>\n<p>Clojure permet de créer des\n<a href=\"https://clojure.org/reference/namespaces\"><strong>namespaces</strong></a> pouvant contenir un\nensemble d’instructions:</p>\n<pre><code class=\"hljs language-clojure\">;Déclaration du namespace\n(ns my-namespace.utils)\n\n(defn group-by-type\n  &quot;Take a coll of pokemons and group by it by types&quot;\n  [pokemons]\n  (reduce\n   (fn [acc {:keys [types] :as pokemon}]\n     (merge-with\n      into\n      acc\n      (into {} (map #(vector % [pokemon]) types))))\n   {}\n   pokemons))\n\n;Utilisation du namespace\n(use &#x27;my-namespace.utils)\n\n(def pokemons\n  [{:id &quot;149&quot; :name &quot;Dracolosse&quot; :types #{:dragon :flying}}\n   {:id &quot;376&quot; :name &quot;Metalosse&quot; :types #{:psy :steel}}\n   {:id &quot;169&quot; :name &quot;Nostenfer&quot; :types #{:poison :flying}}\n   {:id &quot;248&quot; :name &quot;Tyranocif&quot; :types #{:rock :darkness}}])\n\n(def pokemons-by-type (group-by-type pokemons))\n\n;Le nombre de pokemons de type vol\n(count (:flying pokemons-by-types))\n=&gt; 2\n\n;Le nom des pokemons de type dragon\n(map :name (:dragon pokemons-by-types))\n=&gt; (&quot;Dracolosse&quot; &quot;Drattack&quot;)\n\n;Le nombre de pokemon par type\n(into\n  {}\n  (map\n    (fn [[type pokemons]] (vector type (count pokemons))\n    pokemons-by-types)\n=&gt; {:dragon 2 :flying 2 :poison 1 :psy 1 :steel 1 :rock 1 :darkness 1}\n</code></pre>\n<p>Dans l’exemple, ci-dessus, <code>ns</code> permet de créer le namespace\n<code>my-namespace.utils</code>. Pour utiliser le namespace dans un autre, Clojure offre\nplusieurs possiblités:</p>\n<pre><code class=\"hljs language-clojure\">(<span class=\"hljs-name\"><span class=\"hljs-builtin-name\">ns</span></span> my-namespace.core\n  <span class=\"hljs-comment\">;Charger toutes les fonctions du namespace</span>\n  (<span class=\"hljs-symbol\">:use</span> my-namespace.utils)\n  <span class=\"hljs-comment\">;Préfixer les fonctions du namespace</span>\n  (<span class=\"hljs-symbol\">:require</span> [my-namespace.utils <span class=\"hljs-symbol\">:as</span> utils])\n  <span class=\"hljs-comment\">;Charger uniquement la ou les fonction(s)</span>\n  (<span class=\"hljs-symbol\">:require</span> [my-namespace.utils <span class=\"hljs-symbol\">:refer</span> [group-by-type]]))\n</code></pre>\n<h4>Le destructuring</h4>\n<p>Clojure dispose d’un puissant mécanisme de\n<a href=\"https://clojure.org/guides/destructuring\"><strong>destructuring</strong></a>:</p>\n<pre><code class=\"hljs language-clojure\">(<span class=\"hljs-name\"><span class=\"hljs-builtin-name\">ns</span></span> my-namespace.utils\n  (<span class=\"hljs-symbol\">:require</span> [clojure.string <span class=\"hljs-symbol\">:refer</span> [join]]))\n\n(<span class=\"hljs-keyword\">defn</span> <span class=\"hljs-title\">pokemon-&gt;string</span>\n  <span class=\"hljs-string\">&quot;Take a pokemon and return it to string&quot;</span>\n  <span class=\"hljs-comment\">;Des bindings locals sont crées en fonction des keys de la map</span>\n  <span class=\"hljs-comment\">;{label key label key}</span>\n  <span class=\"hljs-comment\">;`:as` (optionnel) permet de conserver une trace de l&#x27;objet</span>\n  [{id <span class=\"hljs-symbol\">:id</span> pokemon-name <span class=\"hljs-symbol\">:name</span> types <span class=\"hljs-symbol\">:types</span> <span class=\"hljs-symbol\">:as</span> pokemon}]\n  (<span class=\"hljs-name\"><span class=\"hljs-builtin-name\">let</span></span> [types-string\n        (<span class=\"hljs-name\">join</span> <span class=\"hljs-string\">&quot;&quot;</span> (<span class=\"hljs-name\"><span class=\"hljs-builtin-name\">-&gt;&gt;</span></span> types (<span class=\"hljs-name\"><span class=\"hljs-builtin-name\">map</span></span> name) (<span class=\"hljs-name\">interpose</span> <span class=\"hljs-string\">&quot;/&quot;</span>)]\n    (<span class=\"hljs-name\"><span class=\"hljs-builtin-name\">str</span></span> pokemon-name <span class=\"hljs-string\">&quot;|&quot;</span> id <span class=\"hljs-string\">&quot;:&quot;</span> types-string <span class=\"hljs-string\">&quot; pokemon&quot;</span>)))\n\n(<span class=\"hljs-name\">pokemon-&gt;string</span> dracolosse)\n=&gt; <span class=\"hljs-string\">&quot;Dracolosse|149: dragon/flying pokemon\n</span></code></pre>\n<p>Dans l’exemple, ci-dessus, la destructuration s’opère sur une map. Il est\npossible de destructurer d’autres structures de données comme les vecteurs par\nexemple:</p>\n<pre><code class=\"hljs language-clojure\">(def pokemons-by-type (group-by-type pokemons))\n\npokemon-by-type\n=&gt; {:dragon ({...} {...}) :psy ({...}) ...}\n\n(into\n  {}\n  (map\n    (fn [[type pokemons]]\n      (vector type (map :name pokemons)))\n    pokemons-by-type))\n=&gt; {:dragon (&quot;Dracolosse&quot; &quot;Drattack&quot;) :psy (&quot;Metalosse&quot;) ...}\n</code></pre>\n<blockquote>\n<p><code>(into {} (...))</code> convertit une collection dans le type indiqué en premier\nparamètre.</p>\n</blockquote>\n<p>C’est tout pour cette première partie sur Clojure. Pour en découvrir un peu plus\nsur le langage, vous pouvez jeter un oeil à la\n<a href=\"https://clojuredocs.org/\">documention</a>. Dans les prochains articles, nous\nverrons d'autres aspects du langage, notamment l'interopérabilité avec Java pour\nClojure et avec JavaScript pour ClojureScript, le REPL-driven-development, le\ntesting, les macros ainsi que l'utilisation de React.</p>\n<p>En attendant, attrapez-les tous ! ;)</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>