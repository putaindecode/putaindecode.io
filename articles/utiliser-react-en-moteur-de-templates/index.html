<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Utiliser React en moteur de templates | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Utiliser React en moteur de templates | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Utiliser React en moteur de templates | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par MoOx" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/utiliser-react-en-moteur-de-templates" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(303, 100%, 35%), hsl(252, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Utiliser React en moteur de templates</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/MoOx"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="MoOx" src="https://avatars.githubusercontent.com/MoOx?size=64"/><div>MoOx<!-- --> <!-- -->•<!-- --> <!-- -->2015/05/07</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Vous connaissez probablement tous des moteurs de templates. En JavaScript nous
avons Handlebars, Jade, EJS, Slim... Tous ces projets partent de bonnes
intentions mais à l'utilisation, on peut sentir des limitations et donc de
l'insatisfaction.</p>
<p>Utiliser Handlebars par exemple, c'est un peu devoir coder tout un tas de
helpers pour gérer une partie de votre affichage, ça peut vite devenir lourd.
Être restreint à une syntaxe limitée par choix est un peu frustrant. Quand c'est
pas ça, c'est la syntaxe du moteur qui va être lourde.</p>
<p>On peut en venir à regretter PHP. Faut avouer que ce langage était plutôt simple
à utiliser en tant que moteur de template. Efficace et pas de restrictions. On
trouve même parfois des <code>mysql_query()</code> dans des templates…</p>
<p>Blague à part, nous cherchions des langages pour refaire une partie de notre
site puisque nous n'étions pas vraiment satisfaits du processus actuel
(anciennement Handlebars, puis Jade).</p>
<p>Mais finalement, pourquoi ne pas rester avec du JavaScript, purement et
simplement ?</p>
<p>C'est ce que nous avons fait avec React et JSX qui sont de plus en plus
utilisés. La syntaxe est plutôt libératrice.</p>
<p>Pour ceux qui ne connaissent pas JSX, il s'agit d'un superset de JavaScript qui
supporte une syntaxe XML transformé en appel de fonctions JavaScript. Il faut
dire que le XML a beau être verbeux, pour définir des éléments ayant des
propriétés et des enfants, on a pas vraiment fait plus lisible et clair sur ce
point. Le HTML est plutôt simple à prendre en main c'est certain. Les méthodes
de rendu de React (ce qui va nous intéresser) sont très proches de l'HTML.</p>
<p>Ceux qui ont utilisé JSX (bien qu'ayant pu avoir des nausées au premier contact)
avouent souvent qu'ils ont fini par aimer cette petite syntaxe créée par
Facebook qui fonctionne très bien avec React.</p>
<p>Du coup, si on utilisait ça pour faire de simple templates et non pas des
composants d'interface utilisateur dynamiques ? Qui peut le plus peut le moins
(quoi qu'en fait, des templates, c'est un peu des composants d'interface).</p>
<h2>Exemple de template React/JSX</h2>
<p>Si vous ne savez pas trop ce qu'est React, nous vous recommandons de lire notre
<a href="/fr/articles/js/react/">introduction à React</a>.</p>
<p>Dans notre cas, on ne va pas spécialement bénéficier de certaines de ses forces,
mais ça fera très bien le job pour notre besoin.</p>
<p>Nous n'aborderons pas dans le détail la syntaxe React/JSX, ni ES6, pour rester
focalisés sur la finalité (on a prévu des articles à ce propos, en attendant
<a href="http://babeljs.io/docs/learn-es6/">voici de quoi vous occuper avec ES6</a>).</p>
<p><em>Attention, pour ceux qui sont encore sur des plugins jQuery, ça risque de vous
piquer les yeux</em> 😭.</p>
<p><a name="es6-class"></a></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostTemplate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{this.props.pageTitle}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org-Post&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org-Post-header&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{this.props.pageTitle}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
              <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org-Post-content&quot;</span>
              <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">this.props.pageContent</span> }}
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
    );
  }
}
</code></pre>
<p>Ce que vous voyez c'est bien du JavaScript. Un peu amélioré via JSX, on ne va
pas le nier (dans notre cas, on gère tout ça de manière transparente avec
<a href="http://babeljs.io/">babel(-node)</a>).</p>
<p>Ça ressemble drôlement à de l'HTML et c'est ça qui est appréciable pour nous.
Vous noterez que l'attribut pour définir une classe HTML est <code>className</code> puisque
React est en JavaScript et que le mot <code>class</code> est réservé (cf.
<a href="#es6-class">la définition en ES6 de la classe</a>).</p>
<p>En même temps ce qui est cool, c'est qu'on reste dans du JavaScript.</p>
<p>On peut donc utiliser toutes nos bibliothèques préférées via <em>npm</em> pour
l'affichage (exemple : <code>momentjs</code>), ou simplement des boucles via les méthodes
de parcours de tableau tel que <code>forEach()</code> ou <code>map()</code> en appelant d'autres
composants.</p>
<p>Ci-dessous vous trouverez un exemple plus complexe avec une page pour la liste
des posts et quelques composants. Les balises qui ressemblent à du HTML et qui
commencent par une majuscule sont liées à des composants qui doivent être
définis (dans notre cas importés). C'est une particularité de React.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> React, {Component} <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>

<span class="hljs-keyword">import</span> Html <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Html&quot;</span>
<span class="hljs-keyword">import</span> Head <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Head&quot;</span>
<span class="hljs-keyword">import</span> Body <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Body&quot;</span>
<span class="hljs-keyword">import</span> PostsList <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../PostsList&quot;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Posts</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{

  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Html</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Head</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{head.title}</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Body</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{head.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">PostsList</span>
            <span class="hljs-attr">posts</span>=<span class="hljs-string">{</span>
              <span class="hljs-attr">this.props.collection</span>
                <span class="hljs-attr">.filter</span>((<span class="hljs-attr">item</span>) =&gt;</span> {
                  /*
                    ce que vous voulez pour filtrer votre collection
                    eg:
                    return !item.draft
                  */
                }
              }
          /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Body</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Html</span>&gt;</span></span>
    )
  }
}
</code></pre>
<p>Voici deux exemples de composants utilisés ci-dessus :</p>
<h3>Head</h3>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Head</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charSet</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">httpEquiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=Edge&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{this.props.title}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/index.css&quot;</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span>
          <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;alternate&quot;</span>
          <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/feed.xml&quot;</span>
          <span class="hljs-attr">title</span>=<span class="hljs-string">{this.props.title}</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/atom+xml&quot;</span>
        /&gt;</span>
        {this.props.children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span>
    );
  }
}
</code></pre>
<h3>Body</h3>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> React, { Component, PropTypes } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Header&quot;</span>;
<span class="hljs-keyword">import</span> Footer <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Footer&quot;</span>;
<span class="hljs-keyword">import</span> GoogleAnalytics <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../Analytics&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Body</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;Main&quot;</span>&gt;</span>{this.props.children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{</span>&quot;/<span class="hljs-attr">index.js</span>&quot;} /&gt;</span><span class="handlebars"><span class="xml">

        <span class="hljs-tag">&lt;<span class="hljs-name">GoogleAnalytics</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></span></span>
    );
  }
}
</code></pre>
<p>Bon c'est bien beau mais comment je gère l'affichage du composant initial
finalement (le parent) ?</p>
<h2>Comment utiliser un template React/JSX ?</h2>
<p>C'est bien simple. Dans notre cas, pas besoin de React côté client. On doit
gérer ça côté « serveur » (je mets ça entre guillemets puisque dans notre cas
précis, c'est pour générer un site statique, et c'est donc sur une machine
quelconque que la génération se fait).</p>
<p>Voilà de quoi effectuer le rendu de nos composants vers du bon vieux HTML (car
c'est la finalité d'un <em>moteur de template</em>).</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-keyword">import</span> markdownify <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./markdown-parser&quot;</span>;
<span class="hljs-comment">// je vous conseille marked pour rendre du markdown</span>
<span class="hljs-comment">// c&#x27;est ce que nous utilisons pour rendre nos pages à l&#x27;heure où j&#x27;écris ce post</span>

<span class="hljs-keyword">const</span> reactClass = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./template/PostTemplate&quot;</span>);
<span class="hljs-keyword">const</span> component = <span class="hljs-keyword">new</span> (react.createFactory(reactClass))({
  <span class="hljs-comment">// ici on passe nos &quot;props&quot; react</span>
  <span class="hljs-attr">pageTitle</span>: <span class="hljs-string">&quot;Test&quot;</span>,
  <span class="hljs-attr">pageContent</span>: markdownify(<span class="hljs-string">&quot;Imaginons du **markdown** parsé&quot;</span>),
  <span class="hljs-comment">// vous pouvez bien entendu rajouter d&#x27;autres choses</span>
  <span class="hljs-attr">collections</span>: {
    <span class="hljs-attr">posts</span>: [
      <span class="hljs-comment">//...</span>
    ],
  },
});

<span class="hljs-keyword">let</span> html;
<span class="hljs-keyword">try</span> {
  html = react.renderToStaticMarkup(component);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-comment">// Vous devrez gérer votre exception selon votre environnement</span>
  <span class="hljs-comment">// si c&#x27;est pour un test on peut simplement ne pas utiliser</span>
  <span class="hljs-comment">// try/catch, ça nous pètera à la gueule et c&#x27;est tant mieux</span>
  <span class="hljs-keyword">throw</span> err;
}

<span class="hljs-comment">// maintenant vous faites ce que vous voulez de votre string html !</span>
<span class="hljs-comment">// ex: require(&quot;fs&quot;).writeFile(...)</span>
</code></pre>
<p>La méthode intéressante de React est dans notre cas <code>renderToStaticMarkup()</code> qui
va nous générer un HTML qui va bien.</p>
<p>Pour aller plus loin on pourrait décider d'utiliser <code>renderToString()</code> plutôt
que <code>renderToStaticMarkup()</code> afin de pouvoir faire prendre le relais à React
côté client mais là
<a href="/fr/articles/js/react/cote-serveur/">le niveau de complexité est différent</a>.</p>
<p>Pour la petite anecdote, notre site utilise actuellement
<a href="http://www.metalsmith.io/">metalsmith</a>, une petite bibliothèque simple mais qui
permet par son API de faire des choses sympas.</p>
<p>J'ai donc codé
<a href="https://github.com/search?q=user%3AMoOx+metalsmith">quelques plugins metalsmith</a>
dont un <a href="https://github.com/MoOx/metalsmith-react">metalsmith-react</a> à
l'occasion.</p>
<p>N'hésitez pas à consulter
<a href="https://github.com/putaindecode/putaindecode.io">le code source de notre site</a>
pour faire des découvertes sympas.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Utiliser%20React%20en%20moteur%20de%20templates%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Futiliser-react-en-moteur-de-templates" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"utiliser-react-en-moteur-de-templates","v":{"_0":{"TAG":0,"_0":{"slug":"utiliser-react-en-moteur-de-templates","filename":"2015-05-07-utiliser-react-en-moteur-de-templates","title":"Utiliser React en moteur de templates","date":"Thu, 07 May 2015 00:00:00 GMT","draft":false,"meta":{"date":"2015-05-07T00:00:00.000Z","title":"Utiliser React en moteur de templates","author":"MoOx","oldSlug":"js/react/utiliser-en-moteur-de-templates","slug":"utiliser-react-en-moteur-de-templates"},"body":"<p>Vous connaissez probablement tous des moteurs de templates. En JavaScript nous\navons Handlebars, Jade, EJS, Slim... Tous ces projets partent de bonnes\nintentions mais à l'utilisation, on peut sentir des limitations et donc de\nl'insatisfaction.</p>\n<p>Utiliser Handlebars par exemple, c'est un peu devoir coder tout un tas de\nhelpers pour gérer une partie de votre affichage, ça peut vite devenir lourd.\nÊtre restreint à une syntaxe limitée par choix est un peu frustrant. Quand c'est\npas ça, c'est la syntaxe du moteur qui va être lourde.</p>\n<p>On peut en venir à regretter PHP. Faut avouer que ce langage était plutôt simple\nà utiliser en tant que moteur de template. Efficace et pas de restrictions. On\ntrouve même parfois des <code>mysql_query()</code> dans des templates…</p>\n<p>Blague à part, nous cherchions des langages pour refaire une partie de notre\nsite puisque nous n'étions pas vraiment satisfaits du processus actuel\n(anciennement Handlebars, puis Jade).</p>\n<p>Mais finalement, pourquoi ne pas rester avec du JavaScript, purement et\nsimplement ?</p>\n<p>C'est ce que nous avons fait avec React et JSX qui sont de plus en plus\nutilisés. La syntaxe est plutôt libératrice.</p>\n<p>Pour ceux qui ne connaissent pas JSX, il s'agit d'un superset de JavaScript qui\nsupporte une syntaxe XML transformé en appel de fonctions JavaScript. Il faut\ndire que le XML a beau être verbeux, pour définir des éléments ayant des\npropriétés et des enfants, on a pas vraiment fait plus lisible et clair sur ce\npoint. Le HTML est plutôt simple à prendre en main c'est certain. Les méthodes\nde rendu de React (ce qui va nous intéresser) sont très proches de l'HTML.</p>\n<p>Ceux qui ont utilisé JSX (bien qu'ayant pu avoir des nausées au premier contact)\navouent souvent qu'ils ont fini par aimer cette petite syntaxe créée par\nFacebook qui fonctionne très bien avec React.</p>\n<p>Du coup, si on utilisait ça pour faire de simple templates et non pas des\ncomposants d'interface utilisateur dynamiques ? Qui peut le plus peut le moins\n(quoi qu'en fait, des templates, c'est un peu des composants d'interface).</p>\n<h2>Exemple de template React/JSX</h2>\n<p>Si vous ne savez pas trop ce qu'est React, nous vous recommandons de lire notre\n<a href=\"/fr/articles/js/react/\">introduction à React</a>.</p>\n<p>Dans notre cas, on ne va pas spécialement bénéficier de certaines de ses forces,\nmais ça fera très bien le job pour notre besoin.</p>\n<p>Nous n'aborderons pas dans le détail la syntaxe React/JSX, ni ES6, pour rester\nfocalisés sur la finalité (on a prévu des articles à ce propos, en attendant\n<a href=\"http://babeljs.io/docs/learn-es6/\">voici de quoi vous occuper avec ES6</a>).</p>\n<p><em>Attention, pour ceux qui sont encore sur des plugins jQuery, ça risque de vous\npiquer les yeux</em> 😭.</p>\n<p><a name=\"es6-class\"></a></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> React, { Component } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PostTemplate</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> {\n    <span class=\"hljs-keyword\">return</span> (\n      <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>{this.props.pageTitle}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">article</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;org-Post&quot;</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">header</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;org-Post-header&quot;</span>&gt;</span>\n              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>{this.props.pageTitle}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">header</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>\n              <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;org-Post-content&quot;</span>\n              <span class=\"hljs-attr\">dangerouslySetInnerHTML</span>=<span class=\"hljs-string\">{{</span> <span class=\"hljs-attr\">__html:</span> <span class=\"hljs-attr\">this.props.pageContent</span> }}\n            /&gt;</span>\n          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">article</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span></span>\n    );\n  }\n}\n</code></pre>\n<p>Ce que vous voyez c'est bien du JavaScript. Un peu amélioré via JSX, on ne va\npas le nier (dans notre cas, on gère tout ça de manière transparente avec\n<a href=\"http://babeljs.io/\">babel(-node)</a>).</p>\n<p>Ça ressemble drôlement à de l'HTML et c'est ça qui est appréciable pour nous.\nVous noterez que l'attribut pour définir une classe HTML est <code>className</code> puisque\nReact est en JavaScript et que le mot <code>class</code> est réservé (cf.\n<a href=\"#es6-class\">la définition en ES6 de la classe</a>).</p>\n<p>En même temps ce qui est cool, c'est qu'on reste dans du JavaScript.</p>\n<p>On peut donc utiliser toutes nos bibliothèques préférées via <em>npm</em> pour\nl'affichage (exemple : <code>momentjs</code>), ou simplement des boucles via les méthodes\nde parcours de tableau tel que <code>forEach()</code> ou <code>map()</code> en appelant d'autres\ncomposants.</p>\n<p>Ci-dessous vous trouverez un exemple plus complexe avec une page pour la liste\ndes posts et quelques composants. Les balises qui ressemblent à du HTML et qui\ncommencent par une majuscule sont liées à des composants qui doivent être\ndéfinis (dans notre cas importés). C'est une particularité de React.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> React, {Component} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>\n\n<span class=\"hljs-keyword\">import</span> Html <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../Html&quot;</span>\n<span class=\"hljs-keyword\">import</span> Head <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../Head&quot;</span>\n<span class=\"hljs-keyword\">import</span> Body <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../Body&quot;</span>\n<span class=\"hljs-keyword\">import</span> PostsList <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../PostsList&quot;</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Posts</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n\n  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> {\n    <span class=\"hljs-keyword\">return</span> (\n      <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Html</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Head</span> <span class=\"hljs-attr\">title</span>=<span class=\"hljs-string\">{head.title}</span> /&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Body</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>{head.title}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">PostsList</span>\n            <span class=\"hljs-attr\">posts</span>=<span class=\"hljs-string\">{</span>\n              <span class=\"hljs-attr\">this.props.collection</span>\n                <span class=\"hljs-attr\">.filter</span>((<span class=\"hljs-attr\">item</span>) =&gt;</span> {\n                  /*\n                    ce que vous voulez pour filtrer votre collection\n                    eg:\n                    return !item.draft\n                  */\n                }\n              }\n          /&gt;\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Body</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Html</span>&gt;</span></span>\n    )\n  }\n}\n</code></pre>\n<p>Voici deux exemples de composants utilisés ci-dessus :</p>\n<h3>Head</h3>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> React, { Component } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Head</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> {\n    <span class=\"hljs-keyword\">return</span> (\n      <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charSet</span>=<span class=\"hljs-string\">&quot;utf-8&quot;</span> /&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">httpEquiv</span>=<span class=\"hljs-string\">&quot;X-UA-Compatible&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;IE=Edge&quot;</span> /&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;viewport&quot;</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>{this.props.title}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">&quot;stylesheet&quot;</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;/index.css&quot;</span> /&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span>\n          <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">&quot;alternate&quot;</span>\n          <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;/feed.xml&quot;</span>\n          <span class=\"hljs-attr\">title</span>=<span class=\"hljs-string\">{this.props.title}</span>\n          <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;application/atom+xml&quot;</span>\n        /&gt;</span>\n        {this.props.children}\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span></span>\n    );\n  }\n}\n</code></pre>\n<h3>Body</h3>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> React, { Component, PropTypes } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n\n<span class=\"hljs-keyword\">import</span> Header <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../Header&quot;</span>;\n<span class=\"hljs-keyword\">import</span> Footer <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../Footer&quot;</span>;\n<span class=\"hljs-keyword\">import</span> GoogleAnalytics <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../Analytics&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Body</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> {\n    <span class=\"hljs-keyword\">return</span> (\n      <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Header</span> /&gt;</span>\n\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;Main&quot;</span>&gt;</span>{this.props.children}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Footer</span> /&gt;</span>\n\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">{</span>&quot;/<span class=\"hljs-attr\">index.js</span>&quot;} /&gt;</span><span class=\"handlebars\"><span class=\"xml\">\n\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">GoogleAnalytics</span> /&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span></span></span></span>\n    );\n  }\n}\n</code></pre>\n<p>Bon c'est bien beau mais comment je gère l'affichage du composant initial\nfinalement (le parent) ?</p>\n<h2>Comment utiliser un template React/JSX ?</h2>\n<p>C'est bien simple. Dans notre cas, pas besoin de React côté client. On doit\ngérer ça côté « serveur » (je mets ça entre guillemets puisque dans notre cas\nprécis, c'est pour générer un site statique, et c'est donc sur une machine\nquelconque que la génération se fait).</p>\n<p>Voilà de quoi effectuer le rendu de nos composants vers du bon vieux HTML (car\nc'est la finalité d'un <em>moteur de template</em>).</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> react <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n<span class=\"hljs-keyword\">import</span> markdownify <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./markdown-parser&quot;</span>;\n<span class=\"hljs-comment\">// je vous conseille marked pour rendre du markdown</span>\n<span class=\"hljs-comment\">// c&#x27;est ce que nous utilisons pour rendre nos pages à l&#x27;heure où j&#x27;écris ce post</span>\n\n<span class=\"hljs-keyword\">const</span> reactClass = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;./template/PostTemplate&quot;</span>);\n<span class=\"hljs-keyword\">const</span> component = <span class=\"hljs-keyword\">new</span> (react.createFactory(reactClass))({\n  <span class=\"hljs-comment\">// ici on passe nos &quot;props&quot; react</span>\n  <span class=\"hljs-attr\">pageTitle</span>: <span class=\"hljs-string\">&quot;Test&quot;</span>,\n  <span class=\"hljs-attr\">pageContent</span>: markdownify(<span class=\"hljs-string\">&quot;Imaginons du **markdown** parsé&quot;</span>),\n  <span class=\"hljs-comment\">// vous pouvez bien entendu rajouter d&#x27;autres choses</span>\n  <span class=\"hljs-attr\">collections</span>: {\n    <span class=\"hljs-attr\">posts</span>: [\n      <span class=\"hljs-comment\">//...</span>\n    ],\n  },\n});\n\n<span class=\"hljs-keyword\">let</span> html;\n<span class=\"hljs-keyword\">try</span> {\n  html = react.renderToStaticMarkup(component);\n} <span class=\"hljs-keyword\">catch</span> (err) {\n  <span class=\"hljs-comment\">// Vous devrez gérer votre exception selon votre environnement</span>\n  <span class=\"hljs-comment\">// si c&#x27;est pour un test on peut simplement ne pas utiliser</span>\n  <span class=\"hljs-comment\">// try/catch, ça nous pètera à la gueule et c&#x27;est tant mieux</span>\n  <span class=\"hljs-keyword\">throw</span> err;\n}\n\n<span class=\"hljs-comment\">// maintenant vous faites ce que vous voulez de votre string html !</span>\n<span class=\"hljs-comment\">// ex: require(&quot;fs&quot;).writeFile(...)</span>\n</code></pre>\n<p>La méthode intéressante de React est dans notre cas <code>renderToStaticMarkup()</code> qui\nva nous générer un HTML qui va bien.</p>\n<p>Pour aller plus loin on pourrait décider d'utiliser <code>renderToString()</code> plutôt\nque <code>renderToStaticMarkup()</code> afin de pouvoir faire prendre le relais à React\ncôté client mais là\n<a href=\"/fr/articles/js/react/cote-serveur/\">le niveau de complexité est différent</a>.</p>\n<p>Pour la petite anecdote, notre site utilise actuellement\n<a href=\"http://www.metalsmith.io/\">metalsmith</a>, une petite bibliothèque simple mais qui\npermet par son API de faire des choses sympas.</p>\n<p>J'ai donc codé\n<a href=\"https://github.com/search?q=user%3AMoOx+metalsmith\">quelques plugins metalsmith</a>\ndont un <a href=\"https://github.com/MoOx/metalsmith-react\">metalsmith-react</a> à\nl'occasion.</p>\n<p>N'hésitez pas à consulter\n<a href=\"https://github.com/putaindecode/putaindecode.io\">le code source de notre site</a>\npour faire des découvertes sympas.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>