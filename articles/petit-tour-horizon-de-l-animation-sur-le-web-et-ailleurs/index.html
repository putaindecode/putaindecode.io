<!DOCTYPE html><html lang="fr"><head><title data-react-helmet="true">Petit tour d&#x27;horizon de l&#x27;animation sur le web (et ailleurs) | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><meta data-react-helmet="true" content="Petit tour d&#x27;horizon de l&#x27;animation sur le web (et ailleurs) | Putain de code" property="og:title"/><meta data-react-helmet="true" content="Petit tour d&#x27;horizon de l&#x27;animation sur le web (et ailleurs) | Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="Un article proposé par bloodyowl" name="description"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion="rpcss zx73cm 1lc6tyj 28v1b4">@-webkit-keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-zx73cm{from{opacity:0;-webkit-transform:translateY(20px);-moz-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}:root{--page-background-color:#fff;--page-slightly-accented-background-color:#F9F6F6;--page-accented-background-color:#E4EBEE;--page-text-color:#46515B;--link-text-color:#E51D58;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#FAF3E1;--one-percent-contrast-color:rgba(0, 0, 0, 0.1);--half-percent-contrast-color:rgba(0, 0, 0, 0.05);}@media (prefers-color-scheme: dark){:root{--page-background-color:#222;--page-slightly-accented-background-color:#171717;--page-accented-background-color:#111;--page-text-color:#ddd;--link-text-color:#F87098;--gradient-red-top:#E51D58;--gradient-red-bottom:#CC0613;--code-background-color:#4F3804;--one-percent-contrast-color:rgba(255, 255, 255, 0.1);--half-percent-contrast-color:rgba(255, 255, 255, 0.05);}}body{padding:0;margin:0;background-color:var(--page-background-color);color:var(--page-text-color);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}html{font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}a{color:var(--link-text-color);-webkit-text-decoration:underline;text-decoration:underline;}a:hover{-webkit-text-decoration:none;text-decoration:none;}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}*,*:before,*:after{box-sizing:border-box;}pre,.hljs{color:#adbac7;background:#22272e;}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067;}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb;}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-variable,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id{color:#6cb6ff;}.hljs-regexp,.hljs-string,.hljs-meta .hljs-string{color:#96d0ff;}.hljs-built_in,.hljs-symbol{color:#f69d50;}.hljs-comment,.hljs-code,.hljs-formula{color:#768390;}.hljs-name,.hljs-quote,.hljs-selector-tag,.hljs-selector-pseudo{color:#8ddb8c;}.hljs-subst{color:#adbac7;}.hljs-section{color:#316dca;font-weight:bold;}.hljs-bullet{color:#eac55f;}.hljs-emphasis{color:#adbac7;font-style:italic;}.hljs-strong{color:#adbac7;font-weight:bold;}.hljs-addition{color:#b4f1b4;background-color:#1b4721;}.hljs-deletion{color:#ffd8d3;background-color:#78191b;}</style><style data-emotion="rpcss 9vhaby">.rpcss-9vhaby{background-color:var(--gradient-red-bottom);background-image:linear-gradient(to bottom right, var(--gradient-red-top), var(--gradient-red-bottom));}</style><header class="rpcss-9vhaby" style="background-image:linear-gradient(to bottom right, hsl(13, 100%, 35%), hsl(11, 100%, 30%))"><style data-emotion="rpcss 1qqk0tr">.rpcss-1qqk0tr{padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);}</style><div class="rpcss-1qqk0tr"><style data-emotion="rpcss qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion="rpcss 7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion="rpcss gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion="rpcss 1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion="rpcss 13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion="rpcss 4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion="rpcss u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion="rpcss 1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255, 255, 255, 0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></div></header><style data-emotion="rpcss a4ric9">.rpcss-a4ric9{background-color:var(--page-slightly-accented-background-color);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="rpcss-a4ric9"><style data-emotion="rpcss oeugsb">.rpcss-oeugsb{-webkit-animation:500ms ease-out animation-zx73cm;animation:500ms ease-out animation-zx73cm;}</style><div class="rpcss-oeugsb"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Petit tour d&#x27;horizon de l&#x27;animation sur le web (et ailleurs)</h1><style data-emotion="rpcss obg2kr">.rpcss-obg2kr{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:var(--page-text-color);-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-obg2kr" href="https://github.com/bloodyowl"><style data-emotion="rpcss uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="bloodyowl" src="https://avatars.githubusercontent.com/bloodyowl?size=64"/><div>bloodyowl<!-- --> <!-- -->•<!-- --> <!-- -->2016/12/20</div></a><style data-emotion="rpcss 15kxmi0">.rpcss-15kxmi0{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-15kxmi0 h2,.rpcss-15kxmi0 h3,.rpcss-15kxmi0 h4,.rpcss-15kxmi0 h5,.rpcss-15kxmi0 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-15kxmi0 img{max-width:100%;background-color:rgba(255, 255, 255, 0.75);}.rpcss-15kxmi0 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:var(--code-background-color);margin:0 0.2em;}.rpcss-15kxmi0 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid var(--one-percent-contrast-color);-webkit-overflow-scrolling:touch;}.rpcss-15kxmi0 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-15kxmi0 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid var(--one-percent-contrast-color);font-style:italic;}.rpcss-15kxmi0 table{width:100%;text-align:center;}.rpcss-15kxmi0 figure{padding:20px 0;}.rpcss-15kxmi0 figcaption{text-align:center;}.rpcss-15kxmi0 a{word-wrap:break-word;}.rpcss-15kxmi0 table thead th{background-color:var(--page-accented-background-color);padding:10px 0;}</style><div class="rpcss-15kxmi0"><p>Les animations prennent une grande place dans les interfaces utilisateur. Loin
de n'apporter qu'un côté esthétique, elles augmentent la performance perçue,
améliorent notre expérience en nous aidant à nous repérer et en guidant notre
attention. Sur les applications natives, ces animations sont souvent plus
naturelles que sur le web, et pour cause, beaucoup de leurs animations sont des
<em>springs</em>.</p>
<p>Qu'est-ce qu'une animation <em>spring</em> ? Pour arriver à le définir, voyons comment
on a l'habitude de créer des animations avec les technologies web.</p>
<p>CSS possède deux propriétés permettant d'animer des valeurs: les <code>animation</code> et
les <code>transition</code>. Au delà de la différence entre leurs capacités au sein de CSS
(propriété VS ensemble de propriétés avec des étapes), les deux reposent sur le
même mécanisme. On va donc étudier le plus simple: <code>transition</code>.</p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.block</span> {
  <span class="hljs-attribute">transition</span>: <span class="hljs-number">300ms</span> linear transform;
}

<span class="hljs-selector-class">.block</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
}
</code></pre>
<p>Cette transition est définie sur un modèle simple : on fixe une durée
d'animation (ici <code>300ms</code>) et un easing —<em>ou <em>zizine</em> si vous écoutez
<a href="http://putaindecode.io/fr/articles/podcast/1/">le podcast</a></em>— qui est une
fonction d'interpolation (ici <code>linear</code>).</p>
<p>L'easing est une fonction toute bête comme vous avez pu en voir au collège et
les avez dessinées sur votre calculatrice Casio ou Texas (si comme moi vous
étiez le seul péquin de la classe à avoir l'autre modèle, à devoir toujours se
démerder parce que les profs savaient pas comment la vôtre marchait).</p>
<p>Bref, une fonction d'easing est assez simple. Par exemple, la <code>linear</code> ça
revient à :</p>
<p><img src="/public/images/articles/2016-12-20-petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs/Linear.png" alt="" /></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> linear = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x; <span class="hljs-comment">// such complicated</span>
<span class="hljs-comment">// didn&#x27;t even import `lodash.identity` from npm</span>
</code></pre>
<p>Le paramètre <code>x</code> varie entre <code>0</code> et <code>1</code>, c'est la progression de l'animation. Ce
paramètre vaut <code>0</code> quand vous êtes au début de l'animation et <code>1</code> à la fin.</p>
<p>En faisant à la main une version du système gérant l'animation, ça donne quelque
chose dans ce style :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> transition = <span class="hljs-function">(<span class="hljs-params">{ duration, easing, onUpdate, startValue, endValue }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> startDate = <span class="hljs-built_in">Date</span>.now(); <span class="hljs-comment">// le moment où commence l&#x27;animation</span>
  <span class="hljs-comment">// la fonction tick sera executée périodiquement</span>
  <span class="hljs-keyword">const</span> tick = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> absoluteProgress = (<span class="hljs-built_in">Date</span>.now() - startDate) / duration; <span class="hljs-comment">// on calcule `x`</span>
    <span class="hljs-keyword">const</span> progress = <span class="hljs-built_in">Math</span>.min(absoluteProgress, <span class="hljs-number">1</span>); <span class="hljs-comment">// on fait gaffe de pas déborder</span>
    <span class="hljs-keyword">const</span> progressWithEasing = easing(progress); <span class="hljs-comment">// on applique la fonction d&#x27;easing</span>
    <span class="hljs-comment">// pour calculer la valeur, on diminue progressivement la valeur initiale et l&#x27;on accroit la valeur finale</span>
    onUpdate(
      (<span class="hljs-number">1</span> - progressWithEasing) * startValue + progressWithEasing * endValue,
    );
    <span class="hljs-keyword">if</span> (progress &lt; <span class="hljs-number">1</span>) {
      <span class="hljs-comment">// si c&#x27;est pas fini, on repart pour un tour</span>
      requestAnimationFrame(tick);
    }
  };
  tick();
};

myElement.onclick = <span class="hljs-function">() =&gt;</span>
  transition({
    <span class="hljs-attr">duration</span>: <span class="hljs-number">500</span>,
    <span class="hljs-attr">easing</span>: <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x,
    <span class="hljs-attr">onUpdate</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span>
      (myElement.style.transform = <span class="hljs-string">`translateY(<span class="hljs-subst">${value + <span class="hljs-string">&quot;px&quot;</span>}</span>)`</span>),
    <span class="hljs-attr">startValue</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">endValue</span>: <span class="hljs-number">200</span>,
  });
</code></pre>
<p>Pour définir cette fonction d'easing, CSS vous permet également de configurer
des courbes de Bézier cubiques.</p>
<p>Une courbe de Bézier cubique se définit avec 4 points : <code>P0</code>, <code>P1</code>, <code>P2</code> et
<code>P3</code>. Il en est ensuite dérivé une courbe à partir de ces quatre points. C'est
avec ce mécanisme que fonctionne la plume de la plupart des logiciels d'édition
d'image.</p>
<p><img src="/public/images/articles/2016-12-20-petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs/Bezier.png" alt="" /></p>
<p>Vu que votre animation commence et finit à des valeurs définies à l'avance, deux
points sont fixés à l'avance : <code>P0</code> sera toujours <code>(0, 0)</code> et <code>P3</code> <code>(1, 1)</code>.</p>
<p>Vous avez avec CSS la liberté de définir <code>P1</code> et <code>P2</code> sous la forme
<code>cubic-bezier(P1x, P1y, P2x, P2y)</code>. Pour visualiser le fonctionnement, je vous
conseille de faire un tour sur <a href="http://cubic-bezier.com">cubic-bezier</a> de
<a href="https://twitter.com/leaverou">Lea Verou</a>.</p>
<p>Tout ce que nous avons vu jusque-là sont des animations <em>timées</em> (vive les
anglicismes). Leur durée est connue à l'avance et est immuable, les variations
possibles se feront dans les limites de ces contraintes.</p>
<p>Ces animations sont très pratiques pour certaines animations basiques et
rempliront très bien leur mission, mais elles peuvent rapidement avoir des
limites :</p>
<p>Avec CSS :</p>
<ul>
<li>On n'a aucun contrôle sur l'exécution de l'animation</li>
<li>Configurer des animations complexes complique la maintenance</li>
</ul>
<p>Avec un easing basique en général :</p>
<ul>
<li><code>cubic-bezier</code> limite énormément les possibilités d'évolution de la valeur
animée (e.g. on souhaite que l'animation ait de l'élasticité, les
timing-functions ne permettent de faire qu'un seul débord qui ne parait pas
&quot;naturel&quot;).</li>
<li>Avoir des animations cohérentes dans toute notre UI est extrêmement
contraignant avec CSS</li>
</ul>
<p>Pour l'élasticité, vous pouvez vous débrouiller avec <code>@keyframes</code>, hardcoder
toutes les valeurs, les <em>timer</em> à la main, y passer des heures pour vous
retrouver avec 60 étapes dans votre animation et au final de ne pas être
satisfait du résultat, claquer la porte de votre boulot et partir élever des
brebis dans les Pyrénées.</p>
<p>C'est là qu'interviennent les <em>springs</em>.</p>
<p>Une animation spring vous expose en général deux paramètres : <code>tension</code> et
<code>friction</code> (ou <code>stiffness</code>, pour rigidité &amp; <code>damping</code>, pour amortissement, selon
les systèmes). Ce sont des valeurs logiques dans ce contexte, puisqu'elles
viennent des lois de la physique (big up Newton).</p>
<p>Quelques exemples sur les
<a href="http://facebook.github.io/rebound-js/examples/">demos de Rebound.js</a> peuvent
vous aider à visualiser ce que représentent ces paramètres au sein de
l'animation.</p>
<p>Afin d'obéir à des lois &quot;logiques&quot; de la physique, l'animation spring doit
prendre en compte à chaque <code>tick</code> non seulement la valeur actuelle et celle
d'arrivée mais aussi sa rapidité actuelle : c'est ce qui lui permet d'enchaîner
naturellement les animations.</p>
<p>À chaque frame, il va exécuter la fonction suivante pour déterminer la <code>value</code>
et <code>velocity</code> à venir (note : ce côté est une simplification du code utilisé par
<a href="https://github.com/chenglou/react-motion">react-motion</a>).</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> unitOfTime = <span class="hljs-number">1</span> / <span class="hljs-number">60</span>; <span class="hljs-comment">// the number of seconds in a frame</span>
<span class="hljs-keyword">const</span> precision = <span class="hljs-number">0.01</span>;

<span class="hljs-keyword">const</span> step = <span class="hljs-function">(<span class="hljs-params">lastValue, lastVelocity, toValue, stiffness, damping</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> spring = -stiffness * (lastValue - toValue);
  <span class="hljs-keyword">const</span> damper = -damping * lastVelocity;

  <span class="hljs-keyword">const</span> all = spring + damper;
  <span class="hljs-keyword">const</span> nextVelocity = lastVelocity + all * unitOfTime;
  <span class="hljs-keyword">const</span> nextValue = lastValue + nextVelocity * unitOfTime;

  <span class="hljs-keyword">const</span> shouldRest =
    <span class="hljs-built_in">Math</span>.abs(nextVelocity) &lt; precision &amp;&amp;
    <span class="hljs-built_in">Math</span>.abs(nextValue - toValue) &lt; precision;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">velocity</span>: shouldRest ? <span class="hljs-number">0</span> : nextVelocity,
    <span class="hljs-attr">value</span>: shouldRest ? toValue : nextValue,
  };
};
</code></pre>
<p>Ensuite, une simple fonction <code>spring</code> qui reproduit à peu de choses près la
mécanique de notre <code>createTransition</code> vu plus haut :</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> spring = <span class="hljs-function">(<span class="hljs-params">{
  stiffness = <span class="hljs-number">180</span>,
  damping = <span class="hljs-number">12</span>,
  onRest = () =&gt; {},
  toValue,
}</span>) =&gt;</span> <span class="hljs-function"><span class="hljs-params">onUpdate</span> =&gt;</span> {
  <span class="hljs-keyword">let</span> frame;
  <span class="hljs-keyword">const</span> tick = <span class="hljs-function"><span class="hljs-params">curr</span> =&gt;</span> {
    <span class="hljs-comment">// on calcule l&#x27;état</span>
    <span class="hljs-keyword">const</span> { velocity, value } = step(
      curr.value,
      curr.velocity,
      toValue,
      stiffness,
      damping,
    );
    onUpdate({ velocity, value });
    <span class="hljs-comment">// si l&#x27;animation n&#x27;est pas terminée</span>
    <span class="hljs-keyword">if</span> (velocity !== <span class="hljs-number">0</span> || value !== toValue) {
      <span class="hljs-comment">// on programme la prochaine frame</span>
      frame = requestAnimationFrame(<span class="hljs-function">() =&gt;</span> tick({ value, velocity }));
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// sinon on prévient que l&#x27;animation est au repos</span>
      onRest();
    }
  };
  <span class="hljs-keyword">return</span> {
    <span class="hljs-comment">// afin de permettre aux animations de s&#x27;enchaîner, la fonction `start` prend l&#x27;état actuel de la valeur</span>
    <span class="hljs-attr">start</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
      frame = requestAnimationFrame(<span class="hljs-function">() =&gt;</span> tick(value));
    },
    <span class="hljs-attr">stop</span>: <span class="hljs-function">() =&gt;</span> {
      cancelAnimationFrame(frame);
    },
  };
};
</code></pre>
<p>Il nous reste à créer une classe &quot;observable&quot; <code>Value</code> qui conserve l'état et
l'animation active. Cela permet de stopper l'animation en cours avant de lancer
la suivante lorsque cela arrive.</p>
<pre><code class="hljs language-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Value</span> </span>{
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">initialValue</span>)</span> {
    <span class="hljs-built_in">this</span>.value = {
      <span class="hljs-attr">value</span>: initialValue,
      <span class="hljs-attr">velocity</span>: <span class="hljs-number">0</span>,
    };
    <span class="hljs-built_in">this</span>.listeners = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>();
    <span class="hljs-built_in">this</span>.animation = <span class="hljs-literal">null</span>;
  }
  <span class="hljs-function"><span class="hljs-title">addListener</span>(<span class="hljs-params">listener</span>)</span> {
    <span class="hljs-built_in">this</span>.listeners.add(listener);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">this</span>.listeners.delete(listener);
    };
  }
  <span class="hljs-function"><span class="hljs-title">updateValue</span>(<span class="hljs-params">nextValue</span>)</span> {
    <span class="hljs-built_in">this</span>.value = nextValue;
    <span class="hljs-built_in">this</span>.listeners.forEach(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> listener(<span class="hljs-built_in">this</span>.value.value));
  }
  <span class="hljs-function"><span class="hljs-title">animate</span>(<span class="hljs-params">animation</span>)</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.animation) {
      <span class="hljs-built_in">this</span>.animation.stop();
    }
    <span class="hljs-built_in">this</span>.animation = animation(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">this</span>.updateValue(v));
    <span class="hljs-built_in">this</span>.animation.start(<span class="hljs-built_in">this</span>.value);
  }
}
</code></pre>
<p>Et voilà, vous avez une animation :</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> scale = <span class="hljs-keyword">new</span> Value(<span class="hljs-number">1</span>);

scale.addListener(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> (myElement.style.transform = <span class="hljs-string">`scale(<span class="hljs-subst">${value}</span>)`</span>));

myElement.onmousedown = <span class="hljs-function">() =&gt;</span> {
  scale.animate(spring({ <span class="hljs-attr">toValue</span>: <span class="hljs-number">2</span> }));
};

myElement.onmouseup = <span class="hljs-function">() =&gt;</span> {
  scale.animate(spring({ <span class="hljs-attr">toValue</span>: <span class="hljs-number">1</span> }));
};
</code></pre>
<iframe width="100%" height="300" src="//jsfiddle.net/bloodyowl/36d0nc7r/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
<p>Les animations spring ont de nombreux avantages. Elles vous permettent
d'utiliser un vocabulaire cohérent avec celui du mouvement. Elles vous
permettent aussi de gérer de manière intelligente le timing de vos animations :
plus besoin de <em>hardcoder</em> le temps qu'elles doivent mettre ; seule la
description du mouvement compte. Aussi, vous n'avez plus à vous soucier des
changements de valeurs et de ses conséquences sur la cohérence globale d'une
animation : le système les gère et s'adapte.</p>
<p>Il existe plusieurs solutions pour les gérer :</p>
<ul>
<li>JS: <a href="http://facebook.github.io/rebound-js/examples/">Rebound.js</a></li>
<li>JS spécifique React: <a href="https://github.com/chenglou/react-motion">react-motion</a></li>
<li>JS spécifique React, utilisé par react-native:
<a href="https://github.com/animatedjs/animated">Animated</a></li>
<li>Java (Android): <a href="http://facebook.github.io/rebound/">Rebound</a></li>
<li>Objective-C/Swift (iOS): <a href="https://github.com/facebook/pop">Pop</a></li>
</ul>
<p>La team WebKit
<a href="https://twitter.com/webkit/status/748573524734812161">a également proposé</a>
l'ajout d'une fonction <code>spring</code> à CSS mais la discussion stagne (à tester dans
Safari Technology Preview).</p>
<p>En espérant que ça vous donne des idées d'animations cool à faire.</p>
<p>Bisous bisous.</p>
</div><style data-emotion="rpcss unyj6i">.rpcss-unyj6i{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:20px auto;padding:20px;background-color:var(--page-background-color);border-radius:10px;box-shadow:0 15px 15px -5px rgba(0, 0, 0, 0.2);}@media (max-width: 540px){.rpcss-unyj6i{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-unyj6i"><style data-emotion="rpcss ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion="rpcss klacsp">.rpcss-klacsp{width:0;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-klacsp"></div><style data-emotion="rpcss 1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Petit%20tour%20d&#x27;horizon%20de%20l&#x27;animation%20sur%20le%20web%20(et%20ailleurs)%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fpetit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs" target="_blank">Le partager sur Twitter</a></div><style data-emotion="rpcss x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion="rpcss gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion="rpcss 8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div></div><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 1vau6rl">.rpcss-1vau6rl{margin:20px 0;background-color:var(--page-accented-background-color);border-radius:10px;padding:20px;}</style><div class="rpcss-1vau6rl"><style data-emotion="rpcss 1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion="rpcss 1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion="rpcss 1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div></div><style data-emotion="rpcss zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-1qqk0tr"><div class="rpcss-qx7dny"><style data-emotion="rpcss 79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion="rpcss 1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion="rpcss lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion="rpcss um3i31">@media (max-width: 400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion="rpcss 12cp4l7">.rpcss-12cp4l7{color:rgba(255, 255, 255, 0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2021 Putain de code !</div><style data-emotion="rpcss 1w98uy3">.rpcss-1w98uy3{position:absolute;right:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1w98uy3" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs","v":{"_0":{"TAG":0,"_0":{"slug":"petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs","filename":"2016-12-20-petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs","title":"Petit tour d'horizon de l'animation sur le web (et ailleurs)","date":"Tue, 20 Dec 2016 00:00:00 GMT","draft":false,"meta":{"date":"2016-12-20T00:00:00.000Z","title":"Petit tour d'horizon de l'animation sur le web (et ailleurs)","author":"bloodyowl","oldSlug":"css/animations","slug":"petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs"},"body":"<p>Les animations prennent une grande place dans les interfaces utilisateur. Loin\nde n'apporter qu'un côté esthétique, elles augmentent la performance perçue,\naméliorent notre expérience en nous aidant à nous repérer et en guidant notre\nattention. Sur les applications natives, ces animations sont souvent plus\nnaturelles que sur le web, et pour cause, beaucoup de leurs animations sont des\n<em>springs</em>.</p>\n<p>Qu'est-ce qu'une animation <em>spring</em> ? Pour arriver à le définir, voyons comment\non a l'habitude de créer des animations avec les technologies web.</p>\n<p>CSS possède deux propriétés permettant d'animer des valeurs: les <code>animation</code> et\nles <code>transition</code>. Au delà de la différence entre leurs capacités au sein de CSS\n(propriété VS ensemble de propriétés avec des étapes), les deux reposent sur le\nmême mécanisme. On va donc étudier le plus simple: <code>transition</code>.</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.block</span> {\n  <span class=\"hljs-attribute\">transition</span>: <span class=\"hljs-number\">300ms</span> linear transform;\n}\n\n<span class=\"hljs-selector-class\">.block</span><span class=\"hljs-selector-pseudo\">:hover</span> {\n  <span class=\"hljs-attribute\">transform</span>: <span class=\"hljs-built_in\">scale</span>(<span class=\"hljs-number\">1.05</span>);\n}\n</code></pre>\n<p>Cette transition est définie sur un modèle simple : on fixe une durée\nd'animation (ici <code>300ms</code>) et un easing —<em>ou <em>zizine</em> si vous écoutez\n<a href=\"http://putaindecode.io/fr/articles/podcast/1/\">le podcast</a></em>— qui est une\nfonction d'interpolation (ici <code>linear</code>).</p>\n<p>L'easing est une fonction toute bête comme vous avez pu en voir au collège et\nles avez dessinées sur votre calculatrice Casio ou Texas (si comme moi vous\nétiez le seul péquin de la classe à avoir l'autre modèle, à devoir toujours se\ndémerder parce que les profs savaient pas comment la vôtre marchait).</p>\n<p>Bref, une fonction d'easing est assez simple. Par exemple, la <code>linear</code> ça\nrevient à :</p>\n<p><img src=\"/public/images/articles/2016-12-20-petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs/Linear.png\" alt=\"\" /></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> linear = <span class=\"hljs-function\"><span class=\"hljs-params\">x</span> =&gt;</span> x; <span class=\"hljs-comment\">// such complicated</span>\n<span class=\"hljs-comment\">// didn&#x27;t even import `lodash.identity` from npm</span>\n</code></pre>\n<p>Le paramètre <code>x</code> varie entre <code>0</code> et <code>1</code>, c'est la progression de l'animation. Ce\nparamètre vaut <code>0</code> quand vous êtes au début de l'animation et <code>1</code> à la fin.</p>\n<p>En faisant à la main une version du système gérant l'animation, ça donne quelque\nchose dans ce style :</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> transition = <span class=\"hljs-function\">(<span class=\"hljs-params\">{ duration, easing, onUpdate, startValue, endValue }</span>) =&gt;</span> {\n  <span class=\"hljs-keyword\">const</span> startDate = <span class=\"hljs-built_in\">Date</span>.now(); <span class=\"hljs-comment\">// le moment où commence l&#x27;animation</span>\n  <span class=\"hljs-comment\">// la fonction tick sera executée périodiquement</span>\n  <span class=\"hljs-keyword\">const</span> tick = <span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-keyword\">const</span> absoluteProgress = (<span class=\"hljs-built_in\">Date</span>.now() - startDate) / duration; <span class=\"hljs-comment\">// on calcule `x`</span>\n    <span class=\"hljs-keyword\">const</span> progress = <span class=\"hljs-built_in\">Math</span>.min(absoluteProgress, <span class=\"hljs-number\">1</span>); <span class=\"hljs-comment\">// on fait gaffe de pas déborder</span>\n    <span class=\"hljs-keyword\">const</span> progressWithEasing = easing(progress); <span class=\"hljs-comment\">// on applique la fonction d&#x27;easing</span>\n    <span class=\"hljs-comment\">// pour calculer la valeur, on diminue progressivement la valeur initiale et l&#x27;on accroit la valeur finale</span>\n    onUpdate(\n      (<span class=\"hljs-number\">1</span> - progressWithEasing) * startValue + progressWithEasing * endValue,\n    );\n    <span class=\"hljs-keyword\">if</span> (progress &lt; <span class=\"hljs-number\">1</span>) {\n      <span class=\"hljs-comment\">// si c&#x27;est pas fini, on repart pour un tour</span>\n      requestAnimationFrame(tick);\n    }\n  };\n  tick();\n};\n\nmyElement.onclick = <span class=\"hljs-function\">() =&gt;</span>\n  transition({\n    <span class=\"hljs-attr\">duration</span>: <span class=\"hljs-number\">500</span>,\n    <span class=\"hljs-attr\">easing</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">x</span> =&gt;</span> x,\n    <span class=\"hljs-attr\">onUpdate</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">value</span> =&gt;</span>\n      (myElement.style.transform = <span class=\"hljs-string\">`translateY(<span class=\"hljs-subst\">${value + <span class=\"hljs-string\">&quot;px&quot;</span>}</span>)`</span>),\n    <span class=\"hljs-attr\">startValue</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-attr\">endValue</span>: <span class=\"hljs-number\">200</span>,\n  });\n</code></pre>\n<p>Pour définir cette fonction d'easing, CSS vous permet également de configurer\ndes courbes de Bézier cubiques.</p>\n<p>Une courbe de Bézier cubique se définit avec 4 points : <code>P0</code>, <code>P1</code>, <code>P2</code> et\n<code>P3</code>. Il en est ensuite dérivé une courbe à partir de ces quatre points. C'est\navec ce mécanisme que fonctionne la plume de la plupart des logiciels d'édition\nd'image.</p>\n<p><img src=\"/public/images/articles/2016-12-20-petit-tour-horizon-de-l-animation-sur-le-web-et-ailleurs/Bezier.png\" alt=\"\" /></p>\n<p>Vu que votre animation commence et finit à des valeurs définies à l'avance, deux\npoints sont fixés à l'avance : <code>P0</code> sera toujours <code>(0, 0)</code> et <code>P3</code> <code>(1, 1)</code>.</p>\n<p>Vous avez avec CSS la liberté de définir <code>P1</code> et <code>P2</code> sous la forme\n<code>cubic-bezier(P1x, P1y, P2x, P2y)</code>. Pour visualiser le fonctionnement, je vous\nconseille de faire un tour sur <a href=\"http://cubic-bezier.com\">cubic-bezier</a> de\n<a href=\"https://twitter.com/leaverou\">Lea Verou</a>.</p>\n<p>Tout ce que nous avons vu jusque-là sont des animations <em>timées</em> (vive les\nanglicismes). Leur durée est connue à l'avance et est immuable, les variations\npossibles se feront dans les limites de ces contraintes.</p>\n<p>Ces animations sont très pratiques pour certaines animations basiques et\nrempliront très bien leur mission, mais elles peuvent rapidement avoir des\nlimites :</p>\n<p>Avec CSS :</p>\n<ul>\n<li>On n'a aucun contrôle sur l'exécution de l'animation</li>\n<li>Configurer des animations complexes complique la maintenance</li>\n</ul>\n<p>Avec un easing basique en général :</p>\n<ul>\n<li><code>cubic-bezier</code> limite énormément les possibilités d'évolution de la valeur\nanimée (e.g. on souhaite que l'animation ait de l'élasticité, les\ntiming-functions ne permettent de faire qu'un seul débord qui ne parait pas\n&quot;naturel&quot;).</li>\n<li>Avoir des animations cohérentes dans toute notre UI est extrêmement\ncontraignant avec CSS</li>\n</ul>\n<p>Pour l'élasticité, vous pouvez vous débrouiller avec <code>@keyframes</code>, hardcoder\ntoutes les valeurs, les <em>timer</em> à la main, y passer des heures pour vous\nretrouver avec 60 étapes dans votre animation et au final de ne pas être\nsatisfait du résultat, claquer la porte de votre boulot et partir élever des\nbrebis dans les Pyrénées.</p>\n<p>C'est là qu'interviennent les <em>springs</em>.</p>\n<p>Une animation spring vous expose en général deux paramètres : <code>tension</code> et\n<code>friction</code> (ou <code>stiffness</code>, pour rigidité &amp; <code>damping</code>, pour amortissement, selon\nles systèmes). Ce sont des valeurs logiques dans ce contexte, puisqu'elles\nviennent des lois de la physique (big up Newton).</p>\n<p>Quelques exemples sur les\n<a href=\"http://facebook.github.io/rebound-js/examples/\">demos de Rebound.js</a> peuvent\nvous aider à visualiser ce que représentent ces paramètres au sein de\nl'animation.</p>\n<p>Afin d'obéir à des lois &quot;logiques&quot; de la physique, l'animation spring doit\nprendre en compte à chaque <code>tick</code> non seulement la valeur actuelle et celle\nd'arrivée mais aussi sa rapidité actuelle : c'est ce qui lui permet d'enchaîner\nnaturellement les animations.</p>\n<p>À chaque frame, il va exécuter la fonction suivante pour déterminer la <code>value</code>\net <code>velocity</code> à venir (note : ce côté est une simplification du code utilisé par\n<a href=\"https://github.com/chenglou/react-motion\">react-motion</a>).</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">const</span> unitOfTime = <span class=\"hljs-number\">1</span> / <span class=\"hljs-number\">60</span>; <span class=\"hljs-comment\">// the number of seconds in a frame</span>\n<span class=\"hljs-keyword\">const</span> precision = <span class=\"hljs-number\">0.01</span>;\n\n<span class=\"hljs-keyword\">const</span> step = <span class=\"hljs-function\">(<span class=\"hljs-params\">lastValue, lastVelocity, toValue, stiffness, damping</span>) =&gt;</span> {\n  <span class=\"hljs-keyword\">const</span> spring = -stiffness * (lastValue - toValue);\n  <span class=\"hljs-keyword\">const</span> damper = -damping * lastVelocity;\n\n  <span class=\"hljs-keyword\">const</span> all = spring + damper;\n  <span class=\"hljs-keyword\">const</span> nextVelocity = lastVelocity + all * unitOfTime;\n  <span class=\"hljs-keyword\">const</span> nextValue = lastValue + nextVelocity * unitOfTime;\n\n  <span class=\"hljs-keyword\">const</span> shouldRest =\n    <span class=\"hljs-built_in\">Math</span>.abs(nextVelocity) &lt; precision &amp;&amp;\n    <span class=\"hljs-built_in\">Math</span>.abs(nextValue - toValue) &lt; precision;\n\n  <span class=\"hljs-keyword\">return</span> {\n    <span class=\"hljs-attr\">velocity</span>: shouldRest ? <span class=\"hljs-number\">0</span> : nextVelocity,\n    <span class=\"hljs-attr\">value</span>: shouldRest ? toValue : nextValue,\n  };\n};\n</code></pre>\n<p>Ensuite, une simple fonction <code>spring</code> qui reproduit à peu de choses près la\nmécanique de notre <code>createTransition</code> vu plus haut :</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">const</span> spring = <span class=\"hljs-function\">(<span class=\"hljs-params\">{\n  stiffness = <span class=\"hljs-number\">180</span>,\n  damping = <span class=\"hljs-number\">12</span>,\n  onRest = () =&gt; {},\n  toValue,\n}</span>) =&gt;</span> <span class=\"hljs-function\"><span class=\"hljs-params\">onUpdate</span> =&gt;</span> {\n  <span class=\"hljs-keyword\">let</span> frame;\n  <span class=\"hljs-keyword\">const</span> tick = <span class=\"hljs-function\"><span class=\"hljs-params\">curr</span> =&gt;</span> {\n    <span class=\"hljs-comment\">// on calcule l&#x27;état</span>\n    <span class=\"hljs-keyword\">const</span> { velocity, value } = step(\n      curr.value,\n      curr.velocity,\n      toValue,\n      stiffness,\n      damping,\n    );\n    onUpdate({ velocity, value });\n    <span class=\"hljs-comment\">// si l&#x27;animation n&#x27;est pas terminée</span>\n    <span class=\"hljs-keyword\">if</span> (velocity !== <span class=\"hljs-number\">0</span> || value !== toValue) {\n      <span class=\"hljs-comment\">// on programme la prochaine frame</span>\n      frame = requestAnimationFrame(<span class=\"hljs-function\">() =&gt;</span> tick({ value, velocity }));\n    } <span class=\"hljs-keyword\">else</span> {\n      <span class=\"hljs-comment\">// sinon on prévient que l&#x27;animation est au repos</span>\n      onRest();\n    }\n  };\n  <span class=\"hljs-keyword\">return</span> {\n    <span class=\"hljs-comment\">// afin de permettre aux animations de s&#x27;enchaîner, la fonction `start` prend l&#x27;état actuel de la valeur</span>\n    <span class=\"hljs-attr\">start</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">value</span> =&gt;</span> {\n      frame = requestAnimationFrame(<span class=\"hljs-function\">() =&gt;</span> tick(value));\n    },\n    <span class=\"hljs-attr\">stop</span>: <span class=\"hljs-function\">() =&gt;</span> {\n      cancelAnimationFrame(frame);\n    },\n  };\n};\n</code></pre>\n<p>Il nous reste à créer une classe &quot;observable&quot; <code>Value</code> qui conserve l'état et\nl'animation active. Cela permet de stopper l'animation en cours avant de lancer\nla suivante lorsque cela arrive.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Value</span> </span>{\n  <span class=\"hljs-function\"><span class=\"hljs-title\">constructor</span>(<span class=\"hljs-params\">initialValue</span>)</span> {\n    <span class=\"hljs-built_in\">this</span>.value = {\n      <span class=\"hljs-attr\">value</span>: initialValue,\n      <span class=\"hljs-attr\">velocity</span>: <span class=\"hljs-number\">0</span>,\n    };\n    <span class=\"hljs-built_in\">this</span>.listeners = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Set</span>();\n    <span class=\"hljs-built_in\">this</span>.animation = <span class=\"hljs-literal\">null</span>;\n  }\n  <span class=\"hljs-function\"><span class=\"hljs-title\">addListener</span>(<span class=\"hljs-params\">listener</span>)</span> {\n    <span class=\"hljs-built_in\">this</span>.listeners.add(listener);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =&gt;</span> {\n      <span class=\"hljs-built_in\">this</span>.listeners.delete(listener);\n    };\n  }\n  <span class=\"hljs-function\"><span class=\"hljs-title\">updateValue</span>(<span class=\"hljs-params\">nextValue</span>)</span> {\n    <span class=\"hljs-built_in\">this</span>.value = nextValue;\n    <span class=\"hljs-built_in\">this</span>.listeners.forEach(<span class=\"hljs-function\"><span class=\"hljs-params\">listener</span> =&gt;</span> listener(<span class=\"hljs-built_in\">this</span>.value.value));\n  }\n  <span class=\"hljs-function\"><span class=\"hljs-title\">animate</span>(<span class=\"hljs-params\">animation</span>)</span> {\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span>.animation) {\n      <span class=\"hljs-built_in\">this</span>.animation.stop();\n    }\n    <span class=\"hljs-built_in\">this</span>.animation = animation(<span class=\"hljs-function\"><span class=\"hljs-params\">v</span> =&gt;</span> <span class=\"hljs-built_in\">this</span>.updateValue(v));\n    <span class=\"hljs-built_in\">this</span>.animation.start(<span class=\"hljs-built_in\">this</span>.value);\n  }\n}\n</code></pre>\n<p>Et voilà, vous avez une animation :</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">const</span> scale = <span class=\"hljs-keyword\">new</span> Value(<span class=\"hljs-number\">1</span>);\n\nscale.addListener(<span class=\"hljs-function\"><span class=\"hljs-params\">value</span> =&gt;</span> (myElement.style.transform = <span class=\"hljs-string\">`scale(<span class=\"hljs-subst\">${value}</span>)`</span>));\n\nmyElement.onmousedown = <span class=\"hljs-function\">() =&gt;</span> {\n  scale.animate(spring({ <span class=\"hljs-attr\">toValue</span>: <span class=\"hljs-number\">2</span> }));\n};\n\nmyElement.onmouseup = <span class=\"hljs-function\">() =&gt;</span> {\n  scale.animate(spring({ <span class=\"hljs-attr\">toValue</span>: <span class=\"hljs-number\">1</span> }));\n};\n</code></pre>\n<iframe width=\"100%\" height=\"300\" src=\"//jsfiddle.net/bloodyowl/36d0nc7r/embedded/\" allowfullscreen=\"allowfullscreen\" frameborder=\"0\"></iframe>\n<p>Les animations spring ont de nombreux avantages. Elles vous permettent\nd'utiliser un vocabulaire cohérent avec celui du mouvement. Elles vous\npermettent aussi de gérer de manière intelligente le timing de vos animations :\nplus besoin de <em>hardcoder</em> le temps qu'elles doivent mettre ; seule la\ndescription du mouvement compte. Aussi, vous n'avez plus à vous soucier des\nchangements de valeurs et de ses conséquences sur la cohérence globale d'une\nanimation : le système les gère et s'adapte.</p>\n<p>Il existe plusieurs solutions pour les gérer :</p>\n<ul>\n<li>JS: <a href=\"http://facebook.github.io/rebound-js/examples/\">Rebound.js</a></li>\n<li>JS spécifique React: <a href=\"https://github.com/chenglou/react-motion\">react-motion</a></li>\n<li>JS spécifique React, utilisé par react-native:\n<a href=\"https://github.com/animatedjs/animated\">Animated</a></li>\n<li>Java (Android): <a href=\"http://facebook.github.io/rebound/\">Rebound</a></li>\n<li>Objective-C/Swift (iOS): <a href=\"https://github.com/facebook/pop\">Pop</a></li>\n</ul>\n<p>La team WebKit\n<a href=\"https://twitter.com/webkit/status/748573524734812161\">a également proposé</a>\nl'ajout d'une fonction <code>spring</code> à CSS mais la discussion stagne (à tester dans\nSafari Technology Preview).</p>\n<p>En espérant que ça vous donne des idées d'animations cool à faire.</p>\n<p>Bisous bisous.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><head><script defer="defer" src="/public/main.56c69761a03eb0112696.js"></script></head></html>