{"slug":"dependances-et-premier-projet-en-ruby","filename":"2014-10-14-dependances-et-premier-projet-en-ruby","title":"Dépendances et premier projet en Ruby","date":"Tue, 14 Oct 2014 00:00:00 GMT","draft":false,"meta":{"date":"2014-10-14T00:00:00.000Z","title":"Dépendances et premier projet en Ruby","author":"rhannequin","oldSlug":"ruby/bundler","slug":"dependances-et-premier-projet-en-ruby"},"body":"<p><a href=\"#tl-dr\">tl;dr</a></p>\n<p>Dans l'<a href=\"/fr/articles/ruby/premiers-pas/\">article précédent</a> nous avons installé\nRuby. Désormais nous allons aborder les gems, les dépendances et commencer notre\nweb service.</p>\n<p>Un gem en Ruby c'est une lib, comme un paquet NPM pour NodeJS. C'est d'ailleurs\nle système de rubygems qui a inspiré le système de NPM. Pour installer un gem,\nrien de plus simple que <code>gem install sass</code>, qui ici va installer la bibliothèque\n<code>sass</code>.</p>\n<p>Un projet Ruby nécessite la plupart du temps des bibliothèques afin de ne pas\ntout faire soi-même, il est donc nécessaire d'avoir une gestion des dépendances\npour le projet.</p>\n<h2>Bundler, le gem qui gère les gems</h2>\n<p><a href=\"http://bundler.io\">Bundler</a> est un gem qui va vous permettre de créer un\nfichier Gemfile contenant vos dépendances, et qui vous installera les gems\nnécessaires avec la gestion des versions et de leurs propres dépendances. Un\nfichier Gemfile se présente comme ceci :</p>\n<pre><code class=\"hljs language-ruby\">source <span class=\"hljs-string\">&#x27;https://rubygems.org&#x27;</span>\nruby <span class=\"hljs-string\">&#x27;2.1.2&#x27;</span>\ngem <span class=\"hljs-string\">&#x27;sinatra&#x27;</span>\n</code></pre>\n<p>L'instruction <code>source</code> permet de préciser l'url des dépôts de gems. La version\nde ruby n'est pas obligatoire mais j'aime la préciser pour ne pas me mélanger\ndans mes projets avec différentes versions de Ruby (voir le\n<a href=\"/fr/articles/ruby/premiers-pas/\">précédent article pour les versions du Ruby</a>\net <a href=\"https://github.com/sstephenson/rbenv\">rbenv</a>). Et enfin, la déclaration de\nnotre première bibliothèque de dépendance : <a href=\"http://www.sinatrarb.com\">Sinatra</a>.</p>\n<p>Il est possible d'être bien plus précis dans le Gemfile, comme...</p>\n<p>Préciser dans quel environnement charger les gems :</p>\n<pre><code class=\"hljs language-ruby\">gem <span class=\"hljs-string\">&#x27;sqlite3&#x27;</span>, <span class=\"hljs-symbol\">group:</span> [<span class=\"hljs-symbol\">:development</span>, <span class=\"hljs-symbol\">:test</span>]\n</code></pre>\n<p>Une numéro de version :</p>\n<pre><code class=\"hljs language-ruby\">gem <span class=\"hljs-string\">&#x27;rails&#x27;</span>, <span class=\"hljs-string\">&#x27;4.1.6&#x27;</span>         <span class=\"hljs-comment\"># version 4.1.6</span>\ngem <span class=\"hljs-string\">&#x27;sass-rails&#x27;</span>, <span class=\"hljs-string\">&#x27;~&gt; 4.0.3&#x27;</span> <span class=\"hljs-comment\"># &gt;= 4.0.3 mais &lt; 4.1.0</span>\n</code></pre>\n<p>Préciser la classe à charger :</p>\n<pre><code class=\"hljs language-ruby\">gem <span class=\"hljs-string\">&#x27;valid_email&#x27;</span>, <span class=\"hljs-symbol\">require:</span> <span class=\"hljs-string\">&#x27;valid_email/email_validator&#x27;</span>\n</code></pre>\n<p>Aller chercher directement sur Github :</p>\n<pre><code class=\"hljs language-ruby\">gem <span class=\"hljs-string\">&#x27;nokogiri&#x27;</span>, <span class=\"hljs-symbol\">github:</span> <span class=\"hljs-string\">&#x27;sparklemotion/nokogiri&#x27;</span>\n<span class=\"hljs-comment\"># https://github.com/sparklemotion/nokogiri.git</span>\n\ngem <span class=\"hljs-string\">&#x27;rails&#x27;</span>, <span class=\"hljs-symbol\">github:</span> <span class=\"hljs-string\">&#x27;rails&#x27;</span>\n<span class=\"hljs-comment\"># https://github.com/rails/rails.git</span>\n\ngem <span class=\"hljs-string\">&#x27;rails&#x27;</span>, <span class=\"hljs-symbol\">github:</span> <span class=\"hljs-string\">&#x27;rails&#x27;</span>, <span class=\"hljs-symbol\">branch:</span> <span class=\"hljs-string\">&#x27;4-1-stable&#x27;</span>\n<span class=\"hljs-comment\"># https://github.com/rails/rails.git sur la branche 4-1-stable</span>\n</code></pre>\n<p>Il existe encore d'autres instructions, de quoi rendre sa gestion des\ndépendances vraiment fine et précise.</p>\n<p>Une fois le Gemfile prêt, bundler a plusieurs commandes de disponibles pour\npouvoir les télécharger et utiliser.</p>\n<ul>\n<li><code>$ bundle install</code> installera les gems requis</li>\n<li><code>$ bundle update</code> mettra à jour vers les versions les plus récentes si\npossible les gems requis</li>\n<li><code>$ bundle exec</code> permettra de précéder une commande ruby afin de l'exécuter\ndans le contexte du Gemfile, très utile lorsque l'on a différentes versions de\nRuby qui se baladent dans le terminal</li>\n</ul>\n<p>Bundler va générer un fichier <code>Gemfile.lock</code> qui est la description exhaustive\ndes dépendances de votre application, chaque gem avec le numéro de sa version\ninstallée, chaque dépendance pour chaque gem, une jolie arborescence plus que\nprécise.</p>\n<h2>Commençons notre web service</h2>\n<p>Assez parlé des outils qui existent, utilisons-les. Tout d'abord installons\nBundler, sans oublier le <code>$ rbenv rehash</code> nécessaire si vous utilisez rbenv pour\nvos versions de Ruby afin de mettre à jour les commandes disponibles dans le\nterminal :</p>\n<pre><code>$ gem install bundler\n$ rbenv rehash\n</code></pre>\n<p>Pour notre première application, nous allons faire un web service avec Sinatra\nqui est un micro-framework web, ayant d'ailleurs clairement inspiré Express\n(&quot;Sinatra inspired web development framework for node.js&quot;). Notre Gemfile va\ndonc être exactement comme notre premier exemple :</p>\n<pre><code class=\"hljs language-ruby\">source <span class=\"hljs-string\">&#x27;https://rubygems.org&#x27;</span>\nruby <span class=\"hljs-string\">&#x27;2.1.2&#x27;</span>\ngem <span class=\"hljs-string\">&#x27;sinatra&#x27;</span>\n</code></pre>\n<p>Un petit <code>bundle install</code> et nous sommes prêts à démarrer !</p>\n<p>Pour ne pas brusquer les choses, nous allons faire la version la plus simple\nd'un web service avec Sinatra, ce qui nous permettra de constater la simplicité\nextrême de Ruby et du framework :</p>\n<pre><code class=\"hljs language-ruby\"><span class=\"hljs-comment\">########</span>\n<span class=\"hljs-comment\"># app.rb</span>\n<span class=\"hljs-comment\">#</span>\n\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;sinatra&#x27;</span>\n\nget <span class=\"hljs-string\">&#x27;/&#x27;</span> <span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-string\">&#x27;Hello World!&#x27;</span>\n<span class=\"hljs-keyword\">end</span>\n</code></pre>\n<p>Qu'avons-nous fait là ? Pas grand chose, et en même temps tout juste ce qu'il\nfaut. Nous avons inclus le gem à notre script et utilisé la méthode Sinatra\n<code>get</code> nous permettant de déclarer un point d'entrée en <code>GET</code> sur la route '/'.\nCette méthode prend également comme argument un <code>block</code> caractérisé par le <code>do</code>\net le <code>end</code>. La dernière valeur du block étant la valeur de retour, nous\nrenvoyons la seule chaîne de caractères &quot;Hello World!&quot;.</p>\n<p>Et maintenant : lancement ! <code>$ bundle exec ruby app.rb</code> va lancer l'application\n(mais <code>ruby app.rb</code> suffit), par défaut sur le port <code>4567</code>. Regardez vite\n<a href=\"http://localhost:4567\">http://localhost:4567</a> et là magie, &quot;Hello World!&quot; sur\nune magnifique page blanche, notre tout premier web service est fonctionnel.</p>\n<p>Alors oui, ce n'est pas une révolution. Mais tout de même, en réduisant la\nsyntaxe du block on se retrouve avec un script de deux lignes qui crée un vrai\nweb service web. Et vous allez vite voir qu'en quelques lignes de plus on peut\nvite complexifier le bousin.</p>\n<h2>Au prochain épisode</h2>\n<p>Dans l'article suivant nous allons ajouter des fonctionnalités à notre toute\nnouvelle application, de nouvelles routes, de la persistence et aussi des vues\ndans un format un peu plus utile.</p>\n<p>Stay tuned!</p>\n<h2>tl;dr</h2>\n<p>Voici la version abrégée de cet article :</p>\n<pre><code class=\"hljs language-ruby\"><span class=\"hljs-comment\"># Gemfile</span>\nsource <span class=\"hljs-string\">&#x27;https://rubygems.org&#x27;</span>\nruby <span class=\"hljs-string\">&#x27;2.1.2&#x27;</span>\ngem <span class=\"hljs-string\">&#x27;sinatra&#x27;</span>\n</code></pre>\n<pre><code class=\"hljs language-ruby\"><span class=\"hljs-comment\"># app.rb</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;sinatra&#x27;</span>\nget <span class=\"hljs-string\">&#x27;/&#x27;</span> <span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-string\">&#x27;Hello World!&#x27;</span>\n<span class=\"hljs-keyword\">end</span>\n</code></pre>\n<pre><code class=\"hljs language-console\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> gem install bundler</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> rbenv <span class=\"hljs-built_in\">rehash</span></span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> bundle install</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> ruby app.rb</span>\n</code></pre>\n<h2>Sources</h2>\n<ul>\n<li><a href=\"https://rubygems.org\">RubyGems</a></li>\n<li><a href=\"http://bundler.io\">Bundler</a></li>\n<li><a href=\"https://github.com/sstephenson/rbenv\">rbenv</a></li>\n<li><a href=\"http://www.sinatrarb.com\">Sinatra</a> et surtout son\n<a href=\"http://www.sinatrarb.com/intro.html\">README</a></li>\n</ul>\n"}