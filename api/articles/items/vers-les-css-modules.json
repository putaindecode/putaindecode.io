{"slug":"vers-les-css-modules","filename":"2016-02-23-vers-les-css-modules","title":"Vers les CSS modules","date":"Tue, 23 Feb 2016 00:00:00 GMT","draft":false,"meta":{"date":"2016-02-23T00:00:00.000Z","title":"Vers les CSS modules","author":"thibthib","oldSlug":"css/modules","slug":"vers-les-css-modules"},"body":"<blockquote>\n<p>Je crois que m√™me avant que je sache exactement ce qu'√©tait le CSS, j'avais\nd√©j√† entendu quelqu'un me dire &quot;Je HAIS le CSS&quot;. Cette phrase √©tait souvent\ndite par un de mes amis du back-end, et souvent pour de tr√®s bonnes raisons.\nCet article n'essaiera pas de d√©fendre ni de vous faire aimer le CSS, mais\ncomme les outils de d√©veloppement front-end √©voluent rapidement, je trouve\nint√©ressant d'expliquer les nouvelles fa√ßons d'√©crire le CSS.</p>\n</blockquote>\n<h2>Retour aux bases</h2>\n<p>D'abord, pour comprendre quel sont les probl√®mes que les nouveaux outils tentent\nde r√©soudre, un petit rappel sur ce qu'est le CSS : <em>Cascading Style Sheets</em> ou\n<em>Feuilles de style en cascade</em>.</p>\n<p>Une feuille de style ? C'est facile ! C'est un bout de code qui lie des &quot;styles&quot;\n√† du HTML. En cascade ? Et bien, quelques fois un √©l√©ment HTML peut correspondre\n√† plusieurs styles, et &quot;en cascade&quot; est le groupe de r√®gles qui permet de\nd√©terminer lequel appliquer.</p>\n<p>Voici du code CSS basique : nous voulons que nos titres h1 soient rouges.</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">h1</span> {\n  <span class=\"hljs-attribute\">color</span>: red;\n}\n</code></pre>\n<p>Ici, nous lions la <strong><em>r√®gle (ou d√©claration)</em></strong> <code>color: red</code> au <strong><em>s√©lecteur</em></strong>\n&quot;h1&quot;. Un s√©lecteur peut contenir plusieurs r√®gles dans son bloc de d√©clarations.</p>\n<blockquote>\n<p>Et les derni√®res lueurs de bonheur s'√©teignent alors que nous entrons dans\nl'enfer de la cascade</p>\n</blockquote>\n<h2>Le truc qui cascade</h2>\n<p>La cascade est pour moi un d√©sastre qui rend le CSS tr√®s compliqu√© √† maintenir\nsi on ne suit pas de lignes directrices ou on n'utilise pas d'outils pour\nl'√©crire. Je vais vous montrer quelques exemples simples pour vous expliquer les\nprincipaux concepts de la cascade, mais gardez en t√™te que la plupart des\napplications web contiennent de nos jours beaucoup de code, aggravant les effets\nde la cascade.</p>\n<p>La n√©cessit√© d'avoir un syst√®me comme la cascade vient du fait que le CSS permet\n√† plusieurs r√®gles de style de s'appliquer √† un m√™me √©l√©ment, ces derni√®res\npouvant m√™me venir de plusieurs origines (du site, mais aussi du navigateur ou\nencore m√™me de l'utilisateur). Il faut donc pouvoir d√©finir dans ce cas-l√†\nquelle est la r√®gle qui au final sera appliqu√©e. Pour cela, la cascade donne √†\nchacune un poids, calcul√© selon un certain nombre de crit√®res, et applique la\nr√®gle la plus lourde. Cela peut paraitre simple au premier abord, mais les\ncrit√®res de calcul de poids ne le sont pas du tout.</p>\n<p>Les r√®gles qui sont les plus l√©g√®res dans la cascade ne sont pas vraiment un\nprobl√®me, mais il faut les connaitre afin de s'√©viter des surprises :</p>\n<h3>Les valeurs par d√©faut du navigateur</h3>\n<p>Voici le haut de la cascade. Ce sont les r√®gles qui font qu'un titre h1 est gros\nm√™me si on ne l'a pas sp√©cifi√©.</p>\n<h3>L'h√©ritage des parents</h3>\n<p>Ensuite, les r√®gles sont h√©rit√©es depuis les √©l√©ments HTML parents. Si on\nreprend notre √©l√©ment h1, si une r√®gle <code>color: blue</code> est d√©finie sur l'√©l√©ment\n<code>body</code>, le titre va en h√©riter, et sera donc bleu.</p>\n<p>Ceci √©tant dit, on entre maintenant dans un niveau plus douloureux de la\ncascade.</p>\n<h3>L'ordre des r√®gles</h3>\n<p>La position d'une r√®gle par rapport aux autres va influer sur son poids. Deux\nr√®gles auraient pu avoir le m√™me poids si elles √©taient √† la m√™me position mais,\nau final, c'est la derni√®re qui sera la plus lourde et sera donc appliqu√©e.\n<strong><em>La derni√®re.</em></strong> Quand il s'agit de code assez simple, cela peut √™tre\nfacilement compr√©hensible :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">h1</span> {\n  <span class=\"hljs-attribute\">color</span>: red;\n  <span class=\"hljs-attribute\">color</span>: blue;\n}\n</code></pre>\n<p>Facile, n'est-ce pas ? Le titre sera bleu ! Mais s'il y a une r√®gle <code>color: red</code>\ndans un fichier CSS nomm√© <em>foo.css</em>, et une r√®gle <code>color: blue</code> dans un autre\nfichier nomm√© <em>bar.css</em>, que le fichier <em>foo.css</em> met plus de temps que le\nfichier <em>bar.css</em> √† charger, mais que le tag HTML r√©f√©ren√ßant <em>foo.css</em> est\navant celui de <em>bar.css</em>, quelle r√®gle est appliqu√©e ? Eh bien, c'est plus\ncompliqu√© √† savoir. <em>(indice : le temps de chargement n'est pas pris en compte)</em></p>\n<h3>La sp√©cificit√© des s√©lecteurs</h3>\n<p>Ce crit√®re est un niveau de complexit√© au-dessus des autres,\n<a href=\"https://specificity.keegan.st\">si bien que des personnes en ont fait des calculettes pour le simplifier</a>.\nJe ne vais pas rentrer dans les d√©tails, mais il faut savoir que le poids d'un\ns√©lecteur est √©gal √† la somme des poids de tous les s√©lecteurs le composant. Et\nque tous les s√©lecteurs n'ont pas le m√™me poids.</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.title</span> {\n  <span class=\"hljs-attribute\">color</span>: red;\n}\n\n<span class=\"hljs-selector-tag\">body</span> <span class=\"hljs-selector-tag\">header</span> <span class=\"hljs-selector-tag\">h1</span> {\n  <span class=\"hljs-attribute\">color</span>: blue;\n}\n</code></pre>\n<p>Ici, le premier s√©lecteur p√®se 10 parce qu'il contient un s√©lecteur de classe\nCSS, qui p√®se lui-m√™me 10. Le deuxi√®me s√©lecteur quant √† lui p√®se 3, parce qu'il\ncontient trois s√©lecteurs de tag, pesant chacun 1. Et donc, comme 10 &gt; 3, le\ntitre h1 sera rouge !</p>\n<h3>Les styles inline</h3>\n<p>Les r√®gles qui sont dans l'attribut ‚Äústyle‚Äù d'un √©l√©ment HTML sont plus lourdes\nque n'importe quel s√©lecteur d√©fini pr√©c√©demment. Et donc voici un titre bleu :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">h1</span> {\n  <span class=\"hljs-attribute\">color</span>: red;\n}\n</code></pre>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;color: blue;&quot;</span>&gt;</span>Title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n</code></pre>\n<h3>Importance</h3>\n<p>Et enfin le dernier crit√®re, le God Mode, le broyeur de styles, le mot-cl√©\n<strong><em>!important.</em></strong> Quand on veut VRAIMENT que le titre soit rouge :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">h1</span> {\n  <span class=\"hljs-attribute\">color</span>: red <span class=\"hljs-meta\">!important</span>;\n}\n</code></pre>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&quot;color: blue;&quot;</span>&gt;</span>Title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n</code></pre>\n<p>Et comme toute la cascade est √† propos de poids, si deux r√®gles sont marqu√©es\ncomme !important, le reste des crit√®res est toujours pris en compte pour\ncalculer laquelle est la plus lourde, et donc appliqu√©e.</p>\n<p><strong>‚Ä¶Et on ne peut pas faire plus compliqu√© que √ßa.</strong> Maintenant, imaginez des\nmilliers et des milliers de s√©lecteurs et r√®gles cascadant les uns sur les\nautres pour d√©finir le style d'un site, et vous comprendrez l'enfer que peut\n√™tre le CSS. Ainsi, des d√©veloppeurs CSS ont imagin√© diff√©rentes m√©thodologies\net outils pour √©viter ce cauchemar !</p>\n<h2>L'√©volution des outils</h2>\n<p>Maintenant, je vais vous pr√©senter comment ma fa√ßon d'√©crire du CSS a √©volu√© au\nfil du temps. Ne vous attendez pas √† une chronologie compl√®te de tous les outils\ninvent√©s depuis la cr√©ation du CSS en 1996 (j'avais 6 ans !) mais plut√¥t une\nexplication de comment je me suis d√©brouill√© avec la cascade dans ma courte\nexp√©rience personnelle.</p>\n<h3>Pr√©-processeurs</h3>\n<p>J'ai commenc√© √† developper des applications web en 2012, en plein √¢ge d'or\n<a href=\"/fr/articles/css/preprocesseurs/\">des pr√©-processeurs</a>. Ils √©taient apparus\nquelques ann√©es auparavant, comme le CSS lui-m√™me n'√©tait pas suffisamment\nadapt√© pour construire des sites complexes. Les pr√©-processeurs sont des\ncompilateurs qui g√©n√®rent du code CSS √† partir de languages l√©g√®rement\ndiff√©rents, comme <a href=\"http://sass-lang.com\">Sass</a> ou <a href=\"http://lesscss.org\">LESS</a>.\nCes nouveaux languages permettent de cr√©er des variables par exemple, ou\nd'imbriquer des s√©lecteurs, entre autres merveilleuses nouvelles\nfonctionnalit√©s.</p>\n<p>On peut transformer ce vieux code CSS compliqu√© √† maintenir :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">body</span> {\n  <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#e5e5e5</span>;\n}\n\n<span class=\"hljs-selector-tag\">body</span> <span class=\"hljs-selector-tag\">h1</span> {\n  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#333333</span>;\n}\n</code></pre>\n<p>en cette bien <em>meilleure</em> version :</p>\n<pre><code class=\"hljs language-scss\"><span class=\"hljs-variable\">$textColor</span>: <span class=\"hljs-number\">#333333</span>;\n\n<span class=\"hljs-selector-tag\">body</span> {\n  <span class=\"hljs-attribute\">background</span>: lighten(<span class=\"hljs-variable\">$textColor</span>, <span class=\"hljs-number\">90%</span>);\n\n  <span class=\"hljs-selector-tag\">h1</span> {\n    <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-variable\">$textColor</span>;\n  }\n}\n</code></pre>\n<p>Avec ces nouveaux outils, et pour √©viter aux r√®gles d'entrer en collision dans\nla cascade, nous avons commenc√© √† imbriquer nos s√©lecteurs et √† r√©pliquer toute\nnotre structure HTML dans le code de notre pr√©-processeur favori. Notre CSS se\nretrouva donc avec des s√©lecteurs tr√®s long et lourds qui √©taient associ√©s\nuniquement avec un element HTML pr√©cis, comme ce dernier :</p>\n<blockquote>\n<p>.searchPage .sideBar .refinements.default .category .star input</p>\n</blockquote>\n<p>Et √ßa a plut√¥t bien march√© au d√©but ! Mais ces s√©lecteurs n'√©taient pas les plus\nperformants, et la structure du HTML √©tant r√©pliqu√©e, n'importe quel changement\ndans cette derni√®re doit √™tre r√©percut√© dans les styles. Donc je suis pass√© √†\nautre chose.</p>\n<h3>M√©thodologies CSS</h3>\n<p>√Ä ce moment, quelques nouvelles guidelines CSS ont commenc√© a attirer mon\nattention. On pouvait les utiliser avec les pr√©-processeurs, et avaient pour but\nd'√©viter les collisions dans la cascade (tout comme l'imbrication des\ns√©lecteurs) avec un certain nombre de r√®gles, comme sur le nommage des\ns√©lecteurs.</p>\n<p>Ces m√©thodologies sont arriv√©es au moment ou je commen√ßais √† d√©couper mes\nd√©veloppements en composants. L'imbrication des s√©lecteurs ne marchait pas tr√®s\nbien avec ces derniers, vu que le but est de cr√©er des bouts de code\nr√©utilisables partout dans la web app, comme un bouton par exemple. La\nm√©thodologie que j'utilise (toujours aujourd'hui) est appel√©e\n<a href=\"/fr/articles/css/bem/\">BEM, pour Block Element Modifier</a>, mais il y en a\nd'autres avec le m√™me but : chaque √©l√©ment HTML de mes composants doit avoir une\nclasse CSS qui lui est unique. De cette fa√ßon, pas besoin d'imbrication, et pas\nde collision de la cascade !</p>\n<p>Et ce code de pr√©-processeur :</p>\n<pre><code class=\"hljs language-scss\"><span class=\"hljs-selector-tag\">h1</span> {\n  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-variable\">$textColor</span> img {\n    border: <span class=\"hljs-number\">1px</span> solid black;\n  }\n}\n</code></pre>\n<p>se transforme en :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.Title</span> {\n  <span class=\"hljs-attribute\">color</span>: $textColor;\n}\n\n<span class=\"hljs-selector-class\">.Title-icon</span> {\n  <span class=\"hljs-attribute\">border</span>: <span class=\"hljs-number\">1px</span> solid black;\n}\n</code></pre>\n<p>√âvidement, le code HTML doit √™tre mis √† jour avec les nouvelles classes, mais\nles s√©lecteurs sont maintenant courts et compr√©hensibles. Et ceci, sans aucune\nchance de collision de cascade.</p>\n<p>Maintenant, pour pouvoir mieux expliquer un dernier outil, celui qui je pense va\nr√©soudre tous nos probl√®mes, il faut que je vous montre une autre approche pour\ncontourner les probl√®mes de la cascade :</p>\n<h3>Frameworks CSS</h3>\n<p>Ici, pour √©viter √† nos r√®gles CSS d'entrer en collision, nous‚Ä¶ n'en √©crivons\nplus ! Les frameworks CSS sont des styles d√©j√† √©crits qu'on peut utiliser avec\ndes classes CSS sp√©cifiques. Il y a deux approches ici :</p>\n<ul>\n<li><p>Les frameworks de styles &quot;finaux&quot; comme <a href=\"http://getbootstrap.com\">Bootstrap</a>.\nIl suffit d'ajouter la classe <code>btn</code> sur un √©l√©ment HTML et‚Ä¶ tada ! C'est\nmaintenant un magnifique bouton. Certaines variables sont modifiables pour\ntransformer le look global du framework.</p></li>\n<li><p>Les frameworks de styles &quot;utilitaires&quot; comme <a href=\"http://tachyons.io\">Tachyons</a>.\nIci, il n'y a pas de styles pr√©-d√©finis, mais plein de classes utilitaires\nsont disponibles, comme <code>pam</code> pour donner un <em>medium padding</em> √† un √©l√©ment, ou\nencore <code>ba</code> pour lui donner une <em>border all</em> tout autour.</p></li>\n</ul>\n<p>Les frameworks utilitaires sont assez int√©ressants, du fait que le fichier CSS\nfinal fera autour de 10kB et jamais plus, m√™me si le site grandit ! Mais il y\naura beaucoup de classes peu compr√©hensibles dans le code HTML. C'est comparable\naux styles inline, avec une optimization de poids final, comme <code>ba</code> est plus\ncourt que <em>‚Äúborder-style: solid; border-width: 1px;‚Äù</em></p>\n<p>Ces frameworks nous √©vitent tout tracas avec la cascade ! Mais je n'aimais pas\nle fait d'utiliser un framework, ainsi qu'avoir beaucoup de classes non\ncompr√©hensibles dans mon code HTML. Cependant, la totale r√©utilisabilit√© et\nmodularit√© des styles, sans probl√®mes de cascade, sont impressionnants.</p>\n<p>Cela nous am√®ne donc √† cet outil g√©nial, forg√© directement avec la meilleure\nmagie JavaScript :</p>\n<h3>CSS Modules</h3>\n<p>Ce concept a d'abord pris forme suite √† une simple observation : de nos jours,\nle CSS est compil√© √† partir d'autres languages pour permettre une √©criture plus\nfacile, et pour cette m√™me raison le HTML est aussi g√©n√©r√© gr√¢ce √† des outils de\ntemplating en JavaScript. Mais les s√©lecteurs CSS, le lien entre les √©l√©ments et\nles styles, ceux-la m√™me auxquels le codeur doit faire tr√®s attention pour\n√©viter qu'ils n'entrent en collision, n'ont pas d'outils du tout.</p>\n<p>Et <a href=\"https://github.com/css-modules/css-modules\">CSS Modules</a> fut cr√©√©. La\npremi√®re fonctionnalit√© int√©ressante est la g√©n√©ration automatique des noms de\nclasses CSS. Plus d'inqui√©tude sur leur unicit√©, on peut les nommer comme on\nveut, au final ceux g√©n√©r√©s dans le HTML seront uniques. Promis. Cela nous\npermet de r√©√©crire ce code CSS en BEM, et HTML :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.Title</span> {\n  <span class=\"hljs-attribute\">color</span>: $textColor;\n}\n</code></pre>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;Title&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n</code></pre>\n<p>en ce code CSS et template JavaScript :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.styleName</span> {\n  <span class=\"hljs-attribute\">color</span>: $textColor;\n}\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> styles <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./style.css&quot;</span>;\n<span class=\"hljs-string\">`&lt;h1 class=<span class=\"hljs-subst\">${styles.styleName}</span>&gt;&lt;/h1&gt;`</span>;\n</code></pre>\n<p>Une fois compil√©, ce code g√©n√©rera quelque chose comme √ßa :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.styleName__abc5436</span> {\n  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#333333</span>;\n}\n</code></pre>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;styleName__abc5436&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n</code></pre>\n<p>Une casc-quoi ? Je ne sais pas ce que c'est ! ‚ù§Ô∏è</p>\n<p>La deuxi√®me fonctionnalit√© g√©niale, directement inspir√©e par les frameworks CSS\nmodulaires comme Tachyons, est la composition des styles. De la m√™me fa√ßon qu'en\najoutant plusieurs classes utilitaires sur son √©l√©ment HTML, CSS Modules nous\npermet de composer nos classes √† partir de styles communs. Laissez-moi vous\nmontrer :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.titleColor</span> {\n  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#333333</span>;\n}\n\n<span class=\"hljs-selector-class\">.bigTitle</span> {\n  <span class=\"hljs-attribute\">composes</span>: titleColor;\n  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">24px</span>;\n}\n\n<span class=\"hljs-selector-class\">.mediumTitle</span> {\n  <span class=\"hljs-attribute\">composes</span>: titleColor;\n  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">16px</span>;\n}\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> styles <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./style.css&quot;</span>;\n<span class=\"hljs-string\">`&lt;h1 class=<span class=\"hljs-subst\">${styles.bigTitle}</span>&gt;&lt;/h1&gt;\n &lt;h2 class=<span class=\"hljs-subst\">${styles.mediumTitle}</span>&gt;&lt;/h2&gt;`</span>;\n</code></pre>\n<p>va g√©n√©rer :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.titleColor__abc5436</span> {\n  <span class=\"hljs-attribute\">color</span>: <span class=\"hljs-number\">#333333</span>;\n}\n\n<span class=\"hljs-selector-class\">.bigTitle__def6547</span> {\n  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">24px</span>;\n}\n\n<span class=\"hljs-selector-class\">.mediumTitle__1638bcd</span> {\n  <span class=\"hljs-attribute\">font-size</span>: <span class=\"hljs-number\">16px</span>;\n}\n</code></pre>\n<pre><code class=\"hljs language-js\">&lt;h1 <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span></span>=<span class=\"hljs-string\">&quot;titleColor__abc5436 bigTitle__def6547&quot;</span>&gt;&lt;/h1&gt;\n<span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;titleColor__abc5436 mediumTitle__1638bcd&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span></span>\n</code></pre>\n<p>Et ceci, messieurs-dames, est plut√¥t fantastique. Les styles sont modularisables\net composables, et ce sans classes incompr√©hensibles mais directement dans les\nfeuilles de style. Et les collisions de s√©lecteurs et r√®gles ne sont plus qu'un\nmauvais souvenir.</p>\n<p>Et c'est ainsi que j'ai exp√©riment√© avec le CSS et sa cascade jusque-l√†.\nJ'esp√®re que les mois et les ann√©es √† venir vont me surprendre avec de meilleurs\noutils et / ou m√©thodologies, et je serais heureux de les apprendre et les\nessayer üëç</p>\n"}