{"slug":"responsive-webdesign-et-structure-du-dom","filename":"2013-12-26-responsive-webdesign-et-structure-du-dom","title":"Responsive webdesign et structure du DOM","date":"Thu, 26 Dec 2013 00:00:00 GMT","draft":false,"meta":{"date":"2013-12-26T00:00:00.000Z","title":"Responsive webdesign et structure du DOM","author":"neemzy","oldSlug":"html/responsive-dom","slug":"responsive-webdesign-et-structure-du-dom"},"body":"<p>Bien, commençons par le commencement, si tu veux bien. Le <strong>responsive\nwebdesign</strong>, ça te dit quelque chose ? Oui ? Bon. Dans ce cas, tu as peut-être\ncomme moi déjà été confronté à un cas de figure plutôt ennuyeux. Que tu sois\nadepte du <em>mobile-first</em> ou irréductible dégradateur progressiste, il est\nforcément arrivé un moment où tu t'es dit cette chose toute bête :</p>\n<blockquote>\n<p>Ce serait quand même pas mal si cet élément était ici plutôt que là. Sauf que\nnon.</p>\n</blockquote>\n<p>Le cas typique est celui d'un menu un minimum complexe, dont on réordonnerait\nvolontiers les éléments un chouïa au-dessus ou en deçà d'une certaine taille\nd'écran. Et là, il faut bien avouer qu'il n'existe pas vraiment de solution\nmiracle.</p>\n<p>J'entends déjà les plus teigneux vociférer qu'avec une meilleure réflexion en\namont, le <em>markup</em> aurait été mieux conçu et on n'en serait pas là. Bien qu'un\npeu facile, cette réponse peut s'avérer vraie dans un certain nombre de cas\n(admire la phrase du mec qui ne se mouille pas). Mais quoi qu'il en soit, si tu\nen es au stade de ce type de questionnement, c'est qu'il est de toute façon trop\ntard pour faire machine arrière.</p>\n<p>Au train où va l'innovation dans notre branche, surtout pour tout ce qui touche\nau mobile en général et à la conception web en particulier, il n'est pas exclu\nque les bouts de ficelle que je vais t'exposer ici soient obsolètes dans six\nmois, et que cet article fasse un comeback incroyable sur Twitter, les RT\nmoquant gentiment les techniques précolombiennes auxquelles nous étions réduits\nil n'y a encore pas si longtemps. Va savoir, je pourrais bien faire l'objet\nd'une célébrité paradoxalement décadente, à la Rick Astley. En attendant, il\ns'agit des seules solutions que je connais pour ce type de cas. Si tu as mieux à\nproposer, je te recommande chaudement de l'ouvrir dans les commentaires pour\nqu'on en bénéficie tous. C'est bon, on y va ? Je t'attends, moi !</p>\n<h2>À l'ancienne : Do Repeat Yourself</h2>\n<p>Imagine une page de blog, où apparaissent consécutivement le titre de l'article,\nla photo l'illustrant, et enfin le texte. Comme une photo, selon la qualité de\nta connexion, ça peut être un peu galère à charger sur mobile (et que la\nquestion des images en responsive design\n<a href=\"http://css-tricks.com/responsive-images-hard/\">est encore un sacré bordel</a>), tu\nprends la décision de passer la photo en dessous du contenu textuel pour que tes\nvisiteurs puissent lire leur article peinards même si la photo n'a pas fini de\ncharger - et tu vas même en profiter pour la remplacer par une version plus\nlight.</p>\n<p>Dans un tel cas, la meilleure solution peut encore être de dupliquer ta balise\n<code>img</code>, et de masquer l'une ou l'autre avec CSS en fonction de la taille d'écran,\ngrâce à une <code>media query</code>. Voilà un exemple rudimentaire :</p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">article</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Mon super article<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/mon/image/desktop.jpg&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;img-desktop&quot;</span> /&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>Lâche tes comm&#x27; !<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/mon/image/mobile.jpg&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;img-mobile&quot;</span> /&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">article</span>&gt;</span>\n</code></pre>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.img-desktop</span> {\n  <span class=\"hljs-comment\">/* Par défaut, l&#x27;image desktop est cachée */</span>\n  <span class=\"hljs-attribute\">display</span>: none;\n}\n\n<span class=\"hljs-keyword\">@media</span> screen <span class=\"hljs-keyword\">and</span> (<span class=\"hljs-attribute\">min-width:</span> <span class=\"hljs-number\">768px</span>) {\n  <span class=\"hljs-comment\">/* Si on est sur &quot;grand&quot; écran, on affiche l&#x27;image desktop... */</span>\n  <span class=\"hljs-selector-class\">.img-desktop</span> {\n    <span class=\"hljs-attribute\">display</span>: block;\n  }\n\n  <span class=\"hljs-comment\">/* ...et on masque l&#x27;image mobile */</span>\n  <span class=\"hljs-selector-class\">.img-mobile</span> {\n    <span class=\"hljs-attribute\">display</span>: none;\n  }\n}\n</code></pre>\n<p>Évidemment, le gros inconvénient de ce type de solution est que qui dit\nduplication de contenu dit augmentation du poids total. Dans le cas d'un contenu\npurement textuel, selon sa taille, cela peut être négligeable. J'ai ici\nvolontairement pris l'exemple le moins adapté : une image, qu'il ne faut\nabsolument pas faire charger deux fois à nos visiteurs. On va tricher un peu\navec JavaScript :</p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">article</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Mon super article<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n\n  <span class=\"hljs-comment\">&lt;!-- Ces images ne seront pas chargées car elles n&#x27;ont pas d&#x27;attribut src --&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;/mon/image/desktop.jpg&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;img-desktop&quot;</span> /&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>Lâche tes comm&#x27; !<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;/mon/image/mobile.jpg&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;img-mobile&quot;</span> /&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">noscript</span>&gt;</span>\n    <span class=\"hljs-comment\">&lt;!-- Cette image ne sera chargée que si le visiteur n&#x27;a pas activé le JS --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/mon/image/mobile.jpg&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;img-mobile img-noscript&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">noscript</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">article</span>&gt;</span>\n</code></pre>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.img-desktop</span> {\n  <span class=\"hljs-attribute\">display</span>: none;\n}\n\n<span class=\"hljs-keyword\">@media</span> screen <span class=\"hljs-keyword\">and</span> (<span class=\"hljs-attribute\">min-width:</span> <span class=\"hljs-number\">768px</span>) {\n  <span class=\"hljs-selector-class\">.img-desktop</span> {\n    <span class=\"hljs-attribute\">display</span>: block;\n  }\n\n  <span class=\"hljs-selector-class\">.img-mobile</span> {\n    <span class=\"hljs-attribute\">display</span>: none;\n  }\n}\n\n<span class=\"hljs-selector-class\">.img-noscript</span> {\n  <span class=\"hljs-comment\">/* On surcharge le style desktop pour s&#x27;assurer\n     que cette image s&#x27;affiche quelle que soit la taille de l&#x27;écran */</span>\n\n  <span class=\"hljs-attribute\">display</span>: block;\n}\n</code></pre>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">var</span> handleImages = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-comment\">// On charge les images ayant l&#x27;attribut data-src,</span>\n  <span class=\"hljs-comment\">// non encore chargées (attribut src indéfini)</span>\n  <span class=\"hljs-comment\">// et non masquées par CSS</span>\n\n  [].forEach.call(\n    <span class=\"hljs-built_in\">document</span>.querySelectorAll(<span class=\"hljs-string\">&quot;img[data-src]:not([src])&quot;</span>),\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">el</span>) </span>{\n      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">window</span>.getComputedStyle(el).display != <span class=\"hljs-string\">&quot;none&quot;</span>) {\n        el.src = el.getAttribute(<span class=\"hljs-string\">&quot;data-src&quot;</span>);\n      }\n    },\n  );\n};\n\n<span class=\"hljs-built_in\">window</span>.addEventListener(<span class=\"hljs-string\">&quot;load&quot;</span>, handleImages);\n<span class=\"hljs-built_in\">window</span>.addEventListener(<span class=\"hljs-string\">&quot;resize&quot;</span>, handleImages);\n</code></pre>\n<p>Ainsi, seules les images nécessaires seront chargées avec la page. J'applique\négalement le même traitement au <code>resize</code> ; c'est un peu bourrin, je te\nl'accorde, on pourrait probablement faire plus fin avec <code>matchMedia</code>.</p>\n<p>Dans le cas d'un visiteur naviguant sans JavaScript, seule l'image mobile est\nchargée : je pars du principe qu'étant donné qu'on ne peut pas définir laquelle\ndes deux versions de l'image est la mieux adaptée pour lui, autant lui envoyer\nla plus légère.</p>\n<h2>JS powa : enquire.js</h2>\n<p>La seconde solution peut tout à fait être réalisée &quot;à la main&quot;, mais je vais te\nparler d'une petite librairie que j'aime beaucoup et que j'ai déjà utilisée dans\nce genre de cas. Elle se nomme <a href=\"http://wicky.nillia.ms/enquire.js/\">enquire.js</a>\net permet tout simplement d'affecter des callbacks à des media queries :</p>\n<pre><code class=\"hljs language-javascript\">enquire.register(<span class=\"hljs-string\">&quot;screen and (min-width: 768px)&quot;</span>, {\n  <span class=\"hljs-attr\">match</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n    <span class=\"hljs-comment\">// L&#x27;écran fait 768px de large ou plus...</span>\n  },\n\n  <span class=\"hljs-attr\">unmatch</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n    <span class=\"hljs-comment\">// ...et ici, 767px de large ou moins.</span>\n    <span class=\"hljs-comment\">// La librairie repose sur matchMedia et matchMedia.addListener</span>\n  },\n});\n</code></pre>\n<p>Plutôt sympa, non ? Pour reprendre notre exemple de tout à l'heure (le CSS n'est\nplus nécessaire) :</p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">article</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Mon super article<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span>\n    <span class=\"hljs-attr\">data-src</span>=<span class=\"hljs-string\">&quot;/mon/image/desktop.jpg&quot;</span>\n    <span class=\"hljs-attr\">data-mobile-src</span>=<span class=\"hljs-string\">&quot;/mon/image/mobile.jpg&quot;</span>\n  /&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>Lâche tes comm&#x27; !<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">noscript</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/mon/image/mobile.jpg&quot;</span> /&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">noscript</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">article</span>&gt;</span>\n</code></pre>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">var</span> content = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">&quot;p&quot;</span>),\n  switchImage = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">isMobile</span>) </span>{\n    <span class=\"hljs-keyword\">var</span> attr = isMobile ? <span class=\"hljs-string\">&quot;data-mobile-src&quot;</span> : <span class=\"hljs-string\">&quot;data-src&quot;</span>;\n\n    [].forEach.call(<span class=\"hljs-built_in\">document</span>.querySelectorAll(<span class=\"hljs-string\">&quot;img[&quot;</span> + attr + <span class=\"hljs-string\">&quot;]&quot;</span>), <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">\n      el,\n    </span>) </span>{\n      <span class=\"hljs-comment\">// On affecte l&#x27;une ou l&#x27;autre source à notre image,</span>\n      <span class=\"hljs-comment\">// entraînant son chargement si nécessaire.</span>\n      el.src = el.getAttribute(attr);\n\n      <span class=\"hljs-comment\">// On en profite pour la bouger avant ou après le contenu</span>\n      content.parentNode.insertBefore(\n        el,\n        isMobile ? content.nextSibling : content,\n      );\n    });\n  };\n\nenquire.register(<span class=\"hljs-string\">&quot;screen and (min-width: 768px)&quot;</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  switchImage(<span class=\"hljs-literal\">false</span>);\n});\n\nenquire.register(<span class=\"hljs-string\">&quot;screen and (max-width: 767px)&quot;</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  switchImage(<span class=\"hljs-literal\">true</span>);\n});\n</code></pre>\n<p>On peut ainsi gérer facilement le chargement de l'image, ainsi que son\nemplacement. J'utilise ici deux handlers distincts pour m'assurer qu'enquire\nfait bien son boulot au chargement aussi, dans tous les cas (les callbacks\n<code>unmatch</code> ne sont appelés qu'au redimensionnement, semble-t-il : avec un seul\nhandler, l'image n'arrive donc jamais si on charge la page avec un écran d'une\nlargeur inférieure à 768px).</p>\n<h2>That's all you've got, bitch?</h2>\n<p>On peut également, puisque tu y tiens tant, évoquer d'autres solutions plus\nmarginales mais qui méritent d'être citées.</p>\n<h3>Foundation</h3>\n<p><a href=\"http://foundation.zurb.com/\">Foundation</a> propose, dans sa version 5 (et\npeut-être même avant, j'ai pas vérifié) un peu de sucre syntaxique HTML\npermettant de switcher (via JS, œuf corse) simplement entre différents contenus\npour l'élément sur lequel on l'utilise.</p>\n<p>C'est pas mal. Ça donne ça (tiré de\n<a href=\"http://foundation.zurb.com/docs/components/interchange.html\">la doc</a>) :</p>\n<blockquote>\n<p>We use the data-interchange attribute on a markup container (probably a div)\nto do this. Here's an example which loads up a small, static map on mobile, a\nlarger static map for medium-sized devices, and a full interactive Google map\non large display devices.</p>\n</blockquote>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>\n  <span class=\"hljs-attr\">data-interchange</span>=<span class=\"hljs-string\">&quot;[../examples/interchange/default.html, (small)],\n                       [../examples/interchange/medium.html, (medium)],\n                       [../examples/interchange/large.html, (large)]&quot;</span>\n&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">data-alert</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;alert-box secondary radius&quot;</span>&gt;</span>\n    This is the default content.\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;#&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;close&quot;</span>&gt;</span><span class=\"hljs-symbol\">&amp;times;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n</code></pre>\n<p><code>small</code>, <code>medium</code> et <code>large</code> étant des raccourcis pour des media queries données\n(c'est dans\n<a href=\"http://foundation.zurb.com/docs/components/interchange.html\">la doc</a>, toujours.\nJ'insiste.)</p>\n<h3>Flexbox (pas toi, David)</h3>\n<p>On peut également, comme l'a très justement souligné lionelB, se pencher (mais\npas trop) sur le cas de Flexbox, qui est un nouveau type de positionnement\nintroduit en CSS3. La <a href=\"http://caniuse.com/#search=flexbox\">compatibilité</a> n'est\npas encore au top (surtout grâce à IE, qui l'eût cru) mais autant se tenir prêts\n! Pour ceux qui ont dormi, en gros, tu définis un conteneur :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.flex-container</span> {\n  <span class=\"hljs-attribute\">display</span>: flex;\n\n  <span class=\"hljs-comment\">/* ou bien */</span>\n\n  <span class=\"hljs-attribute\">display</span>: inline-flex;\n}\n</code></pre>\n<p>...et tu donnes des numéros à ses enfants, comme à Bangkok :</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.title</span> {\n  <span class=\"hljs-attribute\">order</span>: <span class=\"hljs-number\">1</span>;\n}\n\n<span class=\"hljs-selector-class\">.content</span> {\n  <span class=\"hljs-attribute\">order</span>: <span class=\"hljs-number\">2</span>;\n}\n\n<span class=\"hljs-selector-class\">.image</span> {\n  <span class=\"hljs-attribute\">order</span>: <span class=\"hljs-number\">3</span>;\n}\n\n<span class=\"hljs-comment\">/*\nBien sûr, tu as été assez malin pour mettre ton image en dernier dans le DOM...\n...n&#x27;est-ce pas ?\n*/</span>\n\n<span class=\"hljs-keyword\">@media</span> screen <span class=\"hljs-keyword\">and</span> (<span class=\"hljs-attribute\">min-width:</span> <span class=\"hljs-number\">768px</span>) {\n  <span class=\"hljs-selector-class\">.content</span> {\n    <span class=\"hljs-attribute\">order</span>: <span class=\"hljs-number\">3</span>;\n  }\n\n  <span class=\"hljs-selector-class\">.image</span> {\n    <span class=\"hljs-attribute\">order</span>: <span class=\"hljs-number\">2</span>;\n  }\n}\n</code></pre>\n<p>Et voilà, pas besoin d'avoir fait Polly Pocket pour percevoir à quel point la\nflexibilité et la propreté du code que cette technique nous permet d'écrire\nrésolvent notre problème en deux secondes douze. Ce n'est évidemment ici que la\npartie émergée du flexberg ; il y a des tas de bonnes ressources qui vous\nexpliqueront ça en long, en large et en travers bien mieux que moi, notamment\n<a href=\"http://www.adobe.com/devnet/html5/articles/working-with-flexbox-the-new-spec.html\">cet article</a>\nsur lequel j'ai honteusement pompé les snippets de cette partie.</p>\n<h2>Conclusion</h2>\n<p>Comme tu l'as vu, rien de ce que je t'ai montré n'est réellement satisfaisant :\npour pouvoir contrôler le positionnement d'un élément dans le DOM dans le cadre\nd'un webdesign responsive, tu dois soit le dupliquer et jouer à cache-cache,\nsoit le déplacer avec JavaScript. Aussi, je serais ravi que tu partages ton\nopinion, tes idées ou tes retours d'XP à ce sujet. Ça me fera de la lecture pour\npasser le temps, et toi tu feras quelque chose de constructif !</p>\n<p>Il est temps pour moi de te laisser reprendre le cours de ta vie. Peut-être nos\nroutes se croiseront-elles de nouveau. Dans l'intervalle, va, vis, et code !</p>\n"}